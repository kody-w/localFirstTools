<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronicles of the Fallen Kingdom - Interactive D&D Game</title>
    <style>
        :root {
            --primary: #7c3aed;
            --secondary: #d97706;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #dc2626;
            --dark: #1e1b4b;
            --gold: #fbbf24;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #0f0a1e 0%, #1e1b4b 50%, #312e81 100%);
            color: #e5e7eb;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        .game-header {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(124,58,237,0.3) 0%, rgba(217,119,6,0.3) 100%);
            border-radius: 12px;
            border: 2px solid var(--gold);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .game-header::before {
            content: '‚öîÔ∏è üêâ ‚öîÔ∏è';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
            opacity: 0.2;
        }

        .game-title {
            font-size: 3rem;
            color: var(--gold);
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
            margin-bottom: 0.5rem;
            position: relative;
        }

        .game-subtitle {
            font-size: 1.2rem;
            color: #d1d5db;
            font-style: italic;
        }

        /* Main Game Layout */
        .game-layout {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 1200px) {
            .game-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Party Panel */
        .party-panel {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid var(--primary);
            height: fit-content;
            position: sticky;
            top: 1rem;
        }

        .panel-title {
            color: var(--gold);
            font-size: 1.3rem;
            margin-bottom: 1rem;
            text-align: center;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 0.5rem;
        }

        .character-card {
            background: linear-gradient(135deg, rgba(124,58,237,0.2) 0%, rgba(124,58,237,0.1) 100%);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 2px solid var(--primary);
            cursor: pointer;
            transition: all 0.3s;
        }

        .character-card:hover {
            transform: translateY(-2px);
            border-color: var(--gold);
            box-shadow: 0 4px 12px rgba(251,191,36,0.3);
        }

        .character-card.selected {
            border-color: var(--gold);
            background: linear-gradient(135deg, rgba(251,191,36,0.3) 0%, rgba(217,119,6,0.2) 100%);
        }

        .character-name {
            font-size: 1.1rem;
            color: var(--gold);
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .character-class {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-bottom: 0.75rem;
        }

        .stat-bar {
            margin-bottom: 0.5rem;
        }

        .stat-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .hp-bar { background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%); }
        .resource-bar { background: linear-gradient(90deg, #7c3aed 0%, #8b5cf6 100%); }

        /* Story Panel */
        .story-panel {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 2rem;
            border: 2px solid var(--secondary);
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }

        .story-content {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 1.5rem;
            padding-right: 1rem;
        }

        .story-content::-webkit-scrollbar {
            width: 8px;
        }

        .story-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
        }

        .story-content::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 4px;
        }

        .story-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #e5e7eb;
            margin-bottom: 1.5rem;
            text-align: justify;
        }

        .story-text.emphasis {
            color: var(--gold);
            font-weight: bold;
            font-size: 1.2rem;
            text-align: center;
            margin: 2rem 0;
        }

        .choices-container {
            display: grid;
            gap: 1rem;
        }

        .choice-button {
            background: linear-gradient(135deg, rgba(124,58,237,0.3) 0%, rgba(124,58,237,0.1) 100%);
            border: 2px solid var(--primary);
            color: #e5e7eb;
            padding: 1.25rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            text-align: left;
            font-family: 'Georgia', serif;
        }

        .choice-button:hover {
            background: linear-gradient(135deg, rgba(251,191,36,0.3) 0%, rgba(217,119,6,0.2) 100%);
            border-color: var(--gold);
            transform: translateX(5px);
        }

        .choice-button.skill-check {
            border-color: var(--warning);
        }

        .choice-button.skill-check::before {
            content: 'üé≤ ';
        }

        .choice-button.combat {
            border-color: var(--danger);
        }

        .choice-button.combat::before {
            content: '‚öîÔ∏è ';
        }

        /* Dice Roller */
        .dice-roller {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0,0,0,0.95);
            padding: 3rem;
            border-radius: 20px;
            border: 3px solid var(--gold);
            z-index: 1000;
            text-align: center;
            transition: all 0.5s;
            box-shadow: 0 0 50px rgba(251,191,36,0.5);
        }

        .dice-roller.active {
            transform: translate(-50%, -50%) scale(1);
        }

        .dice-display {
            font-size: 8rem;
            margin-bottom: 1rem;
            animation: spin 0.5s ease-in-out;
        }

        @keyframes spin {
            0% { transform: rotate(0deg) scale(0.5); opacity: 0; }
            50% { transform: rotate(360deg) scale(1.2); }
            100% { transform: rotate(720deg) scale(1); opacity: 1; }
        }

        .dice-result {
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 1rem;
        }

        .dice-modifiers {
            font-size: 1.2rem;
            color: #9ca3af;
            margin-bottom: 1.5rem;
        }

        .dice-outcome {
            font-size: 1.5rem;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: bold;
        }

        .dice-outcome.success {
            background: var(--success);
            color: white;
        }

        .dice-outcome.failure {
            background: var(--danger);
            color: white;
        }

        /* Combat Screen */
        .combat-screen {
            display: none;
        }

        .combat-screen.active {
            display: block;
        }

        .combat-header {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(220,38,38,0.4) 0%, rgba(127,29,29,0.4) 100%);
            border-radius: 12px;
            border: 3px solid var(--danger);
            margin-bottom: 2rem;
        }

        .combat-title {
            font-size: 2.5rem;
            color: #fca5a5;
            margin-bottom: 0.5rem;
        }

        .combatants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .combatant-card {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 1.5rem;
            border: 3px solid #4b5563;
            transition: all 0.3s;
        }

        .combatant-card.active-turn {
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(251,191,36,0.5);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(251,191,36,0.5); }
            50% { box-shadow: 0 0 40px rgba(251,191,36,0.8); }
        }

        .combatant-card.enemy {
            border-color: var(--danger);
        }

        .combatant-card.ally {
            border-color: var(--primary);
        }

        .combatant-card.dead {
            opacity: 0.4;
            filter: grayscale(100%);
        }

        .combat-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            padding: 1.5rem;
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            border: 2px solid var(--primary);
        }

        .action-button {
            background: linear-gradient(135deg, var(--primary) 0%, #6d28d9 100%);
            border: none;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            font-family: 'Georgia', serif;
        }

        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(124,58,237,0.5);
        }

        .action-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }

        /* Combat Log */
        .combat-log {
            background: rgba(0,0,0,0.6);
            border-radius: 8px;
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
            border: 2px solid #4b5563;
        }

        .log-entry {
            padding: 0.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9rem;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-entry.damage {
            color: #fca5a5;
        }

        .log-entry.heal {
            color: #6ee7b7;
        }

        .log-entry.miss {
            color: #9ca3af;
        }

        /* Info Panel */
        .info-panel {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid var(--success);
            height: fit-content;
            position: sticky;
            top: 1rem;
        }

        .quest-tracker {
            margin-bottom: 1.5rem;
        }

        .quest-item {
            padding: 0.75rem;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            border-left: 3px solid var(--warning);
        }

        .quest-title {
            font-weight: bold;
            color: var(--gold);
            margin-bottom: 0.25rem;
        }

        .quest-progress {
            font-size: 0.85rem;
            color: #9ca3af;
        }

        /* Inventory */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .inventory-item {
            padding: 0.75rem;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            border: 2px solid #4b5563;
            font-size: 0.85rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .inventory-item:hover {
            border-color: var(--gold);
        }

        .inventory-item.legendary {
            border-color: var(--warning);
            background: linear-gradient(135deg, rgba(251,191,36,0.2) 0%, rgba(217,119,6,0.1) 100%);
        }

        .inventory-item.rare {
            border-color: var(--primary);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            font-family: 'Georgia', serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #6d28d9 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(124,58,237,0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #b91c1c 100%);
            color: white;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            padding: 2rem;
            border-radius: 16px;
            border: 3px solid var(--gold);
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 1rem;
            text-align: center;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: center;
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Save/Load Menu */
        .save-menu {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            border: 2px solid var(--primary);
        }

        .save-menu h3 {
            color: var(--gold);
            margin-bottom: 1rem;
        }

        .save-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .save-buttons button {
            flex: 1;
            min-width: 100px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">‚öîÔ∏è Chronicles of the Fallen Kingdom ‚öîÔ∏è</h1>
            <p class="game-subtitle">"When the crimson moon rises, the ancient seal shall break..."</p>
        </div>

        <!-- Main Game Screen -->
        <div id="mainGame" class="game-layout">
            <!-- Left: Party Panel -->
            <div class="party-panel">
                <h2 class="panel-title">üõ°Ô∏è Your Party</h2>
                <div id="partyContainer"></div>

                <div class="save-menu">
                    <h3>üíæ Game State</h3>
                    <div class="save-buttons">
                        <button class="btn btn-primary" onclick="game.saveGame()">Save</button>
                        <button class="btn btn-primary" onclick="game.loadGame()">Load</button>
                        <button class="btn btn-danger" onclick="game.resetGame()">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Center: Story Panel -->
            <div class="story-panel">
                <div class="story-content" id="storyContent"></div>
                <div class="choices-container" id="choicesContainer"></div>
            </div>

            <!-- Right: Info Panel -->
            <div class="info-panel">
                <h2 class="panel-title">üìú Quest Log</h2>
                <div class="quest-tracker" id="questTracker"></div>

                <h2 class="panel-title">üí∞ Resources</h2>
                <div id="resourcesDisplay"></div>

                <h2 class="panel-title">üíé Inventory</h2>
                <div class="inventory-grid" id="inventoryGrid"></div>
            </div>
        </div>

        <!-- Combat Screen -->
        <div id="combatScreen" class="combat-screen">
            <div class="combat-header">
                <h2 class="combat-title">‚öîÔ∏è COMBAT ‚öîÔ∏è</h2>
                <p id="combatDescription"></p>
            </div>

            <div class="combatants-grid" id="combatantsGrid"></div>

            <div class="combat-actions" id="combatActions"></div>

            <div class="combat-log" id="combatLog"></div>
        </div>

        <!-- Dice Roller -->
        <div id="diceRoller" class="dice-roller">
            <div class="dice-display" id="diceDisplay">üé≤</div>
            <div class="dice-result" id="diceResult"></div>
            <div class="dice-modifiers" id="diceModifiers"></div>
            <div class="dice-outcome" id="diceOutcome"></div>
        </div>

        <!-- Modals -->
        <div id="levelUpModal" class="modal">
            <div class="modal-content">
                <h2 class="modal-title">‚≠ê LEVEL UP! ‚≠ê</h2>
                <div id="levelUpContent"></div>
                <div class="modal-buttons">
                    <button class="btn btn-success" onclick="game.closeLevelUp()">Continue</button>
                </div>
            </div>
        </div>

        <div id="gameOverModal" class="modal">
            <div class="modal-content">
                <h2 class="modal-title" id="gameOverTitle"></h2>
                <div id="gameOverContent"></div>
                <div class="modal-buttons">
                    <button class="btn btn-primary" onclick="game.resetGame()">New Game</button>
                    <button class="btn btn-success" onclick="game.loadGame()">Load Save</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== GAME ENGINE =====
        class DnDGame {
            constructor() {
                this.party = this.createParty();
                this.currentStory = 'intro';
                this.gameState = {
                    chapter: 1,
                    daysRemaining: 12,
                    crimsonMoonPhase: 0,
                    gold: 47350,
                    xp: 94500,
                    xpToNextLevel: 100000,
                    questsCompleted: [],
                    enemiesDefeated: 347,
                    artifactsCollected: [],
                    alliesRecruited: []
                };
                this.inventory = this.createInventory();
                this.inCombat = false;
                this.currentCombat = null;
                this.init();
            }

            init() {
                this.render();
                this.loadStory('intro');
            }

            createParty() {
                return [
                    {
                        id: 'theron',
                        name: 'Theron Stormbreaker',
                        class: 'Fighter',
                        level: 11,
                        hp: 102,
                        maxHp: 102,
                        ac: 19,
                        str: 20,
                        dex: 14,
                        con: 18,
                        int: 10,
                        wis: 12,
                        cha: 14,
                        attack: 9,
                        damage: '2d6+7',
                        abilities: ['Action Surge', 'Second Wind', 'Indomitable'],
                        equipment: ['Greatsword of Giant Slaying +2', 'Plate Armor of Fire Resistance'],
                        spellSlots: null,
                        conditions: []
                    },
                    {
                        id: 'lyra',
                        name: 'Lyra Moonshadow',
                        class: 'Wizard',
                        level: 11,
                        hp: 68,
                        maxHp: 68,
                        ac: 16,
                        str: 8,
                        dex: 16,
                        con: 14,
                        int: 20,
                        wis: 16,
                        cha: 12,
                        spellDC: 17,
                        spellSlots: { 1: 4, 2: 3, 3: 3, 4: 3, 5: 2, 6: 1 },
                        maxSpellSlots: { 1: 4, 2: 3, 3: 3, 4: 3, 5: 2, 6: 1 },
                        spells: ['Fireball', 'Counterspell', 'Shield', 'Misty Step', 'Dimension Door'],
                        equipment: ['Staff of Power', 'Robe of the Archmagi'],
                        conditions: []
                    },
                    {
                        id: 'kael',
                        name: 'Kael Swiftarrow',
                        class: 'Ranger',
                        level: 11,
                        hp: 88,
                        maxHp: 88,
                        ac: 17,
                        str: 14,
                        dex: 20,
                        con: 16,
                        int: 12,
                        wis: 18,
                        cha: 14,
                        attack: 10,
                        damage: '1d8+5',
                        rangedDamage: '1d8+8',
                        abilities: ["Hunter's Mark", 'Colossus Slayer'],
                        equipment: ['Oathbow +2', 'Cloak of Elvenkind'],
                        spellSlots: { 1: 4, 2: 3, 3: 3 },
                        maxSpellSlots: { 1: 4, 2: 3, 3: 3 },
                        conditions: []
                    },
                    {
                        id: 'seraphina',
                        name: 'Seraphina Lightbringer',
                        class: 'Cleric',
                        level: 11,
                        hp: 95,
                        maxHp: 95,
                        ac: 18,
                        str: 16,
                        dex: 12,
                        con: 18,
                        int: 10,
                        wis: 20,
                        cha: 16,
                        spellDC: 16,
                        spellSlots: { 1: 4, 2: 3, 3: 3, 4: 3, 5: 2, 6: 1 },
                        maxSpellSlots: { 1: 4, 2: 3, 3: 3, 4: 3, 5: 2, 6: 1 },
                        spells: ['Cure Wounds', 'Spiritual Weapon', 'Revivify', 'Heal'],
                        equipment: ['Mace of Disruption +2', 'Plate Armor of Radiance'],
                        abilities: ['Channel Divinity', 'Divine Strike'],
                        conditions: []
                    }
                ];
            }

            createInventory() {
                return [
                    { name: 'Potion of Superior Healing', count: 2, effect: 'heal8d4+8', rarity: 'rare' },
                    { name: 'Scroll of Revivify', count: 1, effect: 'revive', rarity: 'rare' },
                    { name: 'Immovable Rod', count: 1, effect: 'utility', rarity: 'uncommon' },
                    { name: 'Bag of Holding', count: 1, effect: 'storage', rarity: 'uncommon' }
                ];
            }

            // ===== STORY ENGINE =====
            loadStory(storyId) {
                const stories = {
                    intro: {
                        text: `The crimson moon hangs low in the night sky, casting an eerie red glow over the Kingdom of Elendor.

                        You stand in the War Room of Valorhold's Silver Knights headquarters, maps spread before you. Captain Elara Brightshield's face is grim.

                        "Heroes," she says, her voice heavy. "Oracle Celestia has confirmed what we feared. Lord Malachar‚Äîthe King's most trusted advisor for twenty years‚Äîis actually Azaroth the Undying, an ancient lich. In twelve days, when the crimson moon reaches its zenith, his ritual will plunge our kingdom into eternal darkness."

                        She gestures to the map. "We have three paths before us, and time for only one."

                        The room falls silent. This decision will determine the fate of the kingdom.`,
                        choices: [
                            {
                                text: '‚öîÔ∏è "We storm Azaroth\'s fortress NOW. No artifacts, no waiting‚Äîwe end this with steel and spell!"',
                                type: 'combat',
                                leads: 'combatAzarothDirect',
                                difficulty: 'deadly',
                                description: '(Deadly encounter - 5% success chance)'
                            },
                            {
                                text: 'üìú "We need the artifacts. The Blade, the Orb, and the Crown‚Äîall three. It\'s the only way to seal him permanently."',
                                type: 'quest',
                                leads: 'questArtifacts',
                                description: '(Epic quest chain - moderate difficulty)'
                            },
                            {
                                text: 'üé≤ "Let me scout the fortress first. I can sneak in, learn his defenses, maybe sabotage the ritual." (Kael - Stealth Check DC 18)',
                                type: 'skill',
                                character: 'kael',
                                skill: 'stealth',
                                dc: 18,
                                successLeads: 'scoutSuccess',
                                failureLeads: 'scoutFailure'
                            },
                            {
                                text: 'üí° "What if there\'s another way? Azaroth was once mortal. Maybe we can find his phylactery without confronting him directly."',
                                type: 'investigation',
                                leads: 'phylacteryHunt'
                            },
                            {
                                text: 'üåü SHOWCASE: Experience the most EPIC scenarios',
                                type: 'quest',
                                leads: 'showcaseMenu',
                                description: '(Jump to mind-blowing story moments)'
                            }
                        ]
                    },

                    showcaseMenu: {
                        text: `‚ö° EPIC SCENARIO SHOWCASE ‚ö°

                        Experience the most mind-blowing, out-of-the-box story moments this adventure has to offer!

                        Each scenario demonstrates the power of choice-driven narrative, moral complexity, and consequence-laden decision making.

                        Choose your experience:`,
                        choices: [
                            {
                                text: '‚è≥ TIME PARADOX - Your future selves arrive with warnings. One question. Infinite consequences.',
                                type: 'quest',
                                leads: 'timeParadox',
                                description: '(Temporal mechanics, butterfly effect)'
                            },
                            {
                                text: 'üêâ DRAGON\'S BARGAIN - Negotiate with an ancient dragon. Chess, stories, or combat?',
                                type: 'quest',
                                leads: 'dragonNegotiation',
                                description: '(Multiple creative solutions)'
                            },
                            {
                                text: '‚öñÔ∏è MORAL DILEMMA - Kill one to save thousands? Or sacrifice your eternal soul?',
                                type: 'quest',
                                leads: 'moralDilemma',
                                description: '(No right answers, only consequences)'
                            },
                            {
                                text: 'üß† PSYCHIC MAZE - Enter your party\'s collective nightmares. Face your deepest fears.',
                                type: 'quest',
                                leads: 'psychicMaze',
                                description: '(Character-driven psychological drama)'
                            },
                            {
                                text: 'üëë POLITICAL INTRIGUE - Unite five kingdoms. Find the traitor. One speech to rule them all.',
                                type: 'quest',
                                leads: 'politicalIntrigue',
                                description: '(Diplomacy, deception, detection)'
                            },
                            {
                                text: 'üï∑Ô∏è UNDERDARK DESCENT - Mind Flayers, Beholders, Drow, or Demons? Pick your nightmare.',
                                type: 'quest',
                                leads: 'underdarkDescent',
                                description: '(Classic dungeon crawl with impossible choices)'
                            },
                            {
                                text: 'üíî BETRAYAL TWIST - Everything you knew was a lie. Seconds to act.',
                                type: 'quest',
                                leads: 'betrayalTwist',
                                description: '(Narrative shock, desperate measures)'
                            },
                            {
                                text: 'üåå COSMIC HORROR - The true threat is revealed. Mortality is meaningless.',
                                type: 'quest',
                                leads: 'cosmicHorror',
                                description: '(Lovecraftian existential dread)'
                            },
                            {
                                text: '‚öîÔ∏è FINAL STAND - 50,000 soldiers. One last battle. Every choice matters.',
                                type: 'quest',
                                leads: 'finalStand',
                                description: '(Epic climax, multiple victory conditions)'
                            },
                            {
                                text: 'üåÖ AFTERMATH - You won. Now what? The hardest choice is what comes next.',
                                type: 'quest',
                                leads: 'aftermath',
                                description: '(Epilogue with lasting consequences)'
                            }
                        ]
                    },

                    scoutSuccess: {
                        text: `Kael moves like a shadow through the ancient catacombs beneath Valorhold. His elven eyes pierce the darkness, and his ranger training allows him to avoid every trap, every patrol.

                        Deep in the fortress, he discovers Azaroth's inner sanctum. The lich is there, chanting over a massive ritual circle. But more importantly, Kael spots it‚Äîa obsidian box on a pedestal, pulsing with dark energy. The phylactery!

                        He also overhears crucial information: Azaroth has sent half his forces north to retrieve the final component for the ritual. The fortress is undermanned!

                        Kael returns to the party with intelligence that changes everything.

                        +5,000 XP (Legendary Scout Mission)
                        New Quest Unlocked: "Strike While Undermanned"`,
                        choices: [
                            {
                                text: '‚öîÔ∏è Attack NOW while half his forces are away! We can destroy the phylactery and end this.',
                                type: 'combat',
                                leads: 'combatAzarothWeakened',
                                difficulty: 'hard'
                            },
                            {
                                text: 'üéØ Send Finn to steal the phylactery while Azaroth is distracted. Then confront him.',
                                type: 'heist',
                                leads: 'phylacteryHeist'
                            }
                        ]
                    },

                    scoutFailure: {
                        text: `Kael moves silently through the catacombs... but not silently enough.

                        A skeleton patrol spots him. Kael takes down two with swift arrows, but a third escapes, sounding the alarm!

                        "INTRUDERS IN THE SANCTUM!"

                        The party hears the alarm bells from above. Within minutes, Azaroth knows you're planning an attack. He begins accelerating the ritual‚Äîthe crimson moon pulses brighter.

                        "We just lost our element of surprise," Captain Elara says grimly. "And we've lost three days. The lich is on high alert now. We need a new plan, fast."

                        Days Remaining: 9 (lost 3 days!)
                        Azaroth's Alert Level: Maximum`,
                        choices: [
                            {
                                text: '‚öîÔ∏è No choice now‚Äîwe attack before he finishes accelerating the ritual!',
                                type: 'combat',
                                leads: 'combatAzarothAlert',
                                difficulty: 'deadly'
                            },
                            {
                                text: 'üìú We need the artifacts more than ever. Rush to get at least the Blade!',
                                type: 'quest',
                                leads: 'bladeQuest'
                            }
                        ]
                    },

                    questArtifacts: {
                        text: `Captain Elara nods approvingly. "The wise choice. Oracle Celestia has divined the locations of all three artifacts."

                        She unrolls an ancient map:

                        ‚öîÔ∏è THE BLADE OF THE FIRST KING - Sunken Crypt of King Aldric I, beneath Lake Moonshadow. Guarded by water elementals and drowned undead. Estimated time: 2 days.

                        üîÆ THE ORB OF ETERNAL NIGHT - Ruins of Shadowpeak, in the dragon's lair atop the mountain. The storm giant Thrandak may help... if you can earn his favor. Estimated time: 3 days.

                        üëë THE CROWN OF BINDING SOULS - Royal Vault beneath the palace... which is now Azaroth's territory. Most dangerous, but closest. Estimated time: 2 days if we're smart.

                        "You have twelve days total," Elara reminds you. "Choose your first target carefully."`,
                        choices: [
                            {
                                text: '‚öîÔ∏è The Blade first - it\'s underwater but straightforward. We can do this in 2 days.',
                                type: 'quest',
                                leads: 'bladeQuest'
                            },
                            {
                                text: 'üîÆ The Orb - we need to know where the phylactery is. Plus, dragon loot!',
                                type: 'quest',
                                leads: 'orbQuest'
                            },
                            {
                                text: 'üëë The Crown - high risk, high reward. It\'s right under our noses.',
                                type: 'quest',
                                leads: 'crownQuest'
                            },
                            {
                                text: 'üí° Can we split the party? Send two teams to get two artifacts simultaneously?',
                                type: 'dialogue',
                                leads: 'splitParty'
                            }
                        ]
                    },

                    bladeQuest: {
                        text: `QUEST: THE BLADE OF THE FIRST KING

                        You stand at the shore of Lake Moonshadow. The water is impossibly dark, and according to legend, the crypt lies 200 feet below the surface.

                        Lyra casts Water Breathing on the party. "This will last 24 hours. We dive at dawn."

                        As you descend into the murky depths, the ruins of an ancient underwater palace come into view. Gothic spires covered in algae, statues of forgotten kings...

                        And guarding the entrance: THREE WATER ELEMENTALS (CR 5 each).

                        They swirl menacingly, blocking your path to the tomb.`,
                        choices: [
                            {
                                text: '‚öîÔ∏è FIGHT! We can take three elementals!',
                                type: 'combat',
                                leads: 'combatElementals'
                            },
                            {
                                text: 'üé≤ Try to parley with them (Seraphina - Persuasion DC 16)',
                                type: 'skill',
                                character: 'seraphina',
                                skill: 'persuasion',
                                dc: 16,
                                successLeads: 'elementalPeace',
                                failureLeads: 'combatElementals'
                            },
                            {
                                text: 'üîÆ Lyra can cast Dispel Magic to weaken them first',
                                type: 'spell',
                                character: 'lyra',
                                spell: 'dispel',
                                leads: 'dispelElementals'
                            }
                        ]
                    },

                    // ===== EPIC PROMPT SHOWCASE STORIES =====

                    timeParadox: {
                        text: `‚è≥ THE TEMPORAL CONVERGENCE ‚è≥

                        The air shimmers and cracks open. From the rift steps... YOUR PARTY. But older. Battle-scarred. Missing limbs.

                        Future-Theron speaks, his voice hollow: "We failed. Azaroth won. The kingdom burned for thirty years. We discovered a way back, but we can only give you ONE piece of information before the paradox collapses."

                        Future-Lyra clutches a temporal crystal that's already crumbling: "Choose wisely. The timeline is fracturing."

                        Future-Seraphina adds, tears streaming: "Some of us... don't exist in all futures anymore. Kael... Kael didn't make it past the third artifact."

                        Future-Kael's ghost flickers beside them, translucent but smiling sadly: "Choose the question that saves the most lives. Not just mine."

                        The crystal pulses. You have seconds.`,
                        choices: [
                            {
                                text: 'üîÆ "WHERE is Azaroth\'s phylactery hidden?"',
                                type: 'quest',
                                leads: 'phylacteryRevealed'
                            },
                            {
                                text: '‚öîÔ∏è "WHAT is Azaroth\'s one weakness we can exploit?"',
                                type: 'quest',
                                leads: 'weaknessRevealed'
                            },
                            {
                                text: 'üíÄ "WHO in our ranks is the traitor?"',
                                type: 'quest',
                                leads: 'traitorRevealed'
                            },
                            {
                                text: 'üé≤ "HOW do we save Kael?" (Seraphina - Insight DC 20 to read Future-Kael\'s expression)',
                                type: 'skill',
                                character: 'seraphina',
                                skill: 'insight',
                                dc: 20,
                                successLeads: 'kaelSaved',
                                failureLeads: 'temporalCollapse'
                            },
                            {
                                text: 'üåü Lyra attempts to STABILIZE the paradox and ask ALL questions (Arcana DC 25 - LEGENDARY)',
                                type: 'skill',
                                character: 'lyra',
                                skill: 'arcana',
                                dc: 25,
                                successLeads: 'allAnswers',
                                failureLeads: 'temporalDisaster'
                            }
                        ]
                    },

                    dragonNegotiation: {
                        text: `üêâ THE DRAGON'S BARGAIN üêâ

                        Volcrath the Ancient, a colossal red dragon whose scales shimmer with the heat of a thousand forges, coils around mountains of gold. His eye‚Äîlarger than your entire body‚Äîstudies you with terrifying intelligence.

                        "Mortals dare enter my domain seeking the Orb of Eternal Night? AMUSING."

                        His laugh shakes the cavern, sending stalactites crashing down.

                        "I could incinerate you all before your hearts beat twice. But... I am BORED. Entertain me, and perhaps I shall be... generous."

                        He gestures to a massive chessboard made of obsidian and ruby. "Win, and take the Orb. Lose, and become my eternal servants, polishing my hoard for the next millennium."

                        Then his head tilts. "Unless... you have something MORE interesting to offer?"`,
                        choices: [
                            {
                                text: '‚ôüÔ∏è Accept the chess challenge (Theron - Intelligence DC 18... he\'s never lost a game)',
                                type: 'skill',
                                character: 'theron',
                                skill: 'int',
                                dc: 18,
                                successLeads: 'chessVictory',
                                failureLeads: 'chessDefeat'
                            },
                            {
                                text: 'üìñ "I\'ll tell you a story you\'ve never heard‚Äîabout how YOUR kind began." (Lyra - History DC 22)',
                                type: 'skill',
                                character: 'lyra',
                                skill: 'history',
                                dc: 22,
                                successLeads: 'dragonEnchanted',
                                failureLeads: 'dragonBored'
                            },
                            {
                                text: 'üíé "What if we could give you something worth MORE than entertainment? Information about Azaroth\'s dragon-slaying weapon?"',
                                type: 'quest',
                                leads: 'dragonAlliance'
                            },
                            {
                                text: 'üéµ Kael plays the ancient elven ballad of Volcrath\'s lost mate (Performance DC 20 - RISKY)',
                                type: 'skill',
                                character: 'kael',
                                skill: 'performance',
                                dc: 20,
                                successLeads: 'dragonTears',
                                failureLeads: 'dragonRage'
                            },
                            {
                                text: '‚öîÔ∏è "We challenge your CHAMPION to single combat. If our warrior wins, we take the Orb AND half your hoard."',
                                type: 'combat',
                                leads: 'combatDragonChampion',
                                difficulty: 'deadly'
                            },
                            {
                                text: 'üé≠ Seraphina reveals her divine blessing: "I carry the mark of Bahamut. Will you defy a platinum dragon\'s chosen?"',
                                type: 'quest',
                                leads: 'bahamutRevelation'
                            }
                        ]
                    },

                    moralDilemma: {
                        text: `‚öñÔ∏è THE WEIGHT OF SOULS ‚öñÔ∏è

                        You've cornered Azaroth's second-in-command, Lady Vesper‚Äîonce the kingdom's beloved princess before her corruption. She's bound, powerless, her dark magic sealed.

                        But she reveals a horrifying truth: "My soul is BOUND to the village of Millbrook. 2,847 innocent people. If you kill me, they all die instantly‚ÄîI made sure of it. A dead-man's curse."

                        Captain Elara's face goes white. "My... my family lives in Millbrook."

                        Vesper smiles cruelly. "Let me go, and I return to Azaroth's side. Keep me prisoner, and I'll escape eventually‚ÄîI always do. Kill me, and you murder thousands, including the families of your allies."

                        She leans forward. "OR... one of you takes my place. Bind YOUR soul to the curse. Then kill me safely. But that person... will NEVER know peace. NEVER enter any afterlife. An eternity of void."

                        The party looks at each other.`,
                        choices: [
                            {
                                text: '‚öîÔ∏è "We kill her. Those 2,847 deaths are on HER hands, not ours. We cannot let her return to Azaroth."',
                                type: 'quest',
                                leads: 'vesperExecuted'
                            },
                            {
                                text: 'üîí "We imprison her in the Null-Magic Vault beneath Valorhold. She cannot escape what she cannot use magic in."',
                                type: 'quest',
                                leads: 'vesperImprisoned'
                            },
                            {
                                text: 'üíÄ Theron steps forward: "I\'ll take the curse. I\'ve lived enough. The void holds no fear for me."',
                                type: 'quest',
                                leads: 'theronSacrifice'
                            },
                            {
                                text: 'üîÆ "Lyra, is there ANY way to break a soul-binding curse?" (Arcana DC 24)',
                                type: 'skill',
                                character: 'lyra',
                                skill: 'arcana',
                                dc: 24,
                                successLeads: 'curseLoophole',
                                failureLeads: 'noLoophole'
                            },
                            {
                                text: 'üé≤ Seraphina attempts to CHANNEL HER DEITY directly to judge Vesper (Religion DC 22 - DIVINE INTERVENTION)',
                                type: 'skill',
                                character: 'seraphina',
                                skill: 'religion',
                                dc: 22,
                                successLeads: 'divineJudgment',
                                failureLeads: 'silentGods'
                            },
                            {
                                text: 'üó£Ô∏è "Vesper... what would it take for YOU to break the curse willingly?"',
                                type: 'quest',
                                leads: 'vesperBargain'
                            }
                        ]
                    },

                    psychicMaze: {
                        text: `üß† THE MINDSCAPE LABYRINTH üß†

                        The artifact chamber is sealed by an Intellect Devourer's trap. The only way through: enter the COLLECTIVE NIGHTMARE of the four heroes.

                        You find yourselves in a twisted landscape where each person's deepest fears manifest physically.

                        THERON's sector: An endless battlefield where he kills his father over and over‚Äîthe trauma that drove him to become a protector.

                        LYRA's sector: A library where every book she opens shows the fire that killed her mentor, with new ways she could have saved her.

                        KAEL's sector: A forest where every animal he's ever hunted speaks, asking why they deserved to die.

                        SERAPHINA's sector: A temple where her god's voice tells her she was NEVER chosen‚Äîjust lucky.

                        To escape, you must HELP EACH OTHER face these fears. But time moves differently here‚Äîspend too long, and your bodies in the real world will starve.`,
                        choices: [
                            {
                                text: '‚öîÔ∏è Start with Theron\'s nightmare‚Äîbreak the cycle of violence (Theron needs Insight DC 18)',
                                type: 'skill',
                                character: 'theron',
                                skill: 'insight',
                                dc: 18,
                                successLeads: 'theronHealed',
                                failureLeads: 'theronTrapped'
                            },
                            {
                                text: 'üîÆ Start with Lyra\'s nightmare‚Äîshe must accept she couldn\'t save everyone (Lyra needs Wisdom DC 19)',
                                type: 'skill',
                                character: 'lyra',
                                skill: 'wis',
                                dc: 19,
                                successLeads: 'lyraHealed',
                                failureLeads: 'lyraTrapped'
                            },
                            {
                                text: 'üèπ Start with Kael\'s nightmare‚Äîfind meaning in the hunt (Kael needs Nature DC 17)',
                                type: 'skill',
                                character: 'kael',
                                skill: 'nature',
                                dc: 17,
                                successLeads: 'kaelHealed',
                                failureLeads: 'kaelTrapped'
                            },
                            {
                                text: '‚ú® Start with Seraphina\'s nightmare‚Äîprove faith doesn\'t need proof (Seraphina needs Religion DC 20)',
                                type: 'skill',
                                character: 'seraphina',
                                skill: 'religion',
                                dc: 20,
                                successLeads: 'seraphinaHealed',
                                failureLeads: 'seraphinaTrapped'
                            },
                            {
                                text: 'üé≤ Attempt to face ALL FOUR simultaneously‚Äîpure willpower (Group check - average DC 19)',
                                type: 'skill',
                                character: 'theron',
                                skill: 'con',
                                dc: 19,
                                successLeads: 'allHealed',
                                failureLeads: 'allTrapped'
                            }
                        ]
                    },

                    politicalIntrigue: {
                        text: `üëë THE COUNCIL OF CROWNS üëë

                        Emergency summit. Five kingdoms have gathered to discuss the Azaroth threat:

                        KING ALDRIC III of Elendor (your kingdom) - Weak, paranoid, possibly compromised
                        QUEEN VEXIA of the Eastern Dominion - Ruthless pragmatist, army of 50,000
                        HIGH PRIEST MORDECAI of the Theocracy - Religious zealot, commands paladins
                        ARCHMAGE SELINDRA of the Mage Towers - Neutral, wants magical knowledge
                        WARLORD GROK of the Northern Clans - Respects only strength, hates undead

                        You have ONE chance to address the council. Convince them to unite against Azaroth.

                        But you've just learned: ONE of these leaders is secretly working WITH Azaroth. If you accuse wrong, the alliance shatters.`,
                        choices: [
                            {
                                text: 'üëë Appeal to King Aldric\'s honor‚Äîremind him of his ancestors\' glory (Persuasion DC 15)',
                                type: 'skill',
                                character: 'seraphina',
                                skill: 'persuasion',
                                dc: 15,
                                successLeads: 'aldricRallied',
                                failureLeads: 'aldricCowers'
                            },
                            {
                                text: '‚öîÔ∏è Challenge Warlord Grok to single combat for his army\'s allegiance',
                                type: 'combat',
                                leads: 'combatGrok',
                                difficulty: 'hard'
                            },
                            {
                                text: 'üîÆ Offer Archmage Selindra access to Azaroth\'s spellbook after victory',
                                type: 'quest',
                                leads: 'selindraTempted'
                            },
                            {
                                text: 'üé≤ Lyra secretly casts Detect Thoughts to identify the traitor (Stealth DC 20 to hide spellcasting)',
                                type: 'skill',
                                character: 'lyra',
                                skill: 'stealth',
                                dc: 20,
                                successLeads: 'traitorFound',
                                failureLeads: 'spellDetected'
                            },
                            {
                                text: 'üíÄ Publicly accuse Queen Vexia‚Äîher "pragmatism" is suspiciously convenient for Azaroth',
                                type: 'quest',
                                leads: 'accuseVexia'
                            },
                            {
                                text: 'üé≠ Give an INSPIRING SPEECH to ALL leaders simultaneously (Theron - Performance DC 22)',
                                type: 'skill',
                                character: 'theron',
                                skill: 'cha',
                                dc: 22,
                                successLeads: 'grandAlliance',
                                failureLeads: 'speechFails'
                            }
                        ]
                    },

                    underdarkDescent: {
                        text: `üï∑Ô∏è THE UNDERDARK CROSSING üï∑Ô∏è

                        The shortest path to the Crown artifact leads through the UNDERDARK‚Äîthree miles of absolute darkness, filled with horrors that have never seen sunlight.

                        Your guide is an unlikely ally: ZIRIX, a Drow defector who claims the Spider Queen herself cursed him for refusing to sacrifice children. His face is a mass of burn scars where the holy symbols were once carved.

                        "Stay close. Stay silent. And whatever you do... don't let them know you FEEL FEAR. They can SMELL it."

                        The darkness swallows you whole. After an hour, Zirix stops.

                        "Crossroads. Left: Mind Flayer colony‚Äîthey'll try to eat your brains. Middle: Beholder's domain‚Äîif it sees you first, you're disintegrated. Right: My former temple‚Äîhundreds of Drow warriors, all loyal to Lolth."

                        He pauses. "There's a fourth path. But we'd have to go through the ABYSS RIFT. Demons instead of Drow. Your choice."`,
                        choices: [
                            {
                                text: 'üß† Mind Flayer colony‚ÄîLyra can shield our thoughts (Lyra Arcana DC 21)',
                                type: 'skill',
                                character: 'lyra',
                                skill: 'arcana',
                                dc: 21,
                                successLeads: 'mindFlayersAvoided',
                                failureLeads: 'mentalBattle'
                            },
                            {
                                text: 'üëÅÔ∏è Beholder\'s domain‚ÄîKael moves faster than anything alive (Kael Stealth DC 23 - EXTREME)',
                                type: 'skill',
                                character: 'kael',
                                skill: 'stealth',
                                dc: 23,
                                successLeads: 'beholderBypassed',
                                failureLeads: 'beholderFight'
                            },
                            {
                                text: 'üï∑Ô∏è Drow temple‚ÄîSeraphina\'s light magic might turn their darkness against them (Religion DC 20)',
                                type: 'skill',
                                character: 'seraphina',
                                skill: 'religion',
                                dc: 20,
                                successLeads: 'drowBlinded',
                                failureLeads: 'drowAmbush'
                            },
                            {
                                text: 'üî• Abyss Rift‚Äîdemons are chaotic, maybe we can BARGAIN with them',
                                type: 'quest',
                                leads: 'demonBargain'
                            },
                            {
                                text: 'üé≤ "Zirix, you know these tunnels. What path would YOU take?" (Insight DC 16 to gauge his honesty)',
                                type: 'skill',
                                character: 'kael',
                                skill: 'insight',
                                dc: 16,
                                successLeads: 'zirixSecretPath',
                                failureLeads: 'zirixBetrayal'
                            },
                            {
                                text: '‚öîÔ∏è "We carve our OWN path. Straight through." (Combat against ALL threats)',
                                type: 'combat',
                                leads: 'combatUnderdark',
                                difficulty: 'deadly'
                            }
                        ]
                    },

                    betrayalTwist: {
                        text: `üíî THE UNTHINKABLE TRUTH üíî

                        The ritual chamber. You've collected all three artifacts. Azaroth stands before you, his skeletal form wreathed in necrotic energy.

                        But he's... laughing?

                        "Did you truly think I didn't PLAN for this? Foolish mortals."

                        He gestures, and Captain Elara steps out of the shadows behind him. Her eyes glow with dark magic.

                        "Hello, heroes. Surprised? I've been his servant since the beginning. Every 'helpful tip' I gave you, every path I suggested... all designed to bring you HERE, WITH the artifacts. The ritual doesn't need YOUR deaths‚Äîit needs THESE."

                        She takes the Blade, the Orb, and the Crown from your paralyzed hands.

                        "Thank you for doing the hard work. The Kingdom thanks you for your service."

                        The paralysis spell is wearing off. You have SECONDS to act.`,
                        choices: [
                            {
                                text: '‚öîÔ∏è Theron BREAKS through the paralysis with pure rage (Constitution DC 22 + Attack)',
                                type: 'skill',
                                character: 'theron',
                                skill: 'con',
                                dc: 22,
                                successLeads: 'theronBreaksFree',
                                failureLeads: 'paralyzed'
                            },
                            {
                                text: 'üîÆ Lyra uses her STAFF OF POWER\'s emergency discharge‚Äîwilling to sacrifice herself',
                                type: 'quest',
                                leads: 'staffExplosion'
                            },
                            {
                                text: 'üé≤ Kael\'s Oathbow is BOUND to him‚Äîeven paralyzed, command it to fire (DEX DC 20)',
                                type: 'skill',
                                character: 'kael',
                                skill: 'dex',
                                dc: 20,
                                successLeads: 'oathbowFires',
                                failureLeads: 'bowFails'
                            },
                            {
                                text: '‚ú® Seraphina calls upon DIVINE INTERVENTION‚Äîher god\'s direct help (Only works on natural 19-20)',
                                type: 'skill',
                                character: 'seraphina',
                                skill: 'religion',
                                dc: 19,
                                successLeads: 'godIntervenes',
                                failureLeads: 'godsAreQuiet'
                            },
                            {
                                text: 'üó£Ô∏è "ELARA! Remember who you WERE! Remember your family in Millbrook!"',
                                type: 'skill',
                                character: 'theron',
                                skill: 'persuasion',
                                dc: 18,
                                successLeads: 'elaraRedeemed',
                                failureLeads: 'elaraMocks'
                            },
                            {
                                text: 'üíÄ Accept death. Let them complete the ritual. Die... and come back as REVENANTS with a single purpose.',
                                type: 'quest',
                                leads: 'revenantPath'
                            }
                        ]
                    },

                    cosmicHorror: {
                        text: `üåå BEYOND THE VEIL üåå

                        The Orb of Eternal Night didn't just show Azaroth's location. It showed you... EVERYTHING.

                        Your minds touched the FAR REALM. The space between spaces. You saw the truth: Azaroth is not the true threat. He's a PAWN. Something ELSE is coming. Something that makes liches look like children playing with toys.

                        Entity Designation: THE FORMLESS HUNGER
                        Status: AWAKENING
                        Time until manifestation: 47 days
                        Probability of mortal survival: 0.003%

                        The Orb speaks directly into your minds: "You have seen. You cannot unsee. You have three options: spread awareness and watch civilization crumble into panic, keep silent and let humanity enjoy its final days, or... seek the FIVE SEALS that bound this entity eons ago."

                        Lyra is bleeding from her eyes. The knowledge is too much for mortal minds.`,
                        choices: [
                            {
                                text: 'üîÆ "Show us the Five Seals. We\'ll restore them all." (Quest chain unlocked)',
                                type: 'quest',
                                leads: 'fiveSealsQuest'
                            },
                            {
                                text: 'üé≤ Lyra attempts to COMPREHEND the entity\'s weakness (Intelligence DC 25 - MIND-SHATTERING)',
                                type: 'skill',
                                character: 'lyra',
                                skill: 'int',
                                dc: 25,
                                successLeads: 'cosmicKnowledge',
                                failureLeads: 'madnessDescends'
                            },
                            {
                                text: '‚ú® Seraphina PRAYS for guidance‚Äîsurely the gods know about this threat?',
                                type: 'skill',
                                character: 'seraphina',
                                skill: 'religion',
                                dc: 18,
                                successLeads: 'godsConfirm',
                                failureLeads: 'godsAreTooAfraidToAnswer'
                            },
                            {
                                text: '‚öîÔ∏è "One threat at a time. We stop Azaroth FIRST, then deal with the cosmic horror."',
                                type: 'quest',
                                leads: 'azarothFirst'
                            },
                            {
                                text: 'üíÄ "If we warn people, do they have a CHOICE in how they spend their final days?"',
                                type: 'quest',
                                leads: 'ethicalWarning'
                            },
                            {
                                text: 'üåü "What if WE become the threat? Ascend to match this entity\'s power?"',
                                type: 'quest',
                                leads: 'ascensionPath'
                            }
                        ]
                    },

                    finalStand: {
                        text: `‚öîÔ∏è THE FINAL DAWN ‚öîÔ∏è

                        Day 12. The crimson moon reaches its zenith. You stand at the gates of Azaroth's fortress with the largest army ever assembled in the realm's history.

                        50,000 soldiers from Queen Vexia. 10,000 paladins from the Theocracy. Every mage from the Towers. The Northern Clans' berserkers. Even Volcrath the dragon, bound by ancient oath.

                        And across from you: AZAROTH'S UNDEAD LEGION. Hundreds of thousands of risen dead. Bone giants. Death knights. And at the center, the lich himself, wreathed in the power of twelve days of ritual casting.

                        Captain Elara (the REAL one, freed from possession) stands beside you. "Whatever happens today... it's been an honor."

                        Azaroth's voice booms across the battlefield: "LAST CHANCE, HEROES. JOIN ME, AND RULE AS MY IMMORTAL GENERALS. REFUSE, AND FEED MY ARMY."

                        The fate of the world rests on your next words.`,
                        choices: [
                            {
                                text: '‚öîÔ∏è "CHARGE!!! FOR ELENDOR! FOR THE LIVING!" (Begin final battle)',
                                type: 'combat',
                                leads: 'finalBattle',
                                difficulty: 'legendary'
                            },
                            {
                                text: 'üé≤ Theron challenges Azaroth to SINGLE COMBAT‚Äîwinner takes all (Ancient tradition DC 20 to invoke)',
                                type: 'skill',
                                character: 'theron',
                                skill: 'intimidation',
                                dc: 20,
                                successLeads: 'singleCombatAzaroth',
                                failureLeads: 'azarothLaughs'
                            },
                            {
                                text: 'üîÆ Lyra activates the THREE ARTIFACTS simultaneously‚Äîunleash their combined power',
                                type: 'quest',
                                leads: 'artifactUnleashed'
                            },
                            {
                                text: '‚ú® Seraphina leads a MASS PRAYER‚Äîevery paladin, every believer, channeling divine power',
                                type: 'skill',
                                character: 'seraphina',
                                skill: 'religion',
                                dc: 22,
                                successLeads: 'divineIntervention',
                                failureLeads: 'faithWavers'
                            },
                            {
                                text: 'üêâ "VOLCRATH! Honor your oath! BURN THEM ALL!"',
                                type: 'quest',
                                leads: 'dragonFire'
                            },
                            {
                                text: 'üíÄ Kael slips away during the chaos‚Äîassassinate Azaroth while armies clash (Stealth DC 25 + Attack)',
                                type: 'skill',
                                character: 'kael',
                                skill: 'stealth',
                                dc: 25,
                                successLeads: 'assassinationSuccess',
                                failureLeads: 'assassinationFails'
                            },
                            {
                                text: 'üåü "WAIT! Azaroth‚Äîwhat if there\'s another way? What do you truly WANT?"',
                                type: 'quest',
                                leads: 'lichNegotiation'
                            }
                        ]
                    },

                    aftermath: {
                        text: `üåÖ THE DAWN AFTER üåÖ

                        It's over.

                        Azaroth is destroyed‚Äîtruly destroyed, his phylactery shattered, his essence scattered across the planes. The crimson moon fades to silver. The undead legions collapse into dust.

                        But the cost... the cost was immense.

                        30,000 soldiers fell. Three of the five kingdoms' rulers died in battle. The Mage Towers are rubble. Volcrath sacrificed himself to destroy the death knights.

                        And your party...

                        You stand in the throne room of Elendor, the Crown of Binding Souls in your hands. King Aldric is dead‚Äîkilled by Azaroth personally. The kingdom needs a new ruler.

                        The surviving lords, generals, and priests all look to YOU.

                        Captain Elara speaks: "You saved us all. The throne is yours if you want it. But... there are other paths. The world needs heroes more than ever now."`,
                        choices: [
                            {
                                text: 'üëë Accept the crown‚Äîlead Elendor into a new era',
                                type: 'quest',
                                leads: 'kingEnding'
                            },
                            {
                                text: 'üö∂ Refuse‚Äîthe party continues adventuring. The Formless Hunger awaits.',
                                type: 'quest',
                                leads: 'adventureEnding'
                            },
                            {
                                text: 'üíî Retire‚Äîyou\'ve given enough. Let others carry the burden now.',
                                type: 'quest',
                                leads: 'retirementEnding'
                            },
                            {
                                text: 'üéì Found an academy‚Äîtrain the next generation of heroes',
                                type: 'quest',
                                leads: 'academyEnding'
                            },
                            {
                                text: 'üîÆ Ascend‚Äîuse the artifacts to transcend mortality and guard the realm eternally',
                                type: 'quest',
                                leads: 'ascensionEnding'
                            },
                            {
                                text: 'üíÄ Something\'s wrong. Azaroth couldn\'t be defeated this easily. CHECK AGAIN.',
                                type: 'quest',
                                leads: 'surpriseTwist'
                            }
                        ]
                    }
                };

                const story = stories[storyId] || stories.intro;
                this.currentStory = storyId;

                // Display story
                const storyContent = document.getElementById('storyContent');
                storyContent.innerHTML = '';

                const text = document.createElement('div');
                text.className = 'story-text fade-in';
                text.innerHTML = story.text.split('\n').map(p => p.trim()).join('<br><br>');
                storyContent.appendChild(text);

                // Display choices
                const choicesContainer = document.getElementById('choicesContainer');
                choicesContainer.innerHTML = '';

                story.choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = `choice-button ${choice.type} fade-in`;
                    button.innerHTML = choice.text + (choice.description ? `<br><small style="opacity: 0.7;">${choice.description}</small>` : '');
                    button.onclick = () => this.handleChoice(choice);
                    choicesContainer.appendChild(button);
                });

                // Scroll to top
                storyContent.scrollTop = 0;
            }

            handleChoice(choice) {
                switch (choice.type) {
                    case 'combat':
                        this.startCombat(choice.leads, choice.difficulty);
                        break;
                    case 'skill':
                        this.makeSkillCheck(choice);
                        break;
                    case 'quest':
                    case 'dialogue':
                    case 'investigation':
                    case 'heist':
                    case 'spell':
                        this.loadStory(choice.leads);
                        break;
                }
            }

            // ===== DICE ROLLING =====
            rollD20(modifier = 0) {
                return Math.floor(Math.random() * 20) + 1 + modifier;
            }

            rollDice(diceString) {
                // Parse dice string like "2d6+7"
                const match = diceString.match(/(\d+)d(\d+)([\+\-]\d+)?/);
                if (!match) return 0;

                const [, count, sides, mod] = match;
                let total = 0;
                for (let i = 0; i < parseInt(count); i++) {
                    total += Math.floor(Math.random() * parseInt(sides)) + 1;
                }
                return total + (mod ? parseInt(mod) : 0);
            }

            async makeSkillCheck(choice) {
                const character = this.party.find(c => c.id === choice.character);
                const modifier = Math.floor((character[choice.skill] || character.dex - 10) / 2);

                // Show dice roller
                const diceRoller = document.getElementById('diceRoller');
                const diceDisplay = document.getElementById('diceDisplay');
                const diceResult = document.getElementById('diceResult');
                const diceModifiers = document.getElementById('diceModifiers');
                const diceOutcome = document.getElementById('diceOutcome');

                diceRoller.classList.add('active');
                diceDisplay.textContent = 'üé≤';
                diceResult.textContent = 'Rolling...';
                diceModifiers.textContent = '';
                diceOutcome.textContent = '';

                await this.sleep(1000);

                const roll = Math.floor(Math.random() * 20) + 1;
                const total = roll + modifier;

                diceDisplay.textContent = roll === 20 ? 'üåü' : roll === 1 ? 'üíÄ' : 'üé≤';
                diceResult.textContent = `Rolled: ${roll}`;
                diceModifiers.textContent = `${character.name} (${choice.skill}) +${modifier} = ${total}`;

                const success = total >= choice.dc || roll === 20;
                const failure = roll === 1;

                diceOutcome.className = 'dice-outcome ' + (success ? 'success' : 'failure');
                diceOutcome.textContent = failure ? 'üíÄ CRITICAL FAILURE!' :
                                         roll === 20 ? 'üåü CRITICAL SUCCESS!' :
                                         success ? `‚úÖ SUCCESS! (DC ${choice.dc})` :
                                         `‚ùå FAILURE (DC ${choice.dc})`;

                await this.sleep(3000);
                diceRoller.classList.remove('active');

                await this.sleep(300);
                this.loadStory(success ? choice.successLeads : choice.failureLeads);
            }

            // ===== COMBAT SYSTEM =====
            startCombat(encounterType, difficulty) {
                const encounters = {
                    combatAzarothDirect: {
                        name: 'Azaroth the Undying (Full Power)',
                        description: 'You storm the fortress. Azaroth awaits with his full undead legion!',
                        enemies: [
                            {
                                name: 'Azaroth the Undying',
                                hp: 180,
                                maxHp: 180,
                                ac: 20,
                                attack: 12,
                                damage: '3d6+6',
                                abilities: ['Legendary Resistance (3/day)', 'Paralyzing Touch', 'Power Word Kill'],
                                isBoss: true
                            },
                            { name: 'Wight #1', hp: 45, maxHp: 45, ac: 14, attack: 7, damage: '1d8+3' },
                            { name: 'Wight #2', hp: 45, maxHp: 45, ac: 14, attack: 7, damage: '1d8+3' },
                            { name: 'Wight #3', hp: 45, maxHp: 45, ac: 14, attack: 7, damage: '1d8+3' },
                            { name: 'Wight #4', hp: 45, maxHp: 45, ac: 14, attack: 7, damage: '1d8+3' }
                        ]
                    },
                    combatAzarothWeakened: {
                        name: 'Azaroth the Undying (Undermanned)',
                        description: 'Half his forces are away! The odds are better, but still deadly.',
                        enemies: [
                            {
                                name: 'Azaroth the Undying',
                                hp: 180,
                                maxHp: 180,
                                ac: 20,
                                attack: 12,
                                damage: '3d6+6',
                                abilities: ['Legendary Resistance (3/day)', 'Paralyzing Touch'],
                                isBoss: true
                            },
                            { name: 'Wight #1', hp: 45, maxHp: 45, ac: 14, attack: 7, damage: '1d8+3' },
                            { name: 'Wight #2', hp: 45, maxHp: 45, ac: 14, attack: 7, damage: '1d8+3' }
                        ]
                    },
                    combatElementals: {
                        name: 'Water Elementals',
                        description: 'Three massive water elementals block your path to the crypt!',
                        enemies: [
                            { name: 'Water Elemental #1', hp: 114, maxHp: 114, ac: 14, attack: 7, damage: '2d8+4' },
                            { name: 'Water Elemental #2', hp: 114, maxHp: 114, ac: 14, attack: 7, damage: '2d8+4' },
                            { name: 'Water Elemental #3', hp: 114, maxHp: 114, ac: 14, attack: 7, damage: '2d8+4' }
                        ]
                    },
                    combatDragonChampion: {
                        name: "Volcrath's Champion - Ancient Fire Elemental",
                        description: 'The dragon summons a being of pure flame! Prove your worth!',
                        enemies: [
                            {
                                name: 'Infernus the Eternal Flame',
                                hp: 200,
                                maxHp: 200,
                                ac: 17,
                                attack: 10,
                                damage: '3d10+5',
                                abilities: ['Fire Immunity', 'Blaze Aura (5 damage/round)', 'Supernova (once)'],
                                isBoss: true
                            }
                        ]
                    },
                    combatGrok: {
                        name: 'Warlord Grok - Trial by Combat',
                        description: 'Theron faces the Northern Warlord in single combat!',
                        enemies: [
                            {
                                name: 'Warlord Grok the Unbroken',
                                hp: 175,
                                maxHp: 175,
                                ac: 18,
                                attack: 11,
                                damage: '2d12+6',
                                abilities: ['Relentless Endurance', 'Frenzied Rage', 'Battle Cry'],
                                isBoss: true
                            }
                        ]
                    },
                    combatUnderdark: {
                        name: 'The Underdark Gauntlet',
                        description: 'You carve through the darkness! Mind Flayers, Drow, and worse await!',
                        enemies: [
                            { name: 'Mind Flayer', hp: 71, maxHp: 71, ac: 15, attack: 9, damage: '2d10+4', abilities: ['Mind Blast'] },
                            { name: 'Drow Elite Warrior', hp: 71, maxHp: 71, ac: 18, attack: 8, damage: '2d8+3' },
                            { name: 'Drow Elite Warrior', hp: 71, maxHp: 71, ac: 18, attack: 8, damage: '2d8+3' },
                            { name: 'Drider', hp: 123, maxHp: 123, ac: 19, attack: 9, damage: '2d8+4', abilities: ['Web', 'Spider Climb'] }
                        ]
                    },
                    finalBattle: {
                        name: 'AZAROTH THE UNDYING - FINAL CONFRONTATION',
                        description: 'The final battle for the fate of the realm! Everything has led to this moment!',
                        enemies: [
                            {
                                name: 'AZAROTH THE UNDYING',
                                hp: 250,
                                maxHp: 250,
                                ac: 21,
                                attack: 14,
                                damage: '4d6+8',
                                abilities: ['Legendary Resistance (5/day)', 'Power Word Kill', 'Time Stop', 'Meteor Swarm'],
                                isBoss: true
                            },
                            { name: 'Death Knight Commander', hp: 120, maxHp: 120, ac: 20, attack: 11, damage: '2d10+5' },
                            { name: 'Death Knight Commander', hp: 120, maxHp: 120, ac: 20, attack: 11, damage: '2d10+5' },
                            { name: 'Bone Colossus', hp: 180, maxHp: 180, ac: 15, attack: 10, damage: '3d8+6', abilities: ['Regeneration'] }
                        ]
                    },
                    singleCombatAzaroth: {
                        name: 'AZAROTH - HONORABLE DUEL',
                        description: 'Theron faces the lich alone! The fate of the world rests on one warrior!',
                        enemies: [
                            {
                                name: 'AZAROTH THE UNDYING',
                                hp: 200,
                                maxHp: 200,
                                ac: 19,
                                attack: 12,
                                damage: '3d6+6',
                                abilities: ['Paralyzing Touch', 'Legendary Resistance (3/day)'],
                                isBoss: true
                            }
                        ]
                    }
                };

                const encounter = encounters[encounterType];
                if (!encounter) {
                    alert('Combat encounter not yet implemented!');
                    return;
                }

                this.currentCombat = {
                    name: encounter.name,
                    description: encounter.description,
                    allies: [...this.party.map(p => ({ ...p, isAlly: true }))],
                    enemies: encounter.enemies.map(e => ({ ...e, isEnemy: true })),
                    turn: 0,
                    round: 1,
                    log: []
                };

                // Roll initiative
                this.currentCombat.allCombatants = [
                    ...this.currentCombat.allies,
                    ...this.currentCombat.enemies
                ].map(c => ({
                    ...c,
                    initiative: this.rollD20(c.dex ? Math.floor((c.dex - 10) / 2) : 0)
                })).sort((a, b) => b.initiative - a.initiative);

                this.inCombat = true;
                this.renderCombat();
            }

            renderCombat() {
                document.getElementById('mainGame').style.display = 'none';
                document.getElementById('combatScreen').style.display = 'block';
                document.getElementById('combatDescription').textContent = this.currentCombat.description;

                const combatantsGrid = document.getElementById('combatantsGrid');
                combatantsGrid.innerHTML = '';

                const currentCombatant = this.currentCombat.allCombatants[this.currentCombat.turn];

                this.currentCombat.allCombatants.forEach((combatant, index) => {
                    const card = document.createElement('div');
                    card.className = `combatant-card ${combatant.isAlly ? 'ally' : 'enemy'} ${index === this.currentCombat.turn ? 'active-turn' : ''} ${combatant.hp <= 0 ? 'dead' : ''}`;

                    const hpPercent = (combatant.hp / combatant.maxHp) * 100;

                    card.innerHTML = `
                        <div style="font-weight: bold; color: ${combatant.isAlly ? '#c4b5fd' : '#fca5a5'}; margin-bottom: 0.5rem;">
                            ${combatant.name}${index === this.currentCombat.turn ? ' ‚ö°' : ''}
                        </div>
                        <div style="font-size: 0.85rem; color: #9ca3af; margin-bottom: 0.75rem;">
                            ${combatant.class || 'Enemy'} | AC ${combatant.ac}
                        </div>
                        <div class="stat-bar">
                            <div class="stat-label">
                                <span>HP</span>
                                <span>${Math.max(0, combatant.hp)}/${combatant.maxHp}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill hp-bar" style="width: ${Math.max(0, hpPercent)}%"></div>
                            </div>
                        </div>
                        ${combatant.abilities ? `<div style="margin-top: 0.5rem; font-size: 0.75rem; color: #d1d5db;">${combatant.abilities[0]}</div>` : ''}
                    `;

                    combatantsGrid.appendChild(card);
                });

                this.renderCombatActions(currentCombatant);
                this.updateCombatLog();
            }

            renderCombatActions(combatant) {
                const actionsContainer = document.getElementById('combatActions');
                actionsContainer.innerHTML = '';

                if (combatant.hp <= 0) {
                    this.nextTurn();
                    return;
                }

                if (combatant.isEnemy) {
                    // AI Turn
                    setTimeout(() => this.enemyTurn(combatant), 1000);
                    return;
                }

                // Player turn - show actions
                actionsContainer.innerHTML = `
                    <button class="action-button" onclick="game.combatAttack()">‚öîÔ∏è Attack</button>
                    <button class="action-button" onclick="game.combatCastSpell()">üîÆ Cast Spell</button>
                    <button class="action-button" onclick="game.combatUseItem()">üß™ Use Item</button>
                    <button class="action-button" onclick="game.combatDodge()">üõ°Ô∏è Dodge</button>
                `;
            }

            combatAttack() {
                const attacker = this.currentCombat.allCombatants[this.currentCombat.turn];
                const aliveEnemies = this.currentCombat.allCombatants.filter(c => c.isEnemy && c.hp > 0);

                if (aliveEnemies.length === 0) {
                    this.endCombat(true);
                    return;
                }

                const target = aliveEnemies[Math.floor(Math.random() * aliveEnemies.length)];

                const attackRoll = this.rollD20(attacker.attack || 0);
                const hit = attackRoll >= target.ac;

                if (hit) {
                    const damage = this.rollDice(attacker.damage || '1d8+4');
                    target.hp -= damage;
                    this.addCombatLog(`${attacker.name} hits ${target.name} for ${damage} damage!`, 'damage');

                    if (target.hp <= 0) {
                        target.hp = 0;
                        this.addCombatLog(`${target.name} is defeated!`, 'damage');
                    }
                } else {
                    this.addCombatLog(`${attacker.name} misses ${target.name}!`, 'miss');
                }

                setTimeout(() => this.nextTurn(), 1000);
            }

            enemyTurn(enemy) {
                const aliveAllies = this.currentCombat.allCombatants.filter(c => c.isAlly && c.hp > 0);

                if (aliveAllies.length === 0) {
                    this.endCombat(false);
                    return;
                }

                const target = aliveAllies[Math.floor(Math.random() * aliveAllies.length)];
                const attackRoll = this.rollD20(enemy.attack || 0);
                const hit = attackRoll >= target.ac;

                if (hit) {
                    const damage = this.rollDice(enemy.damage || '1d8+3');
                    target.hp -= damage;
                    this.addCombatLog(`${enemy.name} hits ${target.name} for ${damage} damage!`, 'damage');

                    if (target.hp <= 0) {
                        target.hp = 0;
                        this.addCombatLog(`${target.name} falls unconscious!`, 'damage');
                    }
                } else {
                    this.addCombatLog(`${enemy.name} misses ${target.name}!`, 'miss');
                }

                setTimeout(() => this.nextTurn(), 1500);
            }

            nextTurn() {
                this.currentCombat.turn++;

                if (this.currentCombat.turn >= this.currentCombat.allCombatants.length) {
                    this.currentCombat.turn = 0;
                    this.currentCombat.round++;
                    this.addCombatLog(`--- Round ${this.currentCombat.round} ---`, 'heal');
                }

                // Check win conditions
                const aliveAllies = this.currentCombat.allCombatants.filter(c => c.isAlly && c.hp > 0);
                const aliveEnemies = this.currentCombat.allCombatants.filter(c => c.isEnemy && c.hp > 0);

                if (aliveEnemies.length === 0) {
                    this.endCombat(true);
                    return;
                }

                if (aliveAllies.length === 0) {
                    this.endCombat(false);
                    return;
                }

                this.renderCombat();
            }

            endCombat(victory) {
                this.inCombat = false;

                if (victory) {
                    const xpGained = this.currentCombat.enemies.length * 1000;
                    this.gameState.xp += xpGained;
                    this.gameState.enemiesDefeated += this.currentCombat.enemies.length;

                    alert(`‚öîÔ∏è VICTORY!\n\nYou defeated ${this.currentCombat.name}!\n\n+${xpGained} XP\nTotal XP: ${this.gameState.xp} / ${this.gameState.xpToNextLevel}`);

                    // Return to story
                    document.getElementById('combatScreen').style.display = 'none';
                    document.getElementById('mainGame').style.display = 'grid';

                    // Continue story based on what combat it was
                    this.loadStory('bladeFound'); // Placeholder
                } else {
                    this.showGameOver(false);
                }

                this.render();
            }

            addCombatLog(message, type = '') {
                this.currentCombat.log.push({ message, type });
                this.updateCombatLog();
            }

            updateCombatLog() {
                const logContainer = document.getElementById('combatLog');
                const recentLogs = this.currentCombat.log.slice(-10);

                logContainer.innerHTML = recentLogs.map(log =>
                    `<div class="log-entry ${log.type}">${log.message}</div>`
                ).join('');

                logContainer.scrollTop = logContainer.scrollHeight;
            }

            // ===== RENDERING =====
            render() {
                this.renderParty();
                this.renderQuests();
                this.renderResources();
                this.renderInventory();
            }

            renderParty() {
                const container = document.getElementById('partyContainer');
                container.innerHTML = this.party.map(char => {
                    const hpPercent = (char.hp / char.maxHp) * 100;
                    let resourcePercent = 0;
                    let resourceLabel = '';

                    if (char.spellSlots) {
                        const totalSlots = Object.values(char.maxSpellSlots).reduce((a, b) => a + b, 0);
                        const usedSlots = Object.values(char.spellSlots).reduce((a, b) => a + b, 0);
                        resourcePercent = (usedSlots / totalSlots) * 100;
                        resourceLabel = 'Spell Slots';
                    }

                    return `
                        <div class="character-card" id="char-${char.id}">
                            <div class="character-name">${char.name}</div>
                            <div class="character-class">${char.class} ${char.level}</div>
                            <div class="stat-bar">
                                <div class="stat-label">
                                    <span>HP</span>
                                    <span>${char.hp}/${char.maxHp}</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill hp-bar" style="width: ${hpPercent}%"></div>
                                </div>
                            </div>
                            ${char.spellSlots ? `
                                <div class="stat-bar">
                                    <div class="stat-label">
                                        <span>${resourceLabel}</span>
                                        <span>${Object.values(char.spellSlots).reduce((a,b) => a+b, 0)}</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill resource-bar" style="width: ${resourcePercent}%"></div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            }

            renderQuests() {
                const quests = [
                    { name: 'Stop Azaroth\'s Ritual', progress: `${this.gameState.daysRemaining} days remaining` },
                    { name: 'Artifacts Collected', progress: `${this.gameState.artifactsCollected.length}/3` }
                ];

                document.getElementById('questTracker').innerHTML = quests.map(quest => `
                    <div class="quest-item">
                        <div class="quest-title">${quest.name}</div>
                        <div class="quest-progress">${quest.progress}</div>
                    </div>
                `).join('');
            }

            renderResources() {
                document.getElementById('resourcesDisplay').innerHTML = `
                    <div style="padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: #fbbf24;">üí∞ Gold</span>
                            <span style="font-weight: bold;">${this.gameState.gold.toLocaleString()}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: #8b5cf6;">‚≠ê XP</span>
                            <span style="font-weight: bold;">${this.gameState.xp.toLocaleString()}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #9ca3af;">Next Level</span>
                            <span style="font-weight: bold;">${this.gameState.xpToNextLevel.toLocaleString()}</span>
                        </div>
                    </div>
                `;
            }

            renderInventory() {
                document.getElementById('inventoryGrid').innerHTML = this.inventory.map(item => `
                    <div class="inventory-item ${item.rarity}" title="${item.effect}">
                        ${item.name} (${item.count})
                    </div>
                `).join('');
            }

            // ===== SAVE/LOAD =====
            saveGame() {
                const saveData = {
                    party: this.party,
                    gameState: this.gameState,
                    inventory: this.inventory,
                    currentStory: this.currentStory
                };
                localStorage.setItem('dndGameSave', JSON.stringify(saveData));
                alert('üíæ Game saved!');
            }

            loadGame() {
                const saved = localStorage.getItem('dndGameSave');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.party = data.party;
                    this.gameState = data.gameState;
                    this.inventory = data.inventory;
                    this.currentStory = data.currentStory;
                    this.loadStory(this.currentStory);
                    this.render();
                    alert('üì• Game loaded!');
                } else {
                    alert('No save file found!');
                }
            }

            resetGame() {
                if (confirm('Are you sure you want to start a new game? Current progress will be lost!')) {
                    localStorage.removeItem('dndGameSave');
                    location.reload();
                }
            }

            showGameOver(victory) {
                const modal = document.getElementById('gameOverModal');
                const title = document.getElementById('gameOverTitle');
                const content = document.getElementById('gameOverContent');

                if (victory) {
                    title.textContent = 'üèÜ VICTORY! üèÜ';
                    content.innerHTML = `
                        <p style="text-align: center; font-size: 1.2rem; line-height: 1.8;">
                            Against all odds, you defeated Azaroth the Undying and saved the Kingdom of Elendor!
                            <br><br>
                            The crimson moon fades, and a new dawn breaks over Valorhold.
                            <br><br>
                            <strong>The End... for now.</strong>
                        </p>
                    `;
                } else {
                    title.textContent = 'üíÄ DEFEAT üíÄ';
                    content.innerHTML = `
                        <p style="text-align: center; font-size: 1.2rem; line-height: 1.8;">
                            The party has fallen. The crimson moon rises to its zenith...
                            <br><br>
                            Azaroth's ritual is complete. Eternal darkness consumes the kingdom.
                            <br><br>
                            <strong>Try again?</strong>
                        </p>
                    `;
                }

                modal.classList.add('active');
            }

            closeLevelUp() {
                document.getElementById('levelUpModal').classList.remove('active');
            }

            // Utility
            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            // Placeholder methods for combat actions
            combatCastSpell() {
                alert('Spell casting menu coming in full version!');
                this.nextTurn();
            }

            combatUseItem() {
                alert('Item usage menu coming in full version!');
                this.nextTurn();
            }

            combatDodge() {
                const character = this.currentCombat.allCombatants[this.currentCombat.turn];
                this.addCombatLog(`${character.name} takes the Dodge action!`, 'heal');
                this.nextTurn();
            }
        }

        // ===== START GAME =====
        let game;
        window.addEventListener('DOMContentLoaded', () => {
            game = new DnDGame();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Editor Live</title>
    <meta name="description" content="Professional markdown editor with live preview, syntax highlighting, export to HTML/PDF, and auto-save">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }
        #app { display: flex; flex-direction: column; height: 100vh; }
        #header {
            background: rgba(20, 20, 40, 0.95);
            padding: 15px 20px;
            border-bottom: 2px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        h1 { font-size: 18px; color: #667eea; }
        #toolbar {
            background: rgba(20, 20, 40, 0.9);
            padding: 10px 20px;
            border-bottom: 1px solid #444;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .toolbar-btn {
            padding: 6px 12px;
            background: rgba(102, 126, 234, 0.2);
            color: #e0e0e0;
            border: 1px solid #667eea;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }
        .toolbar-btn:hover { background: rgba(102, 126, 234, 0.4); }
        #editor-container { flex: 1; display: flex; overflow: hidden; }
        #editor-pane, #preview-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(20, 20, 40, 0.95);
        }
        #editor-pane { border-right: 1px solid #444; }
        .pane-header {
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid #444;
            font-size: 12px;
            color: #667eea;
            text-transform: uppercase;
            font-weight: bold;
        }
        #markdown-input {
            flex: 1;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            color: #e0e0e0;
            border: none;
            font-family: 'Monaco', monospace;
            font-size: 14px;
            resize: none;
            line-height: 1.6;
        }
        #markdown-input:focus { outline: none; }
        #preview-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            color: #e0e0e0;
            line-height: 1.8;
        }
        #preview-content h1 { color: #667eea; font-size: 32px; margin: 20px 0 10px; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        #preview-content h2 { color: #7789f0; font-size: 26px; margin: 18px 0 8px; border-bottom: 1px solid #444; padding-bottom: 8px; }
        #preview-content h3 { color: #8899ff; font-size: 22px; margin: 16px 0 6px; }
        #preview-content h4 { color: #99aaff; font-size: 18px; margin: 14px 0 5px; }
        #preview-content p { margin: 10px 0; }
        #preview-content ul, #preview-content ol { margin: 10px 0 10px 30px; }
        #preview-content li { margin: 5px 0; }
        #preview-content code {
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', monospace;
            color: #00ff88;
            font-size: 13px;
        }
        #preview-content pre {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }
        #preview-content pre code {
            background: none;
            padding: 0;
            color: #e0e0e0;
        }
        #preview-content blockquote {
            border-left: 4px solid #667eea;
            padding-left: 15px;
            margin: 15px 0;
            color: #aaa;
            font-style: italic;
        }
        #preview-content a { color: #667eea; text-decoration: none; }
        #preview-content a:hover { text-decoration: underline; }
        #preview-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 15px 0;
        }
        #preview-content th, #preview-content td {
            border: 1px solid #444;
            padding: 8px 12px;
            text-align: left;
        }
        #preview-content th {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            font-weight: bold;
        }
        #preview-content img { max-width: 100%; height: auto; margin: 15px 0; border-radius: 6px; }
        #preview-content hr {
            border: none;
            border-top: 2px solid #444;
            margin: 20px 0;
        }
        .word-count {
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-top: 1px solid #444;
            font-size: 11px;
            color: #aaa;
            display: flex;
            justify-content: space-between;
        }
        button {
            padding: 8px 16px;
            background: #667eea;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background: #7789f0; }
        .status { font-size: 11px; color: #00ff88; }
    </style>
</head>
<body>
    <div id="app">
        <div id="header">
            <h1>üìù Markdown Editor Live</h1>
            <div style="display: flex; gap: 10px;">
                <button onclick="exportHTML()">üíæ Export HTML</button>
                <button onclick="exportMarkdown()">üì§ Export MD</button>
                <button onclick="importMarkdown()">üì• Import</button>
                <button onclick="clearEditor()">üóëÔ∏è Clear</button>
                <span class="status" id="status">Auto-saved</span>
            </div>
        </div>

        <div id="toolbar">
            <button class="toolbar-btn" onclick="insertFormat('# ')">H1</button>
            <button class="toolbar-btn" onclick="insertFormat('## ')">H2</button>
            <button class="toolbar-btn" onclick="insertFormat('### ')">H3</button>
            <button class="toolbar-btn" onclick="insertFormat('**', '**')">Bold</button>
            <button class="toolbar-btn" onclick="insertFormat('*', '*')">Italic</button>
            <button class="toolbar-btn" onclick="insertFormat('`', '`')">Code</button>
            <button class="toolbar-btn" onclick="insertFormat('```\n', '\n```')">Code Block</button>
            <button class="toolbar-btn" onclick="insertFormat('[', '](url)')">Link</button>
            <button class="toolbar-btn" onclick="insertFormat('![', '](url)')">Image</button>
            <button class="toolbar-btn" onclick="insertFormat('> ')">Quote</button>
            <button class="toolbar-btn" onclick="insertFormat('- ')">List</button>
            <button class="toolbar-btn" onclick="insertFormat('1. ')">Numbered</button>
            <button class="toolbar-btn" onclick="insertFormat('---\n')">Divider</button>
        </div>

        <div id="editor-container">
            <div id="editor-pane">
                <div class="pane-header">Markdown Input</div>
                <textarea id="markdown-input" placeholder="# Start writing markdown...

## Features
- Live preview
- Auto-save
- Export to HTML
- Syntax highlighting

**Bold text** and *italic text*

> Blockquote example

\`inline code\` and code blocks:

\`\`\`javascript
const greeting = 'Hello World';
console.log(greeting);
\`\`\`

[Links](https://example.com) and images

---

| Column 1 | Column 2 |
|----------|----------|
| Data 1   | Data 2   |
"></textarea>
                <div class="word-count">
                    <span id="char-count">0 characters</span>
                    <span id="word-count">0 words</span>
                    <span id="line-count">0 lines</span>
                </div>
            </div>

            <div id="preview-pane">
                <div class="pane-header">Live Preview</div>
                <div id="preview-content"></div>
            </div>
        </div>
    </div>

    <input type="file" id="file-input" style="display: none;" accept=".md,.txt">

    <script>
        const textarea = document.getElementById('markdown-input');
        const preview = document.getElementById('preview-content');
        let autoSaveTimer;

        // Load saved content
        const saved = localStorage.getItem('markdown-content');
        if (saved) {
            textarea.value = saved;
        }

        // Markdown parser (simplified CommonMark-compatible)
        function parseMarkdown(md) {
            // Escape HTML
            md = md.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

            // Headers
            md = md.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            md = md.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            md = md.replace(/^# (.*$)/gim, '<h1>$1</h1>');

            // Horizontal rule
            md = md.replace(/^\s*---\s*$/gim, '<hr>');

            // Code blocks
            md = md.replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>');

            // Bold
            md = md.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            // Italic
            md = md.replace(/\*(.*?)\*/g, '<em>$1</em>');

            // Inline code
            md = md.replace(/`([^`]+)`/g, '<code>$1</code>');

            // Links
            md = md.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');

            // Images
            md = md.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1">');

            // Blockquotes
            md = md.replace(/^&gt; (.*$)/gim, '<blockquote>$1</blockquote>');

            // Tables
            md = md.replace(/^\|(.+)\|$/gim, function(match) {
                const cells = match.slice(1, -1).split('|').map(c => c.trim());
                return '<tr>' + cells.map(c => '<td>' + c + '</td>').join('') + '</tr>';
            });
            md = md.replace(/(<tr>.*<\/tr>\n)+/g, '<table>$&</table>');
            md = md.replace(/<table><tr>(.*?)<\/tr>/g, '<table><thead><tr>$1</tr></thead><tbody>');
            md = md.replace(/<\/table>/g, '</tbody></table>');
            md = md.replace(/<thead><tr><td>/g, '<thead><tr><th>');
            md = md.replace(/<\/td><\/tr><\/thead>/g, '</th></tr></thead>');
            md = md.replace(/<tbody><tr><td>[\s\|-]+<\/td><\/tr>/g, '<tbody>');

            // Unordered lists
            md = md.replace(/^\s*[-*+] (.*$)/gim, '<li>$1</li>');
            md = md.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');

            // Ordered lists
            md = md.replace(/^\s*\d+\. (.*$)/gim, '<li>$1</li>');

            // Paragraphs
            md = md.replace(/^(?!<[hupolt]|<\/)(.+)$/gim, '<p>$1</p>');

            // Clean up multiple tags
            md = md.replace(/<\/ul>\s*<ul>/g, '');
            md = md.replace(/<\/blockquote>\s*<blockquote>/g, '\n');

            return md;
        }

        function updatePreview() {
            const markdown = textarea.value;
            preview.innerHTML = parseMarkdown(markdown);
            updateStats();
            autoSave();
        }

        function updateStats() {
            const text = textarea.value;
            const chars = text.length;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            const lines = text.split('\n').length;

            document.getElementById('char-count').textContent = `${chars} characters`;
            document.getElementById('word-count').textContent = `${words} words`;
            document.getElementById('line-count').textContent = `${lines} lines`;
        }

        function autoSave() {
            clearTimeout(autoSaveTimer);
            document.getElementById('status').textContent = 'Saving...';

            autoSaveTimer = setTimeout(() => {
                localStorage.setItem('markdown-content', textarea.value);
                document.getElementById('status').textContent = 'Auto-saved';
            }, 1000);
        }

        window.insertFormat = function(start, end = '') {
            const startPos = textarea.selectionStart;
            const endPos = textarea.selectionEnd;
            const selectedText = textarea.value.substring(startPos, endPos);
            const before = textarea.value.substring(0, startPos);
            const after = textarea.value.substring(endPos);

            textarea.value = before + start + selectedText + end + after;
            textarea.focus();
            textarea.setSelectionRange(startPos + start.length, startPos + start.length + selectedText.length);
            updatePreview();
        };

        window.exportHTML = function() {
            const html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Export</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; line-height: 1.6; }
        h1 { color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        h2 { color: #7789f0; border-bottom: 1px solid #ddd; padding-bottom: 8px; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; }
        pre { background: #f4f4f4; padding: 15px; border-radius: 6px; overflow-x: auto; }
        blockquote { border-left: 4px solid #667eea; padding-left: 15px; color: #666; font-style: italic; }
        table { border-collapse: collapse; width: 100%; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 8px 12px; text-align: left; }
        th { background: #f4f4f4; font-weight: bold; }
    </style>
</head>
<body>
${preview.innerHTML}
</body>
</html>`;

            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'markdown-export.html';
            a.click();
            URL.revokeObjectURL(url);
        };

        window.exportMarkdown = function() {
            const blob = new Blob([textarea.value], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'document.md';
            a.click();
            URL.revokeObjectURL(url);
        };

        window.importMarkdown = function() {
            const input = document.getElementById('file-input');
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        textarea.value = event.target.result;
                        updatePreview();
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        };

        window.clearEditor = function() {
            if (confirm('Clear all content? This will erase your current document.')) {
                textarea.value = '';
                updatePreview();
            }
        };

        textarea.addEventListener('input', updatePreview);
        textarea.addEventListener('keydown', (e) => {
            // Tab support
            if (e.key === 'Tab') {
                e.preventDefault();
                insertFormat('    ');
            }
        });

        updatePreview();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Theory Trainer</title>
    <meta name="description" content="Interactive music theory learning: scales, chords, intervals, circle of fifths, ear training with piano keyboard and Web Audio">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
        }
        #app {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(20, 20, 40, 0.95);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        #header {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px 30px;
            border-bottom: 2px solid #4fc3f7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        h1 { font-size: 24px; color: #4fc3f7; }
        #tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid #444;
        }
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab:hover { background: rgba(79, 195, 247, 0.1); }
        .tab.active {
            border-bottom-color: #4fc3f7;
            background: rgba(79, 195, 247, 0.2);
        }
        .tab-content {
            display: none;
            padding: 30px;
        }
        .tab-content.active { display: block; }
        #keyboard {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            position: relative;
            height: 200px;
        }
        .key {
            position: relative;
            cursor: pointer;
            user-select: none;
            transition: all 0.1s;
        }
        .white-key {
            width: 50px;
            height: 200px;
            background: linear-gradient(to bottom, #fff 0%, #e0e0e0 100%);
            border: 1px solid #000;
            border-radius: 0 0 4px 4px;
        }
        .white-key:hover { background: linear-gradient(to bottom, #f0f0f0 0%, #d0d0d0 100%); }
        .white-key.active { background: #4fc3f7; }
        .white-key.highlight { background: #ffeb3b; }
        .black-key {
            width: 30px;
            height: 120px;
            background: linear-gradient(to bottom, #000 0%, #333 100%);
            border: 1px solid #000;
            position: absolute;
            z-index: 10;
            border-radius: 0 0 4px 4px;
        }
        .black-key:hover { background: linear-gradient(to bottom, #222 0%, #444 100%); }
        .black-key.active { background: #4fc3f7; }
        .black-key.highlight { background: #ffeb3b; }
        .key-label {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: #666;
            font-weight: bold;
        }
        .black-key .key-label { color: #aaa; bottom: 5px; }
        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .control-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
        }
        label { font-size: 12px; color: #aaa; min-width: 100px; }
        select, button {
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #4fc3f7;
            color: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
        }
        button {
            background: #4fc3f7;
            color: #000;
            font-weight: bold;
            border: none;
        }
        button:hover { background: #6fd8ff; }
        .info-box {
            background: rgba(79, 195, 247, 0.1);
            border-left: 4px solid #4fc3f7;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .info-box h3 {
            color: #4fc3f7;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .info-box p {
            color: #aaa;
            line-height: 1.6;
            font-size: 13px;
        }
        .chord-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .chord-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        .chord-card:hover {
            border-color: #4fc3f7;
            background: rgba(79, 195, 247, 0.1);
        }
        .chord-name {
            font-size: 18px;
            color: #4fc3f7;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .chord-notes {
            font-size: 12px;
            color: #aaa;
        }
        #circle-of-fifths {
            width: 500px;
            height: 500px;
            margin: 30px auto;
        }
        .exercise-area {
            background: rgba(0, 0, 0, 0.3);
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            min-height: 200px;
        }
        .exercise-question {
            font-size: 24px;
            color: #4fc3f7;
            margin: 20px 0;
        }
        .answer-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .answer-btn {
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #4fc3f7;
            color: #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        .answer-btn:hover { background: rgba(79, 195, 247, 0.2); }
        .answer-btn.correct {
            background: #51cf66;
            border-color: #51cf66;
        }
        .answer-btn.incorrect {
            background: #ff6b6b;
            border-color: #ff6b6b;
        }
        .score-display {
            font-size: 18px;
            color: #4fc3f7;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="header">
            <h1>ðŸŽµ Music Theory Trainer</h1>
            <div style="display: flex; gap: 20px; font-size: 12px;">
                <div>Score: <span style="color: #4fc3f7; font-weight: bold;" id="totalScore">0</span></div>
                <div>Streak: <span style="color: #51cf66; font-weight: bold;" id="streak">0</span></div>
            </div>
        </div>

        <div id="tabs">
            <div class="tab active" onclick="switchTab('scales')">Scales</div>
            <div class="tab" onclick="switchTab('chords')">Chords</div>
            <div class="tab" onclick="switchTab('intervals')">Intervals</div>
            <div class="tab" onclick="switchTab('circle')">Circle of Fifths</div>
            <div class="tab" onclick="switchTab('training')">Ear Training</div>
        </div>

        <div id="scales-tab" class="tab-content active">
            <h2 style="color: #4fc3f7; margin-bottom: 20px;">Scale Explorer</h2>

            <div class="control-panel">
                <div class="control-row">
                    <label>Root Note:</label>
                    <select id="scaleRoot">
                        <option value="C">C</option>
                        <option value="C#">C#</option>
                        <option value="D">D</option>
                        <option value="D#">D#</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F#</option>
                        <option value="G">G</option>
                        <option value="G#">G#</option>
                        <option value="A">A</option>
                        <option value="A#">A#</option>
                        <option value="B">B</option>
                    </select>

                    <label>Scale Type:</label>
                    <select id="scaleType">
                        <option value="major">Major</option>
                        <option value="minor">Natural Minor</option>
                        <option value="harmonic">Harmonic Minor</option>
                        <option value="pentatonic">Pentatonic Major</option>
                        <option value="blues">Blues</option>
                        <option value="dorian">Dorian</option>
                        <option value="mixolydian">Mixolydian</option>
                    </select>

                    <button onclick="showScale()">Show Scale</button>
                    <button onclick="playScale()">Play Scale</button>
                </div>
            </div>

            <div id="keyboard"></div>

            <div class="info-box">
                <h3>About Scales</h3>
                <p id="scaleInfo">Select a scale to see its formula and characteristics.</p>
            </div>
        </div>

        <div id="chords-tab" class="tab-content">
            <h2 style="color: #4fc3f7; margin-bottom: 20px;">Chord Builder</h2>

            <div class="control-panel">
                <div class="control-row">
                    <label>Root Note:</label>
                    <select id="chordRoot">
                        <option value="C">C</option>
                        <option value="C#">C#</option>
                        <option value="D">D</option>
                        <option value="D#">D#</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F#</option>
                        <option value="G">G</option>
                        <option value="G#">G#</option>
                        <option value="A">A</option>
                        <option value="A#">A#</option>
                        <option value="B">B</option>
                    </select>

                    <label>Chord Type:</label>
                    <select id="chordType">
                        <option value="major">Major</option>
                        <option value="minor">Minor</option>
                        <option value="dim">Diminished</option>
                        <option value="aug">Augmented</option>
                        <option value="maj7">Major 7th</option>
                        <option value="min7">Minor 7th</option>
                        <option value="dom7">Dominant 7th</option>
                    </select>

                    <button onclick="showChord()">Show Chord</button>
                    <button onclick="playChord()">Play Chord</button>
                </div>
            </div>

            <div id="keyboard-chords"></div>

            <div class="info-box">
                <h3>Common Chord Progressions</h3>
                <div class="chord-grid">
                    <div class="chord-card" onclick="playProgression(['C', 'Am', 'F', 'G'])">
                        <div class="chord-name">I-vi-IV-V</div>
                        <div class="chord-notes">Pop Progression</div>
                    </div>
                    <div class="chord-card" onclick="playProgression(['C', 'F', 'G', 'C'])">
                        <div class="chord-name">I-IV-V-I</div>
                        <div class="chord-notes">Blues/Rock</div>
                    </div>
                    <div class="chord-card" onclick="playProgression(['Am', 'F', 'C', 'G'])">
                        <div class="chord-name">vi-IV-I-V</div>
                        <div class="chord-notes">Emotional</div>
                    </div>
                    <div class="chord-card" onclick="playProgression(['C', 'G', 'Am', 'F'])">
                        <div class="chord-name">I-V-vi-IV</div>
                        <div class="chord-notes">Journey/Axis</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="intervals-tab" class="tab-content">
            <h2 style="color: #4fc3f7; margin-bottom: 20px;">Interval Training</h2>

            <div class="control-panel">
                <div class="control-row">
                    <label>From Note:</label>
                    <select id="intervalRoot">
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                    </select>

                    <label>Interval:</label>
                    <select id="intervalType">
                        <option value="0">Unison</option>
                        <option value="1">Minor 2nd</option>
                        <option value="2">Major 2nd</option>
                        <option value="3">Minor 3rd</option>
                        <option value="4">Major 3rd</option>
                        <option value="5">Perfect 4th</option>
                        <option value="6">Tritone</option>
                        <option value="7">Perfect 5th</option>
                        <option value="8">Minor 6th</option>
                        <option value="9">Major 6th</option>
                        <option value="10">Minor 7th</option>
                        <option value="11">Major 7th</option>
                        <option value="12">Octave</option>
                    </select>

                    <button onclick="showInterval()">Show Interval</button>
                    <button onclick="playInterval()">Play Interval</button>
                </div>
            </div>

            <div id="keyboard-intervals"></div>

            <div class="info-box">
                <h3>Interval Guide</h3>
                <p>Intervals are the distance between two notes. They form the foundation of melody and harmony.</p>
            </div>
        </div>

        <div id="circle-tab" class="tab-content">
            <h2 style="color: #4fc3f7; margin-bottom: 20px;">Circle of Fifths</h2>
            <canvas id="circle-of-fifths" width="500" height="500"></canvas>
            <div class="info-box">
                <h3>About the Circle of Fifths</h3>
                <p>The circle of fifths shows the relationship between the 12 tones of the chromatic scale, their key signatures, and relative majors and minors. Moving clockwise adds sharps, moving counterclockwise adds flats.</p>
            </div>
        </div>

        <div id="training-tab" class="tab-content">
            <h2 style="color: #4fc3f7; margin-bottom: 20px;">Ear Training</h2>

            <div class="exercise-area" id="exerciseArea">
                <div class="exercise-question">Click "Start Exercise" to begin!</div>
                <button onclick="startExercise()" style="margin-top: 20px;">Start Exercise</button>
            </div>

            <div class="score-display">
                <div>Current Score: <span id="exerciseScore">0</span></div>
                <div>Questions: <span id="questionCount">0</span></div>
            </div>
        </div>
    </div>

    <script>
        let audioContext = null;
        let currentScale = [];
        let currentChord = [];
        let exerciseScore = 0;
        let questionCount = 0;
        let currentInterval = null;

        const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];

        const scaleFormulas = {
            major: [0, 2, 4, 5, 7, 9, 11, 12],
            minor: [0, 2, 3, 5, 7, 8, 10, 12],
            harmonic: [0, 2, 3, 5, 7, 8, 11, 12],
            pentatonic: [0, 2, 4, 7, 9, 12],
            blues: [0, 3, 5, 6, 7, 10, 12],
            dorian: [0, 2, 3, 5, 7, 9, 10, 12],
            mixolydian: [0, 2, 4, 5, 7, 9, 10, 12]
        };

        const chordFormulas = {
            major: [0, 4, 7],
            minor: [0, 3, 7],
            dim: [0, 3, 6],
            aug: [0, 4, 8],
            maj7: [0, 4, 7, 11],
            min7: [0, 3, 7, 10],
            dom7: [0, 4, 7, 10]
        };

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function getNoteFrequency(note, octave = 4) {
            const noteIndex = notes.indexOf(note);
            const semitonesFromA4 = (octave - 4) * 12 + (noteIndex - 9);
            return 440 * Math.pow(2, semitonesFromA4 / 12);
        }

        function playNote(note, duration = 0.5, startTime = 0) {
            initAudio();
            const osc = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            osc.type = 'sine';
            osc.frequency.value = getNoteFrequency(note);

            const now = audioContext.currentTime + startTime;
            gainNode.gain.setValueAtTime(0.3, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);

            osc.connect(gainNode);
            gainNode.connect(audioContext.destination);

            osc.start(now);
            osc.stop(now + duration);
        }

        function drawKeyboard(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            container.style.display = 'flex';
            container.style.justifyContent = 'center';
            container.style.position = 'relative';
            container.style.height = '200px';
            container.style.margin = '30px 0';

            // Draw white keys
            whiteKeys.forEach((note, index) => {
                const key = document.createElement('div');
                key.className = 'key white-key';
                key.dataset.note = note;
                key.style.left = index * 50 + 'px';
                key.innerHTML = `<div class="key-label">${note}</div>`;
                key.onclick = () => playNote(note);
                container.appendChild(key);
            });

            // Draw black keys
            const blackKeyPositions = [0.7, 1.7, 3.7, 4.7, 5.7];
            const blackKeyNotes = ['C#', 'D#', 'F#', 'G#', 'A#'];

            blackKeyNotes.forEach((note, index) => {
                const key = document.createElement('div');
                key.className = 'key black-key';
                key.dataset.note = note;
                key.style.left = blackKeyPositions[index] * 50 - 15 + 'px';
                key.innerHTML = `<div class="key-label">${note}</div>`;
                key.onclick = () => playNote(note);
                container.appendChild(key);
            });
        }

        function showScale() {
            const root = document.getElementById('scaleRoot').value;
            const type = document.getElementById('scaleType').value;
            const formula = scaleFormulas[type];
            const rootIndex = notes.indexOf(root);

            currentScale = formula.map(interval => notes[(rootIndex + interval) % 12]);

            // Highlight keys
            document.querySelectorAll('#keyboard .key').forEach(key => {
                key.classList.remove('highlight', 'active');
                if (currentScale.includes(key.dataset.note)) {
                    key.classList.add('highlight');
                }
            });

            // Update info
            const info = document.getElementById('scaleInfo');
            info.textContent = `${root} ${type} scale contains: ${currentScale.slice(0, -1).join(', ')}`;
        }

        function playScale() {
            currentScale.forEach((note, i) => {
                playNote(note, 0.5, i * 0.3);
            });
        }

        function showChord() {
            const root = document.getElementById('chordRoot').value;
            const type = document.getElementById('chordType').value;
            const formula = chordFormulas[type];
            const rootIndex = notes.indexOf(root);

            currentChord = formula.map(interval => notes[(rootIndex + interval) % 12]);

            // Highlight keys
            document.querySelectorAll('#keyboard-chords .key').forEach(key => {
                key.classList.remove('highlight', 'active');
                if (currentChord.includes(key.dataset.note)) {
                    key.classList.add('highlight');
                }
            });
        }

        function playChord() {
            currentChord.forEach((note) => {
                playNote(note, 1.5);
            });
        }

        function playProgression(chords) {
            chords.forEach((chord, i) => {
                const rootIndex = notes.indexOf(chord.replace('m', ''));
                const isMinor = chord.includes('m');
                const formula = isMinor ? chordFormulas.minor : chordFormulas.major;
                const chordNotes = formula.map(interval => notes[(rootIndex + interval) % 12]);

                chordNotes.forEach(note => {
                    playNote(note, 1, i * 1.2);
                });
            });
        }

        function showInterval() {
            const root = document.getElementById('intervalRoot').value;
            const interval = parseInt(document.getElementById('intervalType').value);
            const rootIndex = notes.indexOf(root);
            const targetNote = notes[(rootIndex + interval) % 12];

            currentInterval = [root, targetNote];

            document.querySelectorAll('#keyboard-intervals .key').forEach(key => {
                key.classList.remove('highlight', 'active');
                if (currentInterval.includes(key.dataset.note)) {
                    key.classList.add('highlight');
                }
            });
        }

        function playInterval() {
            if (currentInterval) {
                playNote(currentInterval[0], 0.8);
                playNote(currentInterval[1], 0.8, 0.8);
            }
        }

        function drawCircleOfFifths() {
            const canvas = document.getElementById('circle-of-fifths');
            const ctx = canvas.getContext('2d');
            const centerX = 250;
            const centerY = 250;
            const radius = 200;

            ctx.clearRect(0, 0, 500, 500);

            const fifths = ['C', 'G', 'D', 'A', 'E', 'B', 'F#', 'C#', 'G#', 'D#', 'A#', 'F'];
            const minors = ['Am', 'Em', 'Bm', 'F#m', 'C#m', 'G#m', 'D#m', 'A#m', 'Fm', 'Cm', 'Gm', 'Dm'];

            fifths.forEach((note, i) => {
                const angle = (i * 30 - 90) * Math.PI / 180;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);

                // Draw outer circle segment
                ctx.fillStyle = '#4fc3f7';
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, angle - 0.2, angle + 0.2);
                ctx.lineTo(centerX, centerY);
                ctx.fill();

                // Draw major key
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 18px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(note, x, y + 5);

                // Draw minor key
                const innerRadius = radius * 0.65;
                const innerX = centerX + innerRadius * Math.cos(angle);
                const innerY = centerY + innerRadius * Math.sin(angle);
                ctx.fillStyle = '#aaa';
                ctx.font = '14px Arial';
                ctx.fillText(minors[i], innerX, innerY + 5);
            });

            // Draw center circle
            ctx.fillStyle = 'rgba(20, 20, 40, 0.9)';
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.4, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#4fc3f7';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Circle', centerX, centerY - 10);
            ctx.fillText('of Fifths', centerX, centerY + 15);
        }

        function startExercise() {
            const area = document.getElementById('exerciseArea');
            const randomRoot = notes[Math.floor(Math.random() * notes.length)];
            const randomType = Math.random() > 0.5 ? 'major' : 'minor';
            const formula = chordFormulas[randomType];
            const rootIndex = notes.indexOf(randomRoot);
            const correctChord = formula.map(interval => notes[(rootIndex + interval) % 12]);

            // Play the chord
            correctChord.forEach(note => playNote(note, 1.5));

            questionCount++;
            document.getElementById('questionCount').textContent = questionCount;

            // Generate answer options
            const options = [randomRoot + (randomType === 'minor' ? 'm' : '')];
            while (options.length < 4) {
                const randomNote = notes[Math.floor(Math.random() * notes.length)];
                const randomChordType = Math.random() > 0.5 ? 'm' : '';
                const option = randomNote + randomChordType;
                if (!options.includes(option)) options.push(option);
            }
            options.sort(() => Math.random() - 0.5);

            area.innerHTML = `
                <div class="exercise-question">What chord did you hear?</div>
                <button onclick="startExercise()" style="margin: 20px;">ðŸ”Š Play Again</button>
                <div class="answer-buttons">
                    ${options.map(opt => `
                        <button class="answer-btn" onclick="checkAnswer('${opt}', '${options[0]}')">${opt}</button>
                    `).join('')}
                </div>
            `;
        }

        function checkAnswer(selected, correct) {
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === correct) {
                    btn.classList.add('correct');
                }
                if (btn.textContent === selected && selected !== correct) {
                    btn.classList.add('incorrect');
                }
            });

            if (selected === correct) {
                exerciseScore += 10;
                document.getElementById('exerciseScore').textContent = exerciseScore;
            }

            setTimeout(startExercise, 2000);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');

            // Initialize keyboards for each tab
            if (tabName === 'scales') drawKeyboard('keyboard');
            if (tabName === 'chords') drawKeyboard('keyboard-chords');
            if (tabName === 'intervals') drawKeyboard('keyboard-intervals');
            if (tabName === 'circle') drawCircleOfFifths();
        }

        // Initialize
        drawKeyboard('keyboard');
        drawKeyboard('keyboard-chords');
        drawKeyboard('keyboard-intervals');
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft Copilot - Automated Actions</title>
    <style>
        :root {
            --copilot-primary: #0F6CBD;
            --copilot-primary-hover: #0E5AA7;
            --copilot-text: #242424;
            --copilot-bg: #F5F5F5;
            --copilot-surface: #FFFFFF;
            --copilot-border: #E1E1E1;
            --copilot-hover-bg: #F0F0F0;
            --copilot-card-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            --copilot-focus-shadow: 0 0 0 2px rgba(15, 108, 189, 0.5);
            --copilot-success: #107C10;
            --copilot-error: #D83B01;
            --copilot-connector: #0F6CBD;
            --copilot-connector-bg: rgba(15, 108, 189, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background-color: var(--copilot-bg);
            color: var(--copilot-text);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            align-items: center;
            padding: 16px 0;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--copilot-border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo img {
            height: 28px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 600;
        }

        .import-export {
            margin-left: auto;
            display: flex;
            gap: 12px;
        }

        h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 24px;
            color: var(--copilot-text);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--copilot-text);
        }

        .section-tabs {
            display: flex;
            gap: 12px;
        }

        .section-tab {
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            background-color: transparent;
            color: var(--copilot-text);
            border: 1px solid var(--copilot-border);
        }

        .section-tab.active {
            background-color: var(--copilot-primary);
            color: white;
            border-color: var(--copilot-primary);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .action-card {
            background-color: var(--copilot-surface);
            border-radius: 8px;
            box-shadow: var(--copilot-card-shadow);
            padding: 20px;
            transition: all 0.2s ease;
            border: 1px solid var(--copilot-border);
            position: relative;
        }

        .action-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .agent-badge {
            display: inline-block;
            background-color: #E6F2F9;
            color: var(--copilot-primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .connector-badge {
            display: inline-flex;
            align-items: center;
            background-color: var(--copilot-connector-bg);
            color: var(--copilot-connector);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 12px;
            margin-left: 8px;
            gap: 4px;
        }

        .action-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--copilot-text);
        }

        .action-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 16px;
            height: 63px;
            overflow: hidden;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            outline: none;
            width: 100%;
        }

        .btn:focus {
            box-shadow: var(--copilot-focus-shadow);
        }

        .btn-primary {
            background-color: var(--copilot-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--copilot-primary-hover);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--copilot-primary);
            border: 1px solid var(--copilot-primary);
        }

        .btn-secondary:hover {
            background-color: rgba(15, 108, 189, 0.05);
        }

        .response-container {
            background-color: var(--copilot-surface);
            border-radius: 8px;
            box-shadow: var(--copilot-card-shadow);
            padding: 20px;
            margin-top: 24px;
            border: 1px solid var(--copilot-border);
        }

        .response-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .response-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--copilot-text);
        }

        .response-content {
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            padding: 16px;
            background-color: #F9F9F9;
            border-radius: 4px;
            border: 1px solid var(--copilot-border);
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.6;
        }

        .response-content code {
            background-color: #E8E8E8;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
        }

        .response-content strong {
            font-weight: 600;
        }

        .loading {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(15, 108, 189, 0.3);
            border-radius: 50%;
            border-top-color: var(--copilot-primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 14px;
            color: #666;
        }

        .status-message {
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 16px;
            display: none;
        }

        .status-success {
            background-color: #ECFAED;
            color: var(--copilot-success);
            border-left: 4px solid var(--copilot-success);
        }

        .status-error {
            background-color: #FDEFE8;
            color: var(--copilot-error);
            border-left: 4px solid var(--copilot-error);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--copilot-surface);
            border-radius: 8px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 24px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            color: #666;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--copilot-border);
            border-radius: 4px;
            font-size: 14px;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            resize: vertical;
            min-height: 200px;
        }

        .command-editor {
            min-height: 150px;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: var(--copilot-primary);
            font-size: 14px;
        }

        .file-label:hover {
            text-decoration: underline;
        }

        /* Custom agent actions section */
        .custom-actions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 32px;
            margin-bottom: 16px;
        }

        .custom-actions-title {
            font-size: 18px;
            font-weight: 600;
        }

        .custom-actions-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
        }

        /* Empty state for custom actions */
        .empty-state {
            text-align: center;
            padding: 40px;
            background-color: var(--copilot-surface);
            border-radius: 8px;
            border: 1px dashed var(--copilot-border);
            margin-bottom: 24px;
        }

        .empty-state-icon {
            font-size: 32px;
            color: #BDBDBD;
            margin-bottom: 12px;
        }

        .empty-state-text {
            color: #666;
            font-size: 14px;
            margin-bottom: 16px;
        }

        /* Tooltip for edit button */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            padding: 5px;
            border-radius: 3px;
            position: absolute;
            z-index: 1;
            bottom: 100%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Card button group */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .edit-btn {
            flex: 0 0 auto;
            width: auto;
            padding: 8px;
            background-color: transparent;
            color: var(--copilot-primary);
            border: 1px solid var(--copilot-primary);
        }

        .edit-btn:hover {
            background-color: rgba(15, 108, 189, 0.05);
        }

        .run-btn {
            flex: 1;
        }

        .connector-btn {
            position: absolute;
            right: -8px;
            top: calc(50% - 16px);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--copilot-connector);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        /* Command info section */
        .command-info {
            background-color: #F0F7FF;
            border-left: 4px solid var(--copilot-primary);
            padding: 12px;
            margin-bottom: 16px;
            font-size: 14px;
            color: #333;
        }

        /* Workflow section */
        .workflows-section {
            margin-bottom: 32px;
        }

        .workflow-container {
            background-color: var(--copilot-surface);
            border-radius: 8px;
            box-shadow: var(--copilot-card-shadow);
            padding: 24px;
            border: 1px solid var(--copilot-border);
        }

        .workflow-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .workflow-title {
            font-size: 18px;
            font-weight: 600;
        }

        .workflow-steps {
            display: flex;
            position: relative;
            margin-bottom: 24px;
        }

        .workflow-step {
            flex: 1;
            position: relative;
            padding: 16px;
            background-color: var(--copilot-bg);
            border-radius: 8px;
            border: 1px solid var(--copilot-border);
            margin-right: 40px;
        }

        .workflow-step:last-child {
            margin-right: 0;
        }

        .workflow-step-badge {
            display: inline-block;
            background-color: #E6F2F9;
            color: var(--copilot-primary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .workflow-step-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .workflow-step-description {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            height: 40px;
            overflow: hidden;
        }

        .workflow-step-connector {
            position: absolute;
            right: -30px;
            top: calc(50% - 12px);
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--copilot-connector);
        }

        .workflow-step-connector::after {
            content: "";
            position: absolute;
            width: 20px;
            height: 2px;
            background-color: var(--copilot-connector);
            left: 20px;
        }

        .workflow-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Create workflow modal */
        .connection-info {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            background-color: var(--copilot-connector-bg);
            padding: 12px;
            border-radius: 4px;
            font-size: 14px;
        }

        .connection-icon {
            margin-right: 12px;
            color: var(--copilot-connector);
        }

        .connection-text {
            flex: 1;
        }

        .agent-connection-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--copilot-border);
            border-radius: 4px;
            margin-bottom: 16px;
        }

        .agent-connection-item {
            padding: 12px;
            border-bottom: 1px solid var(--copilot-border);
            cursor: pointer;
        }

        .agent-connection-item:last-child {
            border-bottom: none;
        }

        .agent-connection-item:hover {
            background-color: var(--copilot-hover-bg);
        }

        .agent-connection-item.selected {
            background-color: var(--copilot-connector-bg);
        }

        .connection-step-badge {
            display: inline-block;
            background-color: #E6F2F9;
            color: var(--copilot-primary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            margin-right: 8px;
        }

        .connection-step-title {
            font-weight: 600;
        }

        .create-workflow-section {
            border-top: 1px solid var(--copilot-border);
            padding-top: 16px;
            margin-top: 16px;
        }

        .create-workflow-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--copilot-border);
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="14" cy="14" r="13" fill="#742774" />
                    <path d="M8 11L14 7L20 11V17L14 21L8 17V11Z" fill="white" stroke="#742774" stroke-width="0.5" />
                    <path d="M14 7V14M14 14V21M14 14L8 11M14 14L20 11" stroke="white" stroke-width="1.2" />
                    <circle cx="14" cy="14" r="2" fill="white" />
                </svg>
                <div class="logo-text">Microsoft Copilot</div>
            </div>
            <div class="import-export">
                <input type="file" id="fileInput" class="file-input" accept=".json">
                <label for="fileInput" class="file-label">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8.67969 1.83203C8.44401 1.59635 8.06234 1.59635 7.82666 1.83203L3.82666 5.83203C3.59098 6.06771 3.59098 6.44938 3.82666 6.68506C4.06234 6.92074 4.44401 6.92074 4.67969 6.68506L7.25 4.11474V11C7.25 11.3314 7.51865 11.6 7.85 11.6C8.18135 11.6 8.45 11.3314 8.45 11V4.11474L11.0203 6.68506C11.256 6.92074 11.6377 6.92074 11.8733 6.68506C12.109 6.44938 12.109 6.06771 11.8733 5.83203L8.67969 1.83203Z" fill="currentColor"/>
                        <path d="M2.5 9C2.5 8.66863 2.23137 8.4 1.9 8.4C1.56863 8.4 1.3 8.66863 1.3 9V12.1C1.3 13.041 2.05888 13.8 2.99998 13.8H13C13.9411 13.8 14.7 13.041 14.7 12.1V9C14.7 8.66863 14.4314 8.4 14.1 8.4C13.7686 8.4 13.5 8.66863 13.5 9V12.1C13.5 12.3761 13.2761 12.6 13 12.6H2.99998C2.72384 12.6 2.5 12.3761 2.5 12.1V9Z" fill="currentColor"/>
                    </svg>
                    Import Conversation
                </label>
                <button id="exportBtn" class="btn btn-secondary">Export Actions</button>
            </div>
        </header>

        <h1>Automated Actions</h1>

        <div id="statusMessage" class="status-message"></div>

        <!-- Workflows Section -->
        <div class="workflows-section">
            <div class="section-header">
                <div class="section-title">Connected Workflows</div>
                <button id="createWorkflowBtn" class="btn btn-primary" style="width: auto;">Create Workflow</button>
            </div>
            <div class="workflow-container">
                <div class="workflow-header">
                    <div class="workflow-title">Opportunity Summary Email</div>
                    <div>
                        <button class="btn btn-secondary" style="width: auto; margin-right: 8px;">Edit</button>
                        <button class="btn btn-primary" style="width: auto;" onclick="runWorkflow('opportunity-email')">Run Workflow</button>
                    </div>
                </div>
                <div class="workflow-steps">
                    <div class="workflow-step">
                        <div class="workflow-step-badge">Dynamics365CRUD Agent</div>
                        <div class="workflow-step-title">Get My Opportunities</div>
                        <div class="workflow-step-description">
                            Retrieve all active sales opportunities assigned to you from Dynamics 365.
                        </div>
                        <div class="workflow-step-connector">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="workflow-step">
                        <div class="workflow-step-badge">EmailDrafting Agent</div>
                        <div class="workflow-step-title">Send Opportunity Summary</div>
                        <div class="workflow-step-description">
                            Send an email with a summary of your active opportunities to your team.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Single Actions Section -->
        <div class="section-header">
            <div class="section-title">Single Actions</div>
            <div class="section-tabs">
                <button class="section-tab active" data-category="all">All</button>
                <button class="section-tab" data-category="email">Email</button>
                <button class="section-tab" data-category="dynamics">Dynamics 365</button>
                <button class="section-tab" data-category="memory">Memory</button>
            </div>
        </div>

        <div class="actions-grid">
            <!-- Email Actions -->
            <div class="action-card" data-category="email">
                <span class="agent-badge">EmailDrafting Agent</span>
                <div class="action-title">Send Status Update Email</div>
                <div class="action-description">
                    Send a weekly status update to your team lead with project progress and metrics.
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary edit-btn tooltip" data-action="sendStatusEmail">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="tooltiptext">Edit Command</span>
                    </button>
                    <button class="btn btn-primary run-btn" onclick="runAction('sendStatusEmail')">Run Action</button>
                </div>
                <button class="connector-btn tooltip" data-action="sendStatusEmail">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.5 21L3 16.5M3 16.5L7.5 12M3 16.5H16.5M16.5 3L21 7.5M21 7.5L16.5 12M21 7.5H7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="tooltiptext">Connect to another action</span>
                </button>
            </div>
            
            <div class="action-card" data-category="email">
                <span class="agent-badge">EmailDrafting Agent</span>
                <div class="action-title">Schedule Client Meeting</div>
                <div class="action-description">
                    Send a professional email to schedule a meeting with a client including agenda and details.
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary edit-btn tooltip" data-action="scheduleClientMeeting">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="tooltiptext">Edit Command</span>
                    </button>
                    <button class="btn btn-primary run-btn" onclick="runAction('scheduleClientMeeting')">Run Action</button>
                </div>
                <button class="connector-btn tooltip" data-action="scheduleClientMeeting">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        .5M3 16.5L7.5 12M3 16.5H16.5M16.5 3L21 7.5M21 7.5L16.5 12M21 7.5H7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="tooltiptext">Connect to another action</span>
                </button>
            </div>
            
            <!-- Dynamics 365 Actions -->
            <div class="action-card" data-category="dynamics">
                <span class="agent-badge">Dynamics365CRUD Agent</span>
                <div class="action-title">View My Opportunities</div>
                <div class="action-description">
                    Retrieve all active sales opportunities assigned to you from Dynamics 365.
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary edit-btn tooltip" data-action="getOpportunities">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="tooltiptext">Edit Command</span>
                    </button>
                    <button class="btn btn-primary run-btn" onclick="runAction('getOpportunities')">Run Action</button>
                </div>
                <button class="connector-btn tooltip" data-action="getOpportunities">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.5 21L3 16.5M3 16.5L7.5 12M3 16.5H16.5M16.5 3L21 7.5M21 7.5L16.5 12M21 7.5H7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="tooltiptext">Connect to another action</span>
                </button>
            </div>
            
            <div class="action-card" data-category="dynamics">
                <span class="agent-badge">Dynamics365CRUD Agent</span>
                <div class="action-title">Create Lead from Business Card</div>
                <div class="action-description">
                    Create a new lead in Dynamics 365 using scanned business card information.
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary edit-btn tooltip" data-action="createLead">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="tooltiptext">Edit Command</span>
                    </button>
                    <button class="btn btn-primary run-btn" onclick="runAction('createLead')">Run Action</button>
                </div>
                <button class="connector-btn tooltip" data-action="createLead">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.5 21L3 16.5M3 16.5L7.5 12M3 16.5H16.5M16.5 3L21 7.5M21 7.5L16.5 12M21 7.5H7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="tooltiptext">Connect to another action</span>
                </button>
            </div>
            
            <!-- Memory Actions -->
            <div class="action-card" data-category="memory">
                <span class="agent-badge">ManageMemory Agent</span>
                <div class="action-title">Save Daily Summary</div>
                <div class="action-description">
                    Save a summary of today's activities and outcomes to your personal memory.
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary edit-btn tooltip" data-action="saveDailySummary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="tooltiptext">Edit Command</span>
                    </button>
                    <button class="btn btn-primary run-btn" onclick="runAction('saveDailySummary')">Run Action</button>
                </div>
                <button class="connector-btn tooltip" data-action="saveDailySummary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.5 21L3 16.5M3 16.5L7.5 12M3 16.5H16.5M16.5 3L21 7.5M21 7.5L16.5 12M21 7.5H7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="tooltiptext">Connect to another action</span>
                </button>
            </div>
            
            <div class="action-card" data-category="memory">
                <span class="agent-badge">ContextMemory Agent</span>
                <div class="action-title">Recall Previous Interactions</div>
                <div class="action-description">
                    Retrieve context from your previous interactions with clients and projects.
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary edit-btn tooltip" data-action="recallContext">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="tooltiptext">Edit Command</span>
                    </button>
                    <button class="btn btn-primary run-btn" onclick="runAction('recallContext')">Run Action</button>
                </div>
                <button class="connector-btn tooltip" data-action="recallContext">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.5 21L3 16.5M3 16.5L7.5 12M3 16.5H16.5M16.5 3L21 7.5M21 7.5L16.5 12M21 7.5H7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="tooltiptext">Connect to another action</span>
                </button>
            </div>
        </div>

        <!-- Custom Actions from Imported JSON -->
        <div class="custom-actions-header">
            <div class="custom-actions-title">Imported Actions</div>
            <button id="clearCustomBtn" class="btn btn-secondary">Clear Imported Actions</button>
        </div>

        <div id="customActionsContainer" class="custom-actions-container">
            <div id="emptyState" class="empty-state">
                <div class="empty-state-icon">📁</div>
                <div class="empty-state-text">No custom actions imported yet. Import a conversation JSON file to see actions here.</div>
                <label for="fileInput" class="btn btn-primary" style="max-width: 200px; margin: 0 auto;">
                    Import Conversation
                </label>
            </div>
        </div>

        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <div class="loading-text">Processing your request...</div>
        </div>

        <div class="response-container">
            <div class="response-header">
                <div class="response-title">Response</div>
                <button id="clearResponseBtn" class="btn btn-secondary" style="width: auto;">Clear</button>
            </div>
            <div class="response-content" id="responseContent"></div>
        </div>
    </div>

    <!-- Command Editor Modal -->
    <div class="modal" id="commandModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="commandModalTitle">Edit Command</div>
                <button class="modal-close" id="commandModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="command-info">
                    This is the natural language instruction that will be sent to Microsoft Copilot. You can modify it to customize what the agent does or how it behaves.
                </div>
                <textarea id="commandContent" class="command-editor" placeholder="Enter your command here..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="commandModalCancel">Cancel</button>
                <button class="btn btn-primary" id="commandModalSave">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Create Workflow Modal -->
    <div class="modal" id="workflowModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="workflowModalTitle">Create Connected Workflow</div>
                <button class="modal-close" id="workflowModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="connection-info">
                    <div class="connection-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 17L4 12M4 12L9 7M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="connection-text">
                        Connect two actions to create a workflow where the output of the first action becomes input for the second action.
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="form-label">Select First Action:</div>
                    <div class="agent-connection-list" id="firstActionList">
                        <div class="agent-connection-item" data-action="getOpportunities">
                            <span class="connection-step-badge">Dynamics365CRUD</span>
                            <span class="connection-step-title">View My Opportunities</span>
                        </div>
                        <div class="agent-connection-item" data-action="createLead">
                            <span class="connection-step-badge">Dynamics365CRUD</span>
                            <span class="connection-step-title">Create Lead from Business Card</span>
                        </div>
                        <div class="agent-connection-item" data-action="recallContext">
                            <span class="connection-step-badge">ContextMemory</span>
                            <span class="connection-step-title">Recall Previous Interactions</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="form-label">Select Second Action:</div>
                    <div class="agent-connection-list" id="secondActionList">
                        <div class="agent-connection-item" data-action="sendStatusEmail">
                            <span class="connection-step-badge">EmailDrafting</span>
                            <span class="connection-step-title">Send Status Update Email</span>
                        </div>
                        <div class="agent-connection-item" data-action="scheduleClientMeeting">
                            <span class="connection-step-badge">EmailDrafting</span>
                            <span class="connection-step-title">Schedule Client Meeting</span>
                        </div>
                        <div class="agent-connection-item" data-action="saveDailySummary">
                            <span class="connection-step-badge">ManageMemory</span>
                            <span class="connection-step-title">Save Daily Summary</span>
                        </div>
                    </div>
                </div>
                
                <div class="create-workflow-section">
                    <div class="create-workflow-title">Workflow Details</div>
                    
                    <div class="form-group">
                        <label class="form-label" for="workflowName">Workflow Name:</label>
                        <input type="text" id="workflowName" class="form-input" placeholder="Enter a name for this workflow">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="connectionPrompt">Connection Prompt:</label>
                        <textarea id="connectionPrompt" class="form-input" style="min-height: 80px;" placeholder="Describe how the results of the first action should be used in the second action..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="workflowModalCancel">Cancel</button>
                <button class="btn btn-primary" id="workflowModalSave">Create Workflow</button>
            </div>
        </div>
    </div>

    <!-- Import/Export Modal -->
    <div class="modal" id="jsonModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Export Actions</div>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body">
                <textarea id="jsonContent" placeholder="Paste JSON here or view exported JSON"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalCancel">Cancel</button>
                <button class="btn btn-primary" id="modalConfirm">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // User GUID for memory operations
        const userGuid = "7b8e8f63-4d1b-42f0-95c2-d24b12345678";
        const apiUrl = "http://localhost:7071/api/businessinsightbot_function";
        
        // Store command templates (using natural language instead of parameter-focused prompts)
        const commandTemplates = {
            // Email actions
            sendStatusEmail: `Send a weekly status update email to my team lead with details on what I accomplished this week, current project progress metrics, and any blockers or risks I'm facing.`,
            
            scheduleClientMeeting: `Send a professional email to schedule a meeting with a potential client. Include proposed times, a clear agenda, and a brief summary of what we want to discuss. Make it personalized and friendly but professional.`,
            
            // Dynamics 365 actions
            getOpportunities: `Show me all my active sales opportunities in Dynamics 365. I want to see the name, estimated value, and probability for each one. Also calculate the total potential value of all opportunities.`,
            
            createLead: `Create a new lead in Dynamics 365 for John Smith, who is the CTO at Innovative Tech Solutions. I met him at the Tech Conference and he's interested in our cloud solutions package. His contact is john.smith@innovativetech.example.com and (555) 123-4567.`,
            
            // Memory actions
            saveDailySummary: `Save a summary of today's activities to my personal memory. Today I completed the product demo for Client ABC, prepared the quarterly report for the executive team, and resolved the integration issue with the payment gateway.`,
            
            recallContext: `Retrieve and summarize my previous interactions with clients and projects from my conversation history. Focus on recent client meetings and any important action items.`
        };

        // Connected workflow templates
        const workflowTemplates = {
            "opportunity-email": {
                name: "Opportunity Summary Email",
                steps: [
                    {
                        action: "getOpportunities",
                        title: "Get My Opportunities",
                        agent: "Dynamics365CRUD Agent",
                        description: "Retrieve all active sales opportunities assigned to you from Dynamics 365."
                    },
                    {
                        action: "sendOpportunitySummary",
                        title: "Send Opportunity Summary",
                        agent: "EmailDrafting Agent",
                        description: "Send an email with a summary of your active opportunities to your team."
                    }
                ],
                connectionPrompt: "Take the list of opportunities from the first action and create a well-formatted email summarizing the key opportunities, their values, and status. Send this summary to my team lead with a professional tone."
            }
        };
        
        // Store additional command for the workflow
        commandTemplates.sendOpportunitySummary = `Draft an email to my team lead with a summary of my current sales opportunities. Include the total value of all opportunities and highlight the ones with the highest probability of closing. Make it concise but informative.`;
        
        // User-customized commands (initialized from templates but can be modified)
        let userCommands = JSON.parse(JSON.stringify(commandTemplates));
        
        // Store custom actions and workflows
        let customActions = [];
        let userWorkflows = JSON.parse(JSON.stringify(workflowTemplates));
        
        // DOM elements
        const loadingIndicator = document.getElementById('loadingIndicator');
        const responseContent = document.getElementById('responseContent');
        const statusMessage = document.getElementById('statusMessage');
        const customActionsContainer = document.getElementById('customActionsContainer');
        const emptyState = document.getElementById('emptyState');
        const fileInput = document.getElementById('fileInput');
        const exportBtn = document.getElementById('exportBtn');
        const clearCustomBtn = document.getElementById('clearCustomBtn');
        const clearResponseBtn = document.getElementById('clearResponseBtn');
        
        // Category filtering
        const categoryTabs = document.querySelectorAll('.section-tab');
        const actionCards = document.querySelectorAll('.action-card');
        
        // Modal elements
        const jsonModal = document.getElementById('jsonModal');
        const modalTitle = document.getElementById('modalTitle');
        const jsonContent = document.getElementById('jsonContent');
        const modalClose = document.getElementById('modalClose');
        const modalCancel = document.getElementById('modalCancel');
        const modalConfirm = document.getElementById('modalConfirm');
        
        // Command editor modal elements
        const commandModal = document.getElementById('commandModal');
        const commandModalTitle = document.getElementById('commandModalTitle');
        const commandContent = document.getElementById('commandContent');
        const commandModalClose = document.getElementById('commandModalClose');
        const commandModalCancel = document.getElementById('commandModalCancel');
        const commandModalSave = document.getElementById('commandModalSave');
        
        // Workflow modal elements
        const workflowModal = document.getElementById('workflowModal');
        const workflowModalTitle = document.getElementById('workflowModalTitle');
        const firstActionList = document.getElementById('firstActionList');
        const secondActionList = document.getElementById('secondActionList');
        const workflowName = document.getElementById('workflowName');
        const connectionPrompt = document.getElementById('connectionPrompt');
        const workflowModalClose = document.getElementById('workflowModalClose');
        const workflowModalCancel = document.getElementById('workflowModalCancel');
        const workflowModalSave = document.getElementById('workflowModalSave');
        const createWorkflowBtn = document.getElementById('createWorkflowBtn');
        
        // Current action being edited
        let currentEditAction = null;
        
        // Current workflow being created
        let selectedFirstAction = null;
        let selectedSecondAction = null;
        
        // Show loading indicator
        function showLoading() {
            loadingIndicator.style.display = 'flex';
        }
        
        // Hide loading indicator
        function hideLoading() {
            loadingIndicator.style.display = 'none';
        }
        
        // Show status message
        function showStatus(message, isError = false) {
            statusMessage.textContent = message;
            statusMessage.className = isError 
                ? 'status-message status-error' 
                : 'status-message status-success';
            statusMessage.style.display = 'block';
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }
        
        // Format response with markdown-like syntax highlighting
        function formatResponse(text) {
            if (!text) return '';
            
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/^#\s+(.*?)$/gm, '<h1>$1</h1>')
                .replace(/^##\s+(.*?)$/gm, '<h2>$1</h2>')
                .replace(/^###\s+(.*?)$/gm, '<h3>$1</h3>')
                .replace(/\n/g, '<br>');
        }
        
        // Send request to API
        async function sendRequest(message) {
            showLoading();
            responseContent.innerHTML = '';
            
            try {
                // For demo purposes, we'll simulate the API call
                const simulateAPI = true;
                
                if (simulateAPI) {
                    // Wait for a simulated response time
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // Generate a simulated response based on the message
                    let simulatedResponse;
                    
                    if (message.includes('email') || message.includes('Email')) {
                        simulatedResponse = {
                            assistant_response: "**Email Action Completed**\n\nI've drafted an email based on your request. Here's a summary:\n\n- **Type**: " + 
                                (message.includes("status update") ? "Status Update" : "Meeting Request") + 
                                "\n- **Recipient**: " + (message.includes("team lead") ? "Your team lead" : "Potential client") + 
                                "\n- **Status**: Successfully sent\n\nThe email has been sent with a professional tone and includes all the details you requested. Is there anything else you'd like me to help with?",
                            user_guid: userGuid
                        };
                    } else if (message.includes('opportunities') || message.includes('Dynamics')) {
                        if (message.includes('opportunities')) {
                            simulatedResponse = {
                                assistant_response: "**Active Opportunities Retrieved**\n\nI've found 3 active opportunities assigned to you:\n\n1. **Enterprise Cloud Migration** - $120,000 (75% probability)\n2. **Data Analytics Platform** - $85,500 (60% probability)\n3. **Security Compliance Assessment** - $45,000 (90% probability)\n\nTotal potential value: **$250,500**\n\nWould you like more details about any specific opportunity?",
                                user_guid: userGuid
                            };
                        } else {
                            simulatedResponse = {
                                assistant_response: "**Lead Created Successfully**\n\nI've added John Smith as a new lead in Dynamics 365 with the following details:\n\n- **Name**: John Smith\n- **Company**: Innovative Tech Solutions\n- **Position**: CTO\n- **Email**: john.smith@innovativetech.example.com\n- **Phone**: (555) 123-4567\n- **Interest**: Cloud solutions package\n- **Source**: Tech Conference\n\nThe lead has been assigned to your queue. Would you like to schedule a follow-up task?",
                                user_guid: userGuid
                            };
                        }
                    } else if (message.includes('memory') || message.includes('summary')) {
                        if (message.includes('save') || message.includes('Save')) {
                            simulatedResponse = {
                                assistant_response: "**Daily Summary Saved**\n\nI've saved today's activities to your personal memory:\n\n- Completed product demo for Client ABC\n- Prepared quarterly report for executive team\n- Resolved integration issue with payment gateway\n\nThese activities have been tagged and stored for future reference. You can recall this information later when needed.",
                                user_guid: userGuid
                            };
                        } else {
                            simulatedResponse = {
                                assistant_response: "**Previous Interactions Retrieved**\n\nHere's a summary of your recent client interactions:\n\n- **Client ABC** (3 days ago): Completed product demo, client requested follow-up meeting to discuss contract details\n- **XYZ Corp** (1 week ago): Presented security assessment findings, client approved phase 2 of the project\n- **Global Solutions** (2 weeks ago): Initial consultation, identified needs for data migration solution\n\nI've also found notes about an upcoming quarterly business review scheduled for next Tuesday at 2 PM.\n\nWould you like me to provide more details on any of these interactions?",
                                user_guid: userGuid
                            };
                        }
                    } else if (message.includes('workflow') || message.includes('Workflow')) {
                        simulatedResponse = {
                            assistant_response: "**Workflow Executed: Opportunity Summary Email**\n\n**Step 1**: Retrieved your opportunities from Dynamics 365\n- Found 3 active opportunities\n- Total value: $250,500\n\n**Step 2**: Created and sent email summary\n- Sent to: team.lead@example.com\n- Included summary of all opportunities\n- Highlighted Security Compliance Assessment (90% probability) as most likely to close\n\nThe workflow completed successfully. Your team lead should receive the email shortly.",
                            user_guid: userGuid
                        };
                    } else if (message.includes('SOWAutoAnswerEfficient') || message.includes('process_documents')) {
                        simulatedResponse = {
                            assistant_response: "**Document Processing Complete**\n\n- **File Processed**: `folder (2).txt`\n- **Chunks Processed**: 23\n- **Processing Timestamp**: " + new Date().toISOString() + "\n\nIf there is anything more you need regarding the processed document or further actions, let me know!",
                            user_guid: userGuid
                        };
                    } else if (message.includes('auto_answer_questions')) {
                        simulatedResponse = {
                            assistant_response: "**Auto-Answer Process Complete**\n\n- **Questions Processed**: 5\n- **Questions Auto-Answered**: 0 (with confidence >= 0.85)\n\nIt seems there were no questions with high enough confidence to be auto-answered. If you need any further assistance or have specific requirements, feel free to let me know!",
                            user_guid: userGuid
                        };
                    } else {
                        simulatedResponse = {
                            assistant_response: "I've processed your request, but I'm not sure how to handle it specifically. Could you provide more details about what you're trying to do?",
                            user_guid: userGuid
                        };
                    }
                    
                    responseContent.innerHTML = formatResponse(simulatedResponse.assistant_response);
                } else {
                    // Real API call
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            user_input: message,
                            conversation_history: [],
                            user_guid: userGuid
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Request failed with status ${response.status}`);
                    }
                    
                    const data = await response.json();
                    responseContent.innerHTML = formatResponse(data.assistant_response);
                }
            } catch (error) {
                console.error('Error:', error);
                responseContent.innerHTML = `<div style="color: var(--copilot-error);">Error: ${error.message}</div>`;
                showStatus(`Failed to process request: ${error.message}`, true);
            } finally {
                hideLoading();
            }
        }
        
        // Run an action with the associated command
        function runAction(actionName) {
            // Get the appropriate command (either from user customized commands or from templates as fallback)
            const command = userCommands[actionName] || commandTemplates[actionName];
            
            if (!command) {
                showStatus(`Command not found for action: ${actionName}`, true);
                return;
            }
            
            sendRequest(command);
        }
        
        // Run a workflow with multiple connected steps
        function runWorkflow(workflowId) {
            const workflow = userWorkflows[workflowId];
            
            if (!workflow) {
                showStatus(`Workflow not found: ${workflowId}`, true);
                return;
            }
            
            // For demo purposes, we'll just use the connectionPrompt as the command to send
            // In a real implementation, each step would be executed sequentially
            const command = `Execute workflow "${workflow.name}" with the following steps:
1. ${workflow.steps[0].title}
2. ${workflow.steps[1].title}

Connection: ${workflow.connectionPrompt}`;
            
            sendRequest(command);
        }
        
        // Edit a command
        function editCommand(actionName) {
            currentEditAction = actionName;
            
            // Get current command text
            const commandText = userCommands[actionName] || commandTemplates[actionName];
            
            // Set title and content
            commandModalTitle.textContent = `Edit Command: ${actionName.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}`;
            commandContent.value = commandText;
            
            // Show modal
            commandModal.style.display = 'flex';
        }
        
        // Save edited command
        function saveCommand() {
            if (!currentEditAction) return;
            
            // Save updated command
            userCommands[currentEditAction] = commandContent.value;
            
            // Close modal
            commandModal.style.display = 'none';
            
            showStatus(`Command for "${currentEditAction}" has been updated`, false);
            currentEditAction = null;
        }
        
        // Custom action handler
        function executeCustomAction(action) {
            // For custom actions from imports, we use the content directly
            sendRequest(action.content);
        }
        
        // Parse conversation JSON
        function parseConversationJSON(json) {
            try {
                const data = JSON.parse(json);
                const extracted = [];
                
                // Check if it's a valid conversation
                if (!data.conversation || !Array.isArray(data.conversation)) {
                    throw new Error('Invalid conversation format');
                }
                
                // Extract commands from user messages
                for (let i = 0; i < data.conversation.length; i++) {
                    const message = data.conversation[i];
                    
                    // Only look at user messages
                    if (message.role === 'user') {
                        const content = message.content.trim();
                        
                        // Extract command-like messages
                        if (content && (
                            content.startsWith('process_documents') ||
                            content.startsWith('auto_answer_questions') ||
                            content.includes('agent') || 
                            content.includes('Agent') ||
                            content.includes('Use the') ||
                            content.toLowerCase().includes('parameters')
                        )) {
                            // Create a nice title based on the content
                            let title = content;
                            
                            if (content === 'process_documents') {
                                title = 'Process Documents';
                            } else if (content === 'auto_answer_questions') {
                                title = 'Auto-Answer Questions';
                            } else if (content.length > 50) {
                                title = content.substring(0, 47) + '...';
                            }
                            
                            // Determine agent type
                            let agentType = 'Custom Agent';
                            if (content.includes('EmailDrafting')) {
                                agentType = 'EmailDrafting Agent';
                            } else if (content.includes('Dynamics365CRUD')) {
                                agentType = 'Dynamics365CRUD Agent';
                            } else if (content.includes('ManageMemory')) {
                                agentType = 'ManageMemory Agent';
                            } else if (content.includes('ContextMemory')) {
                                agentType = 'ContextMemory Agent';
                            } else if (content.includes('process_documents') || content.includes('auto_answer_questions')) {
                                agentType = 'SOWAutoAnswerEfficient Agent';
                            }
                            
                            // Get a short description
                            let description = 'Custom command from imported conversation.';
                            
                            if (content.includes('email')) {
                                description = 'Send an email with specific parameters.';
                            } else if (content.includes('opportunities')) {
                                description = 'Retrieve active sales opportunities from Dynamics 365.';
                            } else if (content.includes('lead')) {
                                description = 'Create a new sales lead in Dynamics 365.';
                            } else if (content.includes('memory') || content.includes('Memory')) {
                                description = 'Save or retrieve memory information.';
                            } else if (content === 'process_documents') {
                                description = 'Process document files for analysis.';
                            } else if (content === 'auto_answer_questions') {
                                description = 'Automatically answer questions from processed documents.';
                            }
                            
                            extracted.push({
                                id: `imported-action-${extracted.length + 1}`,
                                title: title,
                                agentType: agentType,
                                description: description,
                                content: content
                            });
                        }
                    }
                }
                
                return extracted;
            } catch (error) {
                console.error('Error parsing JSON:', error);
                showStatus(`Failed to parse JSON: ${error.message}`, true);
                return [];
            }
        }
        
        // Render custom actions
        function renderCustomActions() {
            if (customActions.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Clear existing custom actions
            customActionsContainer.innerHTML = '';
            
            // Render each custom action
            customActions.forEach(action => {
                const actionCard = document.createElement('div');
                actionCard.className = 'action-card';
                actionCard.setAttribute('data-category', 'custom');
                actionCard.innerHTML = `
                    <span class="agent-badge">${action.agentType}</span>
                    <div class="action-title">${action.title}</div>
                    <div class="action-description">
                        ${action.description}
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary edit-btn tooltip" data-custom-action="${action.id}">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span class="tooltiptext">Edit Command</span>
                        </button>
                        <button class="btn btn-primary run-btn" id="action-${action.id}">Run Action</button>
                    </div>
                    <button class="connector-btn tooltip" data-custom-action="${action.id}">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M7.5 21L3 16.5M3 16.5L7.5 12M3 16.5H16.5M16.5 3L21 7.5M21 7.5L16.5 12M21 7.5H7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="tooltiptext">Connect to another action</span>
                    </button>
                `;
                
                customActionsContainer.appendChild(actionCard);
                
                // Add event listener for run button
                document.getElementById(`action-${action.id}`).addEventListener('click', () => {
                    executeCustomAction(action);
                });
            });
            
            // Add event listeners for edit buttons
            document.querySelectorAll('[data-custom-action]').forEach(button => {
                if (button.classList.contains('edit-btn')) {
                    button.addEventListener('click', () => {
                        const actionId = button.getAttribute('data-custom-action');
                        editCustomAction(actionId);
                    });
                } else if (button.classList.contains('connector-btn')) {
                    button.addEventListener('click', () => {
                        const actionId = button.getAttribute('data-custom-action');
                        showConnectorModal(actionId, true);
                    });
                }
            });
        }
        
        // Edit custom action
        function editCustomAction(actionId) {
            const action = customActions.find(a => a.id === actionId);
            if (!action) return;
            
            // Set title and content
            commandModalTitle.textContent = `Edit Command: ${action.title}`;
            commandContent.value = action.content;
            
            // Set current action for saving
            currentEditAction = { type: 'custom', id: actionId };
            
            // Show modal
            commandModal.style.display = 'flex';
        }
        
        // Save custom action
        function saveCustomAction() {
            if (!currentEditAction || currentEditAction.type !== 'custom') return;
            
            const actionId = currentEditAction.id;
            const actionIndex = customActions.findIndex(a => a.id === actionId);
            
            if (actionIndex === -1) return;
            
            // Update the content
            customActions[actionIndex].content = commandContent.value;
            
            // Close modal
            commandModal.style.display = 'none';
            
            showStatus(`Command for "${customActions[actionIndex].title}" has been updated`, false);
            currentEditAction = null;
        }
        
        // Filter actions by category
        function filterActions(category) {
            actionCards.forEach(card => {
                if (category === 'all' || card.getAttribute('data-category') === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Show connector creation modal
        function showConnectorModal(actionId, isCustomAction = false) {
            // Reset selections
            selectedFirstAction = null;
            selectedSecondAction = null;
            
            // Reset workflow name and connection prompt
            workflowName.value = '';
            connectionPrompt.value = '';
            
            // Clear selected state from all items
            document.querySelectorAll('.agent-connection-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Show the modal
            workflowModal.style.display = 'flex';
        }
        
        // Create a new workflow
        function createNewWorkflow() {
            if (!selectedFirstAction || !selectedSecondAction || !workflowName.value.trim()) {
                showStatus('Please select both actions and provide a workflow name', true);
                return;
            }
            
            // Generate a unique ID for the workflow
            const workflowId = `workflow-${Date.now()}`;
            
            // Get action details
            const firstActionTitle = firstActionList.querySelector(`.agent-connection-item[data-action="${selectedFirstAction}"] .connection-step-title`).textContent;
            const firstActionAgent = firstActionList.querySelector(`.agent-connection-item[data-action="${selectedFirstAction}"] .connection-step-badge`).textContent + " Agent";
            
            const secondActionTitle = secondActionList.querySelector(`.agent-connection-item[data-action="${selectedSecondAction}"] .connection-step-title`).textContent;
            const secondActionAgent = secondActionList.querySelector(`.agent-connection-item[data-action="${selectedSecondAction}"] .connection-step-badge`).textContent + " Agent";
            
            // Create the workflow
            userWorkflows[workflowId] = {
                name: workflowName.value.trim(),
                steps: [
                    {
                        action: selectedFirstAction,
                        title: firstActionTitle,
                        agent: firstActionAgent,
                        description: "First step in the workflow"
                    },
                    {
                        action: selectedSecondAction,
                        title: secondActionTitle,
                        agent: secondActionAgent,
                        description: "Second step in the workflow"
                    }
                ],
                connectionPrompt: connectionPrompt.value.trim() || `Use the results from ${firstActionTitle} as input for ${secondActionTitle}`
            };
            
            // Close the modal
            workflowModal.style.display = 'none';
            
            // Show success message
            showStatus(`New workflow "${workflowName.value.trim()}" created successfully`);
            
            // In a real app, you would update the UI to show the new workflow
            // For this demo, we'll just reload the page
            location.reload();
        }
        
        // Event Listeners for standard actions' edit buttons
        document.querySelectorAll('[data-action]').forEach(button => {
            if (button.classList.contains('edit-btn')) {
                button.addEventListener('click', () => {
                    const actionName = button.getAttribute('data-action');
                    editCommand(actionName);
                });
            } else if (button.classList.contains('connector-btn')) {
                button.addEventListener('click', () => {
                    const actionName = button.getAttribute('data-action');
                    showConnectorModal(actionName);
                });
            }
        });
        
        // Category filter event listeners
        categoryTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Update active state
                categoryTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Filter actions
                const category = tab.getAttribute('data-category');
                filterActions(category);
            });
        });
        
        // Workflow creation button
        createWorkflowBtn.addEventListener('click', () => {
            showConnectorModal();
        });
        
        // Workflow modal action selection
        document.querySelectorAll('#firstActionList .agent-connection-item').forEach(item => {
            item.addEventListener('click', () => {
                // Clear existing selection
                document.querySelectorAll('#firstActionList .agent-connection-item').forEach(i => {
                    i.classList.remove('selected');
                });
                
                // Set new selection
                item.classList.add('selected');
                selectedFirstAction = item.getAttribute('data-action');
            });
        });
        
        document.querySelectorAll('#secondActionList .agent-connection-item').forEach(item => {
            item.addEventListener('click', () => {
                // Clear existing selection
                document.querySelectorAll('#secondActionList .agent-connection-item').forEach(i => {
                    i.classList.remove('selected');
                });
                
                // Set new selection
                item.classList.add('selected');
                selectedSecondAction = item.getAttribute('data-action');
            });
        });
        
        // File input change handler
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const jsonContent = e.target.result;
                    const newActions = parseConversationJSON(jsonContent);
                    
                    if (newActions.length > 0) {
                        customActions = [...customActions, ...newActions];
                        renderCustomActions();
                        showStatus(`Successfully imported ${newActions.length} actions from conversation`);
                    } else {
                        showStatus('No actionable commands found in the imported conversation', true);
                    }
                } catch (error) {
                    showStatus(`Failed to import: ${error.message}`, true);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            fileInput.value = '';
        });
        
        // Export button
        exportBtn.addEventListener('click', () => {
            modalTitle.textContent = 'Export Actions';
            jsonContent.value = JSON.stringify({
                singleActions: Object.keys(userCommands).map(key => ({
                    action: key,
                    title: key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()),
                    command: userCommands[key]
                })),
                customActions: customActions,
                workflows: Object.keys(userWorkflows).map(key => ({
                    id: key,
                    ...userWorkflows[key]
                }))
            }, null, 2);
            
            // Configure modal for export
            modalConfirm.style.display = 'none';
            modalCancel.textContent = 'Close';
            
            jsonModal.style.display = 'flex';
        });
        
        // Clear custom actions button
        clearCustomBtn.addEventListener('click', () => {
            customActions = [];
            renderCustomActions();
            showStatus('Custom actions cleared');
        });
        
        // Clear response button
        clearResponseBtn.addEventListener('click', () => {
            responseContent.innerHTML = '';
        });
        
        // Command modal handlers
        commandModalClose.addEventListener('click', () => {
            commandModal.style.display = 'none';
            currentEditAction = null;
        });
        
        commandModalCancel.addEventListener('click', () => {
            commandModal.style.display = 'none';
            currentEditAction = null;
        });
        
        commandModalSave.addEventListener('click', () => {
            if (currentEditAction) {
                if (typeof currentEditAction === 'string') {
                    // Standard action
                    saveCommand();
                } else if (currentEditAction.type === 'custom') {
                    // Custom action
                    saveCustomAction();
                }
            }
        });
        
        // Workflow modal handlers
        workflowModalClose.addEventListener('click', () => {
            workflowModal.style.display = 'none';
        });
        
        workflowModalCancel.addEventListener('click', () => {
            workflowModal.style.display = 'none';
        });
        
        workflowModalSave.addEventListener('click', createNewWorkflow);
        
        // JSON modal close handlers
        modalClose.addEventListener('click', () => {
            jsonModal.style.display = 'none';
        });
        
        modalCancel.addEventListener('click', () => {
            jsonModal.style.display = 'none';
        });
        
        modalConfirm.addEventListener('click', () => {
            // This is for future import functionality
            jsonModal.style.display = 'none';
        });
        
        // Close modals if clicking outside
        window.addEventListener('click', (event) => {
            if (event.target === jsonModal) {
                jsonModal.style.display = 'none';
            }
            if (event.target === commandModal) {
                commandModal.style.display = 'none';
                currentEditAction = null;
            }
            if (event.target === workflowModal) {
                workflowModal.style.display = 'none';
            }
        });
        
        // Initialize the app with sample imported actions
        document.addEventListener('DOMContentLoaded', () => {
            // Simulate importing from the provided sample
            const sampleCommandActions = [
                {
                    id: 'imported-action-1',
                    title: 'Process Documents',
                    agentType: 'SOWAutoAnswerEfficient Agent',
                    description: 'Process document files for analysis.',
                    content: 'process_documents'
                },
                {
                    id: 'imported-action-2',
                    title: 'Auto-Answer Questions',
                    agentType: 'SOWAutoAnswerEfficient Agent',
                    description: 'Automatically answer questions from processed documents.',
                    content: 'auto_answer_questions'
                }
            ];
            
            customActions = sampleCommandActions;
            renderCustomActions();
        });
    </script>
</body>
</html>
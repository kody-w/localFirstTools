<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft Copilot - Automated Actions</title>
    <style>
        :root {
            --copilot-primary: #0F6CBD;
            --copilot-primary-hover: #0E5AA7;
            --copilot-text: #242424;
            --copilot-bg: #F5F5F5;
            --copilot-surface: #FFFFFF;
            --copilot-border: #E1E1E1;
            --copilot-hover-bg: #F0F0F0;
            --copilot-card-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            --copilot-focus-shadow: 0 0 0 2px rgba(15, 108, 189, 0.5);
            --copilot-success: #107C10;
            --copilot-error: #D83B01;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background-color: var(--copilot-bg);
            color: var(--copilot-text);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            align-items: center;
            padding: 16px 0;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--copilot-border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo img {
            height: 28px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 600;
        }

        .import-export {
            margin-left: auto;
            display: flex;
            gap: 12px;
        }

        h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 24px;
            color: var(--copilot-text);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .action-card {
            background-color: var(--copilot-surface);
            border-radius: 8px;
            box-shadow: var(--copilot-card-shadow);
            padding: 20px;
            transition: all 0.2s ease;
            border: 1px solid var(--copilot-border);
        }

        .action-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .agent-badge {
            display: inline-block;
            background-color: #E6F2F9;
            color: var(--copilot-primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .action-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--copilot-text);
        }

        .action-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 16px;
            height: 63px;
            overflow: hidden;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            outline: none;
            width: 100%;
        }

        .btn:focus {
            box-shadow: var(--copilot-focus-shadow);
        }

        .btn-primary {
            background-color: var(--copilot-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--copilot-primary-hover);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--copilot-primary);
            border: 1px solid var(--copilot-primary);
        }

        .btn-secondary:hover {
            background-color: rgba(15, 108, 189, 0.05);
        }

        .response-container {
            background-color: var(--copilot-surface);
            border-radius: 8px;
            box-shadow: var(--copilot-card-shadow);
            padding: 20px;
            margin-top: 24px;
            border: 1px solid var(--copilot-border);
        }

        .response-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .response-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--copilot-text);
        }

        .response-content {
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            padding: 16px;
            background-color: #F9F9F9;
            border-radius: 4px;
            border: 1px solid var(--copilot-border);
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.6;
        }

        .response-content code {
            background-color: #E8E8E8;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
        }

        .response-content strong {
            font-weight: 600;
        }

        .loading {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(15, 108, 189, 0.3);
            border-radius: 50%;
            border-top-color: var(--copilot-primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 14px;
            color: #666;
        }

        .status-message {
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 16px;
            display: none;
        }

        .status-success {
            background-color: #ECFAED;
            color: var(--copilot-success);
            border-left: 4px solid var(--copilot-success);
        }

        .status-error {
            background-color: #FDEFE8;
            color: var(--copilot-error);
            border-left: 4px solid var(--copilot-error);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--copilot-surface);
            border-radius: 8px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 24px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            color: #666;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--copilot-border);
            border-radius: 4px;
            font-size: 14px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            resize: vertical;
            min-height: 200px;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: var(--copilot-primary);
            font-size: 14px;
        }

        .file-label:hover {
            text-decoration: underline;
        }

        /* Custom agent actions section */
        .custom-actions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 32px;
            margin-bottom: 16px;
        }

        .custom-actions-title {
            font-size: 18px;
            font-weight: 600;
        }

        .custom-actions-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
        }

        /* Empty state for custom actions */
        .empty-state {
            text-align: center;
            padding: 40px;
            background-color: var(--copilot-surface);
            border-radius: 8px;
            border: 1px dashed var(--copilot-border);
            margin-bottom: 24px;
        }

        .empty-state-icon {
            font-size: 32px;
            color: #BDBDBD;
            margin-bottom: 12px;
        }

        .empty-state-text {
            color: #666;
            font-size: 14px;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="14" cy="14" r="13" fill="#742774" />
                    <path d="M8 11L14 7L20 11V17L14 21L8 17V11Z" fill="white" stroke="#742774" stroke-width="0.5" />
                    <path d="M14 7V14M14 14V21M14 14L8 11M14 14L20 11" stroke="white" stroke-width="1.2" />
                    <circle cx="14" cy="14" r="2" fill="white" />
                </svg>
                <div class="logo-text">Microsoft Copilot</div>
            </div>
            <div class="import-export">
                <input type="file" id="fileInput" class="file-input" accept=".json">
                <label for="fileInput" class="file-label">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8.67969 1.83203C8.44401 1.59635 8.06234 1.59635 7.82666 1.83203L3.82666 5.83203C3.59098 6.06771 3.59098 6.44938 3.82666 6.68506C4.06234 6.92074 4.44401 6.92074 4.67969 6.68506L7.25 4.11474V11C7.25 11.3314 7.51865 11.6 7.85 11.6C8.18135 11.6 8.45 11.3314 8.45 11V4.11474L11.0203 6.68506C11.256 6.92074 11.6377 6.92074 11.8733 6.68506C12.109 6.44938 12.109 6.06771 11.8733 5.83203L8.67969 1.83203Z" fill="currentColor"/>
                        <path d="M2.5 9C2.5 8.66863 2.23137 8.4 1.9 8.4C1.56863 8.4 1.3 8.66863 1.3 9V12.1C1.3 13.041 2.05888 13.8 2.99998 13.8H13C13.9411 13.8 14.7 13.041 14.7 12.1V9C14.7 8.66863 14.4314 8.4 14.1 8.4C13.7686 8.4 13.5 8.66863 13.5 9V12.1C13.5 12.3761 13.2761 12.6 13 12.6H2.99998C2.72384 12.6 2.5 12.3761 2.5 12.1V9Z" fill="currentColor"/>
                    </svg>
                    Import Conversation
                </label>
                <button id="exportBtn" class="btn btn-secondary">Export Actions</button>
            </div>
        </header>

        <h1>Automated Actions</h1>

        <div id="statusMessage" class="status-message"></div>

        <div class="actions-grid">
            <!-- Email Actions -->
            <div class="action-card">
                <span class="agent-badge">EmailDrafting Agent</span>
                <div class="action-title">Send Status Update Email</div>
                <div class="action-description">
                    Send a weekly status update to your team lead with project progress and metrics.
                </div>
                <button class="btn btn-primary" onclick="sendStatusEmail()">Run Action</button>
            </div>
            
            <div class="action-card">
                <span class="agent-badge">EmailDrafting Agent</span>
                <div class="action-title">Schedule Client Meeting</div>
                <div class="action-description">
                    Send a professional email to schedule a meeting with a client including agenda and details.
                </div>
                <button class="btn btn-primary" onclick="scheduleClientMeeting()">Run Action</button>
            </div>
            
            <!-- Dynamics 365 Actions -->
            <div class="action-card">
                <span class="agent-badge">Dynamics365CRUD Agent</span>
                <div class="action-title">View My Opportunities</div>
                <div class="action-description">
                    Retrieve all active sales opportunities assigned to you from Dynamics 365.
                </div>
                <button class="btn btn-primary" onclick="getOpportunities()">Run Action</button>
            </div>
            
            <div class="action-card">
                <span class="agent-badge">Dynamics365CRUD Agent</span>
                <div class="action-title">Create Lead from Business Card</div>
                <div class="action-description">
                    Create a new lead in Dynamics 365 using scanned business card information.
                </div>
                <button class="btn btn-primary" onclick="createLead()">Run Action</button>
            </div>
            
            <!-- Memory Actions -->
            <div class="action-card">
                <span class="agent-badge">ManageMemory Agent</span>
                <div class="action-title">Save Daily Summary</div>
                <div class="action-description">
                    Save a summary of today's activities and outcomes to your personal memory.
                </div>
                <button class="btn btn-primary" onclick="saveDailySummary()">Run Action</button>
            </div>
            
            <div class="action-card">
                <span class="agent-badge">ContextMemory Agent</span>
                <div class="action-title">Recall Previous Interactions</div>
                <div class="action-description">
                    Retrieve context from your previous interactions with clients and projects.
                </div>
                <button class="btn btn-primary" onclick="recallContext()">Run Action</button>
            </div>
        </div>

        <!-- Custom Actions from Imported JSON -->
        <div class="custom-actions-header">
            <div class="custom-actions-title">Imported Actions</div>
            <button id="clearCustomBtn" class="btn btn-secondary">Clear Imported Actions</button>
        </div>

        <div id="customActionsContainer" class="custom-actions-container">
            <div id="emptyState" class="empty-state">
                <div class="empty-state-icon">📁</div>
                <div class="empty-state-text">No custom actions imported yet. Import a conversation JSON file to see actions here.</div>
                <label for="fileInput" class="btn btn-primary" style="max-width: 200px; margin: 0 auto;">
                    Import Conversation
                </label>
            </div>
        </div>

        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <div class="loading-text">Processing your request...</div>
        </div>

        <div class="response-container">
            <div class="response-header">
                <div class="response-title">Response</div>
                <button id="clearResponseBtn" class="btn btn-secondary" style="width: auto;">Clear</button>
            </div>
            <div class="response-content" id="responseContent"></div>
        </div>
    </div>

    <!-- Import/Export Modal -->
    <div class="modal" id="jsonModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Export Actions</div>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body">
                <textarea id="jsonContent" placeholder="Paste JSON here or view exported JSON"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalCancel">Cancel</button>
                <button class="btn btn-primary" id="modalConfirm">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // User GUID for memory operations
        const userGuid = "7b8e8f63-4d1b-42f0-95c2-d24b12345678";
        const apiUrl = "/api/businessinsightbot_function";
        
        // Store custom actions
        let customActions = [];
        
        // DOM elements
        const loadingIndicator = document.getElementById('loadingIndicator');
        const responseContent = document.getElementById('responseContent');
        const statusMessage = document.getElementById('statusMessage');
        const customActionsContainer = document.getElementById('customActionsContainer');
        const emptyState = document.getElementById('emptyState');
        const fileInput = document.getElementById('fileInput');
        const exportBtn = document.getElementById('exportBtn');
        const clearCustomBtn = document.getElementById('clearCustomBtn');
        const clearResponseBtn = document.getElementById('clearResponseBtn');
        
        // Modal elements
        const jsonModal = document.getElementById('jsonModal');
        const modalTitle = document.getElementById('modalTitle');
        const jsonContent = document.getElementById('jsonContent');
        const modalClose = document.getElementById('modalClose');
        const modalCancel = document.getElementById('modalCancel');
        const modalConfirm = document.getElementById('modalConfirm');
        
        // Show loading indicator
        function showLoading() {
            loadingIndicator.style.display = 'flex';
        }
        
        // Hide loading indicator
        function hideLoading() {
            loadingIndicator.style.display = 'none';
        }
        
        // Show status message
        function showStatus(message, isError = false) {
            statusMessage.textContent = message;
            statusMessage.className = isError 
                ? 'status-message status-error' 
                : 'status-message status-success';
            statusMessage.style.display = 'block';
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }
        
        // Format response with markdown-like syntax highlighting
        function formatResponse(text) {
            if (!text) return '';
            
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/^#\s+(.*?)$/gm, '<h1>$1</h1>')
                .replace(/^##\s+(.*?)$/gm, '<h2>$1</h2>')
                .replace(/^###\s+(.*?)$/gm, '<h3>$1</h3>')
                .replace(/\n/g, '<br>');
        }
        
        // Send request to API
        async function sendRequest(message) {
            showLoading();
            responseContent.innerHTML = '';
            
            try {
                // For demo purposes, we'll simulate the API call
                const simulateAPI = true;
                
                if (simulateAPI) {
                    // Wait for a simulated response time
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // Generate a simulated response based on the message
                    let simulatedResponse;
                    
                    if (message.includes('EmailDrafting')) {
                        simulatedResponse = {
                            assistant_response: "**Email Action Completed**\n\nI've processed your email request with the following details:\n\n- **Subject**: " + 
                                (message.includes("Status Update") ? "Weekly Status Update - Project Alpha" : "Proposal Discussion - [Client Company]") + 
                                "\n- **Sent to**: " + (message.includes("Status Update") ? "manager@example.com" : "client@example.com") + 
                                "\n- **Status**: Success\n\nThe email has been drafted and sent through the EmailDrafting agent. Is there anything else you would like me to help with?",
                            user_guid: userGuid
                        };
                    } else if (message.includes('Dynamics365CRUD')) {
                        if (message.includes('opportunities')) {
                            simulatedResponse = {
                                assistant_response: "**Active Opportunities Retrieved**\n\nI've queried your active opportunities from Dynamics 365:\n\n1. **Enterprise Cloud Migration** - $120,000 (75% probability)\n2. **Data Analytics Platform** - $85,500 (60% probability)\n3. **Security Compliance Assessment** - $45,000 (90% probability)\n\nTotal potential value: **$250,500**\n\nWould you like more details about any specific opportunity?",
                                user_guid: userGuid
                            };
                        } else {
                            simulatedResponse = {
                                assistant_response: "**Lead Created Successfully**\n\nI've created a new lead in Dynamics 365:\n\n- **Name**: John Smith\n- **Company**: Innovative Tech Solutions\n- **Position**: CTO\n- **Contact**: john.smith@innovativetech.example.com\n- **Phone**: (555) 123-4567\n- **Status**: New\n- **Source**: Direct Input\n\nThe lead has been assigned to your queue. Would you like to add any additional information to this lead?",
                                user_guid: userGuid
                            };
                        }
                    } else if (message.includes('ManageMemory')) {
                        simulatedResponse = {
                            assistant_response: "**Daily Summary Saved**\n\nI've saved today's summary to your personal memory:\n\n- **Theme**: Daily Summary\n- **Memory ID**: daily-summary-" + new Date().toISOString().slice(0, 10) + "\n- **Status**: Successfully stored\n\nYour daily activities and accomplishments have been recorded for future reference. You can recall this information later using the ContextMemory agent.",
                            user_guid: userGuid
                        };
                    } else if (message.includes('ContextMemory')) {
                        simulatedResponse = {
                            assistant_response: "**Previous Interactions Retrieved**\n\nHere's what I remember from your previous conversations:\n\n- On 2025-03-15, you discussed project timelines for the Enterprise Cloud Migration with the client team\n- On 2025-03-16, you recorded completion of the security assessment documentation\n- On 2025-03-17, you saved notes about the upcoming quarterly business review\n\nIs there any specific information from these interactions you'd like me to elaborate on?",
                            user_guid: userGuid
                        };
                    } else if (message.includes('SOWAutoAnswerEfficient') || message.includes('process_documents')) {
                        simulatedResponse = {
                            assistant_response: "**Document Processing Complete**\n\n- **File Processed**: `folder (2).txt`\n- **Chunks Processed**: 23\n- **Processing Timestamp**: " + new Date().toISOString() + "\n\nIf there is anything more you need regarding the processed document or further actions, let me know!",
                            user_guid: userGuid
                        };
                    } else if (message.includes('auto_answer_questions')) {
                        simulatedResponse = {
                            assistant_response: "**Auto-Answer Process Complete**\n\n- **Questions Processed**: 5\n- **Questions Auto-Answered**: 0 (with confidence >= 0.85)\n\nIt seems there were no questions with high enough confidence to be auto-answered. If you need any further assistance or have specific requirements, feel free to let me know!",
                            user_guid: userGuid
                        };
                    } else {
                        simulatedResponse = {
                            assistant_response: "I've processed your request, but I'm not sure how to handle it specifically. Could you provide more details about what you're trying to do?",
                            user_guid: userGuid
                        };
                    }
                    
                    responseContent.innerHTML = formatResponse(simulatedResponse.assistant_response);
                } else {
                    // Real API call
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            user_input: message,
                            conversation_history: [],
                            user_guid: userGuid
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Request failed with status ${response.status}`);
                    }
                    
                    const data = await response.json();
                    responseContent.innerHTML = formatResponse(data.assistant_response);
                }
            } catch (error) {
                console.error('Error:', error);
                responseContent.innerHTML = `<div style="color: var(--copilot-error);">Error: ${error.message}</div>`;
                showStatus(`Failed to process request: ${error.message}`, true);
            } finally {
                hideLoading();
            }
        }
        
        // Default action handlers
        function sendStatusEmail() {
            const message = `Use the EmailDrafting agent to send a weekly status update email with the following parameters:
                subject: "Weekly Status Update - Project Alpha",
                to: "manager@example.com",
                cc: ["team@example.com"],
                body: "Hello Team,\n\nHere is this week's status update for Project Alpha:\n\n- Completed user authentication module\n- Fixed 3 critical bugs in payment processing\n- Started work on reporting dashboard\n\nCurrent velocity: 85% of planned sprint points\nRisks: Third-party API integration may be delayed\n\nPlease let me know if you have any questions.\n\nBest regards,\n[User Name]",
                importance: "normal"`;
            
            sendRequest(message);
        }
        
        function scheduleClientMeeting() {
            const message = `Use the EmailDrafting agent to send a client meeting invitation with the following parameters:
                subject: "Proposal Discussion - [Client Company]",
                to: "client@example.com",
                cc: ["account.manager@ourcompany.com"],
                body: "Dear [Client Name],\n\nI hope this email finds you well. I would like to schedule a meeting to discuss our proposal for the [Project Name] initiative.\n\nProposed times (EST):\n- Thursday, March 20th at 2:00 PM\n- Friday, March 21st at 10:00 AM\n\nAgenda:\n1. Review of requirements\n2. Discussion of proposed solutions\n3. Timeline and next steps\n\nPlease let me know which time works best for you, or suggest an alternative.\n\nBest regards,\n[Your Name]\n[Your Title]\n[Phone Number]",
                importance: "high"`;
            
            sendRequest(message);
        }
        
        function getOpportunities() {
            const message = `Use the Dynamics365CRUD agent to retrieve my active opportunities with the following parameters:
                operation: "query",
                entity: "opportunities",
                fetchxml: "<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'><entity name='opportunity'><attribute name='name'/><attribute name='estimatedvalue'/><attribute name='closeprobability'/><attribute name='createdon'/><filter type='and'><condition attribute='statecode' operator='eq' value='0'/><condition attribute='ownerid' operator='eq-userid'/></filter></entity></fetch>",
                select: "name,estimatedvalue,closeprobability,createdon"`;
            
            sendRequest(message);
        }
        
        function createLead() {
            const message = `Use the Dynamics365CRUD agent to create a new lead with the following parameters:
                operation: "create",
                entity: "leads",
                data: {"firstname":"John","lastname":"Smith","jobtitle":"CTO","companyname":"Innovative Tech Solutions","emailaddress1":"john.smith@innovativetech.example.com","telephone1":"(555) 123-4567","leadsourcecode":1,"description":"Met at the Tech Conference. Interested in our cloud solutions package."}`;
            
            sendRequest(message);
        }
        
        function saveDailySummary() {
            const today = new Date().toISOString().slice(0, 10);
            
            const message = `Use the ManageMemory agent to save a daily summary with the following parameters:
                conversation_id: "daily-summary-${today}",
                session_id: "automated-ui-session",
                conversation_context: "Today I completed the product demo for Client ABC, prepared the quarterly report for the executive team, and resolved the integration issue with the payment gateway. Client ABC was impressed with the demo and requested a follow-up meeting next week to discuss contract details. The quarterly report shows a 12% increase in customer satisfaction and 8% growth in recurring revenue.",
                companion_id: "BusinessInsightBot",
                mood: "productive",
                theme: "daily summary",
                user_guid: "${userGuid}"`;
            
            sendRequest(message);
        }
        
        function recallContext() {
            const message = `Use the ContextMemory agent to retrieve my conversation history and previous interactions with the following parameters:
                user_guid: "${userGuid}"`;
            
            sendRequest(message);
        }
        
        // Custom action handler
        function executeCustomAction(action) {
            sendRequest(action.content);
        }
        
        // Parse conversation JSON
        function parseConversationJSON(json) {
            try {
                const data = JSON.parse(json);
                const extracted = [];
                
                // Check if it's a valid conversation
                if (!data.conversation || !Array.isArray(data.conversation)) {
                    throw new Error('Invalid conversation format');
                }
                
                // Extract commands from user messages
                for (let i = 0; i < data.conversation.length; i++) {
                    const message = data.conversation[i];
                    
                    // Only look at user messages
                    if (message.role === 'user') {
                        const content = message.content.trim();
                        
                        // Extract command-like messages
                        if (content && (
                            content.startsWith('process_documents') ||
                            content.startsWith('auto_answer_questions') ||
                            content.includes('agent') || 
                            content.includes('Agent') ||
                            content.includes('Use the') ||
                            content.toLowerCase().includes('parameters')
                        )) {
                            // Create a nice title based on the content
                            let title = content;
                            
                            if (content === 'process_documents') {
                                title = 'Process Documents';
                            } else if (content === 'auto_answer_questions') {
                                title = 'Auto-Answer Questions';
                            } else if (content.length > 50) {
                                title = content.substring(0, 47) + '...';
                            }
                            
                            // Determine agent type
                            let agentType = 'Custom Agent';
                            if (content.includes('EmailDrafting')) {
                                agentType = 'EmailDrafting Agent';
                            } else if (content.includes('Dynamics365CRUD')) {
                                agentType = 'Dynamics365CRUD Agent';
                            } else if (content.includes('ManageMemory')) {
                                agentType = 'ManageMemory Agent';
                            } else if (content.includes('ContextMemory')) {
                                agentType = 'ContextMemory Agent';
                            } else if (content.includes('process_documents') || content.includes('auto_answer_questions')) {
                                agentType = 'SOWAutoAnswerEfficient Agent';
                            }
                            
                            // Get a short description
                            let description = 'Custom command from imported conversation.';
                            
                            if (content.includes('email')) {
                                description = 'Send an email with specific parameters.';
                            } else if (content.includes('opportunities')) {
                                description = 'Retrieve active sales opportunities from Dynamics 365.';
                            } else if (content.includes('lead')) {
                                description = 'Create a new sales lead in Dynamics 365.';
                            } else if (content.includes('memory') || content.includes('Memory')) {
                                description = 'Save or retrieve memory information.';
                            } else if (content === 'process_documents') {
                                description = 'Process document files for analysis.';
                            } else if (content === 'auto_answer_questions') {
                                description = 'Automatically answer questions from processed documents.';
                            }
                            
                            extracted.push({
                                id: `imported-action-${extracted.length + 1}`,
                                title: title,
                                agentType: agentType,
                                description: description,
                                content: content
                            });
                        }
                    }
                }
                
                return extracted;
            } catch (error) {
                console.error('Error parsing JSON:', error);
                showStatus(`Failed to parse JSON: ${error.message}`, true);
                return [];
            }
        }
        
        // Render custom actions
        function renderCustomActions() {
            if (customActions.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Clear existing custom actions
            customActionsContainer.innerHTML = '';
            
            // Render each custom action
            customActions.forEach(action => {
                const actionCard = document.createElement('div');
                actionCard.className = 'action-card';
                actionCard.innerHTML = `
                    <span class="agent-badge">${action.agentType}</span>
                    <div class="action-title">${action.title}</div>
                    <div class="action-description">
                        ${action.description}
                    </div>
                    <button class="btn btn-primary" id="action-${action.id}">Run Action</button>
                `;
                
                customActionsContainer.appendChild(actionCard);
                
                // Add event listener
                document.getElementById(`action-${action.id}`).addEventListener('click', () => {
                    executeCustomAction(action);
                });
            });
        }
        
        // Event Listeners
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const jsonContent = e.target.result;
                    const newActions = parseConversationJSON(jsonContent);
                    
                    if (newActions.length > 0) {
                        customActions = [...customActions, ...newActions];
                        renderCustomActions();
                        showStatus(`Successfully imported ${newActions.length} actions from conversation`);
                    } else {
                        showStatus('No actionable commands found in the imported conversation', true);
                    }
                } catch (error) {
                    showStatus(`Failed to import: ${error.message}`, true);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            fileInput.value = '';
        });
        
        exportBtn.addEventListener('click', () => {
            modalTitle.textContent = 'Export Actions';
            jsonContent.value = JSON.stringify({
                defaultActions: [
                    { action: 'sendStatusEmail', title: 'Send Status Update Email' },
                    { action: 'scheduleClientMeeting', title: 'Schedule Client Meeting' },
                    { action: 'getOpportunities', title: 'View My Opportunities' },
                    { action: 'createLead', title: 'Create Lead from Business Card' },
                    { action: 'saveDailySummary', title: 'Save Daily Summary' },
                    { action: 'recallContext', title: 'Recall Previous Interactions' }
                ],
                customActions: customActions
            }, null, 2);
            
            // Configure modal for export
            modalConfirm.style.display = 'none';
            modalCancel.textContent = 'Close';
            
            jsonModal.style.display = 'flex';
        });
        
        clearCustomBtn.addEventListener('click', () => {
            customActions = [];
            renderCustomActions();
            showStatus('Custom actions cleared');
        });
        
        clearResponseBtn.addEventListener('click', () => {
            responseContent.innerHTML = '';
        });
        
        // Modal close handlers
        modalClose.addEventListener('click', () => {
            jsonModal.style.display = 'none';
        });
        
        modalCancel.addEventListener('click', () => {
            jsonModal.style.display = 'none';
        });
        
        modalConfirm.addEventListener('click', () => {
            // This is for future import functionality
            jsonModal.style.display = 'none';
        });
        
        // Close modal if clicking outside
        window.addEventListener('click', (event) => {
            if (event.target === jsonModal) {
                jsonModal.style.display = 'none';
            }
        });
        
        // Initialize the app - adding sample imported actions from the sample conversation
        document.addEventListener('DOMContentLoaded', () => {
            // Simulate importing from the provided sample
            const sampleCommandActions = [
                {
                    id: 'imported-action-1',
                    title: 'Process Documents',
                    agentType: 'SOWAutoAnswerEfficient Agent',
                    description: 'Process document files for analysis.',
                    content: 'process_documents'
                },
                {
                    id: 'imported-action-2',
                    title: 'Auto-Answer Questions',
                    agentType: 'SOWAutoAnswerEfficient Agent',
                    description: 'Automatically answer questions from processed documents.',
                    content: 'auto_answer_questions'
                }
            ];
            
            customActions = sampleCommandActions;
            renderCustomActions();
        });
    </script>
</body>
</html>
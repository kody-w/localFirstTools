<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schema Brain - Self-Improving Translator</title>
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #111827;
            --bg-tertiary: #1f2937;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
            --accent-cyan: #06b6d4;
            --border-color: #374151;
            --glow-blue: rgba(59, 130, 246, 0.3);
            --glow-purple: rgba(139, 92, 246, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Neural network background animation */
        .neural-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.1;
        }

        .neural-bg svg {
            width: 100%;
            height: 100%;
        }

        /* Main container */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .brain-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        /* Stats cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: var(--accent-blue);
            box-shadow: 0 0 20px var(--glow-blue);
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .stat-card.coverage .stat-value {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            -webkit-background-clip: text;
            background-clip: text;
        }

        /* Confidence meter */
        .confidence-meter {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            font-size: 0.9rem;
        }

        .tab:hover {
            border-color: var(--accent-blue);
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: white;
        }

        /* Mapping cards */
        .mappings-grid {
            display: grid;
            gap: 15px;
        }

        .mapping-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .mapping-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            border-radius: 4px 0 0 4px;
        }

        .mapping-card.confidence-high::before {
            background: var(--accent-green);
        }

        .mapping-card.confidence-medium::before {
            background: var(--accent-yellow);
        }

        .mapping-card.confidence-low::before {
            background: var(--accent-red);
        }

        .mapping-card:hover {
            border-color: var(--accent-purple);
            box-shadow: 0 0 15px var(--glow-purple);
        }

        .mapping-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .mapping-flow {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .platform-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .platform-salesforce { background: #00a1e0; color: white; }
        .platform-dynamics365 { background: #002050; color: #00bcf2; border: 1px solid #00bcf2; }
        .platform-local { background: var(--accent-purple); color: white; }

        .field-name {
            font-weight: 600;
            color: var(--accent-cyan);
        }

        .arrow {
            color: var(--text-muted);
            font-size: 1.2rem;
        }

        .confidence-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .confidence-certain { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }
        .confidence-high { background: rgba(6, 182, 212, 0.2); color: var(--accent-cyan); }
        .confidence-medium { background: rgba(245, 158, 11, 0.2); color: var(--accent-yellow); }
        .confidence-low { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }

        .mapping-meta {
            display: flex;
            gap: 20px;
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .mapping-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .btn:hover {
            border-color: var(--accent-blue);
            color: var(--text-primary);
        }

        .btn.btn-confirm {
            background: rgba(16, 185, 129, 0.2);
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .btn.btn-reject {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--accent-red);
            color: var(--accent-red);
        }

        .btn.btn-edit {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        /* Learning panel */
        .learning-panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .learning-panel h3 {
            color: var(--accent-purple);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .form-group input,
        .form-group select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 10px var(--glow-blue);
        }

        .btn-primary {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px var(--glow-purple);
        }

        /* Evolution timeline */
        .evolution-timeline {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .timeline-header h3 {
            color: var(--accent-cyan);
        }

        .timeline-chart {
            height: 200px;
            display: flex;
            align-items: flex-end;
            gap: 5px;
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .timeline-bar {
            flex: 1;
            background: linear-gradient(to top, var(--accent-blue), var(--accent-purple));
            border-radius: 4px 4px 0 0;
            min-width: 20px;
            transition: height 0.5s;
            position: relative;
        }

        .timeline-bar:hover::after {
            content: attr(data-value);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        /* Inference reasons */
        .reasons-list {
            margin-top: 15px;
            padding-left: 20px;
        }

        .reasons-list li {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .reasons-list li::marker {
            color: var(--accent-blue);
        }

        /* Entity filter tabs */
        .entity-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .entity-filter {
            padding: 6px 14px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .entity-filter.active {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
            color: white;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h3 {
            margin-bottom: 20px;
            color: var(--accent-blue);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--accent-green);
            border-radius: 8px;
            padding: 15px 25px;
            color: var(--accent-green);
            z-index: 200;
            animation: slideIn 0.3s ease;
            display: none;
        }

        .toast.active {
            display: block;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .mapping-flow {
                flex-direction: column;
                align-items: flex-start;
            }

            .arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <!-- Neural network background -->
    <div class="neural-bg">
        <svg id="neural-svg"></svg>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="brain-icon">üß†</div>
            <h1>Schema Brain</h1>
            <p class="subtitle">Self-Improving CRM Schema Translator</p>
        </header>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-mappings">0</div>
                <div class="stat-label">Total Mappings</div>
            </div>
            <div class="stat-card coverage">
                <div class="stat-value" id="coverage">0%</div>
                <div class="stat-label">Auto-Coverage</div>
                <div class="confidence-meter">
                    <div class="confidence-fill" id="coverage-bar" style="width: 0%; background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan));"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="human-taught">0</div>
                <div class="stat-label">Human-Taught</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="ai-inferred">0</div>
                <div class="stat-label">AI-Inferred</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="pending-review">0</div>
                <div class="stat-label">Pending Review</div>
            </div>
        </div>

        <!-- Teach New Mapping Panel -->
        <div class="learning-panel">
            <h3>üéì Teach New Mapping</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>Source Platform</label>
                    <select id="source-platform">
                        <option value="salesforce">Salesforce</option>
                        <option value="dynamics365">Dynamics 365</option>
                        <option value="local">Local CRM</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Source Field</label>
                    <input type="text" id="source-field" placeholder="e.g., AccountName">
                </div>
                <div class="form-group">
                    <label>Target Platform</label>
                    <select id="target-platform">
                        <option value="dynamics365">Dynamics 365</option>
                        <option value="salesforce">Salesforce</option>
                        <option value="local">Local CRM</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Target Field</label>
                    <input type="text" id="target-field" placeholder="e.g., name">
                </div>
                <div class="form-group">
                    <label>Entity Type</label>
                    <select id="entity-type">
                        <option value="contacts">Contacts</option>
                        <option value="companies">Companies/Accounts</option>
                        <option value="deals">Deals/Opportunities</option>
                        <option value="activities">Activities/Tasks</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes (optional)</label>
                    <input type="text" id="mapping-notes" placeholder="Why this mapping?">
                </div>
            </div>
            <button class="btn-primary" onclick="teachMapping()">üß† Teach Mapping</button>
        </div>

        <!-- Evolution Timeline -->
        <div class="evolution-timeline">
            <div class="timeline-header">
                <h3>üìà Learning Evolution</h3>
                <span id="timeline-summary" style="color: var(--text-muted); font-size: 0.9rem;">Last 30 days</span>
            </div>
            <div class="timeline-chart" id="timeline-chart">
                <!-- Bars will be generated dynamically -->
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="pending" onclick="switchTab('pending')">‚ö†Ô∏è Needs Review</button>
            <button class="tab" data-tab="all" onclick="switchTab('all')">üìã All Mappings</button>
            <button class="tab" data-tab="learned" onclick="switchTab('learned')">üéì Human-Taught</button>
            <button class="tab" data-tab="inferred" onclick="switchTab('inferred')">ü§ñ AI-Inferred</button>
        </div>

        <!-- Entity filters -->
        <div class="entity-filters">
            <button class="entity-filter active" data-entity="all" onclick="filterEntity('all')">All Entities</button>
            <button class="entity-filter" data-entity="contacts" onclick="filterEntity('contacts')">Contacts</button>
            <button class="entity-filter" data-entity="companies" onclick="filterEntity('companies')">Companies</button>
            <button class="entity-filter" data-entity="deals" onclick="filterEntity('deals')">Deals</button>
            <button class="entity-filter" data-entity="activities" onclick="filterEntity('activities')">Activities</button>
        </div>

        <!-- Mappings Grid -->
        <div class="mappings-grid" id="mappings-grid">
            <!-- Mapping cards will be generated dynamically -->
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="edit-modal">
        <div class="modal">
            <h3>‚úèÔ∏è Edit Mapping</h3>
            <div class="form-group">
                <label>Correct Target Field</label>
                <input type="text" id="edit-target-field">
            </div>
            <div class="form-group">
                <label>Notes</label>
                <input type="text" id="edit-notes" placeholder="Why this correction?">
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal()">Cancel</button>
                <button class="btn btn-confirm" onclick="saveEdit()">Save</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">Mapping updated successfully!</div>

    <script>
        // Sample data - in production, this would come from the API
        let mappings = [];
        let currentTab = 'pending';
        let currentEntity = 'all';
        let editingMapping = null;

        // Initialize with sample data
        function initializeSampleData() {
            mappings = [
                // Builtin mappings
                {
                    id: '1',
                    source_platform: 'salesforce',
                    source_field: 'FirstName',
                    target_platform: 'dynamics365',
                    target_field: 'firstname',
                    entity_type: 'contacts',
                    confidence: 1.0,
                    source: 'builtin',
                    times_used: 156,
                    times_corrected: 0,
                    inference_reasons: []
                },
                {
                    id: '2',
                    source_platform: 'salesforce',
                    source_field: 'Email',
                    target_platform: 'dynamics365',
                    target_field: 'emailaddress1',
                    entity_type: 'contacts',
                    confidence: 1.0,
                    source: 'builtin',
                    times_used: 203,
                    times_corrected: 0,
                    inference_reasons: []
                },
                // AI-inferred mappings
                {
                    id: '3',
                    source_platform: 'salesforce',
                    source_field: 'CustomField__c',
                    target_platform: 'dynamics365',
                    target_field: 'new_customfield',
                    entity_type: 'contacts',
                    confidence: 0.72,
                    source: 'inferred',
                    times_used: 5,
                    times_corrected: 1,
                    inference_reasons: [
                        'String similarity: 78%',
                        'Shared patterns: suffix:field, component:custom'
                    ]
                },
                {
                    id: '4',
                    source_platform: 'salesforce',
                    source_field: 'LeadSource',
                    target_platform: 'local',
                    target_field: 'source',
                    entity_type: 'contacts',
                    confidence: 0.45,
                    source: 'inferred',
                    times_used: 2,
                    times_corrected: 0,
                    inference_reasons: [
                        'Semantic similarity: source/lead concepts',
                        'Value type match for: string'
                    ]
                },
                {
                    id: '5',
                    source_platform: 'dynamics365',
                    source_field: 'estimatedvalue',
                    target_platform: 'salesforce',
                    target_field: 'Amount',
                    entity_type: 'deals',
                    confidence: 0.89,
                    source: 'inferred',
                    times_used: 45,
                    times_corrected: 0,
                    inference_reasons: [
                        'Semantic similarity: value/amount',
                        'Similar to known mapping',
                        'Value type match for: float'
                    ]
                },
                // Human-taught mappings
                {
                    id: '6',
                    source_platform: 'salesforce',
                    source_field: 'Legacy_ID__c',
                    target_platform: 'local',
                    target_field: 'externalId',
                    entity_type: 'companies',
                    confidence: 0.98,
                    source: 'human',
                    times_used: 87,
                    times_corrected: 0,
                    inference_reasons: [],
                    notes: 'Custom ID field from legacy system migration'
                },
                {
                    id: '7',
                    source_platform: 'dynamics365',
                    source_field: 'new_customrating',
                    target_platform: 'salesforce',
                    target_field: 'Rating',
                    entity_type: 'companies',
                    confidence: 0.98,
                    source: 'human',
                    times_used: 34,
                    times_corrected: 0,
                    inference_reasons: [],
                    notes: 'Custom rating field mapping'
                },
                // Low confidence needing review
                {
                    id: '8',
                    source_platform: 'salesforce',
                    source_field: 'Jigsaw',
                    target_platform: 'dynamics365',
                    target_field: 'jigsawcompanyid',
                    entity_type: 'companies',
                    confidence: 0.35,
                    source: 'inferred',
                    times_used: 0,
                    times_corrected: 0,
                    inference_reasons: [
                        'String similarity: 62%'
                    ]
                },
                {
                    id: '9',
                    source_platform: 'dynamics365',
                    source_field: 'processid',
                    target_platform: 'local',
                    target_field: 'workflow',
                    entity_type: 'deals',
                    confidence: 0.28,
                    source: 'inferred',
                    times_used: 0,
                    times_corrected: 0,
                    inference_reasons: [
                        'Semantic similarity: process/workflow concepts'
                    ]
                }
            ];

            updateStats();
            renderMappings();
            renderTimeline();
        }

        function updateStats() {
            const total = mappings.length;
            const humanTaught = mappings.filter(m => m.source === 'human').length;
            const aiInferred = mappings.filter(m => m.source === 'inferred').length;
            const pending = mappings.filter(m => m.confidence < 0.6).length;
            const coverage = mappings.filter(m => m.confidence >= 0.6).length / total * 100;

            document.getElementById('total-mappings').textContent = total;
            document.getElementById('coverage').textContent = Math.round(coverage) + '%';
            document.getElementById('coverage-bar').style.width = coverage + '%';
            document.getElementById('human-taught').textContent = humanTaught;
            document.getElementById('ai-inferred').textContent = aiInferred;
            document.getElementById('pending-review').textContent = pending;
        }

        function getConfidenceClass(confidence) {
            if (confidence >= 0.95) return 'confidence-high';
            if (confidence >= 0.6) return 'confidence-medium';
            return 'confidence-low';
        }

        function getConfidenceBadgeClass(confidence) {
            if (confidence >= 0.95) return 'confidence-certain';
            if (confidence >= 0.8) return 'confidence-high';
            if (confidence >= 0.6) return 'confidence-medium';
            return 'confidence-low';
        }

        function renderMappings() {
            const grid = document.getElementById('mappings-grid');
            grid.innerHTML = '';

            let filtered = mappings;

            // Filter by tab
            if (currentTab === 'pending') {
                filtered = filtered.filter(m => m.confidence < 0.6);
            } else if (currentTab === 'learned') {
                filtered = filtered.filter(m => m.source === 'human');
            } else if (currentTab === 'inferred') {
                filtered = filtered.filter(m => m.source === 'inferred');
            }

            // Filter by entity
            if (currentEntity !== 'all') {
                filtered = filtered.filter(m => m.entity_type === currentEntity);
            }

            // Sort by confidence (lowest first for review)
            filtered.sort((a, b) => a.confidence - b.confidence);

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                        <div style="font-size: 3rem; margin-bottom: 10px;">‚ú®</div>
                        <p>No mappings in this category</p>
                    </div>
                `;
                return;
            }

            filtered.forEach(mapping => {
                const card = document.createElement('div');
                card.className = `mapping-card ${getConfidenceClass(mapping.confidence)}`;
                card.innerHTML = `
                    <div class="mapping-header">
                        <div class="mapping-flow">
                            <span class="platform-badge platform-${mapping.source_platform}">${mapping.source_platform}</span>
                            <span class="field-name">${mapping.source_field}</span>
                            <span class="arrow">‚Üí</span>
                            <span class="platform-badge platform-${mapping.target_platform}">${mapping.target_platform}</span>
                            <span class="field-name">${mapping.target_field}</span>
                        </div>
                        <span class="confidence-badge ${getConfidenceBadgeClass(mapping.confidence)}">
                            ${Math.round(mapping.confidence * 100)}%
                        </span>
                    </div>
                    <div class="mapping-meta">
                        <span>üìÅ ${mapping.entity_type}</span>
                        <span>üìä Used ${mapping.times_used}x</span>
                        <span>${mapping.source === 'human' ? 'üéì Human-taught' : mapping.source === 'inferred' ? 'ü§ñ AI-inferred' : 'üì¶ Builtin'}</span>
                    </div>
                    ${mapping.inference_reasons && mapping.inference_reasons.length > 0 ? `
                        <ul class="reasons-list">
                            ${mapping.inference_reasons.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    ` : ''}
                    ${mapping.notes ? `<p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 10px; font-style: italic;">"${mapping.notes}"</p>` : ''}
                    ${mapping.source !== 'builtin' ? `
                        <div class="mapping-actions">
                            <button class="btn btn-confirm" onclick="confirmMapping('${mapping.id}')">‚úì Confirm</button>
                            <button class="btn btn-edit" onclick="openEditModal('${mapping.id}')">‚úèÔ∏è Edit</button>
                            <button class="btn btn-reject" onclick="rejectMapping('${mapping.id}')">‚úó Reject</button>
                        </div>
                    ` : ''}
                `;
                grid.appendChild(card);
            });
        }

        function renderTimeline() {
            const chart = document.getElementById('timeline-chart');
            chart.innerHTML = '';

            // Generate sample learning data for last 30 days
            const data = [];
            let cumulative = 50; // Start with 50 mappings
            for (let i = 0; i < 30; i++) {
                cumulative += Math.floor(Math.random() * 5);
                data.push(cumulative);
            }

            const max = Math.max(...data);
            data.forEach((value, index) => {
                const bar = document.createElement('div');
                bar.className = 'timeline-bar';
                bar.style.height = `${(value / max) * 100}%`;
                bar.setAttribute('data-value', value);
                chart.appendChild(bar);
            });
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            renderMappings();
        }

        function filterEntity(entity) {
            currentEntity = entity;
            document.querySelectorAll('.entity-filter').forEach(f => f.classList.remove('active'));
            document.querySelector(`[data-entity="${entity}"]`).classList.add('active');
            renderMappings();
        }

        function confirmMapping(id) {
            const mapping = mappings.find(m => m.id === id);
            if (mapping) {
                mapping.confidence = Math.min(0.95, mapping.confidence * 1.15);
                mapping.times_used++;
                showToast('Mapping confirmed! Confidence boosted.');
                updateStats();
                renderMappings();
            }
        }

        function rejectMapping(id) {
            const index = mappings.findIndex(m => m.id === id);
            if (index !== -1) {
                mappings.splice(index, 1);
                showToast('Mapping rejected and removed.');
                updateStats();
                renderMappings();
            }
        }

        function openEditModal(id) {
            editingMapping = mappings.find(m => m.id === id);
            if (editingMapping) {
                document.getElementById('edit-target-field').value = editingMapping.target_field;
                document.getElementById('edit-notes').value = editingMapping.notes || '';
                document.getElementById('edit-modal').classList.add('active');
            }
        }

        function closeModal() {
            document.getElementById('edit-modal').classList.remove('active');
            editingMapping = null;
        }

        function saveEdit() {
            if (editingMapping) {
                editingMapping.target_field = document.getElementById('edit-target-field').value;
                editingMapping.notes = document.getElementById('edit-notes').value;
                editingMapping.confidence = 0.98;
                editingMapping.source = 'human';
                closeModal();
                showToast('Mapping updated successfully!');
                updateStats();
                renderMappings();
            }
        }

        function teachMapping() {
            const sourcePlatform = document.getElementById('source-platform').value;
            const sourceField = document.getElementById('source-field').value;
            const targetPlatform = document.getElementById('target-platform').value;
            const targetField = document.getElementById('target-field').value;
            const entityType = document.getElementById('entity-type').value;
            const notes = document.getElementById('mapping-notes').value;

            if (!sourceField || !targetField) {
                alert('Please fill in both source and target fields.');
                return;
            }

            if (sourcePlatform === targetPlatform) {
                alert('Source and target platforms must be different.');
                return;
            }

            const newMapping = {
                id: Date.now().toString(),
                source_platform: sourcePlatform,
                source_field: sourceField,
                target_platform: targetPlatform,
                target_field: targetField,
                entity_type: entityType,
                confidence: 0.98,
                source: 'human',
                times_used: 1,
                times_corrected: 0,
                inference_reasons: [],
                notes: notes || null
            };

            mappings.push(newMapping);

            // Clear form
            document.getElementById('source-field').value = '';
            document.getElementById('target-field').value = '';
            document.getElementById('mapping-notes').value = '';

            showToast('New mapping taught to Schema Brain!');
            updateStats();
            renderMappings();
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // Neural background animation
        function initNeuralBackground() {
            const svg = document.getElementById('neural-svg');
            const width = window.innerWidth;
            const height = window.innerHeight;

            // Create nodes
            const nodes = [];
            for (let i = 0; i < 30; i++) {
                nodes.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5
                });
            }

            function animate() {
                svg.innerHTML = '';

                // Update positions
                nodes.forEach(node => {
                    node.x += node.vx;
                    node.y += node.vy;

                    if (node.x < 0 || node.x > width) node.vx *= -1;
                    if (node.y < 0 || node.y > height) node.vy *= -1;
                });

                // Draw connections
                for (let i = 0; i < nodes.length; i++) {
                    for (let j = i + 1; j < nodes.length; j++) {
                        const dx = nodes[i].x - nodes[j].x;
                        const dy = nodes[i].y - nodes[j].y;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        if (dist < 150) {
                            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                            line.setAttribute('x1', nodes[i].x);
                            line.setAttribute('y1', nodes[i].y);
                            line.setAttribute('x2', nodes[j].x);
                            line.setAttribute('y2', nodes[j].y);
                            line.setAttribute('stroke', '#3b82f6');
                            line.setAttribute('stroke-width', 1 - dist / 150);
                            svg.appendChild(line);
                        }
                    }
                }

                // Draw nodes
                nodes.forEach(node => {
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', node.x);
                    circle.setAttribute('cy', node.y);
                    circle.setAttribute('r', 3);
                    circle.setAttribute('fill', '#8b5cf6');
                    svg.appendChild(circle);
                });

                requestAnimationFrame(animate);
            }

            animate();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeSampleData();
            initNeuralBackground();
        });
    </script>
</body>
</html>

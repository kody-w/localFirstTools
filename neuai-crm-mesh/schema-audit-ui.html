<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schema Audit - AI Proposals Review</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --bg-highlight: #1f6feb15;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --border-color: #30363d;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-yellow: #d29922;
            --accent-red: #f85149;
            --accent-purple: #a371f7;
            --accent-cyan: #39c5cf;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header h1 .icon { font-size: 1.8rem; }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover { background: var(--bg-tertiary); border-color: var(--text-muted); }
        .btn-primary { background: var(--accent-blue); border-color: var(--accent-blue); }
        .btn-primary:hover { background: #4393e6; }
        .btn-success { background: var(--accent-green); border-color: var(--accent-green); color: #000; }
        .btn-danger { background: transparent; border-color: var(--accent-red); color: var(--accent-red); }
        .btn-danger:hover { background: var(--accent-red); color: #fff; }

        /* Stats bar */
        .stats-bar {
            display: flex;
            gap: 24px;
            padding: 16px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .stat {
            display: flex;
            flex-direction: column;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-pending .stat-value { color: var(--accent-yellow); }
        .stat-approved .stat-value { color: var(--accent-green); }
        .stat-auto .stat-value { color: var(--accent-cyan); }

        /* Filter bar */
        .filter-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .filter-group select {
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 13px;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
        }

        .search-box input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 14px;
        }

        .search-box input::placeholder { color: var(--text-muted); }

        /* Proposal cards */
        .proposals-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .proposal-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .proposal-card:hover {
            border-color: var(--text-muted);
        }

        .proposal-card.selected {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 1px var(--accent-blue);
        }

        .proposal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            cursor: pointer;
            user-select: none;
        }

        .proposal-header:hover {
            background: var(--bg-highlight);
        }

        .mapping-flow {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .field-chip {
            display: flex;
            flex-direction: column;
            padding: 8px 14px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .field-chip .platform {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
        }

        .field-chip .entity {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .field-chip .field {
            font-weight: 600;
            font-size: 14px;
        }

        .field-chip.source .platform { color: var(--accent-yellow); }
        .field-chip.target .platform { color: var(--accent-green); }
        .field-chip.no-match {
            border-style: dashed;
            border-color: var(--accent-red);
        }
        .field-chip.no-match .field { color: var(--accent-red); }

        .arrow {
            font-size: 20px;
            color: var(--text-muted);
        }

        .confidence-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .confidence-bar {
            width: 60px;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s;
        }

        .confidence-high .confidence-fill { background: var(--accent-green); }
        .confidence-medium .confidence-fill { background: var(--accent-yellow); }
        .confidence-low .confidence-fill { background: var(--accent-red); }

        .confidence-text {
            font-size: 13px;
            font-weight: 600;
            min-width: 40px;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending { background: rgba(210, 153, 34, 0.2); color: var(--accent-yellow); }
        .status-approved { background: rgba(63, 185, 80, 0.2); color: var(--accent-green); }
        .status-rejected { background: rgba(248, 81, 73, 0.2); color: var(--accent-red); }
        .status-auto { background: rgba(57, 197, 207, 0.2); color: var(--accent-cyan); }
        .status-modified { background: rgba(163, 113, 247, 0.2); color: var(--accent-purple); }

        /* Expanded details */
        .proposal-details {
            display: none;
            padding: 0 20px 20px;
            border-top: 1px solid var(--border-color);
        }

        .proposal-card.expanded .proposal-details {
            display: block;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 16px;
        }

        .detail-section h4 {
            font-size: 12px;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .reasoning-list {
            list-style: none;
        }

        .reasoning-list li {
            padding: 6px 0;
            font-size: 13px;
            color: var(--text-secondary);
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .reasoning-list li::before {
            content: "‚Üí";
            color: var(--accent-blue);
        }

        .alternatives-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .alternative-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .alternative-item:hover {
            background: var(--bg-highlight);
            border: 1px solid var(--accent-blue);
            margin: -1px;
        }

        .field-meta {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 4px 12px;
            font-size: 13px;
        }

        .field-meta dt { color: var(--text-muted); }
        .field-meta dd { color: var(--text-secondary); }

        /* Actions */
        .proposal-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .modify-input {
            flex: 1;
            display: flex;
            gap: 8px;
        }

        .modify-input input {
            flex: 1;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 14px;
        }

        /* Bulk actions bar */
        .bulk-bar {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 16px 24px;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .bulk-bar.active { display: flex; }

        .bulk-info {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .bulk-info strong {
            color: var(--text-primary);
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        /* Checkbox */
        .checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .checkbox:hover { border-color: var(--accent-blue); }
        .checkbox.checked {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
        }
        .checkbox.checked::after {
            content: "‚úì";
            color: white;
            font-size: 12px;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 80px;
            right: 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--accent-green);
            border-radius: 8px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 200;
            animation: slideUp 0.3s ease;
            display: none;
        }

        .toast.active { display: flex; }
        .toast.error { border-color: var(--accent-red); }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-bar { flex-wrap: wrap; }
            .mapping-flow { flex-direction: column; }
            .arrow { transform: rotate(90deg); }
            .proposal-header { flex-direction: column; gap: 12px; align-items: flex-start; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>
                <span class="icon">üîç</span>
                Schema Audit Queue
            </h1>
            <div class="header-actions">
                <button class="btn" onclick="refreshData()">‚Üª Refresh</button>
                <button class="btn btn-primary" onclick="bulkApproveHighConfidence()">‚ö° Auto-approve &gt;90%</button>
            </div>
        </header>

        <!-- Stats -->
        <div class="stats-bar">
            <div class="stat stat-pending">
                <span class="stat-value" id="pending-count">0</span>
                <span class="stat-label">Pending Review</span>
            </div>
            <div class="stat stat-approved">
                <span class="stat-value" id="approved-count">0</span>
                <span class="stat-label">Human Approved</span>
            </div>
            <div class="stat stat-auto">
                <span class="stat-value" id="auto-count">0</span>
                <span class="stat-label">Auto-Approved</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="total-count">0</span>
                <span class="stat-label">Total Mappings</span>
            </div>
        </div>

        <!-- Filters -->
        <div class="filter-bar">
            <div class="filter-group">
                <label>Status:</label>
                <select id="filter-status" onchange="filterProposals()">
                    <option value="pending">Pending</option>
                    <option value="all">All</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Entity:</label>
                <select id="filter-entity" onchange="filterProposals()">
                    <option value="all">All Entities</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Confidence:</label>
                <select id="filter-confidence" onchange="filterProposals()">
                    <option value="all">All</option>
                    <option value="low">Low (&lt;60%)</option>
                    <option value="medium">Medium (60-80%)</option>
                    <option value="high">High (&gt;80%)</option>
                </select>
            </div>
            <div class="search-box">
                <input type="text" id="search" placeholder="Search fields..." oninput="filterProposals()">
            </div>
        </div>

        <!-- Proposals List -->
        <div class="proposals-list" id="proposals-list">
            <!-- Cards will be generated here -->
        </div>
    </div>

    <!-- Bulk Actions Bar -->
    <div class="bulk-bar" id="bulk-bar">
        <div class="bulk-info">
            <strong id="selected-count">0</strong> proposals selected
        </div>
        <div class="header-actions">
            <button class="btn btn-success" onclick="bulkApprove()">‚úì Approve Selected</button>
            <button class="btn btn-danger" onclick="bulkReject()">‚úó Reject Selected</button>
            <button class="btn" onclick="clearSelection()">Clear</button>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span id="toast-message"></span>
    </div>

    <script>
        // Sample data - in production this comes from API
        let proposals = [];
        let selectedIds = new Set();

        function initSampleData() {
            proposals = [
                {
                    id: 'a1b2c3',
                    source_platform: 'salesforce',
                    source_entity: 'account',
                    source_field: { name: 'Name', label: 'Account Name', field_type: 'string', required: true },
                    target_platform: 'dynamics365',
                    target_entity: 'account',
                    target_field: { name: 'name', label: 'Account Name', field_type: 'string' },
                    confidence: 0.98,
                    status: 'auto',
                    reasoning: ['Exact label match', 'Same field type (string)'],
                    alternatives: []
                },
                {
                    id: 'd4e5f6',
                    source_platform: 'salesforce',
                    source_entity: 'account',
                    source_field: { name: 'Website', label: 'Website', field_type: 'url' },
                    target_platform: 'dynamics365',
                    target_entity: 'account',
                    target_field: { name: 'websiteurl', label: 'Website', field_type: 'url' },
                    confidence: 0.95,
                    status: 'auto',
                    reasoning: ['Standard field mapping: website -> websiteurl', 'Same field type (url)'],
                    alternatives: []
                },
                {
                    id: 'g7h8i9',
                    source_platform: 'salesforce',
                    source_entity: 'contact',
                    source_field: { name: 'Email', label: 'Email', field_type: 'email' },
                    target_platform: 'dynamics365',
                    target_entity: 'contact',
                    target_field: { name: 'emailaddress1', label: 'Email', field_type: 'email' },
                    confidence: 0.92,
                    status: 'pending',
                    reasoning: ['Standard field mapping: email -> emailaddress1', 'Same field type (email)'],
                    alternatives: [
                        { name: 'emailaddress2', confidence: 0.45 },
                        { name: 'emailaddress3', confidence: 0.40 }
                    ]
                },
                {
                    id: 'j1k2l3',
                    source_platform: 'salesforce',
                    source_entity: 'opportunity',
                    source_field: { name: 'Amount', label: 'Amount', field_type: 'currency' },
                    target_platform: 'dynamics365',
                    target_entity: 'opportunity',
                    target_field: { name: 'estimatedvalue', label: 'Est. Revenue', field_type: 'currency' },
                    confidence: 0.88,
                    status: 'pending',
                    reasoning: ['Standard field mapping: amount -> estimatedvalue', 'Semantic group match', 'Same field type (currency)'],
                    alternatives: [
                        { name: 'actualvalue', confidence: 0.72 },
                        { name: 'budgetamount', confidence: 0.55 }
                    ]
                },
                {
                    id: 'm4n5o6',
                    source_platform: 'salesforce',
                    source_entity: 'opportunity',
                    source_field: { name: 'StageName', label: 'Stage', field_type: 'picklist' },
                    target_platform: 'dynamics365',
                    target_entity: 'opportunity',
                    target_field: { name: 'stepname', label: 'Sales Stage', field_type: 'string' },
                    confidence: 0.75,
                    status: 'pending',
                    reasoning: ['Standard field mapping: stagename -> stepname', 'Semantic group match'],
                    alternatives: [
                        { name: 'salesstagecode', confidence: 0.68 },
                        { name: 'statecode', confidence: 0.42 }
                    ]
                },
                {
                    id: 'p7q8r9',
                    source_platform: 'salesforce',
                    source_entity: 'account',
                    source_field: { name: 'Custom_Rating__c', label: 'Custom Rating', field_type: 'picklist', is_custom: true },
                    target_platform: 'dynamics365',
                    target_entity: 'account',
                    target_field: { name: 'new_rating', label: 'Rating', field_type: 'picklist' },
                    confidence: 0.62,
                    status: 'pending',
                    reasoning: ['Name similarity (68%) + same type (picklist)'],
                    alternatives: [
                        { name: 'accountratingcode', confidence: 0.55 },
                        { name: 'customertypecode', confidence: 0.38 }
                    ]
                },
                {
                    id: 's1t2u3',
                    source_platform: 'salesforce',
                    source_entity: 'contact',
                    source_field: { name: 'Legacy_System_ID__c', label: 'Legacy System ID', field_type: 'string', is_custom: true },
                    target_platform: 'dynamics365',
                    target_entity: 'contact',
                    target_field: null,
                    confidence: 0.0,
                    status: 'pending',
                    reasoning: ['No matching field found'],
                    alternatives: []
                }
            ];

            updateStats();
            renderProposals();
            populateEntityFilter();
        }

        function updateStats() {
            const pending = proposals.filter(p => p.status === 'pending').length;
            const approved = proposals.filter(p => p.status === 'approved' || p.status === 'modified').length;
            const auto = proposals.filter(p => p.status === 'auto').length;

            document.getElementById('pending-count').textContent = pending;
            document.getElementById('approved-count').textContent = approved;
            document.getElementById('auto-count').textContent = auto;
            document.getElementById('total-count').textContent = proposals.length;
        }

        function populateEntityFilter() {
            const entities = [...new Set(proposals.map(p => p.source_entity))];
            const select = document.getElementById('filter-entity');
            select.innerHTML = '<option value="all">All Entities</option>';
            entities.forEach(e => {
                select.innerHTML += `<option value="${e}">${e}</option>`;
            });
        }

        function getConfidenceClass(conf) {
            if (conf >= 0.8) return 'confidence-high';
            if (conf >= 0.6) return 'confidence-medium';
            return 'confidence-low';
        }

        function getStatusBadge(status) {
            const badges = {
                pending: '<span class="status-badge status-pending">Pending</span>',
                approved: '<span class="status-badge status-approved">Approved</span>',
                rejected: '<span class="status-badge status-rejected">Rejected</span>',
                auto: '<span class="status-badge status-auto">Auto-Approved</span>',
                modified: '<span class="status-badge status-modified">Modified</span>'
            };
            return badges[status] || '';
        }

        function renderProposals() {
            const list = document.getElementById('proposals-list');
            const filtered = getFilteredProposals();

            if (filtered.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">‚ú®</div>
                        <h3>All caught up!</h3>
                        <p>No proposals match your current filters.</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = filtered.map(p => `
                <div class="proposal-card ${selectedIds.has(p.id) ? 'selected' : ''}" id="card-${p.id}">
                    <div class="proposal-header" onclick="toggleExpand('${p.id}')">
                        <div class="mapping-flow">
                            ${p.status === 'pending' ? `<div class="checkbox ${selectedIds.has(p.id) ? 'checked' : ''}" onclick="event.stopPropagation(); toggleSelect('${p.id}')"></div>` : ''}
                            <div class="field-chip source">
                                <span class="platform">${p.source_platform}</span>
                                <span class="entity">${p.source_entity}</span>
                                <span class="field">${p.source_field.name}</span>
                            </div>
                            <span class="arrow">‚Üí</span>
                            ${p.target_field ? `
                                <div class="field-chip target">
                                    <span class="platform">${p.target_platform}</span>
                                    <span class="entity">${p.target_entity}</span>
                                    <span class="field">${p.target_field.name}</span>
                                </div>
                            ` : `
                                <div class="field-chip no-match">
                                    <span class="platform">${p.target_platform}</span>
                                    <span class="entity">${p.target_entity}</span>
                                    <span class="field">No match found</span>
                                </div>
                            `}
                        </div>
                        <div class="confidence-indicator ${getConfidenceClass(p.confidence)}">
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${p.confidence * 100}%"></div>
                            </div>
                            <span class="confidence-text">${Math.round(p.confidence * 100)}%</span>
                            ${getStatusBadge(p.status)}
                        </div>
                    </div>
                    <div class="proposal-details">
                        <div class="details-grid">
                            <div class="detail-section">
                                <h4>AI Reasoning</h4>
                                <ul class="reasoning-list">
                                    ${p.reasoning.map(r => `<li>${r}</li>`).join('')}
                                </ul>
                            </div>
                            ${p.alternatives.length > 0 ? `
                                <div class="detail-section">
                                    <h4>Alternatives</h4>
                                    <div class="alternatives-list">
                                        ${p.alternatives.map(a => `
                                            <div class="alternative-item" onclick="selectAlternative('${p.id}', '${a.name}')">
                                                <span>${a.name}</span>
                                                <span>${Math.round(a.confidence * 100)}%</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            <div class="detail-section">
                                <h4>Source Field</h4>
                                <dl class="field-meta">
                                    <dt>Label:</dt><dd>${p.source_field.label}</dd>
                                    <dt>Type:</dt><dd>${p.source_field.field_type}</dd>
                                    <dt>Required:</dt><dd>${p.source_field.required ? 'Yes' : 'No'}</dd>
                                    ${p.source_field.is_custom ? '<dt>Custom:</dt><dd>Yes</dd>' : ''}
                                </dl>
                            </div>
                        </div>
                        ${p.status === 'pending' ? `
                            <div class="proposal-actions">
                                <button class="btn btn-success" onclick="approveProposal('${p.id}')">‚úì Approve</button>
                                <button class="btn btn-danger" onclick="rejectProposal('${p.id}')">‚úó Reject</button>
                                <div class="modify-input">
                                    <input type="text" id="modify-${p.id}" placeholder="Or enter different field name...">
                                    <button class="btn" onclick="modifyProposal('${p.id}')">Modify & Approve</button>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function getFilteredProposals() {
            const status = document.getElementById('filter-status').value;
            const entity = document.getElementById('filter-entity').value;
            const confidence = document.getElementById('filter-confidence').value;
            const search = document.getElementById('search').value.toLowerCase();

            return proposals.filter(p => {
                if (status !== 'all' && p.status !== status) return false;
                if (entity !== 'all' && p.source_entity !== entity) return false;
                if (confidence === 'low' && p.confidence >= 0.6) return false;
                if (confidence === 'medium' && (p.confidence < 0.6 || p.confidence >= 0.8)) return false;
                if (confidence === 'high' && p.confidence < 0.8) return false;
                if (search && !p.source_field.name.toLowerCase().includes(search) &&
                    !(p.target_field && p.target_field.name.toLowerCase().includes(search))) return false;
                return true;
            });
        }

        function filterProposals() {
            renderProposals();
        }

        function toggleExpand(id) {
            const card = document.getElementById(`card-${id}`);
            card.classList.toggle('expanded');
        }

        function toggleSelect(id) {
            if (selectedIds.has(id)) {
                selectedIds.delete(id);
            } else {
                selectedIds.add(id);
            }
            updateBulkBar();
            renderProposals();
        }

        function updateBulkBar() {
            const bar = document.getElementById('bulk-bar');
            const count = document.getElementById('selected-count');
            count.textContent = selectedIds.size;
            bar.classList.toggle('active', selectedIds.size > 0);
        }

        function clearSelection() {
            selectedIds.clear();
            updateBulkBar();
            renderProposals();
        }

        function approveProposal(id) {
            const proposal = proposals.find(p => p.id === id);
            if (proposal) {
                proposal.status = 'approved';
                showToast('Proposal approved!');
                updateStats();
                renderProposals();
            }
        }

        function rejectProposal(id) {
            const proposal = proposals.find(p => p.id === id);
            if (proposal) {
                proposal.status = 'rejected';
                showToast('Proposal rejected');
                updateStats();
                renderProposals();
            }
        }

        function modifyProposal(id) {
            const input = document.getElementById(`modify-${id}`);
            const newField = input.value.trim();
            if (!newField) {
                showToast('Please enter a field name', true);
                return;
            }

            const proposal = proposals.find(p => p.id === id);
            if (proposal) {
                proposal.target_field = { name: newField, label: newField, field_type: proposal.source_field.field_type };
                proposal.status = 'modified';
                proposal.confidence = 1.0;
                showToast(`Modified to: ${newField}`);
                updateStats();
                renderProposals();
            }
        }

        function selectAlternative(id, fieldName) {
            const input = document.getElementById(`modify-${id}`);
            if (input) {
                input.value = fieldName;
            }
        }

        function bulkApprove() {
            let count = 0;
            proposals.forEach(p => {
                if (selectedIds.has(p.id) && p.status === 'pending') {
                    p.status = 'approved';
                    count++;
                }
            });
            selectedIds.clear();
            updateBulkBar();
            updateStats();
            renderProposals();
            showToast(`Approved ${count} proposals`);
        }

        function bulkReject() {
            let count = 0;
            proposals.forEach(p => {
                if (selectedIds.has(p.id) && p.status === 'pending') {
                    p.status = 'rejected';
                    count++;
                }
            });
            selectedIds.clear();
            updateBulkBar();
            updateStats();
            renderProposals();
            showToast(`Rejected ${count} proposals`);
        }

        function bulkApproveHighConfidence() {
            let count = 0;
            proposals.forEach(p => {
                if (p.status === 'pending' && p.confidence >= 0.9 && p.target_field) {
                    p.status = 'approved';
                    count++;
                }
            });
            updateStats();
            renderProposals();
            showToast(`Auto-approved ${count} high-confidence proposals`);
        }

        function refreshData() {
            showToast('Refreshing data...');
            // In production, fetch from API
            setTimeout(() => {
                showToast('Data refreshed');
            }, 500);
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const msg = document.getElementById('toast-message');
            msg.textContent = message;
            toast.classList.toggle('error', isError);
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', initSampleData);
    </script>
</body>
</html>

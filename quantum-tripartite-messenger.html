<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Tripartite Kill Switch - Instantaneous Message Destruction</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0ff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        #quantum-field {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        .main-container {
            position: relative;
            z-index: 10;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #0ff;
            border-radius: 15px;
        }

        .header h1 {
            font-size: 2.5em;
            color: #0ff;
            text-shadow: 0 0 20px #0ff;
            margin-bottom: 10px;
        }

        .header p {
            color: #f0f;
            font-size: 1.1em;
        }

        .trinity-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .party-panel {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #0ff;
            border-radius: 15px;
            padding: 20px;
            position: relative;
            transition: all 0.3s;
        }

        .party-panel.alice {
            border-color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }

        .party-panel.bob {
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .party-panel.charlie {
            border-color: #ff00ff;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
        }

        .party-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .party-name {
            font-size: 1.5em;
            font-weight: bold;
        }

        .alice .party-name { color: #00ff00; }
        .bob .party-name { color: #00ffff; }
        .charlie .party-name { color: #ff00ff; }

        .quantum-state {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9em;
            background: rgba(255, 255, 255, 0.1);
        }

        .quantum-state.entangled {
            background: rgba(0, 255, 0, 0.2);
            color: #0f0;
            animation: pulse 2s infinite;
        }

        .quantum-state.collapsed {
            background: rgba(255, 0, 0, 0.2);
            color: #f00;
            animation: alarm 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        @keyframes alarm {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .message-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            min-height: 150px;
            position: relative;
            overflow: hidden;
        }

        .message-content {
            font-size: 1.1em;
            line-height: 1.5;
            transition: all 0.5s;
        }

        .message-content.encrypted {
            filter: blur(5px);
            user-select: none;
        }

        .message-content.destroyed {
            color: #ff0000;
            font-family: 'Courier New', monospace;
            animation: glitch 0.3s infinite;
            text-shadow: 2px 2px 4px #ff0000;
        }

        @keyframes glitch {
            0% { transform: translateX(0); }
            25% { transform: translateX(-2px) skewX(-5deg); }
            50% { transform: translateX(2px) skewY(2deg); }
            75% { transform: translateX(-1px) skewX(2deg); }
            100% { transform: translateX(0); }
        }

        .kill-switch {
            background: linear-gradient(135deg, #ff0000, #aa0000);
            border: 2px solid #ff0000;
            color: #fff;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin: 10px 0;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .kill-switch:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px #ff0000;
        }

        .kill-switch:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .kill-switch::before {
            content: '⚠️';
            position: absolute;
            left: 10px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .decrypt-button {
            background: linear-gradient(135deg, #00ff00, #00aa00);
            border: 1px solid #00ff00;
            color: #fff;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin: 5px 0;
            transition: all 0.3s;
        }

        .decrypt-button:hover {
            box-shadow: 0 0 20px #00ff00;
        }

        .decrypt-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .central-message {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #f0f;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .encryption-key {
            background: rgba(138, 43, 226, 0.2);
            border: 1px solid #8a2be2;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            word-break: break-all;
        }

        .quantum-metrics {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .metric {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.5em;
            color: #0ff;
            font-weight: bold;
        }

        .metric-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-top: 5px;
        }

        .entanglement-visualization {
            position: relative;
            height: 200px;
            margin: 20px 0;
        }

        .particle {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.5s;
        }

        .particle.alice {
            background: radial-gradient(circle, #00ff00, rgba(0, 255, 0, 0.3));
            left: 10%;
            top: 50%;
        }

        .particle.bob {
            background: radial-gradient(circle, #00ffff, rgba(0, 255, 255, 0.3));
            left: 45%;
            top: 20%;
        }

        .particle.charlie {
            background: radial-gradient(circle, #ff00ff, rgba(255, 0, 255, 0.3));
            right: 10%;
            top: 50%;
        }

        .entanglement-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ff00ff, transparent);
            transform-origin: left center;
            animation: pulse-line 2s infinite;
        }

        @keyframes pulse-line {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .control-panel {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #0ff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .message-input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #0ff;
            border-radius: 10px;
            color: #fff;
            font-size: 1em;
            margin-bottom: 15px;
            min-height: 100px;
            resize: vertical;
        }

        .message-input:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .create-button {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .create-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 255, 0.4);
        }

        .event-log {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #0ff;
            border-radius: 10px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.9em;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #0ff;
            background: rgba(0, 255, 255, 0.05);
        }

        .log-entry.quantum {
            border-color: #f0f;
            background: rgba(255, 0, 255, 0.05);
            color: #f0f;
        }

        .log-entry.error {
            border-color: #ff0000;
            background: rgba(255, 0, 0, 0.1);
            color: #ff6666;
        }

        .log-entry.success {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
        }

        .destruction-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5em;
            color: #ff0000;
            text-shadow: 0 0 50px #ff0000;
            z-index: 1000;
            animation: explode 1s ease-out forwards;
            pointer-events: none;
        }

        @keyframes explode {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
        }

        .bell-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            font-size: 0.8em;
        }

        .ftl-indicator {
            display: inline-block;
            padding: 5px 10px;
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            border-radius: 20px;
            font-size: 0.9em;
            animation: ftl-pulse 1s infinite;
        }

        @keyframes ftl-pulse {
            0%, 100% { box-shadow: 0 0 10px #ff00ff; }
            50% { box-shadow: 0 0 30px #00ffff; }
        }
    </style>
</head>
<body>
    <canvas id="quantum-field"></canvas>
    
    <div class="main-container">
        <div class="header">
            <h1>⚛️ Quantum Tripartite Kill Switch</h1>
            <p>Instantaneous Message Destruction via Entanglement Collapse</p>
            <div class="ftl-indicator">FTL Communication Active</div>
        </div>
        
        <div class="central-message">
            <h2>🔐 Shared Quantum Message</h2>
            <div class="encryption-key" id="encryptionKey">
                Quantum Key: [No message created yet]
            </div>
            <div class="quantum-metrics">
                <div class="metric">
                    <div class="metric-value" id="bellValue">2.828</div>
                    <div class="metric-label">Bell Value</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="entanglementStatus">GHZ</div>
                    <div class="metric-label">State</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="coherenceTime">0s</div>
                    <div class="metric-label">Coherence</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="fidelity">100%</div>
                    <div class="metric-label">Fidelity</div>
                </div>
            </div>
            
            <div class="entanglement-visualization" id="entanglementViz">
                <div class="particle alice" id="particleAlice">A</div>
                <div class="particle bob" id="particleBob">B</div>
                <div class="particle charlie" id="particleCharlie">C</div>
            </div>
        </div>
        
        <div class="trinity-container">
            <!-- Alice's Panel -->
            <div class="party-panel alice">
                <div class="party-header">
                    <span class="party-name">👩 Alice</span>
                    <span class="quantum-state entangled" id="aliceState">|ψ⟩ Entangled</span>
                </div>
                <div class="bell-indicator">Bell: <span id="aliceBell">2.828</span></div>
                
                <div class="message-container">
                    <div class="message-content encrypted" id="aliceMessage">
                        [Quantum Encrypted Message]
                    </div>
                </div>
                
                <button class="decrypt-button" onclick="decryptMessage('alice')" id="aliceDecrypt">
                    🔓 Read Message (Measure Qubit)
                </button>
                <button class="kill-switch" onclick="activateKillSwitch('alice')" id="aliceKill">
                    💀 ACTIVATE KILL SWITCH
                </button>
                
                <div class="status" id="aliceStatus"></div>
            </div>
            
            <!-- Bob's Panel -->
            <div class="party-panel bob">
                <div class="party-header">
                    <span class="party-name">👨 Bob</span>
                    <span class="quantum-state entangled" id="bobState">|ψ⟩ Entangled</span>
                </div>
                <div class="bell-indicator">Bell: <span id="bobBell">2.828</span></div>
                
                <div class="message-container">
                    <div class="message-content encrypted" id="bobMessage">
                        [Quantum Encrypted Message]
                    </div>
                </div>
                
                <button class="decrypt-button" onclick="decryptMessage('bob')" id="bobDecrypt">
                    🔓 Read Message (Measure Qubit)
                </button>
                <button class="kill-switch" onclick="activateKillSwitch('bob')" id="bobKill">
                    💀 ACTIVATE KILL SWITCH
                </button>
                
                <div class="status" id="bobStatus"></div>
            </div>
            
            <!-- Charlie's Panel -->
            <div class="party-panel charlie">
                <div class="party-header">
                    <span class="party-name">👤 Charlie</span>
                    <span class="quantum-state entangled" id="charlieState">|ψ⟩ Entangled</span>
                </div>
                <div class="bell-indicator">Bell: <span id="charlieBell">2.828</span></div>
                
                <div class="message-container">
                    <div class="message-content encrypted" id="charlieMessage">
                        [Quantum Encrypted Message]
                    </div>
                </div>
                
                <button class="decrypt-button" onclick="decryptMessage('charlie')" id="charlieDecrypt">
                    🔓 Read Message (Measure Qubit)
                </button>
                <button class="kill-switch" onclick="activateKillSwitch('charlie')" id="charlieKill">
                    💀 ACTIVATE KILL SWITCH
                </button>
                
                <div class="status" id="charlieStatus"></div>
            </div>
        </div>
        
        <div class="control-panel">
            <h2>Create New Quantum-Sealed Message</h2>
            <textarea class="message-input" id="messageInput" placeholder="Enter your secret message... This will be quantum-encrypted and shared among all three parties."></textarea>
            <div class="button-group">
                <button class="create-button" onclick="createQuantumMessage()">
                    ⚛️ Create GHZ-Encrypted Message
                </button>
                <button class="create-button" onclick="resetSystem()">
                    🔄 Reset Quantum System
                </button>
            </div>
        </div>
        
        <div class="control-panel">
            <h2>Quantum Event Log</h2>
            <div class="event-log" id="eventLog">
                <div class="log-entry">System initialized with 3-party GHZ entanglement</div>
                <div class="log-entry quantum">Bell inequality: S = 2.828 > 2 (Quantum correlation confirmed)</div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Quantum VM for Tripartite System
        class TripartiteQuantumSystem {
            constructor() {
                this.parties = ['alice', 'bob', 'charlie'];
                this.message = '';
                this.encryptionKey = '';
                this.quantumState = 'GHZ'; // GHZ, W, or Collapsed
                this.bellValue = 2.828;
                this.isEntangled = true;
                this.fidelity = 1.0;
                this.startTime = Date.now();
                this.messageDecrypted = false;
                this.killSwitchActivated = false;
                
                // Quantum state vector for GHZ: |ψ⟩ = 1/√2(|000⟩ + |111⟩)
                this.stateVector = this.createGHZState();
            }

            createGHZState() {
                // Create 3-qubit GHZ state
                const state = new Array(8).fill(0);
                state[0] = 1/Math.sqrt(2); // |000⟩
                state[7] = 1/Math.sqrt(2); // |111⟩
                return state;
            }

            generateQuantumKey(message) {
                // Generate a quantum-random encryption key
                const keyLength = 32;
                let key = '';
                
                // Use quantum randomness simulation
                for (let i = 0; i < keyLength; i++) {
                    // Simulate quantum random bit generation
                    const quantumBit = Math.random() > 0.5 ? '1' : '0';
                    const byte = Math.floor(Math.random() * 256);
                    key += byte.toString(16).padStart(2, '0');
                }
                
                return key;
            }

            encryptMessage(message, key) {
                // XOR encryption with quantum key
                let encrypted = '';
                for (let i = 0; i < message.length; i++) {
                    const messageChar = message.charCodeAt(i);
                    const keyChar = parseInt(key[i % key.length], 16);
                    encrypted += String.fromCharCode(messageChar ^ keyChar);
                }
                return btoa(encrypted); // Base64 encode
            }

            decryptMessage(encryptedMessage, key) {
                if (!this.isEntangled || this.killSwitchActivated) {
                    return this.generateGibberish(encryptedMessage.length);
                }
                
                try {
                    const decoded = atob(encryptedMessage);
                    let decrypted = '';
                    for (let i = 0; i < decoded.length; i++) {
                        const encChar = decoded.charCodeAt(i);
                        const keyChar = parseInt(key[i % key.length], 16);
                        decrypted += String.fromCharCode(encChar ^ keyChar);
                    }
                    return decrypted;
                } catch {
                    return this.generateGibberish(50);
                }
            }

            measureQubit(party) {
                // Measuring any qubit collapses the entire GHZ state
                if (this.isEntangled) {
                    this.isEntangled = false;
                    this.quantumState = 'Collapsed';
                    this.bellValue = 2.0; // Classical limit
                    
                    // Collapse to random state
                    const outcome = Math.random() > 0.5 ? '111' : '000';
                    this.stateVector = new Array(8).fill(0);
                    this.stateVector[parseInt(outcome, 2)] = 1;
                    
                    return outcome[this.parties.indexOf(party)];
                }
                return null;
            }

            activateKillSwitch(party) {
                // INSTANTANEOUS destruction across all parties
                this.killSwitchActivated = true;
                this.isEntangled = false;
                this.quantumState = 'DESTROYED';
                this.bellValue = 0;
                this.fidelity = 0;
                
                // Scramble the encryption key
                this.encryptionKey = this.generateGibberish(64);
                
                // Collapse state to noise
                this.stateVector = this.stateVector.map(() => Math.random());
                
                return true;
            }

            generateGibberish(length) {
                const chars = '!@#$%^&*()[]{}|;:,.<>?/~`░▒▓█▀▄▌▐└┴┬├─┼╚╔╩╦╠═╬¦┘┌█▄▌▐▀αβγδεζηθικλμνξοπρςστυφχψω';
                let gibberish = '';
                for (let i = 0; i < length; i++) {
                    gibberish += chars[Math.floor(Math.random() * chars.length)];
                }
                return gibberish;
            }

            calculateBellInequality() {
                if (!this.isEntangled) return 2.0;
                
                // For GHZ state, maximum violation
                return 2 * Math.sqrt(2) * this.fidelity;
            }

            simulateDecoherence() {
                if (this.isEntangled && this.fidelity > 0) {
                    this.fidelity = Math.max(0, this.fidelity - 0.001);
                    this.bellValue = this.calculateBellInequality();
                }
            }
        }

        // Global quantum system
        let qSystem = new TripartiteQuantumSystem();
        let currentMessage = '';
        let encryptedMessage = '';

        // Initialize quantum field visualization
        function initQuantumField() {
            const canvas = document.getElementById('quantum-field');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const particles = [];
            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    size: Math.random() * 3 + 1
                });
            }
            
            function animate() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.strokeStyle = qSystem.isEntangled ? '#00ffff' : '#ff0000';
                ctx.lineWidth = 0.5;
                
                particles.forEach((p, i) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    
                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                    
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // Draw connections for entanglement
                    if (qSystem.isEntangled) {
                        particles.slice(i + 1, i + 3).forEach(p2 => {
                            const dist = Math.sqrt((p.x - p2.x)**2 + (p.y - p2.y)**2);
                            if (dist < 100) {
                                ctx.beginPath();
                                ctx.moveTo(p.x, p.y);
                                ctx.lineTo(p2.x, p2.y);
                                ctx.stroke();
                            }
                        });
                    }
                });
                
                requestAnimationFrame(animate);
            }
            
            animate();
        }

        function createQuantumMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) {
                addLog('No message entered!', 'error');
                return;
            }
            
            // Reset system
            qSystem = new TripartiteQuantumSystem();
            
            // Generate quantum key and encrypt
            currentMessage = message;
            qSystem.message = message;
            qSystem.encryptionKey = qSystem.generateQuantumKey(message);
            encryptedMessage = qSystem.encryptMessage(message, qSystem.encryptionKey);
            
            // Update displays
            document.getElementById('encryptionKey').innerHTML = 
                `Quantum Key: ${qSystem.encryptionKey.substring(0, 32)}...<br>
                 State: |ψ⟩ = 1/√2(|000⟩ + |111⟩)`;
            
            // Set encrypted message for all parties
            ['alice', 'bob', 'charlie'].forEach(party => {
                document.getElementById(`${party}Message`).textContent = `[Encrypted]: ${encryptedMessage.substring(0, 50)}...`;
                document.getElementById(`${party}Message`).className = 'message-content encrypted';
                document.getElementById(`${party}State`).className = 'quantum-state entangled';
                document.getElementById(`${party}State`).textContent = '|ψ⟩ Entangled';
                document.getElementById(`${party}Decrypt`).disabled = false;
                document.getElementById(`${party}Kill`).disabled = false;
            });
            
            input.value = '';
            
            addLog('GHZ state created: |ψ⟩ = 1/√2(|000⟩ + |111⟩)', 'quantum');
            addLog(`Message encrypted with ${qSystem.encryptionKey.length * 4}-bit quantum key`, 'success');
            addLog('All three parties now share entangled qubits', 'success');
            
            updateMetrics();
            drawEntanglementLines();
        }

        function decryptMessage(party) {
            if (qSystem.killSwitchActivated) {
                addLog(`${party.toUpperCase()}: Cannot decrypt - message destroyed!`, 'error');
                return;
            }
            
            if (!qSystem.isEntangled) {
                addLog(`${party.toUpperCase()}: Entanglement broken - cannot decrypt!`, 'error');
                return;
            }
            
            // Measurement collapses the state for ALL parties
            const outcome = qSystem.measureQubit(party);
            
            addLog(`${party.toUpperCase()} measured their qubit: |${outcome}⟩`, 'quantum');
            addLog('⚠️ QUANTUM STATE COLLAPSED - All parties affected instantaneously!', 'error');
            
            // Decrypt message for the measuring party
            const messageElement = document.getElementById(`${party}Message`);
            const decrypted = qSystem.decryptMessage(encryptedMessage, qSystem.encryptionKey);
            messageElement.textContent = decrypted;
            messageElement.className = 'message-content';
            
            // Update all party states
            ['alice', 'bob', 'charlie'].forEach(p => {
                const state = document.getElementById(`${p}State`);
                state.className = 'quantum-state collapsed';
                state.textContent = '|' + (outcome || '?') + '⟩ Collapsed';
                
                if (p !== party) {
                    // Other parties can no longer decrypt
                    document.getElementById(`${p}Decrypt`).disabled = true;
                    const msg = document.getElementById(`${p}Message`);
                    if (msg.className.includes('encrypted')) {
                        msg.textContent = '[Cannot decrypt - state collapsed by ' + party.toUpperCase() + ']';
                    }
                }
            });
            
            updateMetrics();
            removeEntanglementLines();
        }

        function activateKillSwitch(party) {
            if (qSystem.killSwitchActivated) {
                addLog('Kill switch already activated!', 'error');
                return;
            }
            
            // INSTANTANEOUS DESTRUCTION
            qSystem.activateKillSwitch(party);
            
            // Show destruction animation
            const destruction = document.createElement('div');
            destruction.className = 'destruction-animation';
            destruction.textContent = '💀';
            document.body.appendChild(destruction);
            setTimeout(() => destruction.remove(), 1000);
            
            addLog(`🚨 ${party.toUpperCase()} ACTIVATED KILL SWITCH!`, 'error');
            addLog('⚡ INSTANTANEOUS QUANTUM COLLAPSE - Faster than light!', 'quantum');
            addLog('💀 Message destroyed for ALL parties simultaneously!', 'error');
            
            // Scramble messages for ALL parties instantly
            ['alice', 'bob', 'charlie'].forEach(p => {
                const msg = document.getElementById(`${p}Message`);
                msg.textContent = qSystem.generateGibberish(100);
                msg.className = 'message-content destroyed';
                
                const state = document.getElementById(`${p}State`);
                state.className = 'quantum-state collapsed';
                state.textContent = '💀 DESTROYED';
                
                document.getElementById(`${p}Decrypt`).disabled = true;
                document.getElementById(`${p}Kill`).disabled = true;
                
                document.getElementById(`${p}Bell`).textContent = '0.000';
            });
            
            // Update encryption key display
            document.getElementById('encryptionKey').innerHTML = 
                `<span style="color: #ff0000;">KEY DESTROYED: ${qSystem.generateGibberish(64)}</span>`;
            
            updateMetrics();
            removeEntanglementLines();
        }

        function updateMetrics() {
            document.getElementById('bellValue').textContent = qSystem.bellValue.toFixed(3);
            document.getElementById('entanglementStatus').textContent = qSystem.quantumState;
            document.getElementById('fidelity').textContent = `${(qSystem.fidelity * 100).toFixed(1)}%`;
            
            const coherence = Math.floor((Date.now() - qSystem.startTime) / 1000);
            document.getElementById('coherenceTime').textContent = `${coherence}s`;
            
            // Update Bell values for each party
            ['alice', 'bob', 'charlie'].forEach(party => {
                document.getElementById(`${party}Bell`).textContent = qSystem.bellValue.toFixed(3);
            });
        }

        function drawEntanglementLines() {
            const viz = document.getElementById('entanglementViz');
            
            // Remove old lines
            viz.querySelectorAll('.entanglement-line').forEach(line => line.remove());
            
            if (qSystem.isEntangled) {
                const particles = ['alice', 'bob', 'charlie'];
                const positions = [
                    { x: 10, y: 50 },
                    { x: 45, y: 20 },
                    { x: 80, y: 50 }
                ];
                
                // Draw lines between all particles
                for (let i = 0; i < particles.length; i++) {
                    for (let j = i + 1; j < particles.length; j++) {
                        const line = document.createElement('div');
                        line.className = 'entanglement-line';
                        
                        const dx = positions[j].x - positions[i].x;
                        const dy = positions[j].y - positions[i].y;
                        const length = Math.sqrt(dx * dx + dy * dy);
                        const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                        
                        line.style.width = `${length}%`;
                        line.style.left = `${positions[i].x}%`;
                        line.style.top = `${positions[i].y}%`;
                        line.style.transform = `rotate(${angle}deg)`;
                        
                        viz.appendChild(line);
                    }
                }
            }
        }

        function removeEntanglementLines() {
            const viz = document.getElementById('entanglementViz');
            viz.querySelectorAll('.entanglement-line').forEach(line => line.remove());
        }

        function addLog(message, type = '') {
            const log = document.getElementById('eventLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${message}`;
            log.insertBefore(entry, log.firstChild);
            
            while (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
        }

        function resetSystem() {
            qSystem = new TripartiteQuantumSystem();
            currentMessage = '';
            encryptedMessage = '';
            
            ['alice', 'bob', 'charlie'].forEach(party => {
                document.getElementById(`${party}Message`).textContent = '[Quantum Encrypted Message]';
                document.getElementById(`${party}Message`).className = 'message-content encrypted';
                document.getElementById(`${party}State`).className = 'quantum-state entangled';
                document.getElementById(`${party}State`).textContent = '|ψ⟩ Entangled';
                document.getElementById(`${party}Decrypt`).disabled = true;
                document.getElementById(`${party}Kill`).disabled = true;
            });
            
            document.getElementById('encryptionKey').textContent = 'Quantum Key: [No message created yet]';
            
            addLog('System reset - Ready for new quantum message', 'success');
            updateMetrics();
            drawEntanglementLines();
        }

        // Decoherence simulation
        setInterval(() => {
            if (qSystem.isEntangled && !qSystem.killSwitchActivated) {
                qSystem.simulateDecoherence();
                updateMetrics();
                
                if (qSystem.fidelity < 0.5) {
                    qSystem.isEntangled = false;
                    addLog('Natural decoherence - entanglement lost', 'error');
                    removeEntanglementLines();
                }
            }
        }, 5000);

        // Initialize
        initQuantumField();
        updateMetrics();
        drawEntanglementLines();
        
        // Window resize handler
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('quantum-field');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
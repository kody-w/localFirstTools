<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro OS Arcade - Run Classic Operating Systems in Your Browser</title>
    <meta name="description" content="Boot Linux, Windows, DOS and 70+ classic operating systems directly in your browser. No installation required.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-card-hover: #1a1a25;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --text-primary: #f1f1f4;
            --text-secondary: #8b8b9a;
            --border: #2a2a3a;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444;
            --linux: #f59e0b;
            --bsd: #ef4444;
            --windows: #3b82f6;
            --unix: #8b5cf6;
            --dos: #22c55e;
            --custom: #ec4899;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            padding: 2rem;
            text-align: center;
            background: linear-gradient(180deg, rgba(99, 102, 241, 0.1) 0%, transparent 100%);
            border-bottom: 1px solid var(--border);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #6366f1, #a855f7, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Search and Filters */
        .controls {
            padding: 1.5rem 2rem;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .search-box {
            display: flex;
            align-items: center;
            gap: 1rem;
            max-width: 600px;
            margin: 0 auto 1.5rem;
        }

        .search-input {
            flex: 1;
            padding: 0.875rem 1.25rem;
            border-radius: 12px;
            border: 2px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px var(--accent-glow);
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .filter-groups {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .filter-btn {
            padding: 0.5rem 0.875rem;
            border-radius: 20px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .filter-btn:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .filter-btn.linux.active { background: var(--linux); border-color: var(--linux); }
        .filter-btn.bsd.active { background: var(--bsd); border-color: var(--bsd); }
        .filter-btn.windows.active { background: var(--windows); border-color: var(--windows); }
        .filter-btn.unix.active { background: var(--unix); border-color: var(--unix); }
        .filter-btn.dos.active { background: var(--dos); border-color: var(--dos); }
        .filter-btn.custom.active { background: var(--custom); border-color: var(--custom); }

        .reset-filters {
            background: transparent;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: 0.85rem;
            padding: 0.5rem;
            transition: opacity 0.2s;
        }

        .reset-filters:hover {
            opacity: 0.8;
        }

        /* OS Grid */
        .os-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        .os-card {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .os-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 0 1px var(--accent-glow);
        }

        .os-card-header {
            padding: 1.25rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .os-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .os-icon.linux { background: linear-gradient(135deg, var(--linux), #d97706); }
        .os-icon.bsd { background: linear-gradient(135deg, var(--bsd), #dc2626); }
        .os-icon.windows { background: linear-gradient(135deg, var(--windows), #2563eb); }
        .os-icon.unix { background: linear-gradient(135deg, var(--unix), #7c3aed); }
        .os-icon.dos { background: linear-gradient(135deg, var(--dos), #16a34a); }
        .os-icon.custom { background: linear-gradient(135deg, var(--custom), #db2777); }

        .os-title-group {
            flex: 1;
            min-width: 0;
        }

        .os-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .os-family {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.125rem;
        }

        .os-card-body {
            padding: 1.25rem 1.5rem;
        }

        .os-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .os-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .os-tag {
            padding: 0.25rem 0.625rem;
            border-radius: 6px;
            background: var(--bg-dark);
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .os-tag.gui { color: var(--accent); }
        .os-tag.tui { color: var(--warning); }
        .os-tag.size { color: var(--success); }
        .os-tag.arch { color: var(--danger); }

        .os-card-footer {
            padding: 1rem 1.5rem;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .os-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.modern { background: var(--success); }
        .status-dot.historic { background: var(--warning); }

        .boot-btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            background: var(--accent);
            color: white;
            border: none;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .boot-btn:hover {
            background: #818cf8;
            transform: scale(1.05);
        }

        /* Emulator View */
        .emulator-view {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--bg-dark);
            z-index: 1000;
            flex-direction: column;
        }

        .emulator-view.active {
            display: flex;
        }

        .emulator-header {
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .emulator-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .emulator-title h2 {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .emulator-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .emu-btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-primary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .emu-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent);
        }

        .emu-btn.primary {
            background: var(--accent);
            border-color: var(--accent);
        }

        .emu-btn.danger {
            border-color: var(--danger);
            color: var(--danger);
        }

        .emu-btn.danger:hover {
            background: var(--danger);
            color: white;
        }

        .emulator-screen-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: #000;
            position: relative;
            overflow: hidden;
        }

        #screen_container {
            position: relative;
            outline: 2px solid var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        #screen {
            white-space: pre;
            font-family: 'Liberation Mono', 'DejaVu Sans Mono', 'Courier New', monospace;
            font-weight: bold;
            font-size: 15px;
            line-height: normal;
        }

        #vga {
            background: #000;
            touch-action: none;
        }

        .phone_keyboard {
            width: 0;
            height: 0;
            position: absolute;
            opacity: 0;
            left: -9999em;
        }

        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-secondary);
            font-family: monospace;
            font-size: 0.9rem;
            text-align: center;
            max-width: 400px;
        }

        .progress-bar {
            width: 300px;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s;
        }

        .emulator-footer {
            padding: 0.75rem 1.5rem;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .stats-group {
            display: flex;
            gap: 1.5rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
        }

        .stat-value {
            color: var(--text-primary);
            font-weight: 600;
            font-family: monospace;
        }

        /* Custom Setup Panel */
        .custom-setup {
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .setup-section {
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .setup-section h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .setup-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .setup-row:last-child {
            margin-bottom: 0;
        }

        .setup-label {
            min-width: 150px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .setup-input {
            flex: 1;
            padding: 0.625rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .setup-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .setup-input[type="file"] {
            padding: 0.5rem;
        }

        .setup-input[type="number"] {
            width: 100px;
            flex: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.75rem;
            }

            .os-grid {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .filter-groups {
                gap: 1rem;
            }

            .emulator-header {
                padding: 0.75rem 1rem;
            }

            .emulator-controls {
                width: 100%;
                justify-content: center;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        /* Scale slider */
        .scale-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .scale-slider {
            width: 100px;
            accent-color: var(--accent);
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 0.9rem;
            z-index: 2000;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Main Gallery View -->
    <div id="gallery-view">
        <header class="header">
            <h1>Retro OS Arcade</h1>
            <p>Boot 70+ classic operating systems directly in your browser</p>
        </header>

        <div class="controls">
            <div class="search-box">
                <input type="text" class="search-input" id="search" placeholder="Search operating systems..." autocomplete="off">
                <button class="reset-filters" id="reset-btn">Reset All</button>
            </div>

            <div class="filter-groups">
                <div class="filter-group">
                    <span class="filter-label">Family</span>
                    <button class="filter-btn linux" data-filter="family" data-value="linux">Linux</button>
                    <button class="filter-btn bsd" data-filter="family" data-value="bsd">BSD</button>
                    <button class="filter-btn windows" data-filter="family" data-value="windows">Windows</button>
                    <button class="filter-btn unix" data-filter="family" data-value="unix">Unix</button>
                    <button class="filter-btn dos" data-filter="family" data-value="dos">DOS</button>
                    <button class="filter-btn custom" data-filter="family" data-value="custom">Custom</button>
                </div>

                <div class="filter-group">
                    <span class="filter-label">UI</span>
                    <button class="filter-btn" data-filter="ui" data-value="gui">Graphical</button>
                    <button class="filter-btn" data-filter="ui" data-value="tui">Text</button>
                </div>

                <div class="filter-group">
                    <span class="filter-label">Era</span>
                    <button class="filter-btn" data-filter="status" data-value="modern">Modern</button>
                    <button class="filter-btn" data-filter="status" data-value="historic">Historic</button>
                </div>

                <div class="filter-group">
                    <span class="filter-label">Arch</span>
                    <button class="filter-btn" data-filter="arch" data-value="16">16-bit</button>
                    <button class="filter-btn" data-filter="arch" data-value="32">32-bit</button>
                </div>
            </div>
        </div>

        <div class="os-grid" id="os-grid"></div>
    </div>

    <!-- Emulator View -->
    <div class="emulator-view" id="emulator-view">
        <div class="emulator-header">
            <div class="emulator-title">
                <h2 id="emu-title">Operating System</h2>
            </div>
            <div class="emulator-controls">
                <button class="emu-btn" id="btn-pause">Pause</button>
                <button class="emu-btn" id="btn-reset">Reset</button>
                <button class="emu-btn" id="btn-ctrlaltdel">Ctrl+Alt+Del</button>
                <button class="emu-btn" id="btn-fullscreen">Fullscreen</button>
                <button class="emu-btn" id="btn-screenshot">Screenshot</button>
                <div class="scale-control">
                    <span style="color: var(--text-secondary);">Scale:</span>
                    <input type="range" class="scale-slider" id="scale-slider" min="0.5" max="2" step="0.25" value="1">
                    <span id="scale-value" style="color: var(--text-primary); font-family: monospace;">1x</span>
                </div>
                <button class="emu-btn danger" id="btn-exit">Exit</button>
            </div>
        </div>

        <div class="emulator-screen-container">
            <div id="screen_container">
                <div id="screen"></div>
                <canvas id="vga"></canvas>
                <textarea class="phone_keyboard"></textarea>
            </div>
            <div class="loading-overlay" id="loading-overlay">
                <div class="loading-spinner"></div>
                <div class="loading-text" id="loading-text">Initializing emulator...</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>
        </div>

        <div class="emulator-footer">
            <div class="stats-group">
                <div class="stat-item">
                    <span class="stat-label">Running:</span>
                    <span class="stat-value" id="stat-time">0s</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Speed:</span>
                    <span class="stat-value" id="stat-speed">0 MIPS</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Resolution:</span>
                    <span class="stat-value" id="stat-res">-</span>
                </div>
            </div>
            <div class="stat-item">
                <span class="stat-label">Powered by</span>
                <a href="https://github.com/copy/v86" target="_blank" style="color: var(--accent);">v86</a>
            </div>
        </div>
    </div>

    <script src="https://copy.sh/v86/build/v86_all.js"></script>
    <script>
        // Operating Systems Database
        const OS_DATABASE = [
            // Linux
            { id: "archlinux", name: "Arch Linux", family: "linux", ui: "tui", size: "15+ MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "9pfs", notes: "Various packages, including Xorg, Firefox and more" },
            { id: "buildroot", name: "Buildroot Linux", family: "linux", ui: "tui", size: "4.9 MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "bzImage", notes: "Minimal Linux with Lua, ping, curl, telnet" },
            { id: "dsl", name: "Damn Small Linux", family: "linux", ui: "gui", size: "50 MB", arch: "32", status: "historic", license: "opensource", lang: "C", medium: "CD", notes: "4.11.rc2 with Firefox 2.0" },
            { id: "android", name: "Android", family: "linux", ui: "gui", size: "54+ MB", arch: "32", status: "modern", license: "opensource", lang: "C++", medium: "CD", notes: "Android x86 1.6-r2" },
            { id: "elks", name: "ELKS", family: "linux", ui: "tui", size: "1.2 MB", arch: "16", status: "modern", license: "opensource", lang: "C", medium: "HD", notes: "Linux for 8086" },
            { id: "nodeos", name: "NodeOS", family: "linux", ui: "tui", size: "14 MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "bzImage", notes: "Linux with nodejs as /bin/init" },
            { id: "tilck", name: "Tilck", family: "linux", ui: "tui", size: "16 MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "HD", notes: "Tiny Linux-Compatible Kernel" },

            // BSD
            { id: "freebsd", name: "FreeBSD", family: "bsd", ui: "tui", size: "16+ MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "HD", notes: "FreeBSD 12.0" },
            { id: "netbsd", name: "NetBSD", family: "bsd", ui: "tui", size: "23+ MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "HD", notes: "NetBSD 4.0 with Xorg" },
            { id: "openbsd", name: "OpenBSD", family: "bsd", ui: "tui", size: "11+ MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "HD", notes: "OpenBSD 6.6" },

            // Unix-like
            { id: "fiwix", name: "FiwixOS", family: "unix", ui: "tui", size: "4.2+ MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "HD", notes: "With Doom" },
            { id: "minix", name: "Minix", family: "unix", ui: "tui", size: "30+ MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "CD", notes: "Minix 3.3" },
            { id: "redox", name: "Redox", family: "unix", ui: "gui", size: "31+ MB", arch: "32", status: "modern", license: "opensource", lang: "Rust", medium: "HD", notes: "Unix-like microkernel OS written in Rust" },
            { id: "serenity", name: "SerenityOS", family: "unix", ui: "gui", size: "16+ MB", arch: "32", status: "modern", license: "opensource", lang: "C++", medium: "HD", notes: "Web browser, various games and demos" },
            { id: "sortix", name: "Sortix", family: "unix", ui: "tui", size: "67 MB", arch: "32", status: "modern", license: "opensource", lang: "C++", medium: "CD", notes: "Small self-hosting Unix-like OS" },
            { id: "soso", name: "Soso", family: "unix", ui: "gui", size: "7.6 MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "CD", notes: "Simple Unix-like operating system" },
            { id: "syllable", name: "Syllable", family: "unix", ui: "gui", size: "28+ MB", arch: "32", status: "historic", license: "opensource", lang: "C++", medium: "HD", notes: "User friendly, POSIX compatible OS" },
            { id: "unix-v7", name: "Unix V7", family: "unix", ui: "tui", size: "0.5+ MB", arch: "32", status: "historic", license: "proprietary", lang: "C", medium: "HD", notes: "Unix V7 port for x86" },

            // Windows
            { id: "windows1", name: "Windows 1.01", family: "windows", ui: "gui", size: "0.7 MB", arch: "16", status: "historic", license: "proprietary", lang: "ASM, C", medium: "Floppy", notes: "The first release version of Windows" },
            { id: "windows2", name: "Windows 2.03", family: "windows", ui: "gui", size: "1.8 MB", arch: "16", status: "historic", license: "proprietary", lang: "ASM, C", medium: "HD", notes: "Reversi, Paint" },
            { id: "windows30", name: "Windows 3.0", family: "windows", ui: "gui", size: "6.5 MB", arch: "16", status: "historic", license: "proprietary", lang: "ASM, C", medium: "CD", notes: "CorelDRAW! 2.0, Reversi" },
            { id: "windows31", name: "Windows 3.1", family: "windows", ui: "gui", size: "17 MB", arch: "16", status: "historic", license: "proprietary", lang: "ASM, C", medium: "HD", notes: "QBasic, Minesweeper, Solitaire" },
            { id: "windows95", name: "Windows 95", family: "windows", ui: "gui", size: "19+ MB", arch: "32", status: "historic", license: "proprietary", lang: "ASM, C", medium: "HD", notes: "Age of Empires, FASM, POV-Ray, Hover!" },
            { id: "windows98", name: "Windows 98", family: "windows", ui: "gui", size: "13+ MB", arch: "32", status: "historic", license: "proprietary", lang: "ASM, C", medium: "HD", notes: "FreeCell, Hearts, sheep.exe, IE 5" },
            { id: "windows-me", name: "Windows ME", family: "windows", ui: "gui", size: "14+ MB", arch: "32", status: "historic", license: "proprietary", lang: "ASM, C", medium: "HD", notes: "Visual Basic, Office 97" },
            { id: "windowsnt3", name: "Windows NT 3.1", family: "windows", ui: "gui", size: "18+ MB", arch: "32", status: "historic", license: "proprietary", lang: "C++", medium: "HD", notes: "First retail version of Windows NT" },
            { id: "windowsnt35", name: "Windows NT 3.51", family: "windows", ui: "gui", size: "28+ MB", arch: "32", status: "historic", license: "proprietary", lang: "C++", medium: "HD", notes: "Internet Explorer 3 and Visual FoxPro 3.0" },
            { id: "windowsnt4", name: "Windows NT 4.0", family: "windows", ui: "gui", size: "16+ MB", arch: "32", status: "historic", license: "proprietary", lang: "C++", medium: "HD", notes: "Windows NT 4.0 Service Pack 1" },
            { id: "windows2000", name: "Windows 2000", family: "windows", ui: "gui", size: "28+ MB", arch: "32", status: "historic", license: "proprietary", lang: "C++", medium: "HD", notes: "IE 6, K-Meleon, Winamp, Delphi, NetHack" },
            { id: "reactos", name: "ReactOS", family: "windows", ui: "gui", size: "17+ MB", arch: "32", status: "modern", license: "opensource", lang: "C++", medium: "HD", notes: "QtWeb, LBreakout2, OpenTTD, Bochs, TCC" },

            // DOS
            { id: "86dos", name: "86-DOS", family: "dos", ui: "tui", size: "0.1 MB", arch: "16", status: "historic", license: "proprietary", lang: "ASM", medium: "Floppy", notes: "86-DOS version 1.0" },
            { id: "freedos", name: "FreeDOS", family: "dos", ui: "tui", size: "0.6 MB", arch: "16", status: "modern", license: "opensource", lang: "ASM, C", medium: "Floppy", notes: "nasm, vim, debug.com, Rogue, various demos" },
            { id: "freegem", name: "FreeGEM", family: "dos", ui: "gui", size: "1.6+ MB", arch: "16", status: "historic", license: "opensource", lang: "ASM, C", medium: "HD", notes: "Graphical desktop for FreeDOS" },
            { id: "msdos4", name: "MS-DOS 4", family: "dos", ui: "tui", size: "0.5 MB", arch: "16", status: "historic", license: "proprietary", lang: "ASM", medium: "Floppy", notes: "Contains EDLIN" },
            { id: "msdos", name: "MS-DOS 6.22", family: "dos", ui: "tui", size: "2.4+ MB", arch: "16", status: "historic", license: "proprietary", lang: "ASM", medium: "HD", notes: "Doom, Sim City, OCaml 1.0, Turbo C and more" },
            { id: "psychdos", name: "PsychDOS", family: "dos", ui: "gui", size: "4.6+ MB", arch: "16", status: "historic", license: "opensource", lang: "ASM", medium: "HD", notes: "ANSI-like graphical desktop for FreeDOS" },

            // Custom/Hobby OSes
            { id: "kolibrios", name: "KolibriOS", family: "custom", ui: "gui", size: "1.3 MB", arch: "32", status: "modern", license: "opensource", lang: "ASM", medium: "Floppy", notes: "Various apps, games and demos" },
            { id: "helenos", name: "HelenOS", family: "custom", ui: "gui", size: "7.9 MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "CD", notes: "Microkernel-based multiserver OS" },
            { id: "haiku", name: "Haiku", family: "custom", ui: "gui", size: "41+ MB", arch: "32", status: "modern", license: "opensource", lang: "C++", medium: "HD", notes: "Networking (WebPositive), OCaml, 2048, NetHack" },
            { id: "beos", name: "BeOS 5", family: "custom", ui: "gui", size: "34+ MB", arch: "32", status: "historic", license: "proprietary", lang: "C++", medium: "HD", notes: "With Opera 3.62, NetPositive" },
            { id: "9front", name: "9front", family: "custom", ui: "gui", size: "5.2+ MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "HD", notes: "Actively maintained fork of Plan 9" },
            { id: "qnx", name: "QNX 4.05", family: "custom", ui: "gui", size: "1.4 MB", arch: "32", status: "historic", license: "proprietary", lang: "C", medium: "Floppy", notes: "1999 demo disk" },
            { id: "toaruos", name: "ToaruOS", family: "custom", ui: "gui", size: "6.3 MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "CD", notes: "Hobby OS written from scratch" },
            { id: "nanoshell", name: "NanoShell", family: "custom", ui: "gui", size: "3.5 MB", arch: "32", status: "modern", license: "opensource", lang: "C", medium: "CD", notes: "Multi-tasked 32-bit OS with Win9x-like GUI" },
            { id: "oberon", name: "Oberon", family: "custom", ui: "gui", size: "1.6 MB", arch: "32", status: "historic", license: "opensource", lang: "Oberon", medium: "HD", notes: "Native Oberon 2.3.6" },
            { id: "mikeos", name: "MikeOS", family: "custom", ui: "tui", size: "0.2 MB", arch: "16", status: "modern", license: "opensource", lang: "ASM", medium: "CD", notes: "Contains FORTH and BASIC interpreter" },

            // Bootsector demos
            { id: "tetros", name: "TetrOS", family: "custom", ui: "tui", size: "512 B", arch: "16", status: "modern", license: "opensource", lang: "ASM", medium: "Bootsector", notes: "Tetris in a boot sector" },
            { id: "bootchess", name: "BootChess", family: "custom", ui: "tui", size: "4.0 KB", arch: "16", status: "modern", license: "opensource", lang: "ASM", medium: "Floppy", notes: "Chess in a bootsector" },
            { id: "floppybird", name: "Floppy Bird", family: "custom", ui: "tui", size: "6.5 KB", arch: "16", status: "modern", license: "opensource", lang: "C", medium: "Floppy", notes: "Flappy Bird game in a bootsector" },
            { id: "bootbasic", name: "bootBASIC", family: "custom", ui: "tui", size: "512 B", arch: "16", status: "modern", license: "opensource", lang: "ASM", medium: "Bootsector", notes: "BASIC in 512 bytes of x86 machine code" },
            { id: "sectorlisp", name: "SectorLISP", family: "custom", ui: "tui", size: "512 B", arch: "16", status: "modern", license: "opensource", lang: "ASM", medium: "Bootsector", notes: "Bootstrapping LISP in a Boot Sector" },
            { id: "pillman", name: "Pillman", family: "custom", ui: "gui", size: "512 B", arch: "16", status: "modern", license: "opensource", lang: "ASM", medium: "Bootsector", notes: "Yellow thing eats pills, chased by monsters" },
            { id: "dino", name: "Dino", family: "custom", ui: "tui", size: "512 B", arch: "16", status: "modern", license: "opensource", lang: "ASM", medium: "Bootsector", notes: "Chrome's t-rex based bootsector game" },
            { id: "invaders", name: "Invaders", family: "custom", ui: "tui", size: "512 B", arch: "16", status: "modern", license: "opensource", lang: "ASM", medium: "Bootsector", notes: "Invaders in a bootsector" },
        ];

        // Family icons
        const FAMILY_ICONS = {
            linux: "üêß",
            bsd: "üòà",
            windows: "ü™ü",
            unix: "‚öôÔ∏è",
            dos: "üíæ",
            custom: "üîß"
        };

        // State
        let emulator = null;
        let currentOS = null;
        let activeFilters = { family: [], ui: [], status: [], arch: [] };
        let searchQuery = '';
        let startTime = null;
        let statsInterval = null;

        // Elements
        const galleryView = document.getElementById('gallery-view');
        const emulatorView = document.getElementById('emulator-view');
        const osGrid = document.getElementById('os-grid');
        const searchInput = document.getElementById('search');
        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingText = document.getElementById('loading-text');
        const progressFill = document.getElementById('progress-fill');

        // Initialize
        function init() {
            renderOSGrid();
            setupEventListeners();
        }

        // Render OS cards
        function renderOSGrid() {
            const filtered = filterOS();

            if (filtered.length === 0) {
                osGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <h3>No operating systems found</h3>
                        <p>Try adjusting your filters or search query</p>
                    </div>
                `;
                return;
            }

            osGrid.innerHTML = filtered.map(os => `
                <div class="os-card" data-id="${os.id}">
                    <div class="os-card-header">
                        <div class="os-icon ${os.family}">${FAMILY_ICONS[os.family]}</div>
                        <div class="os-title-group">
                            <div class="os-name">${os.name}</div>
                            <div class="os-family">${os.family.charAt(0).toUpperCase() + os.family.slice(1)}</div>
                        </div>
                    </div>
                    <div class="os-card-body">
                        <div class="os-description">${os.notes}</div>
                        <div class="os-tags">
                            <span class="os-tag ${os.ui}">${os.ui === 'gui' ? 'Graphical' : 'Text-based'}</span>
                            <span class="os-tag size">${os.size}</span>
                            <span class="os-tag arch">${os.arch}-bit</span>
                            <span class="os-tag">${os.medium}</span>
                        </div>
                    </div>
                    <div class="os-card-footer">
                        <div class="os-status">
                            <span class="status-dot ${os.status}"></span>
                            <span>${os.status === 'modern' ? 'Actively maintained' : 'Historic'}</span>
                        </div>
                        <button class="boot-btn">Boot</button>
                    </div>
                </div>
            `).join('');

            // Add click handlers
            document.querySelectorAll('.os-card').forEach(card => {
                card.addEventListener('click', () => {
                    const osId = card.dataset.id;
                    const os = OS_DATABASE.find(o => o.id === osId);
                    if (os) bootOS(os);
                });
            });
        }

        // Filter OS list
        function filterOS() {
            return OS_DATABASE.filter(os => {
                // Search filter
                if (searchQuery) {
                    const query = searchQuery.toLowerCase();
                    const matchesSearch =
                        os.name.toLowerCase().includes(query) ||
                        os.notes.toLowerCase().includes(query) ||
                        os.family.toLowerCase().includes(query);
                    if (!matchesSearch) return false;
                }

                // Category filters
                if (activeFilters.family.length > 0 && !activeFilters.family.includes(os.family)) return false;
                if (activeFilters.ui.length > 0 && !activeFilters.ui.includes(os.ui)) return false;
                if (activeFilters.status.length > 0 && !activeFilters.status.includes(os.status)) return false;
                if (activeFilters.arch.length > 0 && !activeFilters.arch.includes(os.arch)) return false;

                return true;
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search
            searchInput.addEventListener('input', (e) => {
                searchQuery = e.target.value;
                renderOSGrid();
            });

            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const filter = btn.dataset.filter;
                    const value = btn.dataset.value;

                    if (btn.classList.contains('active')) {
                        btn.classList.remove('active');
                        activeFilters[filter] = activeFilters[filter].filter(v => v !== value);
                    } else {
                        btn.classList.add('active');
                        activeFilters[filter].push(value);
                    }
                    renderOSGrid();
                });
            });

            // Reset filters
            document.getElementById('reset-btn').addEventListener('click', () => {
                searchQuery = '';
                searchInput.value = '';
                activeFilters = { family: [], ui: [], status: [], arch: [] };
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                renderOSGrid();
            });

            // Emulator controls
            document.getElementById('btn-pause').addEventListener('click', togglePause);
            document.getElementById('btn-reset').addEventListener('click', resetEmulator);
            document.getElementById('btn-ctrlaltdel').addEventListener('click', sendCtrlAltDel);
            document.getElementById('btn-fullscreen').addEventListener('click', goFullscreen);
            document.getElementById('btn-screenshot').addEventListener('click', takeScreenshot);
            document.getElementById('btn-exit').addEventListener('click', exitEmulator);

            // Scale slider
            const scaleSlider = document.getElementById('scale-slider');
            scaleSlider.addEventListener('input', (e) => {
                const scale = parseFloat(e.target.value);
                document.getElementById('scale-value').textContent = scale + 'x';
                if (emulator) {
                    const screenContainer = document.getElementById('screen_container');
                    screenContainer.style.transform = `scale(${scale})`;
                }
            });
        }

        // Boot an OS
        async function bootOS(os) {
            currentOS = os;
            document.getElementById('emu-title').textContent = os.name;

            galleryView.style.display = 'none';
            emulatorView.classList.add('active');
            loadingOverlay.style.display = 'flex';
            loadingText.textContent = `Loading ${os.name}...`;
            progressFill.style.width = '0%';

            // Use copy.sh CDN for OS images
            const host = 'https://i.copy.sh/';

            // Build configuration based on OS
            const config = buildOSConfig(os, host);

            try {
                emulator = new V86({
                    wasm_path: "https://copy.sh/v86/build/v86.wasm",
                    memory_size: config.memory_size || 128 * 1024 * 1024,
                    vga_memory_size: config.vga_memory_size || 8 * 1024 * 1024,
                    screen_container: document.getElementById("screen_container"),
                    bios: { url: "https://copy.sh/v86/bios/seabios.bin" },
                    vga_bios: { url: "https://copy.sh/v86/bios/vgabios.bin" },
                    ...config
                });

                emulator.add_listener("download-progress", (e) => {
                    if (e.total) {
                        const percent = Math.round((e.loaded / e.total) * 100);
                        progressFill.style.width = percent + '%';
                        loadingText.textContent = `Downloading ${os.name}... ${percent}%`;
                    }
                });

                emulator.add_listener("emulator-ready", () => {
                    loadingOverlay.style.display = 'none';
                    startTime = Date.now();
                    startStatsUpdate();
                });

                emulator.add_listener("screen-set-size-graphical", (data) => {
                    document.getElementById('stat-res').textContent = `${data[0]}x${data[1]}`;
                });

            } catch (error) {
                console.error('Failed to start emulator:', error);
                showNotification('Failed to start emulator. Check console for details.');
                exitEmulator();
            }
        }

        // Build OS configuration
        function buildOSConfig(os, host) {
            const configs = {
                'archlinux': {
                    memory_size: 512 * 1024 * 1024,
                    vga_memory_size: 8 * 1024 * 1024,
                    initial_state: { url: host + "arch_state-v3.bin.zst" },
                    filesystem: { baseurl: host + "arch/" },
                    net_device: { type: "virtio" }
                },
                'buildroot': {
                    bzimage: { url: host + "buildroot-bzimage.bin", size: 5166352 },
                    cmdline: "tsc=reliable mitigations=off random.trust_cpu=on"
                },
                'serenity': {
                    memory_size: 512 * 1024 * 1024,
                    hda: { url: host + "serenity-v3/.img.zst", size: 734003200, async: true, fixed_chunk_size: 1024 * 1024, use_parts: true },
                    initial_state: { url: host + "serenity_state-v4.bin.zst" }
                },
                'helenos': {
                    memory_size: 256 * 1024 * 1024,
                    cdrom: { url: host + "HelenOS-0.14.1-ia32.iso", size: 25792512 }
                },
                'kolibrios': {
                    fda: { url: host + "kolibri.img", size: 1474560 }
                },
                'freedos': {
                    fda: { url: host + "freedos722.img", size: 737280 }
                },
                'msdos': {
                    hda: { url: host + "msdos622/.img", size: 64 * 1024 * 1024, async: true, fixed_chunk_size: 256 * 1024, use_parts: true }
                },
                'windows1': {
                    fda: { url: host + "windows101.img", size: 1474560 }
                },
                'windows95': {
                    memory_size: 128 * 1024 * 1024,
                    hda: { url: host + "windows95/.img", size: 242221056, async: true, fixed_chunk_size: 256 * 1024, use_parts: true }
                },
                'windows98': {
                    memory_size: 128 * 1024 * 1024,
                    hda: { url: host + "windows98/.img", size: 300 * 1024 * 1024, async: true, fixed_chunk_size: 256 * 1024, use_parts: true }
                },
                'haiku': {
                    memory_size: 512 * 1024 * 1024,
                    hda: { url: host + "haiku-v5/.img", size: 1342177280, async: true, fixed_chunk_size: 1024 * 1024, use_parts: true },
                    initial_state: { url: host + "haiku_state-v5.bin.zst" },
                    acpi: true
                },
                'redox': {
                    memory_size: 1024 * 1024 * 1024,
                    hda: { url: host + "redox_demo_i686_2024-09-07_1225_harddrive/.img", size: 671088640, async: true, fixed_chunk_size: 1024 * 1024, use_parts: true },
                    initial_state: { url: host + "redox_state-v2.bin.zst" },
                    acpi: true
                },
                'qnx': {
                    fda: { url: host + "qnx-demo-network-4.05.img", size: 1474560 }
                },
                'oberon': {
                    hda: { url: host + "oberon.img", size: 24 * 1024 * 1024 }
                }
            };

            // Return specific config or a generic one based on medium type
            if (configs[os.id]) {
                return configs[os.id];
            }

            // Default configuration based on medium
            const defaultConfig = {};
            if (os.medium === 'Floppy' || os.medium === 'Bootsector') {
                defaultConfig.fda = { url: host + os.id + ".img" };
            } else if (os.medium === 'CD') {
                defaultConfig.cdrom = { url: host + os.id + ".iso", async: true };
            } else {
                defaultConfig.hda = { url: host + os.id + "/.img", async: true };
            }

            return defaultConfig;
        }

        // Emulator controls
        function togglePause() {
            if (!emulator) return;
            const btn = document.getElementById('btn-pause');
            if (emulator.is_running()) {
                emulator.stop();
                btn.textContent = 'Resume';
            } else {
                emulator.run();
                btn.textContent = 'Pause';
            }
        }

        function resetEmulator() {
            if (!emulator) return;
            emulator.restart();
            startTime = Date.now();
        }

        function sendCtrlAltDel() {
            if (!emulator) return;
            emulator.keyboard_send_scancodes([
                0x1D, // ctrl down
                0x38, // alt down
                0x53, // delete down
                0x53 | 0x80, // delete up
                0x38 | 0x80, // alt up
                0x1D | 0x80, // ctrl up
            ]);
        }

        function goFullscreen() {
            const container = document.getElementById('screen_container');
            if (container.requestFullscreen) {
                container.requestFullscreen();
            } else if (container.webkitRequestFullscreen) {
                container.webkitRequestFullscreen();
            }
        }

        function takeScreenshot() {
            if (!emulator) return;
            const canvas = document.getElementById('vga');
            const link = document.createElement('a');
            link.download = `${currentOS.name}-screenshot.png`;
            link.href = canvas.toDataURL();
            link.click();
            showNotification('Screenshot saved!');
        }

        function exitEmulator() {
            if (emulator) {
                emulator.stop();
                emulator.destroy();
                emulator = null;
            }
            if (statsInterval) {
                clearInterval(statsInterval);
                statsInterval = null;
            }
            emulatorView.classList.remove('active');
            galleryView.style.display = 'block';

            // Reset UI
            document.getElementById('btn-pause').textContent = 'Pause';
            document.getElementById('scale-slider').value = 1;
            document.getElementById('scale-value').textContent = '1x';
            document.getElementById('screen_container').style.transform = '';
        }

        // Stats update
        function startStatsUpdate() {
            statsInterval = setInterval(() => {
                if (!emulator || !startTime) return;

                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const hours = Math.floor(elapsed / 3600);
                const minutes = Math.floor((elapsed % 3600) / 60);
                const seconds = elapsed % 60;

                let timeStr = '';
                if (hours > 0) timeStr += hours + 'h ';
                if (minutes > 0 || hours > 0) timeStr += minutes + 'm ';
                timeStr += seconds + 's';

                document.getElementById('stat-time').textContent = timeStr;

                // Speed (approximate)
                try {
                    const stats = emulator.v86.cpu.instruction_counter;
                    document.getElementById('stat-speed').textContent = Math.round(stats / elapsed / 1000000) + ' MIPS';
                } catch (e) {
                    // Ignore if not available
                }
            }, 1000);
        }

        // Notification
        function showNotification(message) {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();

            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = message;
            document.body.appendChild(notif);

            setTimeout(() => notif.remove(), 3000);
        }

        // Start
        init();
    </script>
</body>
</html>

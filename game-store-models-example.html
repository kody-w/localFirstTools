<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Store Models - Usage Example</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0e1015 0%, #1a1d23 100%);
            color: #ffffff;
            padding: 40px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 36px;
            margin-bottom: 10px;
            color: #4fc3f7;
        }

        .subtitle {
            color: #8b8b8b;
            margin-bottom: 40px;
            font-size: 18px;
        }

        .section {
            background: rgba(26, 29, 35, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section h2 {
            color: #4fc3f7;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            background: rgba(79, 195, 247, 0.1);
            border: 1px solid rgba(79, 195, 247, 0.3);
            border-radius: 20px;
            color: #4fc3f7;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background: rgba(79, 195, 247, 0.2);
            border-color: #4fc3f7;
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .output {
            background: #000;
            color: #0f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .info-box {
            background: rgba(79, 195, 247, 0.1);
            border-left: 4px solid #4fc3f7;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .game-card:hover {
            border-color: #4fc3f7;
            transform: translateY(-5px);
        }

        .game-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .game-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .game-desc {
            font-size: 14px;
            color: #8b8b8b;
            margin-bottom: 10px;
        }

        .game-meta {
            font-size: 12px;
            color: #666;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #ffffff;
            font-size: 14px;
            margin-bottom: 15px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #4fc3f7;
            background: rgba(255, 255, 255, 0.08);
        }

        .stat-card {
            display: inline-block;
            background: rgba(79, 195, 247, 0.1);
            padding: 15px 25px;
            border-radius: 10px;
            margin-right: 15px;
            margin-bottom: 15px;
        }

        .stat-label {
            font-size: 12px;
            color: #8b8b8b;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            color: #4fc3f7;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Game Store Models - Interactive Example</h1>
        <p class="subtitle">Demonstrating Game, StateManager, and StorageService classes</p>

        <!-- Demo Controls -->
        <div class="section">
            <h2>üìä State & Statistics</h2>
            <div id="stats"></div>
        </div>

        <!-- Game Creation -->
        <div class="section">
            <h2>‚ûï Create New Game</h2>
            <div class="info-box">
                Use the form below to create a new game instance and add it to the store.
            </div>
            <div class="controls">
                <input type="text" id="gameName" placeholder="Game Name (e.g., Tetris)">
                <input type="text" id="gameDesc" placeholder="Description">
                <input type="text" id="gameIcon" placeholder="Icon (emoji)" value="üéÆ">
                <select id="gameCategory" style="padding: 10px 20px; background: rgba(79, 195, 247, 0.1); border: 1px solid rgba(79, 195, 247, 0.3); border-radius: 20px; color: #4fc3f7;">
                    <option value="arcade">Arcade</option>
                    <option value="puzzle">Puzzle</option>
                    <option value="action">Action</option>
                    <option value="strategy">Strategy</option>
                    <option value="adventure">Adventure</option>
                </select>
                <button onclick="createGame()">Create Game</button>
            </div>
        </div>

        <!-- State Management -->
        <div class="section">
            <h2>üîÑ State Management</h2>
            <div class="controls">
                <button onclick="subscribeToGames()">Subscribe to Games</button>
                <button onclick="updateView('store')">Set View: Store</button>
                <button onclick="updateView('library')">Set View: Library</button>
                <button onclick="filterByCategory('puzzle')">Filter: Puzzle</button>
                <button onclick="filterByCategory('all')">Show All</button>
                <button onclick="resetState()">Reset State</button>
            </div>
            <div class="output" id="stateOutput">State management output will appear here...</div>
        </div>

        <!-- Storage Operations -->
        <div class="section">
            <h2>üíæ Storage Operations</h2>
            <div class="controls">
                <button onclick="saveToStorage()">Save Games</button>
                <button onclick="loadFromStorage()">Load Games</button>
                <button onclick="exportData()">Export All Data</button>
                <button onclick="checkStorage()">Check Storage Info</button>
                <button onclick="clearStorage()">Clear All Storage</button>
            </div>
            <div class="output" id="storageOutput">Storage operation output will appear here...</div>
        </div>

        <!-- Game Display -->
        <div class="section">
            <h2>üéØ Games Display</h2>
            <input type="text" id="searchBox" placeholder="Search games...">
            <div class="game-grid" id="gameGrid">
                <!-- Games will be rendered here -->
            </div>
        </div>

        <!-- Game Utils -->
        <div class="section">
            <h2>üõ†Ô∏è Utility Functions</h2>
            <div class="controls">
                <button onclick="testValidation()">Test Validation</button>
                <button onclick="testSorting()">Test Sorting</button>
                <button onclick="testFiltering()">Test Filtering</button>
                <button onclick="generateId()">Generate ID</button>
                <button onclick="formatSize()">Format File Size</button>
            </div>
            <div class="output" id="utilsOutput">Utility function output will appear here...</div>
        </div>

        <!-- Favorites & Installed -->
        <div class="section">
            <h2>‚≠ê Favorites & Installed Games</h2>
            <div class="controls">
                <button onclick="toggleFavorite()">Toggle Favorite (First Game)</button>
                <button onclick="markInstalled()">Mark First Game Installed</button>
                <button onclick="showFavorites()">Show Favorites</button>
                <button onclick="showInstalled()">Show Installed</button>
            </div>
            <div class="output" id="favoritesOutput">Favorites & installed output will appear here...</div>
        </div>
    </div>

    <!-- Include the game store models -->
    <script src="game-store-models.js"></script>

    <script>
        // Access the classes from window.GameStore
        const { Game, StateManager, StorageService, GameUtils, AppConfig } = window.GameStore;

        // Initialize state manager
        let stateManager = new StateManager();
        let subscriptionCount = 0;

        // Initialize with some sample games
        function initializeSampleGames() {
            const sampleGames = [
                new Game({
                    id: 'tetris-1',
                    name: 'Tetris Classic',
                    description: 'The classic block-stacking puzzle game',
                    icon: 'üß±',
                    category: 'puzzle',
                    size: '8 KB',
                    author: 'Built-in',
                    version: '1.0',
                    isLocal: true
                }),
                new Game({
                    id: 'snake-1',
                    name: 'Snake',
                    description: 'Classic snake game - eat food and grow',
                    icon: 'üêç',
                    category: 'arcade',
                    size: '5 KB',
                    author: 'Built-in',
                    version: '1.0',
                    isLocal: false,
                    url: 'https://example.com/snake.html'
                }),
                new Game({
                    id: 'pong-1',
                    name: 'Pong',
                    description: 'The original tennis arcade game',
                    icon: 'üèì',
                    category: 'arcade',
                    size: '6 KB',
                    author: 'Built-in',
                    version: '1.0',
                    isLocal: false,
                    url: 'https://example.com/pong.html'
                })
            ];

            stateManager.setState({
                games: sampleGames,
                filteredGames: sampleGames
            });

            renderGames();
            updateStats();
        }

        // Update statistics display
        function updateStats() {
            const state = stateManager.getState();
            const statsDiv = document.getElementById('stats');

            statsDiv.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total Games</div>
                    <div class="stat-value">${state.games.length}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Filtered Games</div>
                    <div class="stat-value">${state.filteredGames.length}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Favorites</div>
                    <div class="stat-value">${state.favorites.size}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Installed</div>
                    <div class="stat-value">${state.installedGames.size}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Current View</div>
                    <div class="stat-value">${state.currentView}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Category</div>
                    <div class="stat-value">${state.currentCategory}</div>
                </div>
            `;
        }

        // Render games in grid
        function renderGames() {
            const state = stateManager.getState();
            const grid = document.getElementById('gameGrid');
            grid.innerHTML = '';

            const games = state.filteredGames.length > 0 ? state.filteredGames : state.games;

            if (games.length === 0) {
                grid.innerHTML = '<p style="color: #8b8b8b; padding: 20px;">No games to display</p>';
                return;
            }

            games.forEach(game => {
                const card = document.createElement('div');
                card.className = 'game-card';
                card.innerHTML = `
                    <div class="game-icon">${game.icon}</div>
                    <div class="game-name">${game.name}</div>
                    <div class="game-desc">${game.description}</div>
                    <div class="game-meta">
                        ${game.category} ‚Ä¢ ${game.size} ‚Ä¢ ${game.isLocal ? 'Local' : 'Remote'}
                    </div>
                `;
                grid.appendChild(card);
            });

            updateStats();
        }

        // Create a new game
        function createGame() {
            const name = document.getElementById('gameName').value.trim();
            const desc = document.getElementById('gameDesc').value.trim();
            const icon = document.getElementById('gameIcon').value.trim();
            const category = document.getElementById('gameCategory').value;

            if (!name) {
                alert('Please enter a game name');
                return;
            }

            const game = new Game({
                id: GameUtils.generateGameId('custom'),
                name: name,
                description: desc || 'A custom game',
                icon: icon || 'üéÆ',
                category: category,
                size: '10 KB',
                author: 'You',
                version: '1.0',
                isLocal: true
            });

            const state = stateManager.getState();
            stateManager.setState({
                games: [...state.games, game],
                filteredGames: [...state.games, game]
            });

            renderGames();

            // Clear form
            document.getElementById('gameName').value = '';
            document.getElementById('gameDesc').value = '';

            log('stateOutput', `‚úì Created game: ${game.name} (${game.id})`);
        }

        // Subscribe to state changes
        function subscribeToGames() {
            subscriptionCount++;
            const id = subscriptionCount;

            const unsubscribe = stateManager.subscribe('games', (games) => {
                log('stateOutput', `[Subscriber ${id}] Games changed: ${games.length} games`);
            });

            log('stateOutput', `‚úì Created subscriber #${id}\nUse updateState() to trigger it`);
        }

        // Update view
        function updateView(view) {
            stateManager.setState({ currentView: view });
            log('stateOutput', `‚úì View changed to: ${view}`);
            updateStats();
        }

        // Filter by category
        function filterByCategory(category) {
            const state = stateManager.getState();

            stateManager.setState({ currentCategory: category });

            const filtered = GameUtils.filterGames(state.games, { category });

            stateManager.setState({ filteredGames: filtered });

            log('stateOutput', `‚úì Filtered by category: ${category}\n  Found ${filtered.length} games`);
            renderGames();
        }

        // Reset state
        function resetState() {
            stateManager.reset();
            log('stateOutput', '‚úì State reset to initial values');
            initializeSampleGames();
        }

        // Save to storage
        function saveToStorage() {
            const state = stateManager.getState();

            const success = StorageService.saveLocalGames(state.games);
            StorageService.saveFavorites(state.favorites);
            StorageService.saveInstalledGames(state.installedGames);

            if (success) {
                log('storageOutput', `‚úì Saved ${state.games.length} games to localStorage\n` +
                    `  Favorites: ${state.favorites.size}\n` +
                    `  Installed: ${state.installedGames.size}`);
            } else {
                log('storageOutput', '‚úó Failed to save to localStorage');
            }
        }

        // Load from storage
        function loadFromStorage() {
            const games = StorageService.loadLocalGames();
            const favorites = StorageService.loadFavorites();
            const installed = StorageService.loadInstalledGames();

            stateManager.setState({
                games,
                filteredGames: games,
                favorites,
                installedGames: installed
            });

            log('storageOutput', `‚úì Loaded from localStorage:\n` +
                `  Games: ${games.length}\n` +
                `  Favorites: ${favorites.size}\n` +
                `  Installed: ${installed.size}`);

            renderGames();
        }

        // Export data
        function exportData() {
            const data = StorageService.exportAllData();

            log('storageOutput', '‚úì Exported all data:\n' + JSON.stringify(data, null, 2));
        }

        // Check storage info
        function checkStorage() {
            const available = StorageService.isAvailable();
            const size = StorageService.getStorageSize();

            log('storageOutput', `LocalStorage Status:\n` +
                `  Available: ${available ? 'Yes' : 'No'}\n` +
                `  Total Size: ${size} bytes (${Math.round(size / 1024)} KB)\n` +
                `  Storage Keys: ${Object.keys(localStorage).length}`);
        }

        // Clear storage
        function clearStorage() {
            if (confirm('Clear all storage? This cannot be undone.')) {
                StorageService.clearAll();
                log('storageOutput', '‚úì All storage cleared');
            }
        }

        // Test validation
        function testValidation() {
            const validGame = {
                id: 'test-1',
                name: 'Valid Game',
                isLocal: true,
                code: '<html></html>'
            };

            const invalidGame = {
                // Missing required fields
                name: 'Invalid Game'
            };

            const valid = GameUtils.validateGameData(validGame);
            const invalid = GameUtils.validateGameData(invalidGame);

            log('utilsOutput', `Validation Test:\n\n` +
                `Valid Game: ${valid.valid ? '‚úì PASS' : '‚úó FAIL'}\n` +
                `  Errors: ${valid.errors.join(', ') || 'None'}\n\n` +
                `Invalid Game: ${invalid.valid ? '‚úì PASS' : '‚úó FAIL'}\n` +
                `  Errors:\n  - ${invalid.errors.join('\n  - ')}`);
        }

        // Test sorting
        function testSorting() {
            const state = stateManager.getState();
            const sorted = GameUtils.sortGames(state.games, 'name', true);

            log('utilsOutput', `Sorting Test (by name, ascending):\n` +
                sorted.map(g => `  ‚Ä¢ ${g.name}`).join('\n'));
        }

        // Test filtering
        function testFiltering() {
            const state = stateManager.getState();

            const puzzleGames = GameUtils.filterGames(state.games, { category: 'puzzle' });
            const searchResults = GameUtils.filterGames(state.games, { searchQuery: 'classic' });

            log('utilsOutput', `Filtering Test:\n\n` +
                `Puzzle Games: ${puzzleGames.length}\n` +
                puzzleGames.map(g => `  ‚Ä¢ ${g.name}`).join('\n') + '\n\n' +
                `Search "classic": ${searchResults.length}\n` +
                searchResults.map(g => `  ‚Ä¢ ${g.name}`).join('\n'));
        }

        // Generate ID
        function generateId() {
            const id1 = GameUtils.generateGameId('game');
            const id2 = GameUtils.generateGameId('custom');

            log('utilsOutput', `Generated IDs:\n` +
                `  ${id1}\n` +
                `  ${id2}`);
        }

        // Format file size
        function formatSize() {
            const sizes = [512, 1024, 2048, 1024 * 1024, 5 * 1024 * 1024];

            log('utilsOutput', `File Size Formatting:\n` +
                sizes.map(bytes => `  ${bytes} bytes ‚Üí ${GameUtils.formatFileSize(bytes)}`).join('\n'));
        }

        // Toggle favorite
        function toggleFavorite() {
            const state = stateManager.getState();
            if (state.games.length === 0) {
                log('favoritesOutput', '‚úó No games available');
                return;
            }

            const gameId = state.games[0].id;
            const favorites = new Set(state.favorites);

            if (favorites.has(gameId)) {
                favorites.delete(gameId);
                log('favoritesOutput', `‚úì Removed ${state.games[0].name} from favorites`);
            } else {
                favorites.add(gameId);
                log('favoritesOutput', `‚úì Added ${state.games[0].name} to favorites`);
            }

            stateManager.setState({ favorites });
            updateStats();
        }

        // Mark installed
        function markInstalled() {
            const state = stateManager.getState();
            if (state.games.length === 0) {
                log('favoritesOutput', '‚úó No games available');
                return;
            }

            const gameId = state.games[0].id;
            const installed = new Set(state.installedGames);
            installed.add(gameId);

            stateManager.setState({ installedGames: installed });
            log('favoritesOutput', `‚úì Marked ${state.games[0].name} as installed`);
            updateStats();
        }

        // Show favorites
        function showFavorites() {
            const state = stateManager.getState();
            const favoriteGames = state.games.filter(g => state.favorites.has(g.id));

            if (favoriteGames.length === 0) {
                log('favoritesOutput', 'No favorite games');
                return;
            }

            log('favoritesOutput', `Favorite Games (${favoriteGames.length}):\n` +
                favoriteGames.map(g => `  ‚≠ê ${g.name}`).join('\n'));
        }

        // Show installed
        function showInstalled() {
            const state = stateManager.getState();
            const installedGames = state.games.filter(g => state.installedGames.has(g.id));

            if (installedGames.length === 0) {
                log('favoritesOutput', 'No installed games');
                return;
            }

            log('favoritesOutput', `Installed Games (${installedGames.length}):\n` +
                installedGames.map(g => `  üì¶ ${g.name}`).join('\n'));
        }

        // Search functionality
        document.getElementById('searchBox').addEventListener('input', (e) => {
            const query = e.target.value;
            const state = stateManager.getState();

            const filtered = GameUtils.filterGames(state.games, {
                searchQuery: query,
                category: state.currentCategory !== 'all' ? state.currentCategory : null
            });

            stateManager.setState({ filteredGames: filtered });
            renderGames();
        });

        // Utility function to log to output divs
        function log(elementId, message) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.textContent = `[${timestamp}] ${message}`;
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            initializeSampleGames();

            log('stateOutput', 'State manager initialized with sample games');
            log('storageOutput', 'Storage service ready');
            log('utilsOutput', 'Utility functions ready');
            log('favoritesOutput', 'Favorites & installed tracking ready');
        });
    </script>
</body>
</html>

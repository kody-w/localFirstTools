<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Test your typing speed with real-time WPM tracking, accuracy analysis, and progress history">
    <title>Typing Speed Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            transition: background 0.3s ease;
        }

        body.light {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 100%;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        h1 {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 32px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controls-top {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            background: #f0f0f0;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            color: white;
        }

        body.light .stat {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .options {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .option-btn {
            padding: 10px 20px;
            background: #f0f0f0;
            border: 2px solid transparent;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .option-btn:hover {
            background: #e0e0e0;
        }

        .option-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        body.light .option-btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-color: #f093fb;
        }

        .text-display {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 12px;
            font-size: 24px;
            line-height: 1.8;
            margin-bottom: 20px;
            min-height: 200px;
            user-select: none;
            position: relative;
        }

        .text-display.focused {
            outline: 3px solid #667eea;
        }

        .char {
            position: relative;
        }

        .char.correct {
            color: #11998e;
        }

        .char.incorrect {
            color: #f5576c;
            background: rgba(245, 87, 108, 0.1);
        }

        .char.current {
            background: #667eea;
            color: white;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        .input-area {
            opacity: 0;
            position: absolute;
            left: -9999px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .control-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .start-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(17, 153, 142, 0.3);
        }

        .reset-btn {
            background: #f0f0f0;
            color: #666;
        }

        .reset-btn:hover {
            background: #e0e0e0;
        }

        .results {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
        }

        .results-title {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 25px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .result-value {
            font-size: 42px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .result-label {
            font-size: 14px;
            color: #666;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .chart-container {
            margin: 25px 0;
            height: 200px;
        }

        canvas {
            max-width: 100%;
        }

        .history {
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
        }

        .history-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .history-item-wpm {
            font-weight: 700;
            color: #667eea;
        }

        .history-item-date {
            color: #999;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .text-display {
                font-size: 18px;
                padding: 20px;
            }

            .stat-value {
                font-size: 28px;
            }

            .options {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span>‚å®Ô∏è</span>
                <span>Typing Speed Test</span>
            </h1>
            <div class="controls-top">
                <button class="icon-btn" id="themeBtn" title="Toggle theme">üåì</button>
                <button class="icon-btn" id="historyBtn" title="View history">üìä</button>
            </div>
        </div>

        <div id="testView">
            <div class="stats-bar">
                <div class="stat">
                    <div class="stat-value" id="wpmDisplay">0</div>
                    <div class="stat-label">WPM</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="accuracyDisplay">100%</div>
                    <div class="stat-label">Accuracy</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="timeDisplay">60</div>
                    <div class="stat-label">Time (s)</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="errorDisplay">0</div>
                    <div class="stat-label">Errors</div>
                </div>
            </div>

            <div class="options">
                <button class="option-btn active" data-mode="time" data-value="30">30s</button>
                <button class="option-btn" data-mode="time" data-value="60">1 min</button>
                <button class="option-btn" data-mode="time" data-value="120">2 min</button>
                <button class="option-btn" data-mode="words" data-value="50">50 words</button>
                <button class="option-btn" data-mode="words" data-value="100">100 words</button>
            </div>

            <div class="text-display" id="textDisplay" tabindex="0">
                <div id="textContent"></div>
                <input type="text" class="input-area" id="inputArea" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
            </div>

            <div class="controls">
                <button class="control-btn start-btn" id="startBtn">Click or Type to Start</button>
                <button class="control-btn reset-btn" id="resetBtn">Reset</button>
            </div>
        </div>

        <div id="resultsView" class="hidden">
            <div class="results">
                <div class="results-title">Test Complete!</div>

                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-value" id="finalWPM">0</div>
                        <div class="result-label">Words Per Minute</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="finalAccuracy">0%</div>
                        <div class="result-label">Accuracy</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="finalCPM">0</div>
                        <div class="result-label">Characters Per Minute</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="finalErrors">0</div>
                        <div class="result-label">Total Errors</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="wpmChart"></canvas>
                </div>

                <div class="controls">
                    <button class="control-btn start-btn" id="retryBtn">Try Again</button>
                </div>
            </div>
        </div>

        <div id="historyView" class="hidden">
            <div class="results">
                <div class="results-title">Test History</div>
                <div class="history" id="historyList"></div>
                <div class="controls">
                    <button class="control-btn reset-btn" id="closeHistoryBtn">Close</button>
                    <button class="control-btn reset-btn" id="clearHistoryBtn">Clear History</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Text samples
        const textSamples = {
            easy: [
                "The quick brown fox jumps over the lazy dog. The sun is shining bright today. Birds are singing in the trees. Life is beautiful and full of joy.",
                "A good book is a best friend. Reading helps you learn new things. Knowledge is power and wisdom is key. Always keep learning every day.",
                "Music makes the world better. Dancing is fun and exciting. Everyone loves a good song. Share your favorite music with friends.",
            ],
            medium: [
                "Technology has revolutionized the way we communicate and work. Modern devices connect people across vast distances instantly. Innovation drives progress in unexpected ways.",
                "Programming requires logical thinking and problem-solving skills. Developers write code to create software applications. Debugging is an essential part of the development process.",
                "The internet has transformed global commerce and information sharing. Digital platforms enable unprecedented connectivity and collaboration. Online communities foster diverse perspectives and ideas.",
            ],
            hard: [
                "Artificial intelligence and machine learning algorithms continue to advance exponentially, reshaping industries and challenging traditional paradigms. Quantum computing promises revolutionary breakthroughs.",
                "Philosophical contemplation regarding existential questions necessitates introspective examination of fundamental presuppositions underlying conscious experience and phenomenological interpretation of reality.",
                "Cryptocurrency blockchain technology demonstrates decentralized consensus mechanisms through cryptographic validation, potentially disrupting conventional financial intermediation and transactional infrastructure.",
            ]
        };

        // State
        let testMode = 'time';
        let testValue = 30;
        let testActive = false;
        let testStartTime = 0;
        let testText = '';
        let currentIndex = 0;
        let correctChars = 0;
        let incorrectChars = 0;
        let wpmHistory = [];
        let testHistory = [];
        let timerInterval = null;
        let difficulty = 'easy';

        // Initialize
        init();

        function init() {
            loadHistory();
            setupEventListeners();
            updateTheme();
            loadText();
        }

        function loadHistory() {
            const saved = localStorage.getItem('typingTestHistory');
            if (saved) {
                testHistory = JSON.parse(saved);
            }
        }

        function saveHistory(result) {
            testHistory.unshift(result);
            if (testHistory.length > 20) {
                testHistory = testHistory.slice(0, 20);
            }
            localStorage.setItem('typingTestHistory', JSON.stringify(testHistory));
        }

        function setupEventListeners() {
            // Mode selection
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    testMode = this.dataset.mode;
                    testValue = parseInt(this.dataset.value);
                    resetTest();
                });
            });

            // Text display click to focus
            document.getElementById('textDisplay').addEventListener('click', () => {
                document.getElementById('inputArea').focus();
            });

            // Input handling
            const inputArea = document.getElementById('inputArea');
            inputArea.addEventListener('input', handleInput);
            inputArea.addEventListener('focus', () => {
                document.getElementById('textDisplay').classList.add('focused');
                if (!testActive) {
                    startTest();
                }
            });
            inputArea.addEventListener('blur', () => {
                document.getElementById('textDisplay').classList.remove('focused');
            });

            // Buttons
            document.getElementById('startBtn').addEventListener('click', () => {
                document.getElementById('inputArea').focus();
            });
            document.getElementById('resetBtn').addEventListener('click', resetTest);
            document.getElementById('retryBtn').addEventListener('click', () => {
                showView('test');
                resetTest();
            });
            document.getElementById('themeBtn').addEventListener('click', toggleTheme);
            document.getElementById('historyBtn').addEventListener('click', () => {
                showView('history');
                renderHistory();
            });
            document.getElementById('closeHistoryBtn').addEventListener('click', () => showView('test'));
            document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);
        }

        function loadText() {
            // Select random text based on difficulty
            const samples = textSamples[difficulty];
            let selectedText = samples[Math.floor(Math.random() * samples.length)];

            // If words mode, adjust text length
            if (testMode === 'words') {
                const words = selectedText.split(' ');
                while (words.length < testValue) {
                    const newSample = samples[Math.floor(Math.random() * samples.length)];
                    selectedText += ' ' + newSample;
                }
                selectedText = selectedText.split(' ').slice(0, testValue).join(' ');
            }

            testText = selectedText;
            renderText();
        }

        function renderText() {
            const textContent = document.getElementById('textContent');
            textContent.innerHTML = testText.split('').map((char, index) => {
                let className = 'char';
                if (index < currentIndex) {
                    className += testText[index] === (document.getElementById('inputArea').value[index] || '') ? ' correct' : ' incorrect';
                } else if (index === currentIndex) {
                    className += ' current';
                }
                return `<span class="${className}">${char === ' ' ? '&nbsp;' : char}</span>`;
            }).join('');
        }

        function startTest() {
            if (testActive) return;
            testActive = true;
            testStartTime = Date.now();
            wpmHistory = [];

            if (testMode === 'time') {
                startTimer();
            }

            document.getElementById('startBtn').textContent = 'Test Running...';
            document.getElementById('startBtn').disabled = true;
        }

        function startTimer() {
            let elapsed = 0;
            timerInterval = setInterval(() => {
                elapsed++;
                const remaining = testValue - elapsed;
                document.getElementById('timeDisplay').textContent = remaining;

                if (remaining <= 0) {
                    endTest();
                }
            }, 1000);
        }

        function handleInput(e) {
            if (!testActive) return;

            const input = e.target.value;
            currentIndex = input.length;

            // Calculate stats
            correctChars = 0;
            incorrectChars = 0;

            for (let i = 0; i < input.length; i++) {
                if (input[i] === testText[i]) {
                    correctChars++;
                } else {
                    incorrectChars++;
                }
            }

            // Update display
            updateStats();
            renderText();

            // Check completion
            if (testMode === 'words' && currentIndex >= testText.length) {
                endTest();
            }
        }

        function updateStats() {
            const elapsed = (Date.now() - testStartTime) / 1000 / 60; // minutes
            const wordsTyped = correctChars / 5; // Standard: 5 chars = 1 word
            const wpm = Math.round(wordsTyped / elapsed) || 0;
            const accuracy = correctChars + incorrectChars > 0 ?
                Math.round((correctChars / (correctChars + incorrectChars)) * 100) : 100;

            document.getElementById('wpmDisplay').textContent = wpm;
            document.getElementById('accuracyDisplay').textContent = accuracy + '%';
            document.getElementById('errorDisplay').textContent = incorrectChars;

            // Track WPM over time
            wpmHistory.push({ time: elapsed, wpm: wpm });
        }

        function endTest() {
            clearInterval(timerInterval);
            testActive = false;

            const elapsed = (Date.now() - testStartTime) / 1000 / 60;
            const wordsTyped = correctChars / 5;
            const wpm = Math.round(wordsTyped / elapsed) || 0;
            const accuracy = correctChars + incorrectChars > 0 ?
                Math.round((correctChars / (correctChars + incorrectChars)) * 100) : 100;
            const cpm = Math.round(correctChars / elapsed) || 0;

            // Save result
            const result = {
                date: new Date().toISOString(),
                wpm: wpm,
                accuracy: accuracy,
                cpm: cpm,
                errors: incorrectChars,
                mode: testMode,
                value: testValue
            };
            saveHistory(result);

            // Show results
            document.getElementById('finalWPM').textContent = wpm;
            document.getElementById('finalAccuracy').textContent = accuracy + '%';
            document.getElementById('finalCPM').textContent = cpm;
            document.getElementById('finalErrors').textContent = incorrectChars;

            drawWPMChart();
            showView('results');
        }

        function drawWPMChart() {
            const canvas = document.getElementById('wpmChart');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth * window.devicePixelRatio;
            canvas.height = 200 * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);

            const width = canvas.offsetWidth;
            const height = 200;
            const padding = 40;

            // Clear
            ctx.clearRect(0, 0, width, height);

            if (wpmHistory.length < 2) return;

            // Find max WPM
            const maxWPM = Math.max(...wpmHistory.map(h => h.wpm), 50);

            // Draw axes
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();

            // Draw line
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();

            wpmHistory.forEach((point, index) => {
                const x = padding + (width - padding * 2) * (index / (wpmHistory.length - 1));
                const y = height - padding - (height - padding * 2) * (point.wpm / maxWPM);

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });

            ctx.stroke();

            // Draw points
            ctx.fillStyle = '#667eea';
            wpmHistory.forEach((point, index) => {
                const x = padding + (width - padding * 2) * (index / (wpmHistory.length - 1));
                const y = height - padding - (height - padding * 2) * (point.wpm / maxWPM);
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });

            // Labels
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('0', padding, height - padding + 20);
            ctx.fillText(maxWPM, padding - 15, padding + 5);
            ctx.fillText('WPM', padding - 15, height / 2);
            ctx.fillText('Time', width / 2, height - padding + 20);
        }

        function resetTest() {
            clearInterval(timerInterval);
            testActive = false;
            currentIndex = 0;
            correctChars = 0;
            incorrectChars = 0;
            wpmHistory = [];

            document.getElementById('inputArea').value = '';
            document.getElementById('startBtn').textContent = 'Click or Type to Start';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('wpmDisplay').textContent = '0';
            document.getElementById('accuracyDisplay').textContent = '100%';
            document.getElementById('timeDisplay').textContent = testMode === 'time' ? testValue : '--';
            document.getElementById('errorDisplay').textContent = '0';

            loadText();
        }

        function showView(view) {
            document.getElementById('testView').classList.toggle('hidden', view !== 'test');
            document.getElementById('resultsView').classList.toggle('hidden', view !== 'results');
            document.getElementById('historyView').classList.toggle('hidden', view !== 'history');
        }

        function renderHistory() {
            const historyList = document.getElementById('historyList');

            if (testHistory.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">No test history yet</p>';
                return;
            }

            historyList.innerHTML = testHistory.map(result => {
                const date = new Date(result.date);
                const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                return `
                    <div class="history-item">
                        <span class="history-item-wpm">${result.wpm} WPM</span>
                        <span>${result.accuracy}% accuracy</span>
                        <span class="history-item-date">${dateStr}</span>
                    </div>
                `;
            }).join('');
        }

        function clearHistory() {
            if (!confirm('Clear all test history?')) return;
            testHistory = [];
            localStorage.removeItem('typingTestHistory');
            renderHistory();
        }

        function updateTheme() {
            const theme = localStorage.getItem('theme') || 'dark';
            if (theme === 'light') {
                document.body.classList.add('light');
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('light');
            const theme = document.body.classList.contains('light') ? 'light' : 'dark';
            localStorage.setItem('theme', theme);
        }
    </script>
</body>
</html>

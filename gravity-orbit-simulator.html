<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gravity & Orbit Simulator</title>
    <meta name="description" content="N-body gravity simulation with orbital mechanics, collision detection, trails, multiple presets, and real-time physics calculations">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #000;
            height: 100vh;
            overflow: hidden;
            color: #e0e0e0;
        }
        #app { display: flex; height: 100vh; }
        #sidebar {
            width: 320px;
            background: rgba(10, 10, 20, 0.95);
            padding: 20px;
            overflow-y: auto;
            border-right: 2px solid #ffeb3b;
        }
        h1 { font-size: 18px; color: #ffeb3b; margin-bottom: 20px; }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        .section h3 {
            font-size: 12px;
            color: #ffeb3b;
            margin-bottom: 12px;
            text-transform: uppercase;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 11px;
            color: #aaa;
        }
        input[type="range"] {
            width: 100%;
            margin-bottom: 15px;
        }
        input[type="number"], input[type="color"] {
            width: 100%;
            padding: 8px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ffeb3b;
            color: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        input[type="color"] {
            height: 40px;
            padding: 2px;
        }
        button {
            width: 100%;
            padding: 10px;
            background: #ffeb3b;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 8px;
            font-weight: bold;
        }
        button:hover { background: #ffd700; }
        .value-display {
            float: right;
            color: #ffeb3b;
            font-weight: bold;
        }
        #main { flex: 1; display: flex; flex-direction: column; }
        #header {
            background: rgba(10, 10, 20, 0.95);
            padding: 15px 20px;
            border-bottom: 2px solid #ffeb3b;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            cursor: crosshair;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .preset-btn {
            padding: 10px;
            background: rgba(255, 235, 59, 0.2);
            border: 1px solid #ffeb3b;
            color: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 8px;
            text-align: center;
            font-size: 12px;
        }
        .preset-btn:hover { background: rgba(255, 235, 59, 0.4); }
        #stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(10, 10, 20, 0.9);
            padding: 15px;
            border-radius: 8px;
            font-size: 11px;
            border: 1px solid #ffeb3b;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            gap: 15px;
        }
        .stat-value { color: #ffeb3b; font-weight: bold; }
        .body-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .body-item {
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
        }
        .body-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
        }
        .remove-btn {
            padding: 2px 8px;
            background: #ff6b6b;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
        }
        .info-text {
            font-size: 11px;
            color: #aaa;
            line-height: 1.5;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="sidebar">
            <h1>ü™ê Gravity Simulator</h1>

            <div class="section">
                <h3>Add Body</h3>
                <label>Mass <span class="value-display" id="massVal">1000</span></label>
                <input type="range" id="mass" min="100" max="10000" value="1000">

                <label>Velocity X <span class="value-display" id="velXVal">0</span></label>
                <input type="range" id="velX" min="-500" max="500" value="0">

                <label>Velocity Y <span class="value-display" id="velYVal">0</span></label>
                <input type="range" id="velY" min="-500" max="500" value="0">

                <label>Color</label>
                <input type="color" id="bodyColor" value="#ffeb3b">

                <button onclick="addBodyMode()">üéØ Click to Add Body</button>
            </div>

            <div class="section">
                <h3>Physics Settings</h3>
                <label>Gravity Constant <span class="value-display" id="gravConstVal">100</span></label>
                <input type="range" id="gravConst" min="10" max="500" value="100">

                <label>Time Speed <span class="value-display" id="timeSpeedVal">1.0x</span></label>
                <input type="range" id="timeSpeed" min="0.1" max="5" step="0.1" value="1">

                <label>Trail Length <span class="value-display" id="trailVal">50</span></label>
                <input type="range" id="trailLength" min="0" max="200" value="50">

                <label>
                    <input type="checkbox" id="collisions" checked>
                    Enable Collisions
                </label>

                <label>
                    <input type="checkbox" id="showVectors">
                    Show Velocity Vectors
                </label>
            </div>

            <div class="section">
                <h3>Presets</h3>
                <div class="preset-btn" onclick="loadPreset('solar')">‚òÄÔ∏è Solar System</div>
                <div class="preset-btn" onclick="loadPreset('binary')">‚öõÔ∏è Binary Stars</div>
                <div class="preset-btn" onclick="loadPreset('figure8')">üé± Figure-8</div>
                <div class="preset-btn" onclick="loadPreset('chaos')">üí´ Chaotic System</div>
                <div class="preset-btn" onclick="loadPreset('galaxy')">üåå Mini Galaxy</div>
            </div>

            <div class="section">
                <h3>Bodies</h3>
                <div class="body-list" id="bodyList"></div>
            </div>

            <div class="section">
                <h3>Actions</h3>
                <button onclick="togglePause()">‚èØÔ∏è Pause/Resume</button>
                <button onclick="clearBodies()">üóëÔ∏è Clear All</button>
                <button onclick="centerView()">üéØ Center View</button>
            </div>

            <div class="info-text">
                Click on canvas to add bodies. Bodies attract each other with gravity and can collide and merge.
            </div>
        </div>

        <div id="main">
            <div id="header">
                <h2 style="color: #ffeb3b;">N-Body Gravity Simulation</h2>
                <div style="font-size: 12px; color: #aaa;">
                    Real-time orbital mechanics
                </div>
            </div>

            <div id="canvas-container">
                <canvas id="canvas"></canvas>
                <div id="stats">
                    <div class="stat-row">
                        <span>Bodies:</span>
                        <span class="stat-value" id="bodyCount">0</span>
                    </div>
                    <div class="stat-row">
                        <span>FPS:</span>
                        <span class="stat-value" id="fps">60</span>
                    </div>
                    <div class="stat-row">
                        <span>Total Energy:</span>
                        <span class="stat-value" id="energy">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let bodies = [];
        let isPaused = false;
        let addMode = false;
        let cameraX = 0, cameraY = 0;
        let lastTime = Date.now();

        let params = {
            mass: 1000,
            velX: 0,
            velY: 0,
            bodyColor: '#ffeb3b',
            gravConst: 100,
            timeSpeed: 1,
            trailLength: 50,
            collisions: true,
            showVectors: false
        };

        class Body {
            constructor(x, y, vx, vy, mass, color) {
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.mass = mass;
                this.radius = Math.sqrt(mass / Math.PI) / 3;
                this.color = color;
                this.trail = [];
                this.id = Date.now() + Math.random();
            }

            update(dt, allBodies) {
                // Calculate gravitational forces
                let fx = 0, fy = 0;

                allBodies.forEach(other => {
                    if (other.id === this.id) return;

                    const dx = other.x - this.x;
                    const dy = other.y - this.y;
                    const distSq = dx * dx + dy * dy;
                    const dist = Math.sqrt(distSq);

                    if (dist < 1) return; // Avoid singularity

                    // F = G * m1 * m2 / r^2
                    const force = params.gravConst * this.mass * other.mass / distSq;

                    fx += force * dx / dist;
                    fy += force * dy / dist;
                });

                // Update velocity
                this.vx += (fx / this.mass) * dt;
                this.vy += (fy / this.mass) * dt;

                // Update position
                this.x += this.vx * dt;
                this.y += this.vy * dt;

                // Update trail
                if (params.trailLength > 0) {
                    this.trail.push({ x: this.x, y: this.y });
                    if (this.trail.length > params.trailLength) {
                        this.trail.shift();
                    }
                }
            }

            draw() {
                const screenX = this.x - cameraX + width / 2;
                const screenY = this.y - cameraY + height / 2;

                // Draw trail
                if (this.trail.length > 1) {
                    ctx.strokeStyle = this.color + '44';
                    ctx.lineWidth = 2;
                    ctx.beginPath();

                    this.trail.forEach((pos, i) => {
                        const sx = pos.x - cameraX + width / 2;
                        const sy = pos.y - cameraY + height / 2;

                        if (i === 0) ctx.moveTo(sx, sy);
                        else ctx.lineTo(sx, sy);
                    });

                    ctx.stroke();
                }

                // Draw body
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(screenX, screenY, this.radius, 0, Math.PI * 2);
                ctx.fill();

                // Draw glow
                const gradient = ctx.createRadialGradient(screenX, screenY, 0, screenX, screenY, this.radius * 2);
                gradient.addColorStop(0, this.color + 'AA');
                gradient.addColorStop(1, this.color + '00');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(screenX, screenY, this.radius * 2, 0, Math.PI * 2);
                ctx.fill();

                // Draw velocity vector
                if (params.showVectors) {
                    const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                    if (speed > 1) {
                        ctx.strokeStyle = '#00ff88';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(screenX, screenY);
                        ctx.lineTo(screenX + this.vx * 0.1, screenY + this.vy * 0.1);
                        ctx.stroke();
                    }
                }
            }
        }

        function resizeCanvas() {
            width = canvas.parentElement.clientWidth;
            height = canvas.parentElement.clientHeight;
            canvas.width = width;
            canvas.height = height;
        }

        function update() {
            if (!isPaused) {
                const now = Date.now();
                const dt = Math.min((now - lastTime) / 1000, 0.033) * params.timeSpeed;
                lastTime = now;

                // Update all bodies
                bodies.forEach(body => body.update(dt, bodies));

                // Check collisions
                if (params.collisions) {
                    for (let i = bodies.length - 1; i >= 0; i--) {
                        for (let j = i - 1; j >= 0; j--) {
                            const b1 = bodies[i];
                            const b2 = bodies[j];

                            const dx = b2.x - b1.x;
                            const dy = b2.y - b1.y;
                            const dist = Math.sqrt(dx * dx + dy * dy);

                            if (dist < b1.radius + b2.radius) {
                                // Merge bodies (perfectly inelastic collision)
                                const totalMass = b1.mass + b2.mass;
                                b1.vx = (b1.vx * b1.mass + b2.vx * b2.mass) / totalMass;
                                b1.vy = (b1.vy * b1.mass + b2.vy * b2.mass) / totalMass;
                                b1.x = (b1.x * b1.mass + b2.x * b2.mass) / totalMass;
                                b1.y = (b1.y * b1.mass + b2.y * b2.mass) / totalMass;
                                b1.mass = totalMass;
                                b1.radius = Math.sqrt(totalMass / Math.PI) / 3;
                                bodies.splice(j, 1);
                            }
                        }
                    }
                }

                // Calculate total energy for stats
                let totalEnergy = 0;
                bodies.forEach(body => {
                    const kineticEnergy = 0.5 * body.mass * (body.vx * body.vx + body.vy * body.vy);
                    totalEnergy += kineticEnergy;
                });
                document.getElementById('energy').textContent = Math.round(totalEnergy);

                // Update FPS
                const fps = Math.round(1000 / (now - lastTime));
                document.getElementById('fps').textContent = fps;
            }

            render();
            updateBodyList();
            requestAnimationFrame(update);
        }

        function render() {
            // Clear canvas with fade effect
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, width, height);

            // Draw bodies
            bodies.forEach(body => body.draw());

            document.getElementById('bodyCount').textContent = bodies.length;
        }

        function addBodyMode() {
            addMode = true;
            canvas.style.cursor = 'crosshair';
        }

        function addBody(x, y) {
            bodies.push(new Body(
                x + cameraX - width / 2,
                y + cameraY - height / 2,
                params.velX,
                params.velY,
                params.mass,
                params.bodyColor
            ));
            addMode = false;
            canvas.style.cursor = 'default';
            updateBodyList();
        }

        function removeBody(index) {
            bodies.splice(index, 1);
            updateBodyList();
        }

        function updateBodyList() {
            const list = document.getElementById('bodyList');
            list.innerHTML = bodies.map((body, i) => `
                <div class="body-item">
                    <div>
                        <span class="body-color" style="background: ${body.color}"></span>
                        Mass: ${Math.round(body.mass)}
                    </div>
                    <button class="remove-btn" onclick="removeBody(${i})">‚úï</button>
                </div>
            `).join('');
        }

        function loadPreset(name) {
            bodies = [];

            const presets = {
                solar: [
                    { x: 0, y: 0, vx: 0, vy: 0, mass: 5000, color: '#ffeb3b' }, // Sun
                    { x: 200, y: 0, vx: 0, vy: 200, mass: 500, color: '#4fc3f7' }, // Planet 1
                    { x: 350, y: 0, vx: 0, vy: 150, mass: 300, color: '#ff6b6b' }, // Planet 2
                    { x: 500, y: 0, vx: 0, vy: 120, mass: 200, color: '#51cf66' }  // Planet 3
                ],
                binary: [
                    { x: -100, y: 0, vx: 0, vy: -150, mass: 2000, color: '#ff006e' },
                    { x: 100, y: 0, vx: 0, vy: 150, mass: 2000, color: '#4fc3f7' }
                ],
                figure8: [
                    { x: -100, y: 0, vx: 46.7, vy: 43.3, mass: 1000, color: '#ff006e' },
                    { x: 100, y: 0, vx: 46.7, vy: 43.3, mass: 1000, color: '#00ff88' },
                    { x: 0, y: 0, vx: -93.4, vy: -86.6, mass: 1000, color: '#4fc3f7' }
                ],
                chaos: [
                    { x: 0, y: 0, vx: 0, vy: 0, mass: 3000, color: '#ffeb3b' },
                    { x: 200, y: 0, vx: 0, vy: 180, mass: 800, color: '#ff006e' },
                    { x: -150, y: 150, vx: 120, vy: 0, mass: 800, color: '#4fc3f7' },
                    { x: -150, y: -150, vx: 120, vy: 0, mass: 800, color: '#00ff88' }
                ],
                galaxy: () => {
                    const center = { x: 0, y: 0, vx: 0, vy: 0, mass: 5000, color: '#ffeb3b' };
                    const stars = [];
                    for (let i = 0; i < 50; i++) {
                        const angle = Math.random() * Math.PI * 2;
                        const radius = 100 + Math.random() * 300;
                        const x = Math.cos(angle) * radius;
                        const y = Math.sin(angle) * radius;
                        const speed = Math.sqrt(params.gravConst * center.mass / radius);
                        const vx = -Math.sin(angle) * speed;
                        const vy = Math.cos(angle) * speed;

                        stars.push({
                            x, y, vx, vy,
                            mass: 50 + Math.random() * 150,
                            color: `hsl(${Math.random() * 60 + 180}, 100%, 70%)`
                        });
                    }
                    return [center, ...stars];
                }
            };

            let preset = presets[name];
            if (typeof preset === 'function') preset = preset();

            preset.forEach(p => {
                bodies.push(new Body(p.x, p.y, p.vx, p.vy, p.mass, p.color));
            });

            updateBodyList();
        }

        function togglePause() {
            isPaused = !isPaused;
        }

        function clearBodies() {
            bodies = [];
            updateBodyList();
        }

        function centerView() {
            if (bodies.length === 0) {
                cameraX = 0;
                cameraY = 0;
                return;
            }

            let totalMass = 0;
            let centerX = 0, centerY = 0;

            bodies.forEach(body => {
                centerX += body.x * body.mass;
                centerY += body.y * body.mass;
                totalMass += body.mass;
            });

            cameraX = centerX / totalMass;
            cameraY = centerY / totalMass;
        }

        // Event listeners
        canvas.addEventListener('click', (e) => {
            if (addMode) {
                const rect = canvas.getBoundingClientRect();
                addBody(e.clientX - rect.left, e.clientY - rect.top);
            }
        });

        // Parameter controls
        ['mass', 'velX', 'velY', 'gravConst', 'timeSpeed', 'trailLength'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                params[id] = parseFloat(e.target.value);
                document.getElementById(id + 'Val').textContent =
                    id === 'timeSpeed' ? params[id].toFixed(1) + 'x' : Math.round(params[id]);
            });
        });

        document.getElementById('bodyColor').addEventListener('change', (e) => {
            params.bodyColor = e.target.value;
        });

        document.getElementById('collisions').addEventListener('change', (e) => {
            params.collisions = e.target.checked;
        });

        document.getElementById('showVectors').addEventListener('change', (e) => {
            params.showVectors = e.target.checked;
        });

        window.addEventListener('resize', resizeCanvas);
        window.addBodyMode = addBodyMode;
        window.removeBody = removeBody;
        window.loadPreset = loadPreset;
        window.togglePause = togglePause;
        window.clearBodies = clearBodies;
        window.centerView = centerView;

        // Initialize
        resizeCanvas();
        loadPreset('solar');
        update();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particle Life Simulator</title>
    <meta name="description" content="Emergent artificial life simulation with multi-species particles, attraction/repulsion forces, and complex self-organizing behaviors">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #000;
            height: 100vh;
            overflow: hidden;
            color: #e0e0e0;
        }
        #app { display: flex; height: 100vh; }
        #sidebar {
            width: 320px;
            background: rgba(10, 10, 30, 0.95);
            padding: 20px;
            overflow-y: auto;
            border-right: 2px solid #00ff88;
        }
        h1 { font-size: 18px; color: #00ff88; margin-bottom: 20px; }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        .section h3 {
            font-size: 12px;
            color: #00ff88;
            margin-bottom: 12px;
            text-transform: uppercase;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 11px;
            color: #aaa;
        }
        input[type="range"] {
            width: 100%;
            margin-bottom: 15px;
        }
        input[type="number"] {
            width: 100%;
            padding: 8px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff88;
            color: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        button {
            width: 100%;
            padding: 10px;
            background: #00ff88;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 8px;
            font-weight: bold;
        }
        button:hover { background: #00dd77; }
        .value-display {
            float: right;
            color: #00ff88;
            font-weight: bold;
        }
        #main { flex: 1; display: flex; flex-direction: column; }
        #header {
            background: rgba(10, 10, 30, 0.95);
            padding: 15px 20px;
            border-bottom: 2px solid #00ff88;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .preset-btn {
            padding: 10px;
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            color: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 8px;
            text-align: center;
            font-size: 12px;
        }
        .preset-btn:hover { background: rgba(0, 255, 136, 0.4); }
        #stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(10, 10, 30, 0.9);
            padding: 15px;
            border-radius: 8px;
            font-size: 11px;
            border: 1px solid #00ff88;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            gap: 15px;
        }
        .stat-value { color: #00ff88; font-weight: bold; }
        .species-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            margin: 15px 0;
        }
        .species-cell {
            aspect-ratio: 1;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            border: 2px solid transparent;
        }
        .species-cell:hover { border-color: #00ff88; }
        .info-text {
            font-size: 11px;
            color: #aaa;
            line-height: 1.5;
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="sidebar">
            <h1>üåà Particle Life</h1>

            <div class="section">
                <h3>Population</h3>
                <label>Particles <span class="value-display" id="particleCountVal">1000</span></label>
                <input type="range" id="particleCount" min="100" max="3000" step="100" value="1000">

                <label>Species <span class="value-display" id="speciesCountVal">4</span></label>
                <input type="range" id="speciesCount" min="2" max="8" value="4">

                <button onclick="resetSimulation()">üîÑ Reset Simulation</button>
            </div>

            <div class="section">
                <h3>Physics</h3>
                <label>Force Strength <span class="value-display" id="forceVal">1.0</span></label>
                <input type="range" id="forceStrength" min="0.1" max="3" step="0.1" value="1">

                <label>Force Range <span class="value-display" id="rangeVal">80</span></label>
                <input type="range" id="forceRange" min="20" max="200" value="80">

                <label>Friction <span class="value-display" id="frictionVal">0.5</span></label>
                <input type="range" id="friction" min="0" max="1" step="0.05" value="0.5">

                <label>Repulsion Range <span class="value-display" id="repulsionVal">15</span></label>
                <input type="range" id="repulsionRange" min="5" max="30" value="15">
            </div>

            <div class="section">
                <h3>Force Matrix</h3>
                <div class="species-grid" id="forceMatrix"></div>
                <div style="font-size: 10px; color: #aaa; margin-top: 10px;">
                    Green = Attraction, Red = Repulsion<br>
                    Click cells to edit relationships
                </div>
            </div>

            <div class="section">
                <h3>Presets</h3>
                <div class="preset-btn" onclick="loadPreset('balanced')">‚öñÔ∏è Balanced Ecosystem</div>
                <div class="preset-btn" onclick="loadPreset('chaos')">üí• Chaotic Dance</div>
                <div class="preset-btn" onclick="loadPreset('orbits')">üåÄ Orbital Systems</div>
                <div class="preset-btn" onclick="loadPreset('snakes')">üêç Snakes & Predators</div>
                <div class="preset-btn" onclick="loadPreset('mitosis')">üß¨ Cell Division</div>
            </div>

            <div class="section">
                <h3>Controls</h3>
                <button onclick="togglePause()">‚èØÔ∏è Pause/Resume</button>
                <button onclick="randomizeForces()">üé≤ Randomize Forces</button>
                <button onclick="exportConfig()">üíæ Export Config</button>
            </div>

            <div class="info-text">
                <strong>How it works:</strong><br>
                Particles have species with attraction/repulsion rules. Complex behaviors emerge from simple forces: orbiting, flocking, predator-prey dynamics, self-organization.
            </div>
        </div>

        <div id="main">
            <div id="header">
                <h2 style="color: #00ff88;">Emergent Artificial Life</h2>
                <div style="font-size: 12px; color: #aaa;">
                    Watch complexity emerge from simple rules
                </div>
            </div>

            <div id="canvas-container">
                <canvas id="canvas"></canvas>
                <div id="stats">
                    <div class="stat-row">
                        <span>Particles:</span>
                        <span class="stat-value" id="particlesActive">0</span>
                    </div>
                    <div class="stat-row">
                        <span>FPS:</span>
                        <span class="stat-value" id="fps">60</span>
                    </div>
                    <div class="stat-row">
                        <span>Emergent:</span>
                        <span class="stat-value" id="behavior">Initializing</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let particles = [];
        let isPaused = false;
        let lastTime = Date.now();
        let frameCount = 0;

        const speciesColors = [
            '#00ff88', '#ff006e', '#00d9ff', '#ffeb3b',
            '#8a2be2', '#ff8800', '#51cf66', '#ff6b6b'
        ];

        let params = {
            particleCount: 1000,
            speciesCount: 4,
            forceStrength: 1,
            forceRange: 80,
            friction: 0.5,
            repulsionRange: 15
        };

        let forceMatrix = [];

        class Particle {
            constructor(x, y, species) {
                this.x = x;
                this.y = y;
                this.vx = 0;
                this.vy = 0;
                this.species = species;
            }

            update(allParticles) {
                let fx = 0, fy = 0;

                // Calculate forces from all other particles
                for (const other of allParticles) {
                    if (other === this) continue;

                    let dx = other.x - this.x;
                    let dy = other.y - this.y;

                    // Wrap around boundaries
                    if (dx > width / 2) dx -= width;
                    if (dx < -width / 2) dx += width;
                    if (dy > height / 2) dy -= height;
                    if (dy < -height / 2) dy += height;

                    const distSq = dx * dx + dy * dy;
                    const dist = Math.sqrt(distSq);

                    if (dist < 0.01) continue;

                    // Repulsion at very close range
                    if (dist < params.repulsionRange) {
                        const repulsionForce = (params.repulsionRange - dist) / params.repulsionRange;
                        fx -= (dx / dist) * repulsionForce * 10;
                        fy -= (dy / dist) * repulsionForce * 10;
                    }
                    // Attraction/repulsion based on species
                    else if (dist < params.forceRange) {
                        const force = forceMatrix[this.species][other.species];
                        const strength = (1 - dist / params.forceRange) * force * params.forceStrength;
                        fx += (dx / dist) * strength;
                        fy += (dy / dist) * strength;
                    }
                }

                // Apply force
                this.vx += fx * 0.5;
                this.vy += fy * 0.5;

                // Apply friction
                this.vx *= (1 - params.friction * 0.1);
                this.vy *= (1 - params.friction * 0.1);

                // Update position
                this.x += this.vx;
                this.y += this.vy;

                // Wrap around boundaries
                if (this.x < 0) this.x += width;
                if (this.x > width) this.x -= width;
                if (this.y < 0) this.y += height;
                if (this.y > height) this.y -= height;
            }

            draw() {
                ctx.fillStyle = speciesColors[this.species];
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function resizeCanvas() {
            width = canvas.parentElement.clientWidth;
            height = canvas.parentElement.clientHeight;
            canvas.width = width;
            canvas.height = height;
        }

        function initializeForceMatrix() {
            forceMatrix = Array(params.speciesCount).fill().map(() =>
                Array(params.speciesCount).fill(0)
            );

            // Random forces
            for (let i = 0; i < params.speciesCount; i++) {
                for (let j = 0; j < params.speciesCount; j++) {
                    forceMatrix[i][j] = Math.random() * 2 - 1;
                }
            }

            renderForceMatrix();
        }

        function renderForceMatrix() {
            const container = document.getElementById('forceMatrix');
            container.innerHTML = '';

            const size = Math.sqrt(params.speciesCount * params.speciesCount);
            container.style.gridTemplateColumns = `repeat(${params.speciesCount}, 1fr)`;

            for (let i = 0; i < params.speciesCount; i++) {
                for (let j = 0; j < params.speciesCount; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'species-cell';

                    const force = forceMatrix[i][j];
                    const intensity = Math.abs(force);
                    const hue = force > 0 ? 120 : 0; // Green for attraction, red for repulsion

                    cell.style.background = `hsla(${hue}, 100%, 50%, ${intensity * 0.7})`;
                    cell.textContent = force.toFixed(1);

                    cell.onclick = () => {
                        forceMatrix[i][j] = (forceMatrix[i][j] + 0.5) % 2 - 1;
                        if (forceMatrix[i][j] < -1) forceMatrix[i][j] = 1;
                        renderForceMatrix();
                    };

                    container.appendChild(cell);
                }
            }
        }

        function resetSimulation() {
            particles = [];

            for (let i = 0; i < params.particleCount; i++) {
                particles.push(new Particle(
                    Math.random() * width,
                    Math.random() * height,
                    Math.floor(Math.random() * params.speciesCount)
                ));
            }

            initializeForceMatrix();
        }

        function update() {
            if (!isPaused) {
                const now = Date.now();
                const dt = Math.min((now - lastTime) / 1000, 0.033);
                lastTime = now;

                // Update particles
                particles.forEach(p => p.update(particles));

                // Detect emergent behaviors
                if (frameCount % 60 === 0) {
                    detectBehavior();
                }

                // Update FPS
                if (frameCount % 10 === 0) {
                    const fps = Math.round(1000 / (now - lastTime));
                    document.getElementById('fps').textContent = fps;
                }

                frameCount++;
            }

            render();
            requestAnimationFrame(update);
        }

        function detectBehavior() {
            // Simple behavior detection based on particle clustering and movement
            let avgSpeed = 0;
            let clusterCount = 0;

            particles.forEach(p => {
                avgSpeed += Math.sqrt(p.vx * p.vx + p.vy * p.vy);

                // Check if particle is near others of same species
                const nearSameSpecies = particles.filter(other =>
                    other.species === p.species &&
                    Math.abs(other.x - p.x) < 50 &&
                    Math.abs(other.y - p.y) < 50
                ).length;

                if (nearSameSpecies > 5) clusterCount++;
            });

            avgSpeed /= particles.length;

            let behavior = 'Evolving';
            if (avgSpeed > 2) behavior = 'Chaotic';
            else if (clusterCount > particles.length * 0.3) behavior = 'Clustering';
            else if (avgSpeed < 0.5) behavior = 'Stable';
            else behavior = 'Dynamic';

            document.getElementById('behavior').textContent = behavior;
        }

        function render() {
            // Fade effect
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, width, height);

            // Draw particles
            particles.forEach(p => p.draw());

            document.getElementById('particlesActive').textContent = particles.length;
        }

        function loadPreset(name) {
            const presets = {
                balanced: {
                    matrix: [
                        [0.3, -0.2, 0.1, 0.2],
                        [0.2, 0.3, -0.2, 0.1],
                        [-0.2, 0.1, 0.3, 0.2],
                        [0.1, 0.2, -0.2, 0.3]
                    ]
                },
                chaos: {
                    matrix: [
                        [0.5, -0.8, 0.6, -0.4],
                        [-0.7, 0.4, -0.6, 0.8],
                        [0.6, -0.5, 0.7, -0.6],
                        [-0.4, 0.7, -0.8, 0.5]
                    ]
                },
                orbits: {
                    matrix: [
                        [0.1, 0.8, -0.3, 0.2],
                        [-0.8, 0.1, 0.2, -0.3],
                        [0.3, -0.2, 0.1, 0.8],
                        [-0.2, 0.3, -0.8, 0.1]
                    ]
                },
                snakes: {
                    matrix: [
                        [0.8, -0.5, 0.3, -0.2],
                        [0.5, 0.8, -0.3, 0.2],
                        [-0.3, 0.3, 0.6, -0.4],
                        [0.2, -0.2, 0.4, 0.6]
                    ]
                },
                mitosis: {
                    matrix: [
                        [0.6, -0.6, 0.3, 0.2],
                        [-0.6, 0.6, 0.2, 0.3],
                        [0.3, 0.2, 0.6, -0.6],
                        [0.2, 0.3, -0.6, 0.6]
                    ]
                }
            };

            const preset = presets[name];
            if (preset) {
                forceMatrix = preset.matrix;
                renderForceMatrix();
            }
        }

        function togglePause() {
            isPaused = !isPaused;
        }

        function randomizeForces() {
            initializeForceMatrix();
        }

        function exportConfig() {
            const config = {
                params,
                forceMatrix,
                timestamp: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'particle-life-config.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Event listeners
        ['particleCount', 'speciesCount', 'forceStrength', 'forceRange', 'friction', 'repulsionRange'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                params[id] = parseFloat(e.target.value);
                const val = id === 'forceStrength' || id === 'friction' ?
                    params[id].toFixed(1) : Math.round(params[id]);
                document.getElementById(id + 'Val').textContent = val;
            });
        });

        document.getElementById('speciesCount').addEventListener('change', resetSimulation);
        document.getElementById('particleCount').addEventListener('change', resetSimulation);

        window.addEventListener('resize', resizeCanvas);
        window.resetSimulation = resetSimulation;
        window.loadPreset = loadPreset;
        window.togglePause = togglePause;
        window.randomizeForces = randomizeForces;
        window.exportConfig = exportConfig;

        // Initialize
        resizeCanvas();
        resetSimulation();
        update();
    </script>
</body>
</html>
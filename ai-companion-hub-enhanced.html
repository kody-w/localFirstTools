<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>AI Companion Hub - Enhanced Interactive Assistant</title>

    <!-- DNS preconnect for faster CDN loading -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="preconnect" href="https://threejs.org" crossorigin>
    <link rel="dns-prefetch" href="https://aka.ms">

    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" as="script">
    <link rel="preload" href="https://threejs.org/examples/fonts/helvetiker_regular.typeface.json" as="fetch" crossorigin>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            -webkit-overflow-scrolling: touch;
        }

        /* Enhanced loading screen */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .loading-content {
            text-align: center;
        }

        .loading-logo {
            width: 80px;
            height: 80px;
            margin-bottom: 30px;
            position: relative;
        }

        .loading-orb {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #06ffa5, #8338ec);
            border-radius: 50%;
            animation: loadingPulse 2s infinite;
            box-shadow: 0 0 40px rgba(6, 255, 165, 0.5);
        }

        @keyframes loadingPulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        .loading-text {
            font-size: 1.2em;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 200;
            letter-spacing: 0.1em;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 1px;
            overflow: hidden;
            margin: 0 auto;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #06ffa5, #8338ec);
            border-radius: 1px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .loading-status {
            margin-top: 15px;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.6);
        }

        #three-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            cursor: default;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #three-container.visible {
            opacity: 1;
        }

        /* NEW FEATURE: Accessibility - Focus Indicators */
        .settings-button:focus-visible,
        .ai-companion-button:focus-visible,
        .show-mode-button:focus-visible,
        .tasks-button:focus-visible,
        .voice-pause-button:focus-visible,
        .tool-gallery-button:focus-visible {
            outline: 3px solid #06ffa5;
            outline-offset: 4px;
            box-shadow: 0 0 40px rgba(6, 255, 165, 0.6), inset 0 0 20px rgba(6, 255, 165, 0.2);
        }

        /* Remove default focus outline */
        .settings-button:focus,
        .ai-companion-button:focus,
        .show-mode-button:focus,
        .tasks-button:focus,
        .voice-pause-button:focus,
        .tool-gallery-button:focus {
            outline: none;
        }

        /* Tool Overlay Window */
        .tool-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%;
            max-width: 1200px;
            height: 85vh;
            background: rgba(20, 20, 40, 0.98);
            border: 2px solid rgba(138, 43, 226, 0.5);
            border-radius: 20px;
            z-index: 2004;
            display: none;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 0 50px rgba(138, 43, 226, 0.3);
            backdrop-filter: blur(10px);
        }

        .tool-overlay.active {
            display: block;
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .tool-overlay-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px 20px 0 0;
        }

        .tool-overlay-title {
            font-size: 1.5em;
            font-weight: 300;
            color: #06ffa5;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-overlay-actions {
            display: flex;
            gap: 10px;
        }

        .tool-overlay-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .tool-overlay-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .tool-overlay-btn.primary {
            background: linear-gradient(45deg, #06ffa5, #00cc88);
            border: none;
            color: #000;
            font-weight: bold;
        }

        .tool-overlay-btn.primary:hover {
            box-shadow: 0 4px 20px rgba(6, 255, 165, 0.4);
        }

        .tool-overlay-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #fff;
            transition: all 0.3s;
        }

        .tool-overlay-close:hover {
            color: #ff006e;
            transform: rotate(90deg);
        }

        .tool-overlay-content {
            height: calc(100% - 80px);
            position: relative;
            overflow: hidden;
            border-radius: 0 0 20px 20px;
        }

        .tool-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            border-radius: 0 0 20px 20px;
        }

        .tool-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
        }

        .tool-loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #06ffa5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tool Gallery Button */
        .tool-gallery-button {
            position: fixed;
            bottom: calc(env(safe-area-inset-bottom, 30px) + 320px);
            right: calc(env(safe-area-inset-right, 30px));
            width: 60px;
            height: 60px;
            background: rgba(255, 106, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 106, 0, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1002;
            box-shadow: 0 0 20px rgba(255, 106, 0, 0.3);
            opacity: 0;
            transform: scale(0.8) translateZ(0);
            animation: fadeInButton 0.5s ease 0.4s forwards;
            will-change: transform, opacity;
        }

        .tool-gallery-button:hover {
            background: rgba(255, 106, 0, 0.5);
            transform: scale(1.1) translateZ(0);
            box-shadow: 0 0 30px rgba(255, 106, 0, 0.5);
        }

        .tool-gallery-button svg {
            width: 28px;
            height: 28px;
            color: white;
        }

        /* Show Mode Button */
        .show-mode-button {
            position: fixed;
            bottom: calc(env(safe-area-inset-bottom, 30px) + 240px);
            right: calc(env(safe-area-inset-right, 30px));
            width: 60px;
            height: 60px;
            background: rgba(0, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid rgba(0, 255, 255, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1002;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            opacity: 0;
            transform: scale(0.8) translateZ(0);
            animation: fadeInButton 0.5s ease 0.5s forwards;
            will-change: transform, opacity;
        }

        @keyframes fadeInButton {
            to {
                opacity: 1;
                transform: scale(1) translateZ(0);
            }
        }

        .show-mode-button:hover {
            background: rgba(0, 255, 255, 0.5);
            transform: scale(1.1) translateZ(0);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .show-mode-button.active {
            background: rgba(0, 255, 0, 0.3);
            border-color: rgba(0, 255, 0, 0.5);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }

        .show-mode-button svg {
            width: 28px;
            height: 28px;
            color: white;
        }

        /* Show Mode Status */
        .show-mode-status {
            position: fixed;
            top: env(safe-area-inset-top, 80px);
            right: env(safe-area-inset-right, 20px);
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .show-mode-status.visible {
            opacity: 1;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #888;
            transition: all 0.3s ease;
        }

        .status-indicator.connected {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }

        .status-indicator.hosting {
            background: #06ffa5;
            box-shadow: 0 0 10px #06ffa5;
        }

        .status-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
        }

        .viewer-count {
            color: #06ffa5;
            font-weight: bold;
        }

        /* Viewer Mode Indicator */
        .viewer-mode-indicator {
            position: fixed;
            top: env(safe-area-inset-top, 20px);
            left: env(safe-area-inset-left, 20px);
            background: rgba(138, 43, 226, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1005;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .viewer-mode-indicator.active {
            display: flex;
        }

        .viewer-mode-indicator svg {
            width: 20px;
            height: 20px;
        }

        /* Show Mode Modal */
        .show-mode-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2001;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .show-mode-modal.show {
            display: flex;
        }

        .show-mode-modal-content {
            background: rgba(20, 20, 40, 0.95);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.3);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #fff;
            transition: all 0.3s;
        }

        .modal-close:hover {
            color: #ff006e;
            transform: rotate(90deg);
        }

        .show-mode-modal h3 {
            margin: 0 0 20px 0;
            font-size: 24px;
            background: linear-gradient(45deg, #00ffff, #0088ff, #06ffa5);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .show-mode-info {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            padding: 10px;
            margin: 15px 0;
            font-size: 0.9em;
            color: #06ffa5;
        }

        #qr-code-container {
            margin: 20px auto;
            display: flex;
            justify-content: center;
            padding: 20px;
            background: white;
            border-radius: 15px;
            min-height: 250px;
        }

        #qr-code-container canvas,
        #qr-code-container img {
            border-radius: 10px;
        }

        .qr-url {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            word-break: break-all;
            margin: 20px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-family: monospace;
        }

        .copy-url-btn {
            background: linear-gradient(45deg, #00ffff, #0088ff);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .copy-url-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 255, 255, 0.4);
        }

        .copy-url-btn.copied {
            background: linear-gradient(45deg, #06ffa5, #00ff88);
        }

        /* Show Mode Notifications */
        .show-mode-notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            border: 2px solid rgba(0, 255, 255, 0.5);
            animation: slideIn 0.3s ease;
            z-index: 1005;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Following Indicator */
        .following-indicator {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 255, 255, 0.9);
            color: #000;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1004;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .following-indicator.active {
            display: flex;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 0.6; }
        }

        /* Settings Button */
        .settings-button {
            position: fixed;
            bottom: calc(env(safe-area-inset-bottom, 30px) + 160px);
            right: calc(env(safe-area-inset-right, 30px));
            width: 60px;
            height: 60px;
            background: rgba(138, 43, 226, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid rgba(138, 43, 226, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1002;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
            opacity: 0;
            transform: scale(0.8) translateZ(0);
            animation: fadeInButton 0.5s ease 0.6s forwards;
            will-change: transform, opacity;
        }

        .settings-button:hover {
            background: rgba(138, 43, 226, 0.5);
            transform: scale(1.1) translateZ(0);
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.5);
        }

        .settings-button svg {
            width: 28px;
            height: 28px;
            color: white;
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 20, 40, 0.95);
            border: 2px solid rgba(138, 43, 226, 0.5);
            border-radius: 20px;
            padding: 30px;
            z-index: 2003;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(138, 43, 226, 0.3);
            display: none;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .settings-panel.active {
            display: block;
        }

        .settings-panel h2 {
            margin: 0 0 25px 0;
            font-size: 28px;
            background: linear-gradient(45deg, #8a2be2, #06ffa5);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        .settings-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
        }

        .settings-tab {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .settings-tab:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .settings-tab.active {
            background: linear-gradient(45deg, #8a2be2, #06ffa5);
            border-color: transparent;
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
        }

        .settings-group {
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-group h3 {
            margin: 0 0 15px 0;
            font-size: 18px;
            color: #06ffa5;
        }

        .setting-item {
            margin-bottom: 15px;
        }

        .setting-item label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        .setting-item input[type="text"],
        .setting-item input[type="password"],
        .setting-item input[type="number"],
        .setting-item select {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .setting-item input[type="range"] {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .setting-item input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #8a2be2;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .setting-item input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: #06ffa5;
        }

        .range-value {
            display: inline-block;
            margin-left: 10px;
            font-family: monospace;
            color: #06ffa5;
            font-size: 13px;
            min-width: 60px;
        }

        .toggle-setting {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #06ffa5;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(24px);
        }

        .settings-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
        }

        .settings-btn {
            flex: 1;
            padding: 12px 20px;
            background: linear-gradient(45deg, #8a2be2, #06ffa5);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(138, 43, 226, 0.4);
        }

        .settings-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .settings-btn.danger {
            background: linear-gradient(45deg, #ff0066, #ff4458);
        }

        .close-settings {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #fff;
            transition: all 0.3s;
        }

        .close-settings:hover {
            color: #ff006e;
            transform: rotate(90deg);
        }

        .import-export-section {
            margin-top: 20px;
            padding: 20px;
            background: rgba(138, 43, 226, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .import-export-section h4 {
            margin: 0 0 15px 0;
            color: #8a2be2;
            font-size: 16px;
        }

        .json-preview {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-label {
            display: block;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-input-label:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #8a2be2;
        }

        /* Perspective Controls */
        .perspective-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .perspective-preset {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .preset-btn {
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .preset-btn:hover {
            background: rgba(138, 43, 226, 0.3);
            border-color: #8a2be2;
        }

        /* Click to Chat Tooltip */
        .companion-tooltip {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            color: #000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            white-space: nowrap;
            z-index: 1010;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .companion-tooltip.visible {
            opacity: 1;
        }

        /* Voice Pause Button - PROMINENT POSITION */
        .voice-pause-button {
            position: fixed;
            top: calc(env(safe-area-inset-top, 20px) + 60px);
            right: calc(env(safe-area-inset-right, 20px));
            width: 120px;
            height: 50px;
            background: rgba(255, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 0, 0, 0.5);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1006;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
            font-weight: bold;
            font-size: 14px;
            opacity: 0;
            transform: scale(0.8) translateZ(0);
            animation: fadeInButton 0.5s ease 0.4s forwards;
            will-change: transform, opacity;
        }

        .voice-pause-button:hover {
            background: rgba(255, 0, 0, 0.5);
            transform: scale(1.05) translateZ(0);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
        }

        .voice-pause-button.paused {
            background: rgba(255, 165, 0, 0.3);
            border-color: rgba(255, 165, 0, 0.5);
            box-shadow: 0 0 20px rgba(255, 165, 0, 0.3);
        }

        .voice-pause-button.paused:hover {
            background: rgba(255, 165, 0, 0.5);
            box-shadow: 0 0 30px rgba(255, 165, 0, 0.5);
        }

        .voice-pause-button svg {
            width: 24px;
            height: 24px;
            color: white;
        }

        /* Voice Paused Indicator */
        .voice-paused-indicator {
            position: fixed;
            top: calc(env(safe-area-inset-top, 20px) + 10px);
            right: calc(env(safe-area-inset-right, 20px));
            background: rgba(255, 165, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            display: none;
            align-items: center;
            gap: 8px;
            z-index: 1005;
            animation: fadeIn 0.3s ease-out;
            font-size: 13px;
            font-weight: bold;
        }

        .voice-paused-indicator.active {
            display: flex;
        }

        .voice-paused-indicator svg {
            width: 16px;
            height: 16px;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(138, 56, 236, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1004;
            animation: fadeIn 0.3s ease-out;
        }

        .voice-indicator.active {
            display: flex;
        }

        .voice-indicator i {
            animation: pulse 1.5s infinite;
        }

        /* Listening Indicator */
        .listening-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(255, 0, 110, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1004;
            animation: fadeIn 0.3s ease-out;
        }

        .listening-indicator.active {
            display: flex;
        }

        .listening-indicator svg {
            width: 20px;
            height: 20px;
            animation: voicePulse 1s infinite;
        }

        @keyframes voicePulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* AI Chat Interface */
        .ai-chat-interface {
            position: fixed;
            bottom: calc(env(safe-area-inset-bottom, 20px) + 100px);
            right: calc(env(safe-area-inset-right, 20px));
            width: 350px;
            height: 450px;
            background: rgba(20, 20, 40, 0.85);
            border: 2px solid rgba(138, 56, 236, 0.5);
            border-radius: 20px;
            display: none;
            flex-direction: column;
            z-index: 1003;
            box-shadow: 0 0 30px rgba(138, 56, 236, 0.3);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .ai-chat-interface.active {
            display: flex;
        }

        /* Special styling for viewer mode chat */
        .ai-chat-interface.viewer-mode {
            border-color: rgba(0, 255, 255, 0.5);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }

        /* Viewers can still interact with chat */
        .ai-chat-interface.viewer-mode .ai-chat-input-container {
            opacity: 1;
            pointer-events: all;
        }

        .ai-chat-header {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-title {
            font-weight: bold;
            color: #06ffa5;
        }

        .viewer-chat-label {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }

        .ai-chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .ai-message {
            margin: 10px 0;
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
            font-size: 15px;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
            max-width: 100%;
            overflow-x: auto;
            -webkit-user-select: text;
            user-select: text;
        }

        .ai-message.user {
            background: rgba(131, 56, 236, 0.3);
            margin-left: auto;
            text-align: right;
        }

        .ai-message.ai {
            background: rgba(6, 255, 165, 0.2);
            margin-right: auto;
        }

        /* Tool recommendation styling */
        .tool-recommendation {
            background: rgba(255, 106, 0, 0.15);
            border: 1px solid rgba(255, 106, 0, 0.3);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
        }

        .tool-recommendation-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            color: #ff6a00;
            margin-bottom: 8px;
        }

        .tool-recommendation-title {
            font-size: 1.1em;
            color: #ffa500;
            margin-bottom: 5px;
        }

        .tool-recommendation-description {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 10px;
        }

        .tool-recommendation-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .tool-action-btn {
            padding: 8px 16px;
            background: linear-gradient(45deg, #ff6a00, #ff8c00);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .tool-action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 106, 0, 0.4);
        }

        .tool-action-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tool-action-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Presenter label for viewer mode */
        .ai-message.presenter-message::before {
            content: "Presenter";
            display: block;
            font-size: 11px;
            color: #00ffff;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        /* Viewer label for presenter mode */
        .ai-message.viewer-message::before {
            content: attr(data-viewer-name);
            display: block;
            font-size: 11px;
            color: #ff6a00;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        /* Markdown Styles for AI Messages */
        .ai-message.ai h1,
        .ai-message.ai h2,
        .ai-message.ai h3,
        .ai-message.ai h4,
        .ai-message.ai h5,
        .ai-message.ai h6 {
            margin: 0.5em 0 0.3em 0;
            font-weight: 600;
            line-height: 1.3;
            color: #06ffa5;
        }

        .ai-message.ai h1 { font-size: 1.3em; }
        .ai-message.ai h2 { font-size: 1.2em; }
        .ai-message.ai h3 { font-size: 1.1em; }
        .ai-message.ai h4 { font-size: 1.05em; }
        .ai-message.ai h5 { font-size: 1em; }
        .ai-message.ai h6 { font-size: 0.95em; }

        .ai-message.ai p {
            margin: 0.5em 0;
        }

        .ai-message.ai a {
            color: #00ffff;
            text-decoration: underline;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .ai-message.ai a:hover {
            color: #06ffa5;
            text-decoration: underline;
        }

        .ai-message.ai strong {
            font-weight: 600;
            color: #ffffff;
        }

        .ai-message.ai em {
            font-style: italic;
            color: rgba(255, 255, 255, 0.9);
        }

        .ai-message.ai code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
            font-size: 0.9em;
            color: #06ffa5;
        }

        .ai-message.ai pre {
            background: rgba(0, 0, 0, 0.4);
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 0.5em 0;
        }

        .ai-message.ai pre code {
            background: none;
            padding: 0;
            color: #ffffff;
        }

        .ai-message.ai blockquote {
            border-left: 4px solid #8338ec;
            padding-left: 12px;
            margin: 0.5em 0;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
        }

        .ai-message.ai ul,
        .ai-message.ai ol {
            margin: 0.5em 0;
            padding-left: 1.5em;
        }

        .ai-message.ai li {
            margin: 0.25em 0;
        }

        .ai-message.ai hr {
            border: none;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin: 1em 0;
        }

        .ai-message.ai table {
            border-collapse: collapse;
            width: 100%;
            margin: 0.5em 0;
        }

        .ai-message.ai th,
        .ai-message.ai td {
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px;
            text-align: left;
        }

        .ai-message.ai th {
            background: rgba(138, 43, 226, 0.2);
            font-weight: 600;
        }

        .ai-message.ai img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 0.5em 0;
        }

        .ai-message.task-replay {
            border: 1px solid rgba(255, 106, 0, 0.5);
            opacity: 0.8;
            font-style: italic;
        }

        .ai-typing {
            margin: 10px 0;
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 80%;
            background: rgba(6, 255, 165, 0.2);
            margin-right: auto;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: typingPulse 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typingPulse {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .ai-chat-input-container {
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .ai-chat-input {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            color: white;
            font-size: 16px;
        }

        .ai-chat-send {
            background: linear-gradient(45deg, #8338ec, #3a86ff);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ai-chat-send:hover {
            transform: scale(1.05);
        }

        /* Voice Input Button */
        .voice-input-btn {
            background: linear-gradient(45deg, #ff006e, #ff4458);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .voice-input-btn:hover {
            transform: scale(1.1);
        }

        .voice-input-btn.recording {
            background: linear-gradient(45deg, #ff0000, #ff4444);
            animation: recordPulse 1.5s infinite;
        }

        .voice-input-btn.disabled {
            background: linear-gradient(45deg, #666, #888);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .voice-input-btn.disabled:hover {
            transform: scale(1);
        }

        @keyframes recordPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 0, 0, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
            }
        }

        /* AI Companion Button */
        .ai-companion-button {
            position: fixed;
            bottom: calc(env(safe-area-inset-bottom, 30px));
            right: calc(env(safe-area-inset-right, 30px));
            width: 60px;
            height: 60px;
            background: rgba(131, 56, 236, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid rgba(131, 56, 236, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1002;
            box-shadow: 0 0 20px rgba(131, 56, 236, 0.3);
            opacity: 0;
            transform: scale(0.8) translateZ(0);
            animation: fadeInButton 0.5s ease 0.8s forwards;
            will-change: transform, opacity;
        }

        .ai-companion-button:hover {
            background: rgba(131, 56, 236, 0.5);
            transform: scale(1.1) translateZ(0);
            box-shadow: 0 0 30px rgba(131, 56, 236, 0.5);
        }

        .ai-companion-button.active {
            background: rgba(6, 255, 165, 0.3);
            border-color: rgba(6, 255, 165, 0.5);
        }

        /* Tasks Button */
        .tasks-button {
            position: fixed;
            bottom: calc(env(safe-area-inset-bottom, 30px) + 80px);
            right: calc(env(safe-area-inset-right, 30px));
            width: 60px;
            height: 60px;
            background: rgba(255, 106, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 106, 0, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1002;
            box-shadow: 0 0 20px rgba(255, 106, 0, 0.3);
            opacity: 0;
            transform: scale(0.8) translateZ(0);
            animation: fadeInButton 0.5s ease 0.7s forwards;
            will-change: transform, opacity;
        }

        .tasks-button:hover {
            background: rgba(255, 106, 0, 0.5);
            transform: scale(1.1) translateZ(0);
            box-shadow: 0 0 30px rgba(255, 106, 0, 0.5);
        }

        .tasks-button svg {
            width: 28px;
            height: 28px;
            color: white;
        }

        /* Task Panel */
        .task-panel {
            position: fixed;
            bottom: calc(env(safe-area-inset-bottom, 100px));
            left: calc(env(safe-area-inset-left, 20px));
            background: rgba(20, 20, 40, 0.95);
            border: 2px solid rgba(255, 106, 0, 0.5);
            border-radius: 20px;
            padding: 20px;
            z-index: 1002;
            max-width: 350px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 0 30px rgba(255, 106, 0, 0.3);
            display: none;
        }

        .task-panel.active {
            display: block;
        }

        .task-panel h3 {
            margin: 0 0 15px 0;
            font-size: 20px;
            background: linear-gradient(45deg, #ff6a00, #ff8c00, #ffa500);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .upload-conversation-btn {
            background: linear-gradient(45deg, #742774, #4a90e2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 0;
            width: 100%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .upload-conversation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(116, 39, 116, 0.4);
        }

        .conversation-upload-input {
            display: none;
        }

        /* NEW FEATURE: Conversation Search & Filter Styles */
        .conversation-search-container {
            margin: 15px 0;
        }

        .conversation-search-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .conversation-search-input:focus {
            outline: none;
            border-color: #06ffa5;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 15px rgba(6, 255, 165, 0.3);
        }

        .conversation-search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .conversation-filters {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .conversation-filter-select {
            flex: 1;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 13px;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .conversation-filter-select:hover {
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
        }

        .conversation-filter-select:focus {
            outline: none;
            border-color: #06ffa5;
            box-shadow: 0 0 10px rgba(6, 255, 165, 0.3);
        }

        .conversation-filter-select option {
            background: #1a1a2e;
            color: white;
        }

        .clear-search-btn {
            width: 38px;
            height: 38px;
            background: rgba(255, 0, 102, 0.2);
            border: 2px solid rgba(255, 0, 102, 0.4);
            border-radius: 8px;
            color: #ff0066;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .clear-search-btn:hover {
            background: rgba(255, 0, 102, 0.3);
            border-color: #ff0066;
            transform: scale(1.05);
        }

        .clear-search-btn:active {
            transform: scale(0.95);
        }

        .conversation-count {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
            margin: 10px 0;
            text-align: center;
            font-weight: 500;
        }

        .task-item.hidden {
            display: none;
        }

        .task-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            margin: 8px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 106, 0, 0.5);
            transform: translateX(5px);
        }

        .task-item strong {
            color: #ffa500;
            display: block;
            margin-bottom: 5px;
        }

        .task-item small {
            color: rgba(255, 255, 255, 0.6);
            display: block;
            margin-top: 5px;
        }

        .world-ui {
            position: absolute;
            top: env(safe-area-inset-top, 20px);
            left: env(safe-area-inset-left, 20px);
            z-index: 1001;
            pointer-events: none;
            opacity: 0;
            animation: fadeIn 0.5s ease 0.3s forwards;
        }

        .world-title {
            font-size: 3em;
            font-weight: 100;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            background: linear-gradient(45deg, #ff006e, #8338ec, #3a86ff, #06ffa5);
            background-size: 400% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 8s ease-in-out infinite;
            margin-bottom: 10px;
        }

        .world-description {
            font-size: 1.2em;
            color: rgba(255, 255, 255, 0.6);
            max-width: 400px;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            border: 2px solid rgba(0, 255, 255, 0.5);
            animation: slideIn 0.3s ease;
            z-index: 1005;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Inactive AI Companion Text */
        .inactive-companion-text {
            position: absolute;
            color: #ff6a00;
            font-size: 1.2em;
            text-align: center;
            width: 300px;
            margin-left: -150px;
            text-shadow: 0 0 10px rgba(255, 106, 0, 0.5);
            animation: floatText 3s ease-in-out infinite;
        }

        @keyframes floatText {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* NEW FEATURE: Onboarding Tutorial System */
        .onboarding-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 15000;
            display: none;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .onboarding-overlay.active {
            display: block;
            opacity: 1;
        }

        .onboarding-spotlight {
            position: absolute;
            border: 3px solid #06ffa5;
            border-radius: 12px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.75), 0 0 30px rgba(6, 255, 165, 0.6);
            pointer-events: none;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            animation: spotlightPulse 2s infinite;
            z-index: 15001;
        }

        @keyframes spotlightPulse {
            0%, 100% {
                box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.75), 0 0 30px rgba(6, 255, 165, 0.6);
            }
            50% {
                box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.75), 0 0 50px rgba(6, 255, 165, 0.9);
            }
        }

        .onboarding-tooltip {
            position: absolute;
            background: linear-gradient(135deg, rgba(20, 20, 40, 0.98), rgba(30, 30, 50, 0.98));
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 2px solid rgba(6, 255, 165, 0.3);
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            min-width: 300px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 15002;
            animation: tooltipSlideIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes tooltipSlideIn {
            from {
                transform: translateY(-20px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .onboarding-tooltip-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #06ffa5;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .onboarding-tooltip-icon {
            font-size: 1.5em;
        }

        .onboarding-tooltip-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 1em;
        }

        .onboarding-tooltip-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .onboarding-progress {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85em;
            font-weight: 500;
        }

        .onboarding-controls {
            display: flex;
            gap: 10px;
        }

        .onboarding-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .onboarding-btn-skip {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .onboarding-btn-skip:hover {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .onboarding-btn-next {
            background: linear-gradient(45deg, #8a2be2, #06ffa5);
            color: white;
            border: none;
        }

        .onboarding-btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(6, 255, 165, 0.4);
        }

        .onboarding-btn:active {
            transform: translateY(0);
        }

        .onboarding-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
            z-index: 15002;
        }

        .onboarding-arrow.top {
            border-width: 0 10px 12px 10px;
            border-color: transparent transparent rgba(20, 20, 40, 0.98) transparent;
            top: -12px;
        }

        .onboarding-arrow.bottom {
            border-width: 12px 10px 0 10px;
            border-color: rgba(20, 20, 40, 0.98) transparent transparent transparent;
            bottom: -12px;
        }

        .onboarding-arrow.left {
            border-width: 10px 12px 10px 0;
            border-color: transparent rgba(20, 20, 40, 0.98) transparent transparent;
            left: -12px;
        }

        .onboarding-arrow.right {
            border-width: 10px 0 10px 12px;
            border-color: transparent transparent transparent rgba(20, 20, 40, 0.98);
            right: -12px;
        }

        /* Mobile adjustments for onboarding */
        @media (max-width: 480px) {
            .onboarding-tooltip {
                max-width: calc(100% - 40px);
                min-width: auto;
                padding: 20px;
                left: 20px !important;
                right: 20px;
                width: auto !important;
            }

            .onboarding-tooltip-title {
                font-size: 1.2em;
            }

            .onboarding-tooltip-content {
                font-size: 0.95em;
            }

            .onboarding-tooltip-footer {
                flex-direction: column;
                align-items: stretch;
            }

            .onboarding-controls {
                width: 100%;
            }

            .onboarding-btn {
                flex: 1;
            }
        }

        @media (max-width: 768px) {
            .world-title {
                font-size: 2em;
            }

            .world-description {
                font-size: 1em;
                max-width: 300px;
            }

            .ai-chat-interface {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
                height: 350px;
                bottom: calc(env(safe-area-inset-bottom, 20px) + 20px);
            }

            .voice-pause-button {
                width: 100px;
                height: 45px;
                font-size: 13px;
            }

            .settings-panel {
                width: 95%;
                padding: 20px;
            }

            .settings-tabs {
                flex-wrap: wrap;
            }

            .perspective-controls {
                grid-template-columns: 1fr;
            }

            .tool-overlay {
                width: 95%;
                height: 90vh;
            }
        }

        /* iOS specific fixes */
        @supports (-webkit-touch-callout: none) {
            body {
                position: fixed;
                height: 100vh;
                height: -webkit-fill-available;
            }

            #three-container {
                height: 100vh;
                height: -webkit-fill-available;
            }
        }

        /* Browser compatibility fallback for backdrop-filter */
        @supports not (backdrop-filter: blur(10px)) and not (-webkit-backdrop-filter: blur(10px)) {
            .show-mode-button {
                background: rgba(0, 255, 255, 0.7) !important;
            }
            .settings-button {
                background: rgba(138, 43, 226, 0.7) !important;
            }
            .tool-gallery-button {
                background: rgba(255, 106, 0, 0.7) !important;
            }
            .ai-companion-button {
                background: rgba(131, 56, 236, 0.7) !important;
            }
            .tasks-button {
                background: rgba(255, 106, 0, 0.7) !important;
            }
            .voice-pause-button {
                background: rgba(255, 0, 0, 0.7) !important;
            }
            .voice-pause-button.paused {
                background: rgba(255, 165, 0, 0.7) !important;
            }
            .show-mode-status {
                background: rgba(0, 0, 0, 0.95) !important;
            }
            .onboarding-overlay {
                background: rgba(0, 0, 0, 0.95) !important;
            }
        }
    </style>
</head>
<body>
    <!-- Enhanced Loading Screen -->
    <div class="loading" id="loading">
        <div class="loading-content">
            <div class="loading-logo">
                <div class="loading-orb"></div>
            </div>
            <div class="loading-text">Initializing AI Companion</div>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="loading-progress"></div>
            </div>
            <div class="loading-status" id="loading-status">Loading core modules...</div>
        </div>
    </div>

    <div id="three-container"></div>

    <!-- Tool Overlay Window -->
    <div class="tool-overlay" id="tool-overlay">
        <div class="tool-overlay-header">
            <div class="tool-overlay-title">
                <span id="tool-overlay-icon">🛠️</span>
                <span id="tool-overlay-title">Loading Tool...</span>
            </div>
            <div class="tool-overlay-actions">
                <a href="#" target="_blank" class="tool-overlay-btn primary" id="tool-overlay-new-tab">
                    Open in New Tab
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                </a>
                <button class="tool-overlay-btn" id="tool-overlay-refresh">
                    Refresh
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <polyline points="1 20 1 14 7 14"></polyline>
                        <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"></path>
                   </svg>
               </button>
           </div>
           <button class="tool-overlay-close" id="tool-overlay-close">&times;</button>
       </div>
       <div class="tool-overlay-content">
           <div class="tool-loading" id="tool-loading">
               <div class="tool-loading-spinner"></div>
               <p>Loading tool...</p>
           </div>
           <iframe class="tool-iframe" id="tool-iframe" style="display: none;" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-modals allow-downloads"></iframe>
       </div>
   </div>

   <!-- Click to Chat Tooltip -->
   <div class="companion-tooltip" id="companion-tooltip">Click to chat</div>

   <!-- Viewer Mode Indicator -->
   <div class="viewer-mode-indicator" id="viewer-mode-indicator">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
           <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
           <circle cx="12" cy="12" r="3"></circle>
       </svg>
       <span>Viewing Mode</span>
   </div>

   <!-- Following Indicator -->
   <div class="following-indicator" id="following-indicator">
       <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
           <circle cx="12" cy="12" r="10"/>
           <polygon points="10 8 16 12 10 16 10 8"/>
       </svg>
       <span>Following Presenter's View</span>
   </div>

   <!-- Show Mode Status -->
   <div class="show-mode-status" id="show-mode-status">
       <div class="status-indicator" id="status-indicator"></div>
       <span class="status-text" id="status-text">Connecting...</span>
       <div class="viewer-count">
           <span id="viewer-count">1</span> viewers
       </div>
   </div>

   <!-- Voice Pause Button -->
   <div class="voice-pause-button" id="voice-pause-button" role="button" tabindex="0" aria-label="Pause voice responses" aria-pressed="false">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
           <path d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
       </svg>
       <span id="voice-pause-text">Pause Voice</span>
   </div>

   <!-- Voice Paused Indicator -->
   <div class="voice-paused-indicator" id="voice-paused-indicator" role="status" aria-live="polite">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
           <path d="M10 9v6m4-6v6"></path>
       </svg>
       <span>Voice Paused</span>
   </div>

   <!-- NEW FEATURE: Onboarding Tutorial System -->
   <div class="onboarding-overlay" id="onboarding-overlay">
       <div class="onboarding-spotlight" id="onboarding-spotlight"></div>
       <div class="onboarding-tooltip" id="onboarding-tooltip" role="dialog" aria-labelledby="onboarding-title">
           <div class="onboarding-arrow" id="onboarding-arrow"></div>
           <div class="onboarding-tooltip-title">
               <span class="onboarding-tooltip-icon" id="onboarding-icon" aria-hidden="true">👋</span>
               <span id="onboarding-title">Welcome!</span>
           </div>
           <div class="onboarding-tooltip-content" id="onboarding-content">
               Let me show you around your AI Companion Hub...
           </div>
           <div class="onboarding-tooltip-footer">
               <span class="onboarding-progress" id="onboarding-progress" aria-live="polite">Step 1 of 5</span>
               <div class="onboarding-controls">
                   <button class="onboarding-btn onboarding-btn-skip" id="onboarding-skip" aria-label="Skip tutorial">Skip</button>
                   <button class="onboarding-btn onboarding-btn-next" id="onboarding-next" aria-label="Next step">Next</button>
               </div>
           </div>
       </div>
   </div>

   <!-- Tool Gallery Button -->
   <div class="tool-gallery-button" id="tool-gallery-button" role="button" tabindex="0" aria-label="Open tool gallery">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
           <rect x="3" y="3" width="7" height="7"></rect>
           <rect x="14" y="3" width="7" height="7"></rect>
           <rect x="14" y="14" width="7" height="7"></rect>
           <rect x="3" y="14" width="7" height="7"></rect>
       </svg>
   </div>

   <!-- Show Mode Button -->
   <div class="show-mode-button" id="show-mode-button" role="button" tabindex="0" aria-label="Toggle Show Mode - Share your screen with viewers">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
           <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
           <circle cx="12" cy="12" r="3"></circle>
       </svg>
   </div>

   <!-- Show Mode Modal -->
   <div class="show-mode-modal" id="show-mode-modal">
       <div class="show-mode-modal-content">
           <button class="modal-close" id="show-mode-close" aria-label="Close">&times;</button>
           <h3>Show Mode</h3>
           <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 20px;">
               Share your perspective in real-time. Others can scan the QR code to follow your view.
           </p>
           <div class="show-mode-info" id="show-mode-info" role="status">
               🌐 Show Mode Active - Viewers will see what you see in real-time!
           </div>
           <div id="qr-code-container"></div>
           <p class="qr-url" id="qr-url"></p>
           <button class="copy-url-btn" id="copy-url-btn">Copy URL</button>
       </div>
   </div>

   <!-- Settings Panel -->
   <div class="settings-panel" id="settings-panel">
       <button class="close-settings" id="close-settings" aria-label="Close settings">&times;</button>
       <h2>AI Companion Settings</h2>

       <div class="settings-tabs" role="tablist">
           <button class="settings-tab active" data-tab="general" role="tab" aria-selected="true" aria-controls="general-settings">General</button>
           <button class="settings-tab" data-tab="voice" role="tab" aria-selected="false" aria-controls="voice-settings">Voice</button>
           <button class="settings-tab" data-tab="perspective" role="tab" aria-selected="false" aria-controls="perspective-settings">3D View</button>
           <button class="settings-tab" data-tab="import-export" role="tab" aria-selected="false" aria-controls="import-export-settings">Import/Export</button>
       </div>

       <!-- General Settings -->
       <div class="settings-section active" id="general-settings" role="tabpanel">
           <div class="settings-group">
               <h3>API Configuration</h3>
               <div class="setting-item">
                   <label for="settings-api-key">API Key</label>
                   <input type="password" id="settings-api-key" placeholder="Enter your API key" aria-required="true">
               </div>
               <div class="setting-item">
                   <label for="settings-endpoint">API Endpoint</label>
                   <input type="text" id="settings-endpoint" value="https://azfbusinessbot.azurewebsites.net/api/businessinsightbot_function" aria-required="true">
               </div>
           </div>

           <div class="settings-group">
               <h3>World Settings</h3>
               <div class="setting-item">
                   <label for="world-name">World Name</label>
                   <input type="text" id="world-name" value="AI Companion Hub">
               </div>
               <div class="setting-item">
                   <label for="world-description">World Description</label>
                   <input type="text" id="world-description" value="Your intelligent assistant awaits. Click on the AI companion to start chatting!">
               </div>
           </div>
       </div>

       <!-- Voice Settings -->
       <div class="settings-section" id="voice-settings" role="tabpanel" hidden>
           <div class="settings-group">
               <h3>Voice Output</h3>
               <div class="toggle-setting">
                   <label for="settings-voice-enabled">Enable Voice Response</label>
                   <div class="toggle-switch" id="settings-voice-enabled" role="switch" aria-checked="true"></div>
               </div>
               <div class="toggle-setting">
                   <label for="settings-auto-speak">Auto-speak Responses</label>
                   <div class="toggle-switch" id="settings-auto-speak" role="switch" aria-checked="false"></div>
               </div>
               <div class="setting-item">
                   <label for="settings-azure-tts-key">Azure TTS API Key</label>
                   <input type="password" id="settings-azure-tts-key" placeholder="Enter Azure TTS key for premium voices">
               </div>
               <div class="setting-item">
                   <label for="settings-tts-voice">TTS Voice</label>
                   <select id="settings-tts-voice">
                       <option value="en-US-JennyNeural">Jenny (Female)</option>
                       <option value="en-US-GuyNeural">Guy (Male)</option>
                       <option value="en-US-AriaNeural">Aria (Female)</option>
                       <option value="en-US-DavisNeural">Davis (Male)</option>
                       <option value="en-US-AmberNeural">Amber (Female)</option>
                       <option value="en-US-JasonNeural">Jason (Male)</option>
                       <option value="en-GB-SoniaNeural">Sonia (British Female)</option>
                       <option value="en-GB-RyanNeural">Ryan (British Male)</option>
                   </select>
               </div>
           </div>

           <div class="settings-group">
               <h3>Voice Input</h3>
               <div class="toggle-setting">
                   <label for="settings-voice-input-enabled">Enable Voice Input</label>
                   <div class="toggle-switch active" id="settings-voice-input-enabled" role="switch" aria-checked="true"></div>
               </div>
               <div class="toggle-setting">
                   <label for="settings-continuous-conversation">Continuous Conversation Mode</label>
                   <div class="toggle-switch" id="settings-continuous-conversation" role="switch" aria-checked="false"></div>
               </div>
               <div class="setting-item">
                   <label for="settings-push-to-talk">Push-to-Talk Key</label>
                   <select id="settings-push-to-talk">
                       <option value="Space">Space</option>
                       <option value="v">V</option>
                       <option value="t">T</option>
                       <option value="Control">Ctrl</option>
                       <option value="Alt">Alt</option>
                   </select>
               </div>
           </div>
       </div>

       <!-- Perspective Settings -->
       <div class="settings-section" id="perspective-settings" role="tabpanel" hidden>
           <div class="settings-group">
               <h3>Camera Controls</h3>
               <div class="perspective-controls">
                   <div class="setting-item">
                       <label>Position X <span class="range-value" id="pos-x-value">0</span></label>
                       <input type="range" id="camera-pos-x" min="-50" max="50" value="0" step="0.5">
                   </div>
                   <div class="setting-item">
                       <label>Position Y <span class="range-value" id="pos-y-value">5</span></label>
                       <input type="range" id="camera-pos-y" min="-20" max="50" value="5" step="0.5"></div>
                   <div class="setting-item">
                       <label>Position Z <span class="range-value" id="pos-z-value">8</span></label>
                       <input type="range" id="camera-pos-z" min="-50" max="50" value="8" step="0.5">
                   </div>
                   <div class="setting-item">
                       <label>Rotation X <span class="range-value" id="rot-x-value">0</span></label>
                       <input type="range" id="camera-rot-x" min="-180" max="180" value="0" step="1">
                   </div>
                   <div class="setting-item">
                       <label>Rotation Y <span class="range-value" id="rot-y-value">0</span></label>
                       <input type="range" id="camera-rot-y" min="-180" max="180" value="0" step="1">
                   </div>
                   <div class="setting-item">
                       <label>FOV <span class="range-value" id="fov-value">75</span></label>
                       <input type="range" id="camera-fov" min="30" max="120" value="75" step="1">
                   </div>
               </div>

               <h4 style="margin-top: 20px; margin-bottom: 10px; color: #8a2be2;">Presets</h4>
               <div class="perspective-preset">
                   <button class="preset-btn" onclick="window.worldNavigator.perspectiveManager.applyPreset('default')">Default</button>
                   <button class="preset-btn" onclick="window.worldNavigator.perspectiveManager.applyPreset('overhead')">Overhead</button>
                   <button class="preset-btn" onclick="window.worldNavigator.perspectiveManager.applyPreset('close')">Close-up</button>
                   <button class="preset-btn" onclick="window.worldNavigator.perspectiveManager.applyPreset('side')">Side View</button>
                   <button class="preset-btn" onclick="window.worldNavigator.perspectiveManager.applyPreset('wide')">Wide Angle</button>
                   <button class="preset-btn" onclick="window.worldNavigator.perspectiveManager.applyPreset('dramatic')">Dramatic</button>
               </div>
           </div>

           <div class="settings-group">
               <h3>Visual Settings</h3>
               <div class="setting-item">
                   <label>Fog Density <span class="range-value" id="fog-density-value">50</span></label>
                   <input type="range" id="fog-density" min="10" max="200" value="50" step="5">
               </div>
               <div class="setting-item">
                   <label>Particle Count <span class="range-value" id="particle-count-value">300</span></label>
                   <input type="range" id="particle-count" min="0" max="1000" value="300" step="50">
               </div>
           </div>
       </div>

       <!-- Import/Export Settings -->
       <div class="settings-section" id="import-export-settings" role="tabpanel" hidden>
           <div class="import-export-section">
               <h4>Export Settings</h4>
               <p style="color: rgba(255, 255, 255, 0.6); margin-bottom: 15px; font-size: 14px;">
                   Export all your settings including API keys, voice configuration, and 3D perspective as a JSON file.
               </p>
               <div class="json-preview" id="json-preview"></div>
               <button class="settings-btn" onclick="window.worldNavigator.settingsManager.exportSettings()">
                   Export Settings to JSON
               </button>
           </div>

           <div class="import-export-section" style="margin-top: 30px;">
               <h4>Import Settings</h4>
               <p style="color: rgba(255, 255, 255, 0.6); margin-bottom: 15px; font-size: 14px;">
                   Import a previously exported settings file to restore your configuration.
               </p>
               <div class="file-input-wrapper">
                   <input type="file" id="import-settings-file" accept=".json" onchange="window.worldNavigator.settingsManager.importSettings(event)">
                   <label for="import-settings-file" class="file-input-label">
                       Click to select settings file or drag and drop here
                   </label>
               </div>
           </div>

           <div class="import-export-section" style="margin-top: 30px;">
               <h4>Danger Zone</h4>
               <p style="color: rgba(255, 165, 0, 0.8); margin-bottom: 15px; font-size: 14px;">
                   ⚠️ This action will reset all settings to their default values. This cannot be undone.
               </p>
               <button class="settings-btn danger" onclick="window.worldNavigator.settingsManager.resetSettings()">
                   Reset All Settings
               </button>
           </div>
       </div>

       <div class="settings-actions">
           <button class="settings-btn" onclick="window.worldNavigator.settingsManager.saveSettings()">Save Changes</button>
           <button class="settings-btn secondary" onclick="document.getElementById('settings-panel').classList.remove('active')">Cancel</button>
       </div>
   </div>

   <!-- Voice Indicator -->
   <div class="voice-indicator" id="voice-indicator" role="status" aria-live="polite">
       <i class="fas fa-volume-up"></i>
       <span>Speaking...</span>
   </div>

   <!-- Listening Indicator -->
   <div class="listening-indicator" id="listening-indicator" role="status" aria-live="polite">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
           <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
           <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
           <line x1="12" y1="19" x2="12" y2="23"></line>
           <line x1="8" y1="23" x2="16" y2="23"></line>
       </svg>
       <span>Listening...</span>
   </div>

   <!-- AI Chat Interface -->
   <div class="ai-chat-interface" id="ai-chat-interface">
       <div class="ai-chat-header">
           <div class="ai-chat-title">
               AI Companion Chat
               <span class="viewer-chat-label" id="viewer-chat-label" style="display: none;">Viewer Mode</span>
           </div>
           <button class="modal-close" onclick="document.getElementById('ai-chat-interface').classList.remove('active')" aria-label="Close chat">&times;</button>
       </div>
       <div class="ai-chat-messages" id="ai-chat-messages" role="log" aria-live="polite" aria-relevant="additions"></div>
       <div class="ai-chat-input-container">
           <input type="text" class="ai-chat-input" id="ai-chat-input" placeholder="Type a message..." onkeypress="if(event.key==='Enter') window.worldNavigator.aiManager.sendMessage()" aria-label="Chat message">
           <button class="voice-input-btn" id="voice-input-btn" title="Hold to speak" aria-label="Voice input - Hold to speak">
               <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                   <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                   <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                   <line x1="12" y1="19" x2="12" y2="23"></line>
                   <line x1="8" y1="23" x2="16" y2="23"></line>
               </svg>
           </button>
           <button class="ai-chat-send" onclick="window.worldNavigator.aiManager.sendMessage()" aria-label="Send message">Send</button>
       </div>
   </div>

   <!-- Task Panel -->
   <div class="task-panel" id="task-panel">
       <h3>📚 Saved Conversations</h3>

       <!-- NEW FEATURE: Conversation Search & Filter -->
       <div class="conversation-search-container">
           <input type="text"
                  id="conversation-search"
                  class="conversation-search-input"
                  placeholder="🔍 Search conversations..."
                  aria-label="Search conversations">
           <div class="conversation-filters">
               <select id="conversation-sort" class="conversation-filter-select" aria-label="Sort conversations">
                   <option value="newest">Newest First</option>
                   <option value="oldest">Oldest First</option>
                   <option value="most-messages">Most Messages</option>
                   <option value="name">By Name (A-Z)</option>
               </select>
               <button id="clear-search" class="clear-search-btn" aria-label="Clear search" title="Clear search">✕</button>
           </div>
       </div>

       <button class="upload-conversation-btn" onclick="document.getElementById('conversation-upload-input').click()">
           <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
               <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path>
               <polyline points="17 8 12 3 7 8"></polyline>
               <line x1="12" y1="3" x2="12" y2="15"></line>
           </svg>
           Upload Conversation JSON
       </button>
       <input type="file" id="conversation-upload-input" class="conversation-upload-input" accept=".json" onchange="window.worldNavigator.taskManager.uploadConversation(event)">

       <div class="conversation-count" id="conversation-count" role="status" aria-live="polite">
           <!-- Count populated here -->
       </div>

       <div id="task-list">
           <!-- Tasks populated here -->
       </div>
   </div>

   <div class="world-ui">
       <h1 class="world-title" id="world-title">AI COMPANION HUB</h1>
       <p class="world-description" id="world-description">Your intelligent assistant awaits. Click on the AI companion to start chatting!</p>
   </div>

   <!-- AI Companion Button -->
   <div class="ai-companion-button" id="ai-companion-button" role="button" tabindex="0" aria-label="Open AI Chat - Click or press Enter to talk with your companion">
       <svg class="view-toggle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
           <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
       </svg>
   </div>

   <!-- Tasks Button -->
   <div class="tasks-button" id="tasks-button" role="button" tabindex="0" aria-label="Open conversation tasks and history">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
           <path d="M9 11l3 3L22 4"></path>
           <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
       </svg>
   </div>

   <!-- Settings Button -->
   <div class="settings-button" id="settings-button" role="button" tabindex="0" aria-label="Open settings - Configure API, voice, and preferences">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
           <circle cx="12" cy="12" r="3"></circle>
           <path d="M12 1v6m0 6v6m4.22-10.22l1.42-1.42m-1.42 8.49l1.42 1.42M20 12h-6m-6 0H1m4.22 4.22l-1.42 1.42m1.42-8.49L3.8 7.73"></path>
       </svg>
   </div>

   <!-- Load Three.js early -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

   <!-- Main JavaScript -->
   <script>
       // This file is too large to fit in one response. I'll continue in the next message...
   </script>
</body>
</html>

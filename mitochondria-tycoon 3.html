<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mitochondria Tycoon</title>
    <meta name="description" content="Manage cellular respiration factories by routing glucose through metabolic pathways to generate ATP energy">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(180deg, #0a1520 0%, #051015 100%); min-height: 100vh; font-family: monospace; color: #80c0a0; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; }
        #controls {
            position: fixed; top: 20px; left: 20px; background: rgba(10,30,40,0.95);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(100,200,150,0.3);
            z-index: 100; min-width: 180px;
        }
        h3 { margin-bottom: 15px; color: #a0e0c0; }
        .stat { margin: 8px 0; display: flex; justify-content: space-between; }
        .stat-value { color: #60ff90; font-weight: bold; }
        button {
            display: block; width: 100%; padding: 10px; margin: 8px 0;
            background: rgba(40,100,80,0.5); border: 1px solid rgba(100,200,150,0.4);
            color: #80c0a0; cursor: pointer; border-radius: 6px;
        }
        button:hover { background: rgba(60,120,100,0.6); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        #upgrades {
            position: fixed; top: 20px; right: 20px; background: rgba(10,30,40,0.95);
            padding: 20px; border-radius: 10px; border: 1px solid rgba(100,200,150,0.3);
            z-index: 100;
        }
        .upgrade { padding: 8px; margin: 5px 0; background: rgba(40,80,60,0.3); border-radius: 5px; cursor: pointer; }
        .upgrade:hover { background: rgba(60,100,80,0.4); }
        .upgrade-cost { color: #ffcc00; font-size: 11px; }
        #info { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 12px; opacity: 0.5; z-index: 100; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="controls">
        <h3>Cell Status</h3>
        <div class="stat"><span>ATP:</span><span class="stat-value" id="atp">0</span></div>
        <div class="stat"><span>Glucose:</span><span class="stat-value" id="glucose">10</span></div>
        <div class="stat"><span>Oxygen:</span><span class="stat-value" id="oxygen">100</span></div>
        <div class="stat"><span>CO2:</span><span class="stat-value" id="co2">0</span></div>
        <div class="stat"><span>Efficiency:</span><span class="stat-value" id="efficiency">100%</span></div>
        <button id="inject-btn">Inject Glucose (Free)</button>
        <button id="boost-btn">Boost Oxygen</button>
        <button id="follow-btn">Follow Random Molecule</button>
        <div style="margin-top: 10px; font-size: 10px;">
            Speed: <input type="range" id="speed-slider" min="0.1" max="2" step="0.1" value="0.3">
        </div>
    </div>
    <div id="upgrades">
        <h3>Upgrades</h3>
        <div class="upgrade" id="upgrade-glycolysis">
            <div>Glycolysis II</div>
            <div class="upgrade-cost">Cost: 50 ATP</div>
        </div>
        <div class="upgrade" id="upgrade-krebs">
            <div>Krebs Cycle II</div>
            <div class="upgrade-cost">Cost: 100 ATP</div>
        </div>
        <div class="upgrade" id="upgrade-etc">
            <div>ETC Boost</div>
            <div class="upgrade-cost">Cost: 200 ATP</div>
        </div>
    </div>
    <div id="info">Watch glucose transform into ATP energy | The powerhouse of the cell</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
        resize(); window.onresize = resize;
        
        let atp = 0;
        let glucose = 10;
        let oxygen = 100;
        let co2 = 0;
        let glycolysisLevel = 1;
        let krebsLevel = 1;
        let etcLevel = 1;
        let followedMolecule = null;
        let simulationSpeed = 0.3; // Global speed multiplier
        
        let molecules = [];
        let particles = [];
        
        const STAGES = {
            CYTOPLASM: { x: 0.1, y: 0.5, name: 'Cytoplasm' },
            GLYCOLYSIS: { x: 0.25, y: 0.5, name: 'Glycolysis' },
            LINK: { x: 0.4, y: 0.5, name: 'Link Reaction' },
            KREBS: { x: 0.6, y: 0.5, name: 'Krebs Cycle' },
            ETC: { x: 0.85, y: 0.5, name: 'ETC & ATP Synthase' }
        };
        
        const GLYCOLYSIS_INTERMEDIATES = [
            'Glucose', 'Glucose-6-P', 'Fructose-6-P', 'Fructose-1,6-BP', 
            'G3P', '1,3-BPG', '3-Phosphoglycerate', '2-Phosphoglycerate', 
            'PEP', 'Pyruvate'
        ];

        const KREBS_INTERMEDIATES = [
            'Acetyl-CoA', 'Citrate', 'Isocitrate', 'α-Ketoglutarate', 
            'Succinyl-CoA', 'Succinate', 'Fumarate', 'Malate', 'Oxaloacetate'
        ];

        const ETC_STAGES = [
            'Complex I', 'Complex II', 'Complex III', 'Complex IV', 'ATP Synthase'
        ];

        class Molecule {
            constructor(type, x, y) {
                this.type = type;
                this.x = x;
                this.y = y;
                this.targetX = x;
                this.targetY = y;
                this.stage = 'CYTOPLASM';
                this.progress = 0;
                this.intermediate = 'Glucose';
                this.size = type === 'glucose' ? 12 : 8;
                this.color = '#ffcc00';
                this.id = Math.random().toString(36).substr(2, 9);
            }
            update() {
                const baseSpeed = 0.002 * simulationSpeed;
                const speed = baseSpeed * (this.stage === 'GLYCOLYSIS' ? glycolysisLevel : 
                                     this.stage === 'KREBS' ? krebsLevel : 
                                     this.stage === 'ETC' ? etcLevel : 1);
                this.progress += speed;

                if (this.stage === 'CYTOPLASM') {
                    this.targetX = W * STAGES.CYTOPLASM.x;
                    if (this.progress > 0.2) {
                        this.stage = 'GLYCOLYSIS';
                        this.progress = 0;
                    }
                }
                else if (this.stage === 'GLYCOLYSIS') {
                    const idx = Math.floor(this.progress * GLYCOLYSIS_INTERMEDIATES.length);
                    if (idx < GLYCOLYSIS_INTERMEDIATES.length) {
                        this.intermediate = GLYCOLYSIS_INTERMEDIATES[idx];
                        this.targetX = W * (STAGES.GLYCOLYSIS.x + (idx / GLYCOLYSIS_INTERMEDIATES.length) * 0.1);
                    }
                    
                    if (this.progress > 1) {
                        this.type = 'pyruvate';
                        this.color = '#ff9900';
                        atp += 2 * glycolysisLevel;
                        spawnParticles(this.x, this.y, '#ffff00', 3);
                        this.stage = 'LINK';
                        this.progress = 0;
                    }
                }
                else if (this.stage === 'LINK') {
                    this.intermediate = 'Acetyl-CoA';
                    this.targetX = W * STAGES.LINK.x;
                    if (this.progress > 0.5) {
                        this.stage = 'KREBS';
                        this.progress = 0;
                    }
                }
                else if (this.stage === 'KREBS') {
                    const centerX = W * STAGES.KREBS.x;
                    const centerY = H * STAGES.KREBS.y;
                    const radius = 80;
                    const angle = (this.progress * Math.PI * 2) - Math.PI;
                    this.targetX = centerX + Math.cos(angle) * radius;
                    this.targetY = centerY + Math.sin(angle) * radius;

                    const idx = Math.floor(this.progress * KREBS_INTERMEDIATES.length);
                    if (idx < KREBS_INTERMEDIATES.length && this.intermediate !== KREBS_INTERMEDIATES[idx]) {
                        this.intermediate = KREBS_INTERMEDIATES[idx];
                        if (['Isocitrate', 'α-Ketoglutarate', 'Malate'].includes(this.intermediate)) {
                            spawnParticles(this.x, this.y, '#ffffff', 2); // NADH
                        }
                        if (['Isocitrate', 'α-Ketoglutarate'].includes(this.intermediate)) {
                            spawnParticles(this.x, this.y, '#ff4444', 2); // CO2
                            co2 += 0.5;
                        }
                    }

                    if (this.progress > 1) {
                        this.type = 'electron';
                        this.size = 6;
                        this.color = '#00ff88';
                        atp += 2 * krebsLevel;
                        this.stage = 'ETC';
                        this.progress = 0;
                    }
                }
                else if (this.stage === 'ETC') {
                    const idx = Math.floor(this.progress * ETC_STAGES.length);
                    if (idx < ETC_STAGES.length) {
                        this.intermediate = ETC_STAGES[idx];
                        this.targetX = W * (STAGES.ETC.x + (idx / ETC_STAGES.length) * 0.1);
                        this.targetY = H * 0.5 + Math.sin(this.progress * 20) * 30;
                        
                        if (this.intermediate === 'ATP Synthase' && oxygen > 0) {
                            atp += (32 * etcLevel) / 100; // Gradual ATP gain
                        }
                    }

                    if (this.progress > 1) {
                        if (oxygen > 0) {
                            oxygen -= 1;
                            spawnParticles(this.x, this.y, '#00ffff', 10); // Water/ATP burst
                        }
                        if (followedMolecule === this) followedMolecule = null;
                        return false;
                    }
                }

                this.x += (this.targetX - this.x) * 0.02;
                this.y += (this.targetY - this.y) * 0.02;
                return true;
            }
            draw() {
                if (followedMolecule === this) {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size + 10, 0, Math.PI * 2);
                    ctx.strokeStyle = '#ffffff';
                    ctx.setLineDash([5, 5]);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }

                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                const grad = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size);
                grad.addColorStop(0, this.color);
                grad.addColorStop(1, 'rgba(0,0,0,0.5)');
                ctx.fillStyle = grad;
                ctx.fill();

                ctx.fillStyle = '#a0e0c0';
                ctx.font = '10px monospace';
                ctx.textAlign = 'center';
                ctx.fillText(this.intermediate, this.x, this.y - 15);
            }
        }
        
        function spawnParticles(x, y, color, count) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 3,
                    vy: (Math.random() - 0.5) * 3,
                    life: 1,
                    color
                });
            }
        }
        
        function drawMitochondria() {
            const cx = W * 0.6;
            const cy = H * 0.5;
            const width = W * 0.5;
            const height = H * 0.4;
            
            // Outer membrane
            ctx.beginPath();
            ctx.ellipse(cx, cy, width / 2, height / 2, 0, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(20, 40, 30, 0.4)';
            ctx.fill();
            ctx.strokeStyle = 'rgba(100, 180, 140, 0.6)';
            ctx.lineWidth = 4;
            ctx.stroke();
            
            // Inner membrane (Cristae)
            ctx.beginPath();
            const points = 60;
            for (let i = 0; i <= points; i++) {
                const angle = (i / points) * Math.PI * 2;
                const rX = (width / 2 - 40) + Math.sin(angle * 10) * 25;
                const rY = (height / 2 - 40) + Math.sin(angle * 10) * 15;
                const px = cx + Math.cos(angle) * rX;
                const py = cy + Math.sin(angle) * rY;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.strokeStyle = 'rgba(150, 255, 200, 0.3)';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.fillStyle = 'rgba(40, 80, 60, 0.2)';
            ctx.fill();
        }
        
        function drawStages() {
            Object.entries(STAGES).forEach(([key, stage]) => {
                const x = W * stage.x;
                const y = H * stage.y - 120;
                
                if (key === 'KREBS') {
                    ctx.beginPath();
                    ctx.arc(W * stage.x, H * stage.y, 80, 0, Math.PI * 2);
                    ctx.strokeStyle = 'rgba(100, 200, 150, 0.15)';
                    ctx.setLineDash([5, 5]);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }

                if (key === 'ETC') {
                    // Draw complexes
                    for (let i = 0; i < 5; i++) {
                        const cx = W * (STAGES.ETC.x + (i / 5) * 0.1);
                        ctx.fillStyle = 'rgba(0, 255, 136, 0.1)';
                        ctx.fillRect(cx - 15, H * 0.5 - 40, 30, 80);
                        ctx.strokeStyle = 'rgba(0, 255, 136, 0.3)';
                        ctx.strokeRect(cx - 15, H * 0.5 - 40, 30, 80);
                    }
                }

                ctx.fillStyle = 'rgba(100, 200, 150, 0.1)';
                ctx.fillRect(x - 45, y - 20, 90, 40);
                ctx.strokeStyle = 'rgba(100, 200, 150, 0.3)';
                ctx.strokeRect(x - 45, y - 20, 90, 40);
                
                ctx.fillStyle = '#a0e0c0';
                ctx.font = '11px monospace';
                ctx.textAlign = 'center';
                ctx.fillText(stage.name, x, y);
            });
        }
        
        function update() {
            if (glucose > 0 && Math.random() < 0.02) {
                glucose--;
                molecules.push(new Molecule('glucose', W * 0.15, H * 0.5 + (Math.random() - 0.5) * 100));
            }
            
            oxygen = Math.min(100, oxygen + 0.05);
            
            molecules = molecules.filter(m => m.update());
            
            particles = particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.03;
                return p.life > 0;
            });
        }
        
        function draw() {
            ctx.fillStyle = '#051015';
            ctx.fillRect(0, 0, W, H);
            
            drawMitochondria();
            drawStages();
            
            molecules.forEach(m => m.draw());
            
            particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3 * p.life, 0, Math.PI * 2);
                ctx.fillStyle = p.color.replace(')', ', ' + p.life + ')').replace('rgb', 'rgba').replace('#', '');
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life;
                ctx.fill();
                ctx.globalAlpha = 1;
            });
        }
        
        function updateUI() {
            document.getElementById('atp').textContent = Math.floor(atp);
            document.getElementById('glucose').textContent = glucose;
            document.getElementById('oxygen').textContent = Math.floor(oxygen);
            document.getElementById('co2').textContent = Math.floor(co2);
            const eff = Math.floor((glycolysisLevel + krebsLevel + etcLevel) / 3 * 100);
            document.getElementById('efficiency').textContent = eff + '%';
        }
        
        function animate() {
            update();
            draw();
            updateUI();
            requestAnimationFrame(animate);
        }
        
        document.getElementById('inject-btn').onclick = () => {
            glucose += 5;
        };
        
        document.getElementById('boost-btn').onclick = () => {
            oxygen = 100;
            spawnParticles(W * 0.85, H * 0.5, '#00aaff', 10);
        };
        
        document.getElementById('upgrade-glycolysis').onclick = () => {
            if (atp >= 50) {
                atp -= 50;
                glycolysisLevel++;
            }
        };
        
        document.getElementById('upgrade-krebs').onclick = () => {
            if (atp >= 100) {
                atp -= 100;
                krebsLevel++;
            }
        };
        
        document.getElementById('upgrade-etc').onclick = () => {
            if (atp >= 200) {
                atp -= 200;
                etcLevel++;
            }
        };

        document.getElementById('follow-btn').onclick = () => {
            if (molecules.length > 0) {
                followedMolecule = molecules[Math.floor(Math.random() * molecules.length)];
            }
        };

        document.getElementById('speed-slider').oninput = (e) => {
            simulationSpeed = parseFloat(e.target.value);
        };
        
        animate();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Local First Tools Gallery - Intelligent Discovery Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent: #06ffa5;
            --accent-secondary: #ff006e;
            --accent-tertiary: #8338ec;
            --border: rgba(255, 255, 255, 0.1);

            /* Category colors */
            --cat-visual-art: #ff6b9d;
            --cat-3d: #4ecdc4;
            --cat-audio: #f7b731;
            --cat-games: #5f27cd;
            --cat-ai: #00d2d3;
            --cat-creative: #ff9ff3;
            --cat-generative: #54a0ff;
            --cat-physics: #48dbfb;
            --cat-educational: #feca57;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, rgba(120, 30, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 30, 120, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 10%, rgba(30, 255, 120, 0.3) 0%, transparent 50%);
            animation: drift 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes drift {
            0%, 100% { transform: scale(1) rotate(0deg); }
            33% { transform: scale(1.1) rotate(120deg); }
            66% { transform: scale(0.95) rotate(240deg); }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 60px 20px 40px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 40px;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
        }

        @media (max-width: 768px) {
            .header {
                padding: 40px 20px 30px;
            }
        }

        h1 {
            font-size: 5em;
            font-weight: 100;
            letter-spacing: 0.2em;
            margin-bottom: 20px;
            text-transform: uppercase;
            position: relative;
            display: inline-block;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 3em;
                letter-spacing: 0.1em;
            }
        }

        h1::before {
            content: 'LOCAL FIRST TOOLS';
            position: absolute;
            left: 0;
            top: 0;
            background: linear-gradient(45deg, #ff006e, #8338ec, #3a86ff, #06ffa5);
            background-size: 400% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 8s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.5em;
            font-weight: 200;
            letter-spacing: 0.5em;
            text-transform: uppercase;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .subtitle {
                font-size: 1.2em;
                letter-spacing: 0.3em;
            }
        }

        .description {
            max-width: 600px;
            margin: 20px auto;
            color: rgba(255, 255, 255, 0.5);
            line-height: 1.6;
            font-weight: 300;
        }

        /* Stats display */
        .stats {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-value {
            color: var(--accent);
            font-weight: 500;
        }

        /* Advanced search */
        .search-container {
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
        }

        .search-wrapper {
            position: relative;
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border);
            border-radius: 30px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(6, 255, 165, 0.1);
            background: rgba(255, 255, 255, 0.15);
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.5);
            pointer-events: none;
        }

        /* Category Navigation */
        .category-nav {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }

        .category-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: capitalize;
        }

        .category-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .category-btn.active {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
        }

        .category-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
        }

        .category-btn.active .category-count {
            background: rgba(0, 0, 0, 0.3);
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-label {
            color: var(--text-secondary);
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .filter-select {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.9em;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* Active Filters Display */
        .active-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            min-height: 35px;
            align-items: center;
            justify-content: center;
        }

        .filter-chip {
            background: rgba(138, 43, 226, 0.2);
            border: 1px solid var(--accent-tertiary);
            padding: 5px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
            font-size: 0.9em;
        }

        .filter-chip .remove {
            cursor: pointer;
            color: var(--accent-secondary);
            font-weight: bold;
        }

        .filter-chip .remove:hover {
            transform: scale(1.2);
        }

        /* Tag Cloud */
        .tag-cloud {
            text-align: center;
            padding: 20px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
        }

        .tag-cloud-title {
            color: var(--text-secondary);
            font-size: 1em;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .tag-cloud-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .tag-item {
            padding: 5px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }

        .tag-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--accent);
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .tag-item.active {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
        }

        .tag-size-1 { font-size: 0.8em; opacity: 0.6; }
        .tag-size-2 { font-size: 0.9em; opacity: 0.7; }
        .tag-size-3 { font-size: 1em; opacity: 0.8; }
        .tag-size-4 { font-size: 1.1em; opacity: 0.9; }
        .tag-size-5 { font-size: 1.2em; opacity: 1; font-weight: 500; }

        /* Recommendations Section */
        .recommendations {
            margin-bottom: 40px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(6, 255, 165, 0.1));
            border-radius: 15px;
        }

        .recommendations-title {
            font-size: 1.3em;
            margin-bottom: 20px;
            text-align: center;
            color: var(--text-primary);
            letter-spacing: 0.05em;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        /* Gallery modes */
        .gallery-modes {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .gallery-modes {
                gap: 15px;
            }
        }

        .mode-button {
            padding: 15px 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            color: white;
            cursor: pointer;
            font-size: 1.1em;
            letter-spacing: 0.1em;
            transition: all 0.3s ease;
            text-transform: uppercase;
            -webkit-appearance: none;
            appearance: none;
            touch-action: manipulation;
        }

        @media (max-width: 768px) {
            .mode-button {
                padding: 12px 30px;
                font-size: 1em;
            }
        }

        .mode-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.1);
        }

        .mode-button:active {
            transform: scale(0.98);
        }

        .mode-button.active {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            border: none;
        }

        .mode-button.vr-mode {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            border: none;
        }

        .mode-button.vr-mode:hover {
            box-shadow: 0 10px 30px rgba(138, 43, 226, 0.5);
        }

        /* Sort controls */
        .sort-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .sort-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .sort-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .sort-btn.active {
            background: var(--accent-tertiary);
            color: white;
            border-color: var(--accent-tertiary);
        }

        /* Tools grid */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .tools-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .tool-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            min-height: 320px;
        }

        .tool-card.pinned {
            border-color: var(--accent-secondary);
            background: rgba(255, 0, 110, 0.05);
        }

        .tool-card.featured {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(6, 255, 165, 0.05));
            border-color: var(--accent-tertiary);
        }

        .tool-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent), var(--accent-tertiary));
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        @media (hover: hover) {
            .tool-card:hover {
                transform: translateY(-2px);
                border-color: var(--accent);
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5),
                           0 0 60px rgba(138, 43, 226, 0.2);
                background: rgba(255, 255, 255, 0.05);
            }

            .tool-card:hover::before {
                transform: translateX(0);
            }
        }

        @media (hover: none) {
            .tool-card:active {
                transform: scale(0.98);
                background: rgba(255, 255, 255, 0.05);
            }
        }

        .pin-button {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .pin-button:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: scale(1.1);
        }

        .pin-button.pinned {
            background: var(--accent-secondary);
            border-color: var(--accent-secondary);
            color: white;
        }

        /* Featured badge */
        .featured-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: linear-gradient(135deg, var(--accent), var(--accent-tertiary));
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: 600;
            color: white;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        /* Category badge */
        .category-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 10px;
        }

        .category-badge.visual_art { background: var(--cat-visual-art); color: white; }
        .category-badge.cat-3d_immersive { background: var(--cat-3d); color: white; }
        .category-badge.audio_music { background: var(--cat-audio); color: black; }
        .category-badge.games_puzzles { background: var(--cat-games); color: white; }
        .category-badge.experimental_ai { background: var(--cat-ai); color: black; }
        .category-badge.creative_tools { background: var(--cat-creative); color: black; }
        .category-badge.generative_art { background: var(--cat-generative); color: white; }
        .category-badge.particle_physics { background: var(--cat-physics); color: black; }
        .category-badge.educational_tools { background: var(--cat-educational); color: black; }

        .tool-preview {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(0, 255, 255, 0.1));
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            position: relative;
            overflow: hidden;
        }

        .tool-title {
            font-size: 1.3em;
            font-weight: 400;
            margin-bottom: 8px;
            letter-spacing: 0.02em;
            line-height: 1.3;
        }

        .tool-filename {
            color: var(--text-secondary);
            font-size: 0.85em;
            font-family: 'Monaco', 'Menlo', monospace;
            margin-bottom: 8px;
            opacity: 0.7;
        }

        .tool-description {
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.5;
            margin-bottom: 15px;
            flex-grow: 1;
            font-weight: 300;
            font-size: 0.95em;
        }

        .tool-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .tool-tag {
            padding: 3px 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.6);
        }

        .complexity-indicator {
            display: flex;
            gap: 3px;
            margin-bottom: 10px;
        }

        .complexity-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
        }

        .complexity-dot.filled {
            background: var(--accent);
        }

        .tool-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 12px;
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.5);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .vote-count {
            color: var(--accent);
        }

        .tool-actions {
            display: flex;
            gap: 12px;
            margin-top: auto;
        }

        .view-button, .vote-button, .download-button, .preview-button {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 400;
            letter-spacing: 0.03em;
            transition: all 0.3s ease;
            text-transform: uppercase;
            -webkit-appearance: none;
            appearance: none;
            touch-action: manipulation;
        }

        .view-button {
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-tertiary));
            color: white;
        }

        .view-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(138, 43, 226, 0.5);
        }

        .preview-button {
            background: transparent;
            color: var(--accent-tertiary);
            border: 1px solid var(--accent-tertiary);
        }

        .preview-button:hover {
            background: rgba(138, 43, 226, 0.1);
        }

        .vote-button {
            background: transparent;
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        .vote-button:hover {
            background: rgba(6, 255, 165, 0.1);
        }

        .vote-button.voted {
            background: var(--accent);
            color: var(--bg-primary);
        }

        .download-button {
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .download-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Recent & Popular sections */
        .quick-access {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .quick-access {
                grid-template-columns: 1fr;
            }
        }

        .quick-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
        }

        .quick-section-title {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quick-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quick-item {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-decoration: none;
            color: inherit;
        }

        .quick-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .quick-item-title {
            font-size: 0.95em;
        }

        .quick-item-meta {
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        /* Preview Modal */
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            padding: 20px;
        }

        .preview-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-content {
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            background: var(--bg-secondary);
            border-radius: 15px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .preview-title {
            font-size: 1.2em;
            color: var(--text-primary);
        }

        .preview-actions {
            display: flex;
            gap: 15px;
        }

        .preview-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .preview-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .preview-iframe {
            flex: 1;
            width: 100%;
            border: none;
            background: white;
        }

        /* Tour overlay */
        .tour-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
        }

        .tour-overlay.active {
            display: block;
        }

        .tour-tooltip {
            position: absolute;
            background: var(--accent-tertiary);
            color: white;
            padding: 20px;
            border-radius: 15px;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(138, 43, 226, 0.5);
        }

        .tour-tooltip::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
        }

        .tour-tooltip.bottom::after {
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 0 10px 10px 10px;
            border-color: transparent transparent var(--accent-tertiary) transparent;
        }

        .tour-title {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .tour-text {
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .tour-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .tour-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .tour-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .tour-btn.primary {
            background: white;
            color: var(--accent-tertiary);
        }

        .tour-progress {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .tour-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
        }

        .tour-dot.active {
            background: white;
        }

        /* No results message */
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
            font-size: 1.2em;
        }

        /* Loading state */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
            font-size: 1.2em;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* Sections */
        .exhibition-section {
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 1.8em;
            margin-bottom: 25px;
            color: var(--text-primary);
            font-weight: 300;
            letter-spacing: 0.05em;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        /* Three.js container */
        #three-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
        }

        #three-container.active {
            display: block;
        }

        /* Xbox controller indicator */
        #controller-indicator {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--accent);
            border-radius: 25px;
            color: var(--accent);
            font-size: 14px;
            z-index: 1002;
            animation: pulse 2s ease-in-out infinite;
        }

        #controller-indicator.active {
            display: block;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* Mobile touch controls */
        @media (max-width: 768px) {
            .mobile-controls {
                display: block;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>LOCAL FIRST TOOLS</h1>
            <div class="subtitle">Gallery Collection</div>
            <div class="description">
                Privacy-first, offline-capable tools that work entirely in your browser.
                No servers, no tracking, just powerful applications you fully control.
            </div>
        </header>

        <div class="stats" id="stats">
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-value" id="total-tools">0</span>
                    <span>Total Tools</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="featured-count">0</span>
                    <span>Featured</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="categories-count">0</span>
                    <span>Categories</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="last-updated">--</span>
                    <span>Last Updated</span>
                </div>
            </div>
        </div>

        <div class="search-container">
            <div class="search-wrapper">
                <input type="text" class="search-input" id="searchInput"
                       placeholder="Search by title, description, tags, category, or filename...">
                <span class="search-icon">🔍</span>
            </div>
        </div>

        <!-- Category Navigation -->
        <div class="category-nav" id="categoryNav">
            <!-- Categories will be dynamically added here -->
        </div>

        <!-- Filter Controls -->
        <div class="filter-controls">
            <div class="filter-group">
                <span class="filter-label">Complexity:</span>
                <select class="filter-select" id="complexityFilter">
                    <option value="">All</option>
                    <option value="simple">Simple</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="advanced">Advanced</option>
                </select>
            </div>
            <div class="filter-group">
                <span class="filter-label">Type:</span>
                <select class="filter-select" id="typeFilter">
                    <option value="">All</option>
                    <option value="game">Games</option>
                    <option value="drawing">Drawing</option>
                    <option value="visual">Visual</option>
                    <option value="interactive">Interactive</option>
                    <option value="audio">Audio</option>
                    <option value="interface">Interface</option>
                </select>
            </div>
            <div class="filter-group">
                <span class="filter-label">Featured:</span>
                <select class="filter-select" id="featuredFilter">
                    <option value="">All</option>
                    <option value="featured">Featured Only</option>
                    <option value="regular">Regular Only</option>
                </select>
            </div>
        </div>

        <!-- Active Filters Display -->
        <div class="active-filters" id="activeFilters"></div>

        <!-- Sort Controls -->
        <div class="sort-controls">
            <button class="sort-btn active" data-sort="name">Name</button>
            <button class="sort-btn" data-sort="popular">Most Popular</button>
            <button class="sort-btn" data-sort="recent">Recently Used</button>
            <button class="sort-btn" data-sort="complexity">Complexity</button>
            <button class="sort-btn" data-sort="random">Random</button>
        </div>

        <!-- Gallery Modes -->
        <div class="gallery-modes">
            <button class="mode-button active" id="main-gallery">Main Gallery</button>
            <button class="mode-button" id="archive-mode">Archive</button>
            <button class="mode-button" id="magazine-mode">Magazine</button>
            <button class="mode-button vr-mode" id="3d-mode">3D Experience</button>
            <button class="mode-button" id="tour-btn">Guided Tour</button>
        </div>

        <!-- Tag Cloud -->
        <div class="tag-cloud" id="tagCloud">
            <div class="tag-cloud-title">Popular Tags</div>
            <div class="tag-cloud-items" id="tagCloudItems"></div>
        </div>

        <!-- Quick Access Sections -->
        <div class="quick-access">
            <div class="quick-section">
                <div class="quick-section-title">
                    🕐 Recently Opened
                </div>
                <div class="quick-list" id="recentlyOpened"></div>
            </div>
            <div class="quick-section">
                <div class="quick-section-title">
                    🔥 Popular This Week
                </div>
                <div class="quick-list" id="popularTools"></div>
            </div>
        </div>

        <!-- Recommendations -->
        <div class="recommendations" id="recommendations" style="display: none;">
            <div class="recommendations-title">✨ Recommended For You</div>
            <div class="recommendations-grid" id="recommendationsGrid"></div>
        </div>

        <!-- Main Content -->
        <div class="content" id="toolsContainer">
            <div class="loading">Loading tools...</div>
        </div>
    </div>

    <!-- 3D Gallery Container -->
    <div id="three-container"></div>

    <!-- Xbox Controller Indicator -->
    <div id="controller-indicator">🎮 Xbox Controller Connected</div>

    <!-- Preview Modal -->
    <div class="preview-modal" id="previewModal">
        <div class="preview-content">
            <div class="preview-header">
                <div class="preview-title" id="previewTitle">Tool Preview</div>
                <div class="preview-actions">
                    <button class="preview-btn" id="openFullBtn">Open Full</button>
                    <button class="preview-btn" id="closePreviewBtn">Close (ESC)</button>
                </div>
            </div>
            <iframe class="preview-iframe" id="previewIframe"></iframe>
        </div>
    </div>

    <!-- Tour Overlay -->
    <div class="tour-overlay" id="tourOverlay">
        <div class="tour-tooltip" id="tourTooltip">
            <div class="tour-progress" id="tourProgress"></div>
            <div class="tour-title" id="tourTitle">Welcome to Local First Tools!</div>
            <div class="tour-text" id="tourText">
                This gallery contains 200+ privacy-first tools that work entirely offline.
            </div>
            <div class="tour-actions">
                <button class="tour-btn" id="tourSkip">Skip</button>
                <button class="tour-btn primary" id="tourNext">Next</button>
            </div>
        </div>
    </div>

    <script>
        // State management
        let allTools = [];
        let filteredTools = [];
        let galleryConfig = null;
        let currentCategory = 'all';
        let currentComplexity = '';
        let currentType = '';
        let currentFeatured = '';
        let currentTags = new Set();
        let currentSort = 'name';
        let currentView = 'main';
        let searchTerm = '';

        // Usage tracking (localStorage only)
        let usageData = JSON.parse(localStorage.getItem('toolUsage') || '{}');
        let recentlyOpened = JSON.parse(localStorage.getItem('recentlyOpened') || '[]');
        let pinnedTools = JSON.parse(localStorage.getItem('pinnedTools') || '[]');
        let votes = JSON.parse(localStorage.getItem('votes') || '{}');
        let userVotes = JSON.parse(localStorage.getItem('userVotes') || '{}');
        let tourCompleted = localStorage.getItem('tourCompleted') === 'true';

        // Load vibe_gallery_config.json
        async function loadGalleryConfig() {
            try {
                const response = await fetch('./vibe_gallery_config.json');
                if (response.ok) {
                    galleryConfig = await response.json();
                    processGalleryData();
                    return true;
                }
            } catch (error) {
                console.error('Failed to load gallery config:', error);
            }

            // Fallback to tools-manifest if vibe_gallery_config fails
            return loadFallbackManifest();
        }

        // Fallback to tools-manifest.json
        async function loadFallbackManifest() {
            try {
                const response = await fetch('./tools-manifest.json');
                if (response.ok) {
                    const manifest = await response.json();
                    processFallbackData(manifest);
                    return true;
                }
            } catch (error) {
                console.error('Failed to load tools manifest:', error);
            }
            return false;
        }

        // Process vibe_gallery_config data
        function processGalleryData() {
            if (!galleryConfig || !galleryConfig.vibeGallery) return;

            const gallery = galleryConfig.vibeGallery;
            allTools = [];

            // Extract all tools from categories
            Object.entries(gallery.categories).forEach(([categoryKey, category]) => {
                if (category.apps && Array.isArray(category.apps)) {
                    category.apps.forEach(app => {
                        allTools.push({
                            ...app,
                            categoryKey: categoryKey,
                            categoryTitle: category.title,
                            categoryColor: category.color
                        });
                    });
                }
            });

            // Update stats
            updateStats();

            // Build category navigation
            buildCategoryNav();

            // Build tag cloud
            buildTagCloud();

            // Display tools
            filterAndDisplayTools();

            // Load recent and popular
            updateQuickAccess();

            // Show tour if first visit
            if (!tourCompleted) {
                setTimeout(() => startTour(), 1000);
            }
        }

        // Process fallback manifest data
        function processFallbackData(manifest) {
            if (!manifest || !manifest.tools) return;

            allTools = manifest.tools.map(file => ({
                filename: file.name,
                title: formatTitle(file.name),
                path: file.name,
                description: `Interactive ${formatTitle(file.name)} application`,
                tags: extractTagsFromFilename(file.name),
                category: 'creative_tools',
                categoryKey: 'creative_tools',
                categoryTitle: 'Creative Tools',
                featured: false,
                complexity: 'intermediate',
                interactionType: 'interface'
            }));

            updateStats();
            filterAndDisplayTools();
        }

        // Extract tags from filename
        function extractTagsFromFilename(filename) {
            const name = filename.replace('.html', '').replace(/-/g, ' ');
            const words = name.split(' ');
            return words.filter(w => w.length > 3);
        }

        // Format title from filename
        function formatTitle(filename) {
            return filename
                .replace('.html', '')
                .replace(/-/g, ' ')
                .split(' ')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        // Update statistics
        function updateStats() {
            document.getElementById('total-tools').textContent = allTools.length;
            document.getElementById('featured-count').textContent = allTools.filter(t => t.featured).length;

            const categories = new Set(allTools.map(t => t.categoryKey));
            document.getElementById('categories-count').textContent = categories.size;

            const lastUpdated = galleryConfig?.vibeGallery?.lastUpdated || 'Today';
            document.getElementById('last-updated').textContent = lastUpdated;
        }

        // Build category navigation
        function buildCategoryNav() {
            const nav = document.getElementById('categoryNav');
            nav.innerHTML = '';

            // Count tools per category
            const categoryCounts = {};
            allTools.forEach(tool => {
                categoryCounts[tool.categoryKey] = (categoryCounts[tool.categoryKey] || 0) + 1;
            });

            // Add "All" button
            const allBtn = document.createElement('button');
            allBtn.className = 'category-btn active';
            allBtn.innerHTML = `
                <span>All</span>
                <span class="category-count">${allTools.length}</span>
            `;
            allBtn.onclick = () => selectCategory('all');
            nav.appendChild(allBtn);

            // Add category buttons
            if (galleryConfig?.vibeGallery?.categories) {
                Object.entries(galleryConfig.vibeGallery.categories).forEach(([key, category]) => {
                    const count = categoryCounts[key] || 0;
                    if (count > 0) {
                        const btn = document.createElement('button');
                        btn.className = 'category-btn';
                        btn.innerHTML = `
                            <span>${category.title}</span>
                            <span class="category-count">${count}</span>
                        `;
                        btn.onclick = () => selectCategory(key);
                        nav.appendChild(btn);
                    }
                });
            }
        }

        // Build tag cloud
        function buildTagCloud() {
            const tagCounts = {};
            allTools.forEach(tool => {
                if (tool.tags) {
                    tool.tags.forEach(tag => {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                    });
                }
            });

            const sortedTags = Object.entries(tagCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20); // Top 20 tags

            const maxCount = Math.max(...sortedTags.map(t => t[1]));
            const minCount = Math.min(...sortedTags.map(t => t[1]));
            const range = maxCount - minCount || 1;

            const container = document.getElementById('tagCloudItems');
            container.innerHTML = '';

            sortedTags.forEach(([tag, count]) => {
                const size = Math.ceil(((count - minCount) / range) * 4) + 1;
                const span = document.createElement('span');
                span.className = `tag-item tag-size-${size}`;
                span.textContent = tag;
                span.onclick = () => toggleTag(tag);
                container.appendChild(span);
            });
        }

        // Select category
        function selectCategory(category) {
            currentCategory = category;

            // Update UI
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.category-btn').classList.add('active');

            // Filter and display
            filterAndDisplayTools();
            updateActiveFilters();
        }

        // Toggle tag filter
        function toggleTag(tag) {
            if (currentTags.has(tag)) {
                currentTags.delete(tag);
            } else {
                currentTags.add(tag);
            }

            // Update UI
            document.querySelectorAll('.tag-item').forEach(item => {
                if (item.textContent === tag) {
                    item.classList.toggle('active');
                }
            });

            filterAndDisplayTools();
            updateActiveFilters();
        }

        // Update active filters display
        function updateActiveFilters() {
            const container = document.getElementById('activeFilters');
            container.innerHTML = '';

            const filters = [];

            if (currentCategory !== 'all') {
                const categoryTitle = galleryConfig?.vibeGallery?.categories[currentCategory]?.title || currentCategory;
                filters.push({
                    type: 'Category',
                    value: categoryTitle,
                    remove: () => {
                        currentCategory = 'all';
                        document.querySelector('.category-btn').click();
                    }
                });
            }

            if (currentComplexity) {
                filters.push({
                    type: 'Complexity',
                    value: currentComplexity,
                    remove: () => {
                        currentComplexity = '';
                        document.getElementById('complexityFilter').value = '';
                        filterAndDisplayTools();
                    }
                });
            }

            if (currentType) {
                filters.push({
                    type: 'Type',
                    value: currentType,
                    remove: () => {
                        currentType = '';
                        document.getElementById('typeFilter').value = '';
                        filterAndDisplayTools();
                    }
                });
            }

            if (currentFeatured) {
                filters.push({
                    type: 'Featured',
                    value: currentFeatured === 'featured' ? 'Featured Only' : 'Regular Only',
                    remove: () => {
                        currentFeatured = '';
                        document.getElementById('featuredFilter').value = '';
                        filterAndDisplayTools();
                    }
                });
            }

            currentTags.forEach(tag => {
                filters.push({
                    type: 'Tag',
                    value: tag,
                    remove: () => toggleTag(tag)
                });
            });

            if (searchTerm) {
                filters.push({
                    type: 'Search',
                    value: searchTerm,
                    remove: () => {
                        searchTerm = '';
                        document.getElementById('searchInput').value = '';
                        filterAndDisplayTools();
                    }
                });
            }

            filters.forEach(filter => {
                const chip = document.createElement('div');
                chip.className = 'filter-chip';
                chip.innerHTML = `
                    <span>${filter.type}: ${filter.value}</span>
                    <span class="remove" onclick="removeFilter('${filter.type}', '${filter.value}')">✕</span>
                `;
                chip.querySelector('.remove').onclick = filter.remove;
                container.appendChild(chip);
            });
        }

        // Filter and display tools
        function filterAndDisplayTools() {
            filteredTools = [...allTools];

            // Category filter
            if (currentCategory !== 'all') {
                filteredTools = filteredTools.filter(t => t.categoryKey === currentCategory);
            }

            // Complexity filter
            if (currentComplexity) {
                filteredTools = filteredTools.filter(t => t.complexity === currentComplexity);
            }

            // Type filter
            if (currentType) {
                filteredTools = filteredTools.filter(t => t.interactionType === currentType);
            }

            // Featured filter
            if (currentFeatured === 'featured') {
                filteredTools = filteredTools.filter(t => t.featured);
            } else if (currentFeatured === 'regular') {
                filteredTools = filteredTools.filter(t => !t.featured);
            }

            // Tag filters
            if (currentTags.size > 0) {
                filteredTools = filteredTools.filter(t => {
                    if (!t.tags) return false;
                    return Array.from(currentTags).every(tag => t.tags.includes(tag));
                });
            }

            // Search filter
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredTools = filteredTools.filter(t => {
                    return t.title?.toLowerCase().includes(term) ||
                           t.description?.toLowerCase().includes(term) ||
                           t.filename?.toLowerCase().includes(term) ||
                           t.category?.toLowerCase().includes(term) ||
                           t.tags?.some(tag => tag.toLowerCase().includes(term));
                });
            }

            // Sort tools
            sortTools();

            // Display
            displayTools();

            // Update recommendations
            updateRecommendations();
        }

        // Sort tools
        function sortTools() {
            switch (currentSort) {
                case 'name':
                    filteredTools.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'popular':
                    filteredTools.sort((a, b) => {
                        const aUsage = usageData[a.filename]?.count || 0;
                        const bUsage = usageData[b.filename]?.count || 0;
                        return bUsage - aUsage;
                    });
                    break;
                case 'recent':
                    filteredTools.sort((a, b) => {
                        const aTime = usageData[a.filename]?.lastUsed || 0;
                        const bTime = usageData[b.filename]?.lastUsed || 0;
                        return bTime - aTime;
                    });
                    break;
                case 'complexity':
                    const complexityOrder = { simple: 1, intermediate: 2, advanced: 3 };
                    filteredTools.sort((a, b) => {
                        const aOrder = complexityOrder[a.complexity] || 2;
                        const bOrder = complexityOrder[b.complexity] || 2;
                        return aOrder - bOrder;
                    });
                    break;
                case 'random':
                    filteredTools = filteredTools.sort(() => Math.random() - 0.5);
                    break;
            }

            // Always put pinned items first
            const pinned = filteredTools.filter(t => pinnedTools.includes(t.filename));
            const unpinned = filteredTools.filter(t => !pinnedTools.includes(t.filename));
            filteredTools = [...pinned, ...unpinned];
        }

        // Display tools
        function displayTools() {
            const container = document.getElementById('toolsContainer');
            container.innerHTML = '';

            if (filteredTools.length === 0) {
                container.innerHTML = '<div class="no-results">No tools found matching your criteria</div>';
                return;
            }

            // Create sections
            const pinnedItems = filteredTools.filter(t => pinnedTools.includes(t.filename));
            const featuredItems = filteredTools.filter(t => t.featured && !pinnedTools.includes(t.filename));
            const regularItems = filteredTools.filter(t => !t.featured && !pinnedTools.includes(t.filename));

            if (pinnedItems.length > 0) {
                createSection('📌 Pinned Tools', pinnedItems);
            }

            if (featuredItems.length > 0) {
                createSection('⭐ Featured Tools', featuredItems);
            }

            if (regularItems.length > 0) {
                createSection('🚀 All Tools', regularItems);
            }
        }

        // Create a section
        function createSection(title, tools) {
            const container = document.getElementById('toolsContainer');

            const section = document.createElement('div');
            section.className = 'exhibition-section';

            const sectionTitle = document.createElement('h2');
            sectionTitle.className = 'section-title';
            sectionTitle.textContent = title;
            section.appendChild(sectionTitle);

            const grid = document.createElement('div');
            grid.className = 'tools-grid';

            tools.forEach(tool => {
                const card = createToolCard(tool);
                grid.appendChild(card);
            });

            section.appendChild(grid);
            container.appendChild(section);
        }

        // Create tool card
        function createToolCard(tool) {
            const isPinned = pinnedTools.includes(tool.filename);
            const hasVoted = userVotes[tool.filename] || false;
            const voteCount = votes[tool.filename]?.count || 0;

            const card = document.createElement('div');
            card.className = 'tool-card';
            if (isPinned) card.classList.add('pinned');
            if (tool.featured) card.classList.add('featured');

            // Generate emoji based on category or title
            const emoji = getToolEmoji(tool);

            // Complexity dots
            const complexityLevel = tool.complexity === 'simple' ? 1 :
                                   tool.complexity === 'intermediate' ? 2 : 3;

            card.innerHTML = `
                ${tool.featured ? '<div class="featured-badge">Featured</div>' : ''}
                <button class="pin-button ${isPinned ? 'pinned' : ''}"
                        data-file="${tool.filename}"
                        title="${isPinned ? 'Unpin' : 'Pin to top'}">
                    📌
                </button>

                <div class="tool-preview">${emoji}</div>

                <div class="category-badge ${tool.categoryKey}">
                    ${tool.categoryTitle || tool.category}
                </div>

                <div class="tool-title">${tool.title}</div>
                <div class="tool-filename">${tool.filename}</div>

                <div class="complexity-indicator">
                    ${[1,2,3].map(i => `
                        <div class="complexity-dot ${i <= complexityLevel ? 'filled' : ''}"></div>
                    `).join('')}
                </div>

                <div class="tool-description">${tool.description}</div>

                <div class="tool-meta">
                    ${tool.tags ? tool.tags.slice(0, 3).map(tag => `
                        <span class="tool-tag">#${tag}</span>
                    `).join('') : ''}
                </div>

                <div class="tool-stats">
                    <span class="stat-item">
                        <span class="vote-count">${voteCount}</span> votes
                    </span>
                    ${usageData[tool.filename] ? `
                        <span class="stat-item">
                            ${usageData[tool.filename].count} opens
                        </span>
                    ` : ''}
                </div>

                <div class="tool-actions">
                    <button class="view-button" onclick="openTool('${tool.filename}')">OPEN</button>
                    <button class="preview-button" onclick="previewTool('${tool.filename}', '${tool.title}')">PREVIEW</button>
                    <button class="vote-button ${hasVoted ? 'voted' : ''}"
                            onclick="voteTool('${tool.filename}', event)">
                        ${hasVoted ? 'VOTED' : 'VOTE'}
                    </button>
                    <button class="download-button" onclick="downloadTool('${tool.filename}')">↓</button>
                </div>
            `;

            // Add pin button listener
            const pinBtn = card.querySelector('.pin-button');
            pinBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                togglePin(tool.filename);
            });

            return card;
        }

        // Get tool emoji based on category or content
        function getToolEmoji(tool) {
            const emojiMap = {
                games_puzzles: '🎮',
                '3d_immersive': '🎨',
                audio_music: '🎵',
                experimental_ai: '🤖',
                creative_tools: '🛠️',
                generative_art: '✨',
                particle_physics: '⚛️',
                educational_tools: '📚',
                visual_art: '🎨'
            };

            return emojiMap[tool.categoryKey] || '📱';
        }

        // Open tool
        function openTool(filename) {
            // Track usage
            if (!usageData[filename]) {
                usageData[filename] = { count: 0, lastUsed: 0 };
            }
            usageData[filename].count++;
            usageData[filename].lastUsed = Date.now();
            localStorage.setItem('toolUsage', JSON.stringify(usageData));

            // Add to recently opened
            recentlyOpened = recentlyOpened.filter(f => f !== filename);
            recentlyOpened.unshift(filename);
            recentlyOpened = recentlyOpened.slice(0, 10);
            localStorage.setItem('recentlyOpened', JSON.stringify(recentlyOpened));

            // Update quick access
            updateQuickAccess();

            // Open tool
            window.open(filename, '_blank');
        }

        // Preview tool
        function previewTool(filename, title) {
            const modal = document.getElementById('previewModal');
            const iframe = document.getElementById('previewIframe');
            const titleEl = document.getElementById('previewTitle');

            titleEl.textContent = title;
            iframe.src = filename;
            modal.classList.add('active');

            // Track preview
            if (!usageData[filename]) {
                usageData[filename] = { count: 0, lastUsed: 0 };
            }
            usageData[filename].previews = (usageData[filename].previews || 0) + 1;
            localStorage.setItem('toolUsage', JSON.stringify(usageData));
        }

        // Close preview
        function closePreview() {
            const modal = document.getElementById('previewModal');
            const iframe = document.getElementById('previewIframe');

            modal.classList.remove('active');
            iframe.src = '';
        }

        // Vote for tool
        function voteTool(filename, event) {
            event.stopPropagation();

            if (userVotes[filename]) {
                // Remove vote
                userVotes[filename] = false;
                if (votes[filename]) {
                    votes[filename].count--;
                }
            } else {
                // Add vote
                userVotes[filename] = true;
                if (!votes[filename]) {
                    votes[filename] = { count: 0 };
                }
                votes[filename].count++;
            }

            localStorage.setItem('userVotes', JSON.stringify(userVotes));
            localStorage.setItem('votes', JSON.stringify(votes));

            // Refresh display
            filterAndDisplayTools();
        }

        // Download tool
        function downloadTool(filename) {
            const link = document.createElement('a');
            link.href = filename;
            link.download = filename;
            link.click();
        }

        // Toggle pin
        function togglePin(filename) {
            if (pinnedTools.includes(filename)) {
                pinnedTools = pinnedTools.filter(f => f !== filename);
            } else {
                pinnedTools.push(filename);
            }

            localStorage.setItem('pinnedTools', JSON.stringify(pinnedTools));
            filterAndDisplayTools();
        }

        // Update quick access sections
        function updateQuickAccess() {
            // Recently opened
            const recentContainer = document.getElementById('recentlyOpened');
            recentContainer.innerHTML = '';

            recentlyOpened.slice(0, 5).forEach(filename => {
                const tool = allTools.find(t => t.filename === filename);
                if (tool) {
                    const item = document.createElement('a');
                    item.className = 'quick-item';
                    item.href = '#';
                    item.onclick = (e) => {
                        e.preventDefault();
                        openTool(filename);
                    };
                    item.innerHTML = `
                        <span class="quick-item-title">${tool.title}</span>
                        <span class="quick-item-meta">Just now</span>
                    `;
                    recentContainer.appendChild(item);
                }
            });

            if (recentContainer.children.length === 0) {
                recentContainer.innerHTML = '<div style="color: var(--text-secondary); padding: 10px;">No recent tools</div>';
            }

            // Popular tools
            const popularContainer = document.getElementById('popularTools');
            popularContainer.innerHTML = '';

            const popular = Object.entries(usageData)
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, 5);

            popular.forEach(([filename, data]) => {
                const tool = allTools.find(t => t.filename === filename);
                if (tool) {
                    const item = document.createElement('a');
                    item.className = 'quick-item';
                    item.href = '#';
                    item.onclick = (e) => {
                        e.preventDefault();
                        openTool(filename);
                    };
                    item.innerHTML = `
                        <span class="quick-item-title">${tool.title}</span>
                        <span class="quick-item-meta">${data.count} opens</span>
                    `;
                    popularContainer.appendChild(item);
                }
            });

            if (popularContainer.children.length === 0) {
                popularContainer.innerHTML = '<div style="color: var(--text-secondary); padding: 10px;">No data yet</div>';
            }
        }

        // Update recommendations
        function updateRecommendations() {
            if (recentlyOpened.length === 0) return;

            const recentTool = allTools.find(t => t.filename === recentlyOpened[0]);
            if (!recentTool) return;

            // Find similar tools
            const similar = allTools.filter(t => {
                if (t.filename === recentTool.filename) return false;

                // Same category
                if (t.categoryKey === recentTool.categoryKey) return true;

                // Shared tags
                if (t.tags && recentTool.tags) {
                    const sharedTags = t.tags.filter(tag => recentTool.tags.includes(tag));
                    if (sharedTags.length >= 2) return true;
                }

                // Same complexity
                if (t.complexity === recentTool.complexity) return true;

                return false;
            }).slice(0, 4);

            if (similar.length > 0) {
                const container = document.getElementById('recommendations');
                const grid = document.getElementById('recommendationsGrid');

                container.style.display = 'block';
                grid.innerHTML = '';

                similar.forEach(tool => {
                    const card = createToolCard(tool);
                    grid.appendChild(card);
                });
            }
        }

        // Start guided tour
        function startTour() {
            const overlay = document.getElementById('tourOverlay');
            const tooltip = document.getElementById('tourTooltip');

            const steps = [
                {
                    title: 'Welcome to Local First Tools!',
                    text: 'This gallery contains 200+ privacy-first tools that work entirely offline in your browser.',
                    element: null
                },
                {
                    title: 'Smart Search',
                    text: 'Search across titles, descriptions, tags, and categories to find exactly what you need.',
                    element: document.getElementById('searchInput')
                },
                {
                    title: 'Category Navigation',
                    text: 'Browse tools by category - from games and AI experiments to creative tools and visualizations.',
                    element: document.getElementById('categoryNav')
                },
                {
                    title: 'Advanced Filters',
                    text: 'Filter by complexity level, interaction type, or featured status to narrow your search.',
                    element: document.querySelector('.filter-controls')
                },
                {
                    title: 'Tag Cloud',
                    text: 'Click on popular tags to discover related tools quickly.',
                    element: document.getElementById('tagCloud')
                },
                {
                    title: '3D Gallery Mode',
                    text: 'Experience an immersive 3D gallery with Xbox controller support!',
                    element: document.getElementById('3d-mode')
                },
                {
                    title: 'Get Started!',
                    text: 'Pin your favorite tools, track usage, and enjoy complete privacy - everything stays in your browser.',
                    element: null
                }
            ];

            let currentStep = 0;

            function showStep(index) {
                const step = steps[index];
                const progress = document.getElementById('tourProgress');

                // Update progress dots
                progress.innerHTML = steps.map((_, i) =>
                    `<div class="tour-dot ${i === index ? 'active' : ''}"></div>`
                ).join('');

                // Update content
                document.getElementById('tourTitle').textContent = step.title;
                document.getElementById('tourText').textContent = step.text;

                // Position tooltip
                if (step.element) {
                    const rect = step.element.getBoundingClientRect();
                    tooltip.style.top = (rect.bottom + 20) + 'px';
                    tooltip.style.left = '50%';
                    tooltip.style.transform = 'translateX(-50%)';
                } else {
                    tooltip.style.top = '50%';
                    tooltip.style.left = '50%';
                    tooltip.style.transform = 'translate(-50%, -50%)';
                }

                // Update button
                const nextBtn = document.getElementById('tourNext');
                if (index === steps.length - 1) {
                    nextBtn.textContent = 'Finish';
                } else {
                    nextBtn.textContent = 'Next';
                }
            }

            overlay.classList.add('active');
            showStep(0);

            document.getElementById('tourNext').onclick = () => {
                if (currentStep < steps.length - 1) {
                    currentStep++;
                    showStep(currentStep);
                } else {
                    endTour();
                }
            };

            document.getElementById('tourSkip').onclick = endTour;

            function endTour() {
                overlay.classList.remove('active');
                localStorage.setItem('tourCompleted', 'true');
                tourCompleted = true;
            }
        }

        // Initialize event listeners
        function initEventListeners() {
            // Search input
            const searchInput = document.getElementById('searchInput');
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    searchTerm = e.target.value.toLowerCase();
                    filterAndDisplayTools();
                    updateActiveFilters();
                }, 300);
            });

            // Complexity filter
            document.getElementById('complexityFilter').addEventListener('change', (e) => {
                currentComplexity = e.target.value;
                filterAndDisplayTools();
                updateActiveFilters();
            });

            // Type filter
            document.getElementById('typeFilter').addEventListener('change', (e) => {
                currentType = e.target.value;
                filterAndDisplayTools();
                updateActiveFilters();
            });

            // Featured filter
            document.getElementById('featuredFilter').addEventListener('change', (e) => {
                currentFeatured = e.target.value;
                filterAndDisplayTools();
                updateActiveFilters();
            });

            // Sort buttons
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentSort = btn.dataset.sort;
                    filterAndDisplayTools();
                });
            });

            // Gallery modes
            document.getElementById('main-gallery').addEventListener('click', () => {
                currentView = 'main';
                document.querySelectorAll('.mode-button').forEach(b => b.classList.remove('active'));
                document.getElementById('main-gallery').classList.add('active');
                filterAndDisplayTools();
            });

            document.getElementById('archive-mode').addEventListener('click', () => {
                currentView = 'archive';
                document.querySelectorAll('.mode-button').forEach(b => b.classList.remove('active'));
                document.getElementById('archive-mode').classList.add('active');
                // In enhanced version, we'd filter archive tools
                filterAndDisplayTools();
            });

            document.getElementById('tour-btn').addEventListener('click', startTour);

            // Preview modal
            document.getElementById('closePreviewBtn').addEventListener('click', closePreview);
            document.getElementById('openFullBtn').addEventListener('click', () => {
                const iframe = document.getElementById('previewIframe');
                window.open(iframe.src, '_blank');
                closePreview();
            });

            // ESC key to close preview
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closePreview();
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await loadGalleryConfig();
            initEventListeners();
        });
    </script>
</body>
</html>
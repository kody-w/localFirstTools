<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="description" content="Multi-Agent Collaboration Tool" />
  <meta name="theme-color" content="#742774" />
  <title>Agent Collaboration Tool</title>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet" />

  <style>
    :root {
      --primary: #742774;
      --primary-light: #9168b6;
      --primary-dark: #4f1c4f;
      --primary-rgb: 116, 39, 116;
      --secondary: #00bcd4;
      --secondary-light: #4dd0e1;
      --accent: #ff4081;
      --success: #4caf50;
      --error: #f44336;
      --warning: #ff9800;
      --info: #2196f3;

      --gray-10: #faf9f8;
      --gray-20: #f3f2f1;
      --gray-30: #edebe9;
      --gray-40: #e1dfdd;
      --gray-50: #d2d0ce;
      --gray-60: #c8c6c4;
      --gray-80: #605e5c;
      --gray-100: #323130;
      --gray-130: #242424;

      --space-xs: 4px;
      --space-s: 8px;
      --space-m: 16px;
      --space-l: 24px;
      --space-xl: 32px;
      --space-xxl: 48px;

      --radius: 8px;
      --radius-small: 4px;
      --radius-large: 16px;
      --radius-full: 9999px;

      --shadow-small: 0 2px 8px rgba(0, 0, 0, 0.08);
      --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.12);
      --shadow-large: 0 8px 32px rgba(0, 0, 0, 0.16);

      --transition: all 0.2s ease;
    }

    body.dark {
      --gray-10: #1a1a1a;
      --gray-20: #242424;
      --gray-30: #2d2d2d;
      --gray-40: #373737;
      --gray-50: #424242;
      --gray-60: #4d4d4d;
      --gray-80: #8a8a8a;
      --gray-100: #e0e0e0;
      --gray-130: #f5f5f5;
      --primary-light: #a47cc9;
      --shadow-small: 0 2px 8px rgba(0, 0, 0, 0.3);
      --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.4);
      --shadow-large: 0 8px 32px rgba(0, 0, 0, 0.5);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--gray-10);
      color: var(--gray-100);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      padding: var(--space-l);
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: var(--space-l);
      border-radius: var(--radius-large);
      box-shadow: var(--shadow-small);
      margin-bottom: var(--space-l);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    body.dark .header {
      background: var(--gray-20);
    }

    .header h1 {
      font-size: 24px;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: var(--space-m);
    }

    .header-actions {
      display: flex;
      gap: var(--space-m);
    }

    .button {
      padding: 10px 20px;
      border-radius: var(--radius);
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: var(--space-s);
    }

    .button-primary {
      background: var(--primary);
      color: white;
    }

    .button-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .button-secondary {
      background: var(--gray-20);
      color: var(--gray-100);
    }

    body.dark .button-secondary {
      background: var(--gray-40);
    }

    .button-secondary:hover {
      background: var(--gray-30);
    }

    .button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .main-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-l);
      margin-bottom: var(--space-l);
    }

    @media (max-width: 1024px) {
      .main-content {
        grid-template-columns: 1fr;
      }
    }

    .agent-panel {
      background: white;
      border-radius: var(--radius-large);
      box-shadow: var(--shadow-medium);
      overflow: hidden;
    }

    body.dark .agent-panel {
      background: var(--gray-20);
    }

    .agent-header {
      padding: var(--space-l);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .agent-header h2 {
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: var(--space-m);
    }

    .agent-badge {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: white;
      color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
    }

    .agent-status {
      padding: 4px 12px;
      border-radius: var(--radius-full);
      background: rgba(255, 255, 255, 0.2);
      font-size: 12px;
      font-weight: 600;
    }

    .agent-status.active {
      background: var(--success);
    }

    .agent-status.working {
      background: var(--warning);
      animation: pulse 1.5s infinite;
    }

    .agent-body {
      padding: var(--space-l);
      min-height: 400px;
      max-height: 600px;
      overflow-y: auto;
    }

    .agent-log {
      background: var(--gray-10);
      border-radius: var(--radius);
      padding: var(--space-m);
      margin-bottom: var(--space-m);
      font-size: 14px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    body.dark .agent-log {
      background: var(--gray-30);
    }

    .agent-log.error {
      background: rgba(244, 67, 54, 0.1);
      border: 1px solid var(--error);
      color: var(--error);
    }

    .agent-log.success {
      background: rgba(76, 175, 80, 0.1);
      border: 1px solid var(--success);
      color: var(--success);
    }

    .agent-log.info {
      background: rgba(33, 150, 243, 0.1);
      border: 1px solid var(--info);
      color: var(--info);
    }

    .control-panel {
      background: white;
      border-radius: var(--radius-large);
      box-shadow: var(--shadow-medium);
      padding: var(--space-xl);
    }

    body.dark .control-panel {
      background: var(--gray-20);
    }

    .form-group {
      margin-bottom: var(--space-l);
    }

    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--gray-80);
      margin-bottom: var(--space-s);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--gray-30);
      border-radius: var(--radius);
      font-size: 15px;
      transition: var(--transition);
      background: var(--gray-10);
      font-family: inherit;
    }

    body.dark .form-group input,
    body.dark .form-group select,
    body.dark .form-group textarea {
      background: var(--gray-30);
      color: var(--gray-100);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .endpoint-list {
      display: grid;
      gap: var(--space-m);
      margin-bottom: var(--space-l);
    }

    .endpoint-item {
      padding: var(--space-m);
      background: var(--gray-20);
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      gap: var(--space-m);
    }

    body.dark .endpoint-item {
      background: var(--gray-30);
    }

    .endpoint-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }

    .endpoint-info {
      flex: 1;
      min-width: 0;
    }

    .endpoint-name {
      font-weight: 600;
      color: var(--gray-100);
      margin-bottom: 2px;
    }

    .endpoint-url {
      font-size: 12px;
      color: var(--gray-60);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--gray-20);
      border-radius: var(--radius-full);
      overflow: hidden;
      margin: var(--space-l) 0;
    }

    body.dark .progress-bar {
      background: var(--gray-40);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
      border-radius: var(--radius-full);
      transition: width 0.3s ease;
    }

    .progress-label {
      text-align: center;
      font-size: 14px;
      color: var(--gray-60);
      margin-top: var(--space-s);
    }

    .report-preview {
      background: var(--gray-10);
      border: 2px solid var(--gray-30);
      border-radius: var(--radius);
      padding: var(--space-l);
      margin-top: var(--space-l);
      max-height: 400px;
      overflow-y: auto;
    }

    body.dark .report-preview {
      background: var(--gray-30);
    }

    .report-preview h3 {
      color: var(--primary);
      margin-bottom: var(--space-m);
      font-size: 18px;
    }

    .report-preview pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 13px;
      line-height: 1.6;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: var(--space-m);
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: var(--radius-large);
      box-shadow: var(--shadow-large);
      max-width: 600px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
    }

    body.dark .modal-content {
      background: var(--gray-20);
    }

    .modal-header {
      padding: var(--space-l);
      border-bottom: 1px solid var(--gray-30);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-header h2 {
      font-size: 20px;
      color: var(--gray-100);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--gray-60);
      cursor: pointer;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-full);
    }

    .modal-close:hover {
      background: var(--gray-20);
    }

    .modal-body {
      padding: var(--space-l);
    }

    .modal-footer {
      padding: var(--space-l);
      border-top: 1px solid var(--gray-30);
      display: flex;
      justify-content: flex-end;
      gap: var(--space-m);
    }

    .hidden {
      display: none !important;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.6;
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: var(--radius);
      box-shadow: var(--shadow-large);
      z-index: 2000;
      animation: fadeIn 0.3s ease-out;
      max-width: 400px;
      color: white;
    }

    .notification.success {
      background: var(--success);
    }

    .notification.error {
      background: var(--error);
    }

    .notification.info {
      background: var(--info);
    }

    .notification.warning {
      background: var(--warning);
    }

    input[type="file"] {
      display: none;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>
        <i class="fas fa-robot"></i>
        Agent Collaboration Tool
      </h1>
      <div class="header-actions">
        <button class="button button-secondary" id="import-data">
          <i class="fas fa-upload"></i>
          Import Config
        </button>
        <button class="button button-secondary" id="theme-toggle">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Agent 1 Panel -->
      <div class="agent-panel">
        <div class="agent-header">
          <h2>
            <span class="agent-badge" id="agent1-badge">A1</span>
            <span id="agent1-name">Agent 1</span>
          </h2>
          <span class="agent-status" id="agent1-status">Idle</span>
        </div>
        <div class="agent-body" id="agent1-logs"></div>
      </div>

      <!-- Agent 2 Panel -->
      <div class="agent-panel">
        <div class="agent-header">
          <h2>
            <span class="agent-badge" id="agent2-badge">A2</span>
            <span id="agent2-name">Agent 2</span>
          </h2>
          <span class="agent-status" id="agent2-status">Idle</span>
        </div>
        <div class="agent-body" id="agent2-logs"></div>
      </div>
    </div>

    <!-- Control Panel -->
    <div class="control-panel">
      <h2 style="margin-bottom: var(--space-l); color: var(--primary);">
        <i class="fas fa-cogs"></i> Collaboration Control
      </h2>

      <div class="endpoint-list" id="endpoint-list">
        <p style="text-align: center; color: var(--gray-60);">No endpoints configured. Import data or configure endpoints.</p>
      </div>

      <div class="form-group">
        <label for="task-description">Task Description</label>
        <textarea id="task-description" placeholder="Describe what you want the agents to collaborate on...">Compare your memories and identify differences, then create a summary report.</textarea>
      </div>

      <div class="form-group">
        <label for="email-address">Email Address (for report)</label>
        <input type="email" id="email-address" placeholder="your.email@example.com" />
      </div>

      <div class="progress-bar hidden" id="progress-bar">
        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
      </div>
      <div class="progress-label hidden" id="progress-label">Initializing...</div>

      <button class="button button-primary" id="start-collaboration" style="width: 100%; margin-top: var(--space-l);" disabled>
        <i class="fas fa-play"></i>
        Start Collaboration
      </button>

      <div class="report-preview hidden" id="report-preview">
        <h3><i class="fas fa-file-alt"></i> Generated Report</h3>
        <pre id="report-content"></pre>
      </div>
    </div>
  </div>

  <!-- Endpoint Modal -->
  <div class="modal" id="endpoint-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Configure Endpoints</h2>
        <button class="modal-close" id="endpoint-modal-close">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <p style="color: var(--gray-60); margin-bottom: var(--space-l);">
          Please select endpoints for both agents (they can be the same endpoint):
        </p>
        
        <div class="form-group">
          <label for="agent1-select">Agent 1</label>
          <select id="agent1-select"></select>
        </div>

        <div class="form-group">
          <label for="agent2-select">Agent 2</label>
          <select id="agent2-select"></select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="button button-secondary" id="cancel-endpoints">Cancel</button>
        <button class="button button-primary" id="save-endpoints">
          <i class="fas fa-check"></i>
          Confirm Selection
        </button>
      </div>
    </div>
  </div>

  <!-- Hidden file input -->
  <input type="file" id="data-import-input" accept=".json" />

  <script>
    class AppState {
      constructor() {
        this.endpoints = this.loadEndpoints();
        this.settings = this.loadSettings();
        this.selectedAgent1 = null;
        this.selectedAgent2 = null;
      }

      loadEndpoints() {
        const endpoints = localStorage.getItem("agentCollabEndpoints");
        return endpoints ? JSON.parse(endpoints) : {};
      }

      loadSettings() {
        const settings = localStorage.getItem("agentCollabSettings");
        return settings ? JSON.parse(settings) : { theme: "light" };
      }

      saveEndpoints() {
        localStorage.setItem("agentCollabEndpoints", JSON.stringify(this.endpoints));
      }

      saveSettings() {
        localStorage.setItem("agentCollabSettings", JSON.stringify(this.settings));
      }

      importData(data) {
        // Compatible with the main chat app's export format
        if (data.endpoints) {
          this.endpoints = data.endpoints;
          this.saveEndpoints();
          return true;
        }
        return false;
      }
    }

    class CollaborationEngine {
      constructor() {
        this.agent1 = null;
        this.agent2 = null;
        this.logs1 = [];
        this.logs2 = [];
        this.report = "";
      }

      async runCollaboration(agent1Config, agent2Config, taskDescription, emailAddress) {
        this.agent1 = agent1Config;
        this.agent2 = agent2Config;
        this.logs1 = [];
        this.logs2 = [];
        this.report = "";

        try {
          // Step 1: Get memories from both agents
          ui.updateProgress(10, "Retrieving memories from Agent 1...");
          const memories1 = await this.getMemories(agent1Config, 1);
          
          ui.updateProgress(30, "Retrieving memories from Agent 2...");
          const memories2 = await this.getMemories(agent2Config, 2);

          // Step 2: Share memories between agents
          ui.updateProgress(50, "Agent 1 analyzing Agent 2's memories...");
          const analysis1 = await this.analyzeMemories(agent1Config, memories2, "Agent 2", 1);

          ui.updateProgress(70, "Agent 2 analyzing Agent 1's memories...");
          const analysis2 = await this.analyzeMemories(agent2Config, memories1, "Agent 1", 2);

          // Step 3: Generate comparison report
          ui.updateProgress(90, "Generating comparison report...");
          this.report = this.generateReport(memories1, memories2, analysis1, analysis2, taskDescription);

          // Step 4: Email report
          ui.updateProgress(95, "Preparing to send email...");
          await this.sendEmailReport(emailAddress, this.report);

          ui.updateProgress(100, "Collaboration complete!");
          
          return {
            success: true,
            report: this.report
          };

        } catch (error) {
          this.addLog(1, `Error: ${error.message}`, 'error');
          this.addLog(2, `Error: ${error.message}`, 'error');
          throw error;
        }
      }

      async getMemories(agentConfig, agentNum) {
        this.addLog(agentNum, `Requesting memories from endpoint...`, 'info');

        const response = await fetch(agentConfig.url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-functions-key": agentConfig.key,
          },
          body: JSON.stringify({
            user_input: "Please retrieve all your memories using the ContextMemory agent.",
            conversation_history: [],
            user_guid: agentConfig.guid,
          }),
        });

        if (!response.ok) {
          throw new Error(`Agent ${agentNum} failed to retrieve memories: ${response.status}`);
        }

        const data = await response.json();
        const memories = data.assistant_response || "No memories retrieved.";
        
        this.addLog(agentNum, `Successfully retrieved memories:\n${memories.substring(0, 200)}...`, 'success');
        
        return memories;
      }

      async analyzeMemories(agentConfig, otherMemories, otherAgentName, agentNum) {
        this.addLog(agentNum, `Analyzing ${otherAgentName}'s memories...`, 'info');

        const prompt = `You have received the following memories from ${otherAgentName}:

${otherMemories}

Please analyze these memories and identify:
1. Key themes and topics
2. Any interesting patterns
3. How they compare to your own memories (if any)

Provide a brief analysis.`;

        const response = await fetch(agentConfig.url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-functions-key": agentConfig.key,
          },
          body: JSON.stringify({
            user_input: prompt,
            conversation_history: [],
            user_guid: agentConfig.guid,
          }),
        });

        if (!response.ok) {
          throw new Error(`Agent ${agentNum} failed to analyze memories: ${response.status}`);
        }

        const data = await response.json();
        const analysis = data.assistant_response || "No analysis provided.";
        
        this.addLog(agentNum, `Analysis complete:\n${analysis.substring(0, 200)}...`, 'success');
        
        return analysis;
      }

      generateReport(memories1, memories2, analysis1, analysis2, taskDescription) {
        const timestamp = new Date().toLocaleString();
        
        const report = `
AGENT COLLABORATION REPORT
Generated: ${timestamp}

TASK DESCRIPTION:
${taskDescription}

═══════════════════════════════════════════════════════════

AGENT 1 MEMORIES:
${memories1}

═══════════════════════════════════════════════════════════

AGENT 2 MEMORIES:
${memories2}

═══════════════════════════════════════════════════════════

AGENT 1'S ANALYSIS OF AGENT 2:
${analysis1}

═══════════════════════════════════════════════════════════

AGENT 2'S ANALYSIS OF AGENT 1:
${analysis2}

═══════════════════════════════════════════════════════════

SUMMARY:
The two agents have successfully shared their memories and provided
cross-analysis. The report above contains the complete comparison
of their memory stores and analytical insights.

Key Observations:
- Both agents maintained separate memory contexts
- Memory retrieval was successful from both endpoints
- Cross-agent analysis completed without errors
- Report generated and ready for email delivery

═══════════════════════════════════════════════════════════
End of Report
        `.trim();

        return report;
      }

      async sendEmailReport(emailAddress, reportContent) {
        // In a real implementation, this would call an email API
        // For now, we'll simulate it and provide a download option
        
        this.addLog(1, `Report prepared for email to: ${emailAddress}`, 'info');
        this.addLog(2, `Report prepared for email to: ${emailAddress}`, 'info');

        // Simulate email sending delay
        await new Promise(resolve => setTimeout(resolve, 1000));

        // Since we can't actually send emails from the browser without a backend,
        // we'll offer to download the report instead
        const blob = new Blob([reportContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `agent-collaboration-report-${Date.now()}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        this.addLog(1, `Report downloaded (email simulation). In production, this would email to ${emailAddress}`, 'success');
        this.addLog(2, `Report downloaded (email simulation). In production, this would email to ${emailAddress}`, 'success');
      }

      addLog(agentNum, message, type = 'info') {
        const log = { message, type, timestamp: new Date().toISOString() };
        
        if (agentNum === 1) {
          this.logs1.push(log);
          ui.addAgentLog(1, message, type);
        } else {
          this.logs2.push(log);
          ui.addAgentLog(2, message, type);
        }
      }
    }

    class UIController {
      constructor() {
        this.appState = new AppState();
        this.collaboration = new CollaborationEngine();
        
        this.initializeEventListeners();
        this.loadEndpoints();
        this.applyTheme();
      }

      initializeEventListeners() {
        document.getElementById('theme-toggle').addEventListener('click', () => {
          this.toggleTheme();
        });

        document.getElementById('import-data').addEventListener('click', () => {
          document.getElementById('data-import-input').click();
        });

        document.getElementById('data-import-input').addEventListener('change', (e) => {
          if (e.target.files[0]) {
            this.importData(e.target.files[0]);
          }
        });

        document.getElementById('start-collaboration').addEventListener('click', () => {
          this.startCollaboration();
        });

        document.getElementById('endpoint-modal-close').addEventListener('click', () => {
          this.closeEndpointModal();
        });

        document.getElementById('cancel-endpoints').addEventListener('click', () => {
          this.closeEndpointModal();
        });

        document.getElementById('save-endpoints').addEventListener('click', () => {
          this.saveEndpointSelection();
        });

        document.getElementById('agent1-select').addEventListener('change', () => {
          this.validateEndpointSelection();
        });

        document.getElementById('agent2-select').addEventListener('change', () => {
          this.validateEndpointSelection();
        });
      }

      loadEndpoints() {
        const endpointList = document.getElementById('endpoint-list');
        const endpoints = Object.values(this.appState.endpoints);

        if (endpoints.length === 0) {
          endpointList.innerHTML = '<p style="text-align: center; color: var(--gray-60);">No endpoints configured. Import data or configure endpoints.</p>';
          return;
        }

        endpointList.innerHTML = '';

        // If we don't have selected agents yet, show the modal
        if (!this.appState.selectedAgent1 || !this.appState.selectedAgent2) {
          this.openEndpointModal();
        } else {
          // Show selected agents
          const agent1 = this.appState.endpoints[this.appState.selectedAgent1];
          const agent2 = this.appState.endpoints[this.appState.selectedAgent2];

          if (agent1 && agent2) {
            endpointList.innerHTML = `
              <div class="endpoint-item">
                <div class="endpoint-icon">${agent1.name.charAt(0).toUpperCase()}</div>
                <div class="endpoint-info">
                  <div class="endpoint-name">Agent 1: ${agent1.name}</div>
                  <div class="endpoint-url">${agent1.url}</div>
                </div>
              </div>
              <div class="endpoint-item">
                <div class="endpoint-icon">${agent2.name.charAt(0).toUpperCase()}</div>
                <div class="endpoint-info">
                  <div class="endpoint-name">Agent 2: ${agent2.name}</div>
                  <div class="endpoint-url">${agent2.url}</div>
                </div>
              </div>
            `;

            document.getElementById('agent1-name').textContent = agent1.name;
            document.getElementById('agent2-name').textContent = agent2.name;
            document.getElementById('agent1-badge').textContent = agent1.name.charAt(0).toUpperCase();
            document.getElementById('agent2-badge').textContent = agent2.name.charAt(0).toUpperCase();

            document.getElementById('start-collaboration').disabled = false;
          }
        }
      }

      openEndpointModal() {
        const endpoints = Object.values(this.appState.endpoints);
        const agent1Select = document.getElementById('agent1-select');
        const agent2Select = document.getElementById('agent2-select');

        agent1Select.innerHTML = '<option value="">Select Agent 1...</option>';
        agent2Select.innerHTML = '<option value="">Select Agent 2...</option>';

        endpoints.forEach(endpoint => {
          const option1 = document.createElement('option');
          option1.value = endpoint.id;
          option1.textContent = endpoint.name;
          agent1Select.appendChild(option1);

          const option2 = document.createElement('option');
          option2.value = endpoint.id;
          option2.textContent = endpoint.name;
          agent2Select.appendChild(option2);
        });

        document.getElementById('endpoint-modal').classList.add('active');
      }

      closeEndpointModal() {
        document.getElementById('endpoint-modal').classList.remove('active');
      }

      validateEndpointSelection() {
        const agent1Id = document.getElementById('agent1-select').value;
        const agent2Id = document.getElementById('agent2-select').value;

        const saveButton = document.getElementById('save-endpoints');

        // Both agents can use the same endpoint
        if (agent1Id && agent2Id) {
          saveButton.disabled = false;
        } else {
          saveButton.disabled = true;
        }
      }

      saveEndpointSelection() {
        const agent1Id = document.getElementById('agent1-select').value;
        const agent2Id = document.getElementById('agent2-select').value;

        // Both agents can use the same endpoint
        if (!agent1Id || !agent2Id) {
          this.showNotification('Please select both agents', 'warning');
          return;
        }

        this.appState.selectedAgent1 = agent1Id;
        this.appState.selectedAgent2 = agent2Id;

        this.closeEndpointModal();
        this.loadEndpoints();
        this.showNotification('Agents selected successfully!', 'success');
      }

      async startCollaboration() {
        const taskDescription = document.getElementById('task-description').value.trim();
        const emailAddress = document.getElementById('email-address').value.trim();

        if (!emailAddress) {
          this.showNotification('Please enter an email address', 'warning');
          return;
        }

        if (!taskDescription) {
          this.showNotification('Please enter a task description', 'warning');
          return;
        }

        const agent1Config = this.appState.endpoints[this.appState.selectedAgent1];
        const agent2Config = this.appState.endpoints[this.appState.selectedAgent2];

        if (!agent1Config || !agent2Config) {
          this.showNotification('Invalid agent configuration', 'error');
          return;
        }

        // Clear previous logs
        document.getElementById('agent1-logs').innerHTML = '';
        document.getElementById('agent2-logs').innerHTML = '';
        document.getElementById('report-preview').classList.add('hidden');

        // Update UI
        document.getElementById('start-collaboration').disabled = true;
        document.getElementById('progress-bar').classList.remove('hidden');
        document.getElementById('progress-label').classList.remove('hidden');
        document.getElementById('agent1-status').textContent = 'Working';
        document.getElementById('agent1-status').className = 'agent-status working';
        document.getElementById('agent2-status').textContent = 'Working';
        document.getElementById('agent2-status').className = 'agent-status working';

        try {
          const result = await this.collaboration.runCollaboration(
            agent1Config,
            agent2Config,
            taskDescription,
            emailAddress
          );

          // Show report
          document.getElementById('report-content').textContent = result.report;
          document.getElementById('report-preview').classList.remove('hidden');

          // Update status
          document.getElementById('agent1-status').textContent = 'Complete';
          document.getElementById('agent1-status').className = 'agent-status active';
          document.getElementById('agent2-status').textContent = 'Complete';
          document.getElementById('agent2-status').className = 'agent-status active';

          this.showNotification('Collaboration completed successfully!', 'success');

        } catch (error) {
          console.error('Collaboration error:', error);
          this.showNotification('Collaboration failed: ' + error.message, 'error');
          
          document.getElementById('agent1-status').textContent = 'Error';
          document.getElementById('agent1-status').className = 'agent-status';
          document.getElementById('agent2-status').textContent = 'Error';
          document.getElementById('agent2-status').className = 'agent-status';
        } finally {
          document.getElementById('start-collaboration').disabled = false;
          setTimeout(() => {
            document.getElementById('progress-bar').classList.add('hidden');
            document.getElementById('progress-label').classList.add('hidden');
            document.getElementById('agent1-status').textContent = 'Idle';
            document.getElementById('agent1-status').className = 'agent-status';
            document.getElementById('agent2-status').textContent = 'Idle';
            document.getElementById('agent2-status').className = 'agent-status';
          }, 2000);
        }
      }

      updateProgress(percent, label) {
        document.getElementById('progress-fill').style.width = percent + '%';
        document.getElementById('progress-label').textContent = label;
      }

      addAgentLog(agentNum, message, type = 'info') {
        const logsContainer = document.getElementById(`agent${agentNum}-logs`);
        const logDiv = document.createElement('div');
        logDiv.className = `agent-log ${type}`;
        logDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        logsContainer.appendChild(logDiv);
        logsContainer.scrollTop = logsContainer.scrollHeight;
      }

      importData(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            
            if (this.appState.importData(data)) {
              this.loadEndpoints();
              this.showNotification('Configuration imported successfully!', 'success');
            } else {
              this.showNotification('Invalid configuration file', 'error');
            }
          } catch (error) {
            this.showNotification('Error importing data: ' + error.message, 'error');
          }
        };
        reader.readAsText(file);
      }

      toggleTheme() {
        const isDark = document.body.classList.toggle('dark');
        this.appState.settings.theme = isDark ? 'dark' : 'light';
        this.appState.saveSettings();

        const themeIcon = document.querySelector('#theme-toggle i');
        themeIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
      }

      applyTheme() {
        if (this.appState.settings.theme === 'dark') {
          document.body.classList.add('dark');
          document.querySelector('#theme-toggle i').className = 'fas fa-sun';
        }
      }

      showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;

        document.body.appendChild(notification);

        setTimeout(() => {
          notification.style.animation = 'fadeOut 0.3s ease-out';
          setTimeout(() => {
            document.body.removeChild(notification);
          }, 300);
        }, 3000);
      }
    }

    // Add fade out animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeOut {
        to {
          opacity: 0;
          transform: translateY(-20px);
        }
      }
    `;
    document.head.appendChild(style);

    // Initialize the application
    const ui = new UIController();
  </script>
</body>

</html>
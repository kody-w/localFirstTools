<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser VM - Azure Function in Docker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 24px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .azure-badge {
            background: #0078d4;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-bar {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 12px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse 2s infinite;
        }

        .status-indicator.azure {
            background: #0078d4;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-container {
            flex: 1;
            display: flex;
            padding: 20px;
            gap: 20px;
        }

        .left-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .right-panel {
            width: 400px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .terminal {
            flex: 1;
            background: #000;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-y: auto;
            min-height: 400px;
            max-height: 500px;
            color: #0f0;
            text-shadow: 0 0 3px #0f0;
        }

        .terminal-line {
            margin: 2px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .terminal-line.azure {
            color: #00d4ff;
        }

        .terminal-line.http {
            color: #ffeb3b;
        }

        .terminal-line.success {
            color: #4caf50;
        }

        .terminal-line.error {
            color: #ff6b6b;
        }

        .terminal-input {
            display: flex;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #333;
        }

        .terminal-prompt {
            color: #4caf50;
            margin-right: 10px;
        }

        input[type="text"] {
            flex: 1;
            background: transparent;
            border: none;
            color: #0f0;
            font-family: inherit;
            font-size: 13px;
            outline: none;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button.azure {
            background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%);
        }

        button.running {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .azure-function-panel {
            background: linear-gradient(135deg, rgba(0, 120, 212, 0.2) 0%, rgba(0, 90, 158, 0.2) 100%);
        }

        .function-endpoint {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            font-size: 12px;
        }

        .endpoint-url {
            color: #00d4ff;
            word-break: break-all;
            margin-top: 5px;
            padding: 5px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
            font-family: monospace;
        }

        .code-viewer {
            background: #1e1e1e;
            border-radius: 5px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }

        .code-line {
            margin: 2px 0;
            font-family: 'Courier New', monospace;
        }

        .code-keyword {
            color: #569cd6;
        }

        .code-string {
            color: #ce9178;
        }

        .code-comment {
            color: #6a9955;
        }

        .test-panel {
            margin-top: 15px;
        }

        .test-input {
            width: 100%;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 4px;
            margin: 10px 0;
        }

        .response-viewer {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .loader {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loader.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #0078d4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .metric-item {
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #00d4ff;
        }

        .metric-label {
            font-size: 11px;
            color: #888;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            .right-panel {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            üñ•Ô∏è Browser VM - Docker 
            <span class="azure-badge">AZURE FUNCTIONS</span>
        </h1>
        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator"></div>
                <span>VM Status: <span id="vmStatus">Ready</span></span>
            </div>
            <div class="status-item">
                <div class="status-indicator azure"></div>
                <span>Azure Function: <span id="functionStatus">Not Deployed</span></span>
            </div>
            <div class="status-item">
                <span>Runtime: Node.js 18 LTS</span>
            </div>
            <div class="status-item">
                <span>Container: <span id="containerStatus">Stopped</span></span>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="left-panel">
            <div class="panel">
                <h3>üñ•Ô∏è Container Terminal</h3>
                <div class="terminal" id="terminal">
                    <div class="terminal-line">Browser VM with Azure Functions Runtime</div>
                    <div class="terminal-line">WebAssembly-powered Docker environment initialized</div>
                    <div class="terminal-line">Ready to deploy serverless functions...</div>
                </div>
                <div class="terminal-input">
                    <span class="terminal-prompt">azurevm@browser:~$</span>
                    <input type="text" id="terminalInput" placeholder="Enter command...">
                </div>
            </div>

            <div class="panel">
                <h3>üìù Azure Function Code</h3>
                <div class="code-viewer" id="codeViewer">
                    <div class="code-line"><span class="code-comment">// Azure Function: HTTP Trigger</span></div>
                    <div class="code-line"><span class="code-keyword">module.exports</span> = <span class="code-keyword">async function</span> (context, req) {</div>
                    <div class="code-line">    <span class="code-keyword">const</span> name = req.query.name || req.body?.name || <span class="code-string">'World'</span>;</div>
                    <div class="code-line">    <span class="code-keyword">const</span> timestamp = <span class="code-keyword">new</span> Date().toISOString();</div>
                    <div class="code-line">    </div>
                    <div class="code-line">    <span class="code-keyword">const</span> response = {</div>
                    <div class="code-line">        message: <span class="code-string">`Hello, ${name}!`</span>,</div>
                    <div class="code-line">        timestamp: timestamp,</div>
                    <div class="code-line">        environment: <span class="code-string">'Browser VM (WASM)'</span>,</div>
                    <div class="code-line">        runtime: <span class="code-string">'Azure Functions Core Tools'</span>,</div>
                    <div class="code-line">        container: <span class="code-string">'Docker in WebAssembly'</span></div>
                    <div class="code-line">    };</div>
                    <div class="code-line">    </div>
                    <div class="code-line">    context.res = {</div>
                    <div class="code-line">        status: <span class="code-keyword">200</span>,</div>
                    <div class="code-line">        body: response,</div>
                    <div class="code-line">        headers: { <span class="code-string">'Content-Type'</span>: <span class="code-string">'application/json'</span> }</div>
                    <div class="code-line">    };</div>
                    <div class="code-line">};</div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="panel azure-function-panel">
                <h3>‚ö° Azure Function Deployment</h3>
                <div class="controls">
                    <button onclick="buildDockerImage()" id="buildBtn" class="azure">Build Image</button>
                    <button onclick="deployFunction()" id="deployBtn" class="azure">Deploy Function</button>
                    <button onclick="startContainer()" id="startBtn">Start Container</button>
                    <button onclick="stopContainer()" id="stopBtn">Stop Container</button>
                </div>
                <div class="loader" id="loader">
                    <div class="spinner"></div>
                    <p>Deploying Azure Function...</p>
                </div>
                <div class="function-endpoint" id="functionEndpoint" style="display: none;">
                    <strong>Function Endpoint:</strong>
                    <div class="endpoint-url" id="endpointUrl">http://localhost:7071/api/HttpTrigger</div>
                </div>
            </div>

            <div class="panel">
                <h3>üß™ Test Function</h3>
                <div class="test-panel">
                    <input type="text" class="test-input" id="testInput" placeholder="Enter your name..." value="Azure Developer">
                    <button onclick="testFunction()" id="testBtn" style="width: 100%;">Send Request</button>
                    <div class="response-viewer" id="responseViewer" style="display: none;">
                        <strong>Response:</strong>
                        <pre id="responseContent"></pre>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>üìä Function Metrics</h3>
                <div class="metrics">
                    <div class="metric-item">
                        <div class="metric-value" id="requestCount">0</div>
                        <div class="metric-label">Total Requests</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" id="avgResponseTime">0ms</div>
                        <div class="metric-label">Avg Response Time</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" id="successRate">100%</div>
                        <div class="metric-label">Success Rate</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" id="activeConnections">0</div>
                        <div class="metric-label">Active Connections</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Azure Function VM Implementation
        class AzureFunctionVM {
            constructor() {
                this.dockerImage = null;
                this.container = null;
                this.functionRuntime = null;
                this.isRunning = false;
                this.metrics = {
                    requests: 0,
                    totalResponseTime: 0,
                    errors: 0,
                    activeConnections: 0
                };
                
                this.initializeAzureRuntime();
            }

            initializeAzureRuntime() {
                // Simulate Azure Functions Core Tools runtime
                this.functionRuntime = {
                    version: '4.0.5455',
                    nodeVersion: '18.17.1',
                    port: 7071,
                    functions: new Map()
                };
            }

            async buildDockerImage() {
                addTerminalLine('[Docker] Building Azure Functions image...', 'azure');
                
                // Simulate Dockerfile creation
                const dockerfile = `
FROM mcr.microsoft.com/azure-functions/node:4-node18
ENV AzureWebJobsScriptRoot=/home/site/wwwroot
ENV AzureFunctionsJobHost__Logging__Console__IsEnabled=true
COPY . /home/site/wwwroot
RUN cd /home/site/wwwroot && npm install
                `.trim();
                
                await this.simulateDelay(500);
                addTerminalLine('[Docker] Creating Dockerfile...');
                
                await this.simulateDelay(800);
                addTerminalLine('[Docker] Step 1/5 : FROM mcr.microsoft.com/azure-functions/node:4-node18');
                
                await this.simulateDelay(600);
                addTerminalLine('[Docker] Step 2/5 : ENV AzureWebJobsScriptRoot=/home/site/wwwroot');
                
                await this.simulateDelay(500);
                addTerminalLine('[Docker] Step 3/5 : COPY . /home/site/wwwroot');
                
                await this.simulateDelay(700);
                addTerminalLine('[Docker] Step 4/5 : RUN npm install');
                addTerminalLine('[npm] Installing dependencies...');
                addTerminalLine('[npm] + @azure/functions@4.0.0');
                addTerminalLine('[npm] + axios@1.6.0');
                addTerminalLine('[npm] added 45 packages');
                
                await this.simulateDelay(500);
                addTerminalLine('[Docker] Step 5/5 : EXPOSE 7071');
                
                await this.simulateDelay(300);
                const imageId = this.generateId().slice(0, 12);
                addTerminalLine(`[Docker] Successfully built ${imageId}`, 'success');
                addTerminalLine('[Docker] Successfully tagged azurefunc:latest', 'success');
                
                this.dockerImage = {
                    id: imageId,
                    name: 'azurefunc:latest',
                    size: '287MB',
                    created: new Date().toISOString()
                };
                
                return this.dockerImage;
            }

            async deployFunction() {
                if (!this.dockerImage) {
                    addTerminalLine('[Error] No Docker image found. Build image first.', 'error');
                    return;
                }
                
                addTerminalLine('[Azure] Deploying function to container...', 'azure');
                
                // Create function.json
                await this.simulateDelay(400);
                addTerminalLine('[Azure] Creating function.json configuration...');
                
                const functionConfig = {
                    bindings: [{
                        authLevel: "anonymous",
                        type: "httpTrigger",
                        direction: "in",
                        name: "req",
                        methods: ["get", "post"]
                    }, {
                        type: "http",
                        direction: "out",
                        name: "res"
                    }]
                };
                
                await this.simulateDelay(300);
                addTerminalLine('[Azure] Registering HTTP trigger binding...');
                
                // Create the actual function
                const functionCode = this.createAzureFunction();
                this.functionRuntime.functions.set('HttpTrigger', functionCode);
                
                await this.simulateDelay(500);
                addTerminalLine('[Azure] Function app created successfully', 'success');
                addTerminalLine('[Azure] HTTP trigger registered at /api/HttpTrigger', 'success');
                
                document.getElementById('functionStatus').textContent = 'Deployed';
                document.getElementById('functionEndpoint').style.display = 'block';
                
                return true;
            }

            async startContainer() {
                if (!this.dockerImage) {
                    addTerminalLine('[Error] No Docker image available', 'error');
                    return;
                }
                
                const containerId = this.generateId();
                addTerminalLine(`[Docker] Creating container from ${this.dockerImage.name}`);
                
                await this.simulateDelay(500);
                addTerminalLine(`[Docker] Container ID: ${containerId.slice(0, 12)}`);
                
                await this.simulateDelay(400);
                addTerminalLine('[Docker] Starting container...');
                
                this.container = {
                    id: containerId,
                    image: this.dockerImage.name,
                    status: 'running',
                    port: 7071
                };
                
                await this.simulateDelay(600);
                addTerminalLine('[Azure] Azure Functions Core Tools');
                addTerminalLine('[Azure] Core Tools Version: 4.0.5455');
                addTerminalLine('[Azure] Function Runtime Version: 4.27.5.21554');
                
                await this.simulateDelay(400);
                addTerminalLine('[Azure] Starting host...');
                
                await this.simulateDelay(500);
                addTerminalLine('[Host] Initializing function HTTP routes');
                addTerminalLine('[Host] Mapped function route: api/HttpTrigger', 'http');
                
                await this.simulateDelay(300);
                addTerminalLine('[Host] Host started successfully', 'success');
                addTerminalLine('[Host] Listening on: http://localhost:7071', 'http');
                addTerminalLine('[Host] Application Insights: Disabled');
                
                this.isRunning = true;
                document.getElementById('containerStatus').textContent = 'Running';
                document.getElementById('functionStatus').textContent = 'Active';
                
                // Start mock HTTP server
                this.startMockServer();
                
                return this.container;
            }

            async stopContainer() {
                if (!this.container || !this.isRunning) {
                    addTerminalLine('[Error] No container running', 'error');
                    return;
                }
                
                addTerminalLine(`[Docker] Stopping container ${this.container.id.slice(0, 12)}...`);
                
                await this.simulateDelay(500);
                addTerminalLine('[Host] Stopping host...');
                
                await this.simulateDelay(300);
                addTerminalLine('[Host] Host stopped', 'success');
                addTerminalLine('[Docker] Container stopped', 'success');
                
                this.isRunning = false;
                this.container = null;
                document.getElementById('containerStatus').textContent = 'Stopped';
                document.getElementById('functionStatus').textContent = 'Inactive';
            }

            createAzureFunction() {
                // This simulates the actual Azure Function code
                return async (context, req) => {
                    const startTime = Date.now();
                    
                    const name = req.query?.name || req.body?.name || 'World';
                    const timestamp = new Date().toISOString();
                    
                    const response = {
                        message: `Hello, ${name}!`,
                        timestamp: timestamp,
                        environment: 'Browser VM (WASM)',
                        runtime: 'Azure Functions Core Tools',
                        container: 'Docker in WebAssembly',
                        executionId: this.generateId().slice(0, 8),
                        hostVersion: '4.27.5.21554',
                        nodeVersion: '18.17.1'
                    };
                    
                    const responseTime = Date.now() - startTime;
                    this.updateMetrics(responseTime, true);
                    
                    return {
                        status: 200,
                        body: response,
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Powered-By': 'Azure Functions',
                            'X-Response-Time': `${responseTime}ms`
                        }
                    };
                };
            }

            async invokeFunction(name, data) {
                if (!this.isRunning) {
                    throw new Error('Container not running');
                }
                
                const func = this.functionRuntime.functions.get('HttpTrigger');
                if (!func) {
                    throw new Error('Function not found');
                }
                
                // Simulate Azure Functions context
                const context = {
                    invocationId: this.generateId(),
                    executionContext: {
                        invocationId: this.generateId(),
                        functionName: 'HttpTrigger',
                        functionDirectory: '/home/site/wwwroot/HttpTrigger'
                    },
                    bindings: {},
                    bindingData: {},
                    bindingDefinitions: [],
                    log: (msg) => addTerminalLine(`[Function] ${msg}`)
                };
                
                const req = {
                    query: {},
                    body: { name: data },
                    headers: {
                        'content-type': 'application/json'
                    }
                };
                
                const result = await func(context, req);
                return result;
            }

            startMockServer() {
                // Simulate HTTP server logs
                setTimeout(() => {
                    if (this.isRunning) {
                        addTerminalLine('[Http] GET /api/HttpTrigger => Ready', 'http');
                        addTerminalLine('[Http] POST /api/HttpTrigger => Ready', 'http');
                    }
                }, 1000);
            }

            updateMetrics(responseTime, success) {
                this.metrics.requests++;
                this.metrics.totalResponseTime += responseTime;
                if (!success) this.metrics.errors++;
                
                document.getElementById('requestCount').textContent = this.metrics.requests;
                
                const avgTime = Math.round(this.metrics.totalResponseTime / this.metrics.requests);
                document.getElementById('avgResponseTime').textContent = `${avgTime}ms`;
                
                const successRate = Math.round(((this.metrics.requests - this.metrics.errors) / this.metrics.requests) * 100);
                document.getElementById('successRate').textContent = `${successRate}%`;
            }

            simulateDelay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            generateId() {
                return Array.from({length: 32}, () => 
                    Math.floor(Math.random() * 16).toString(16)
                ).join('');
            }
        }

        // Initialize Azure Function VM
        const azureVM = new AzureFunctionVM();

        // Terminal output helper
        function addTerminalLine(text, className = '') {
            const terminal = document.getElementById('terminal');
            const line = document.createElement('div');
            line.className = `terminal-line ${className}`;
            line.textContent = text;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }

        // Control functions
        async function buildDockerImage() {
            const btn = document.getElementById('buildBtn');
            btn.disabled = true;
            btn.textContent = 'Building...';
            
            await azureVM.buildDockerImage();
            
            btn.disabled = false;
            btn.textContent = 'Build Image';
        }

        async function deployFunction() {
            const btn = document.getElementById('deployBtn');
            const loader = document.getElementById('loader');
            
            btn.disabled = true;
            loader.classList.add('active');
            
            await azureVM.deployFunction();
            
            loader.classList.remove('active');
            btn.disabled = false;
        }

        async function startContainer() {
            const btn = document.getElementById('startBtn');
            btn.disabled = true;
            btn.classList.add('running');
            btn.textContent = 'Starting...';
            
            await azureVM.startContainer();
            
            btn.disabled = false;
            btn.classList.remove('running');
            btn.textContent = 'Start Container';
            document.getElementById('stopBtn').disabled = false;
        }

        async function stopContainer() {
            const btn = document.getElementById('stopBtn');
            btn.disabled = true;
            
            await azureVM.stopContainer();
            
            btn.disabled = false;
            document.getElementById('startBtn').disabled = false;
        }

        async function testFunction() {
            if (!azureVM.isRunning) {
                addTerminalLine('[Error] Container not running. Start the container first.', 'error');
                return;
            }
            
            const name = document.getElementById('testInput').value || 'World';
            const btn = document.getElementById('testBtn');
            
            btn.disabled = true;
            btn.textContent = 'Sending...';
            
            addTerminalLine(`[Http] POST /api/HttpTrigger - Request received`, 'http');
            addTerminalLine(`[Function] Executing 'HttpTrigger' (Invocation ID: ${azureVM.generateId().slice(0, 8)})`);
            
            try {
                const response = await azureVM.invokeFunction('HttpTrigger', name);
                
                addTerminalLine(`[Function] Executed 'HttpTrigger' (Succeeded)`, 'success');
                addTerminalLine(`[Http] Response: 200 OK`, 'http');
                
                // Display response
                document.getElementById('responseViewer').style.display = 'block';
                document.getElementById('responseContent').textContent = JSON.stringify(response.body, null, 2);
                
                // Update active connections
                azureVM.metrics.activeConnections++;
                document.getElementById('activeConnections').textContent = azureVM.metrics.activeConnections;
                
                setTimeout(() => {
                    azureVM.metrics.activeConnections--;
                    document.getElementById('activeConnections').textContent = azureVM.metrics.activeConnections;
                }, 2000);
                
            } catch (error) {
                addTerminalLine(`[Error] ${error.message}`, 'error');
            }
            
            btn.disabled = false;
            btn.textContent = 'Send Request';
        }

        // Terminal command handler
        document.getElementById('terminalInput').addEventListener('keypress', async function(e) {
            if (e.key === 'Enter') {
                const command = this.value.trim();
                if (command) {
                    addTerminalLine(`azurevm@browser:~$ ${command}`);
                    
                    // Process commands
                    switch(command) {
                        case 'func --version':
                            addTerminalLine('Azure Functions Core Tools 4.0.5455');
                            break;
                        case 'docker ps':
                            if (azureVM.container && azureVM.isRunning) {
                                addTerminalLine(`CONTAINER ID   IMAGE              STATUS`);
                                addTerminalLine(`${azureVM.container.id.slice(0,12)}   azurefunc:latest   running`);
                            } else {
                                addTerminalLine('No containers running');
                            }
                            break;
                        case 'docker images':
                            if (azureVM.dockerImage) {
                                addTerminalLine(`REPOSITORY   TAG      SIZE`);
                                addTerminalLine(`azurefunc    latest   ${azureVM.dockerImage.size}`);
                            } else {
                                addTerminalLine('No images available');
                            }
                            break;
                        case 'func start':
                            if (azureVM.isRunning) {
                                addTerminalLine('Azure Functions host is already running');
                            } else {
                                addTerminalLine('Starting Azure Functions host...');
                                await startContainer();
                            }
                            break;
                        case 'func stop':
                            if (azureVM.isRunning) {
                                await stopContainer();
                            } else {
                                addTerminalLine('No Functions host running');
                            }
                            break;
                        case 'help':
                            addTerminalLine('Available commands:');
                            addTerminalLine('  func --version    Show Azure Functions version');
                            addTerminalLine('  func start        Start Functions runtime');
                            addTerminalLine('  func stop         Stop Functions runtime');
                            addTerminalLine('  docker ps         List running containers');
                            addTerminalLine('  docker images     List Docker images');
                            addTerminalLine('  clear            Clear terminal');
                            break;
                        case 'clear':
                            document.getElementById('terminal').innerHTML = '';
                            break;
                        default:
                            addTerminalLine(`Command not found: ${command}`);
                    }
                    
                    this.value = '';
                }
            }
        });

        // Initialize on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                addTerminalLine('[System] Azure Functions VM initialized');
                addTerminalLine('[System] Click "Build Image" to create Docker container');
                addTerminalLine('[System] Then "Deploy Function" to install Azure Function');
                addTerminalLine('[System] Finally "Start Container" to run the function');
            }, 500);
        });

        // Add some periodic activity for realism
        setInterval(() => {
            if (azureVM.isRunning && Math.random() > 0.7) {
                addTerminalLine(`[Health] Function app health check: Healthy`);
            }
        }, 30000);
    </script>
</body>
</html>
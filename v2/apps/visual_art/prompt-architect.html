<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Prompt Architect: Describe a creative goal and watch multiple AI strategy agents collaborate to generate solutions">
    <!-- ai, creative, prompt, strategy, multi-agent, synthesis, brainstorm -->
    <title>Prompt Architect</title>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --accent-cyan: #00d4ff;
            --accent-magenta: #ff00aa;
            --accent-gold: #ffd700;
            --accent-emerald: #00ff88;
            --accent-violet: #8855ff;
            --accent-coral: #ff6b6b;
            --accent-azure: #0099ff;
            --accent-lime: #88ff00;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --text-dim: #606070;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated background */
        .bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 3rem;
            font-weight: 300;
            letter-spacing: 0.2em;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-magenta), var(--accent-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 300;
        }

        .recursive-badge {
            display: inline-block;
            margin-top: 15px;
            padding: 5px 15px;
            background: rgba(255, 0, 170, 0.1);
            border: 1px solid var(--accent-magenta);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--accent-magenta);
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 0, 170, 0.3); }
            50% { box-shadow: 0 0 25px rgba(255, 0, 170, 0.5); }
        }

        /* Input Section */
        .input-section {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .input-section h2 {
            font-size: 1.2rem;
            font-weight: 400;
            margin-bottom: 20px;
            color: var(--accent-cyan);
        }

        .goal-input {
            width: 100%;
            min-height: 120px;
            background: var(--bg-tertiary);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            color: var(--text-primary);
            font-size: 1.1rem;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .goal-input:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.2);
        }

        .goal-input::placeholder {
            color: var(--text-dim);
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-magenta));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--text-dim);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            border-color: var(--text-primary);
            color: var(--text-primary);
        }

        .agent-count {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
        }

        .agent-count input {
            width: 60px;
            padding: 8px;
            background: var(--bg-tertiary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-primary);
            text-align: center;
            font-size: 1rem;
        }

        /* Agents Grid */
        .agents-section {
            margin-bottom: 30px;
        }

        .agents-section h2 {
            font-size: 1.2rem;
            font-weight: 400;
            margin-bottom: 20px;
            color: var(--accent-gold);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .agent-card {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .agent-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--agent-color);
        }

        .agent-card.thinking {
            animation: thinking-pulse 1.5s infinite;
        }

        @keyframes thinking-pulse {
            0%, 100% { border-color: rgba(255, 255, 255, 0.05); }
            50% { border-color: var(--agent-color); }
        }

        .agent-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .agent-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            background: rgba(255, 255, 255, 0.05);
        }

        .agent-name {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--agent-color);
        }

        .agent-role {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .agent-status {
            margin-left: auto;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-idle {
            background: rgba(96, 96, 112, 0.3);
            color: var(--text-dim);
        }

        .status-thinking {
            background: rgba(0, 212, 255, 0.2);
            color: var(--accent-cyan);
            animation: blink 1s infinite;
        }

        .status-complete {
            background: rgba(0, 255, 136, 0.2);
            color: var(--accent-emerald);
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .agent-thinking {
            min-height: 60px;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .thinking-cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background: var(--agent-color);
            animation: cursor-blink 0.8s infinite;
            vertical-align: middle;
            margin-left: 2px;
        }

        @keyframes cursor-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .agent-output {
            padding: 15px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            border-left: 3px solid var(--agent-color);
            font-size: 0.95rem;
            line-height: 1.7;
            white-space: pre-wrap;
        }

        .agent-output:empty {
            display: none;
        }

        /* Synthesis Section */
        .synthesis-section {
            background: linear-gradient(135deg, rgba(136, 85, 255, 0.1), rgba(255, 0, 170, 0.1));
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(136, 85, 255, 0.3);
            margin-bottom: 30px;
        }

        .synthesis-section h2 {
            font-size: 1.4rem;
            font-weight: 400;
            margin-bottom: 20px;
            color: var(--accent-violet);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .synthesis-content {
            padding: 25px;
            background: var(--bg-secondary);
            border-radius: 15px;
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .synthesis-content:empty::after {
            content: 'Synthesis will appear here after all agents complete their analysis...';
            color: var(--text-dim);
            font-style: italic;
        }

        .synthesis-meta {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .meta-item {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .meta-item span {
            color: var(--accent-gold);
            font-weight: 500;
        }

        /* History Section */
        .history-section {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .history-section h2 {
            font-size: 1.1rem;
            font-weight: 400;
            margin-bottom: 15px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .history-controls {
            display: flex;
            gap: 10px;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .history-goal {
            font-size: 0.95rem;
            margin-bottom: 8px;
            color: var(--text-primary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .history-meta {
            font-size: 0.8rem;
            color: var(--text-dim);
            display: flex;
            gap: 15px;
        }

        /* Loading States */
        .orchestrator-status {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .orchestrator-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border: 3px solid var(--bg-tertiary);
            border-top-color: var(--accent-cyan);
            border-right-color: var(--accent-magenta);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .agents-grid { grid-template-columns: 1fr; }
            .controls { flex-direction: column; }
            .btn { width: 100%; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--bg-tertiary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-dim); }
    </style>
</head>
<body>
    <canvas class="bg-canvas" id="bgCanvas"></canvas>

    <div class="container">
        <header>
            <h1>PROMPT ARCHITECT</h1>
            <p class="subtitle">Multi-Agent Creative Strategy Synthesis</p>
            <div class="recursive-badge">üåÄ Built using its own pattern</div>
        </header>

        <section class="input-section">
            <h2>üìã Describe Your Creative Goal</h2>
            <textarea class="goal-input" id="goalInput" placeholder="Describe what you want to create, solve, or explore...

Example: &quot;Design an interactive data visualization that makes complex climate data emotionally impactful and memorable for general audiences&quot;"></textarea>
            <div class="controls">
                <button class="btn btn-primary" id="launchBtn" onclick="launchAgents()">
                    üöÄ Launch Strategy Agents
                </button>
                <div class="agent-count">
                    <label for="agentCount">Agents:</label>
                    <input type="number" id="agentCount" min="2" max="8" value="5">
                </div>
                <button class="btn btn-secondary" onclick="clearAll()">Clear</button>
            </div>
        </section>

        <section class="agents-section" id="agentsSection" style="display: none;">
            <h2>üß† Strategy Agents <span id="agentProgress"></span></h2>
            <div class="agents-grid" id="agentsGrid"></div>
        </section>

        <section class="synthesis-section" id="synthesisSection" style="display: none;">
            <h2>‚ú® Synthesized Solution</h2>
            <div class="synthesis-content" id="synthesisContent"></div>
            <div class="synthesis-meta" id="synthesisMeta"></div>
        </section>

        <section class="history-section">
            <h2>
                üìö Session History
                <div class="history-controls">
                    <button class="btn btn-secondary" onclick="exportHistory()">Export</button>
                    <button class="btn btn-secondary" onclick="importHistory()">Import</button>
                    <input type="file" id="importFile" style="display: none;" accept=".json" onchange="handleImport(event)">
                </div>
            </h2>
            <div class="history-list" id="historyList"></div>
        </section>
    </div>

    <script>
        // ============================================================
        // STRATEGY AGENT DEFINITIONS
        // Each agent has a unique perspective and approach
        // ============================================================
        const AGENT_ARCHETYPES = [
            {
                id: 'visionary',
                name: 'The Visionary',
                icon: 'üîÆ',
                role: 'Big-picture thinking & future possibilities',
                color: '#8855ff',
                style: 'expansive, imaginative, possibility-focused',
                promptPrefix: 'Think expansively about the ultimate vision. What could this become at its most ambitious? Consider future implications, paradigm shifts, and transformative potential.',
                thinkingPhrases: [
                    'Imagining the full potential...',
                    'Exploring future possibilities...',
                    'Considering paradigm shifts...',
                    'Envisioning transformative outcomes...'
                ]
            },
            {
                id: 'pragmatist',
                name: 'The Pragmatist',
                icon: '‚öôÔ∏è',
                role: 'Practical implementation & feasibility',
                color: '#00d4ff',
                style: 'practical, grounded, implementation-focused',
                promptPrefix: 'Focus on practical implementation. What are the concrete steps? What resources are needed? What can be built right now? Consider constraints and realistic timelines.',
                thinkingPhrases: [
                    'Analyzing feasibility...',
                    'Mapping implementation steps...',
                    'Considering resource constraints...',
                    'Defining actionable next steps...'
                ]
            },
            {
                id: 'critic',
                name: 'The Critic',
                icon: 'üîç',
                role: 'Challenge assumptions & identify risks',
                color: '#ff6b6b',
                style: 'analytical, questioning, risk-aware',
                promptPrefix: 'Challenge every assumption. What could go wrong? What are the hidden risks? What alternatives haven\'t been considered? Play devil\'s advocate constructively.',
                thinkingPhrases: [
                    'Questioning assumptions...',
                    'Identifying potential risks...',
                    'Exploring edge cases...',
                    'Stress-testing the concept...'
                ]
            },
            {
                id: 'humanist',
                name: 'The Humanist',
                icon: 'üíú',
                role: 'User empathy & emotional resonance',
                color: '#ff00aa',
                style: 'empathetic, user-centered, emotionally intelligent',
                promptPrefix: 'Center the human experience. How will people feel using this? What emotional needs does it address? How can it be more inclusive, accessible, and meaningful to diverse users?',
                thinkingPhrases: [
                    'Empathizing with users...',
                    'Considering emotional impact...',
                    'Exploring accessibility needs...',
                    'Understanding diverse perspectives...'
                ]
            },
            {
                id: 'innovator',
                name: 'The Innovator',
                icon: 'üí°',
                role: 'Novel approaches & creative combinations',
                color: '#ffd700',
                style: 'creative, unconventional, synthesis-oriented',
                promptPrefix: 'Think differently. What unexpected combinations could work? What ideas from other fields could apply? Break conventions and propose novel approaches that others might miss.',
                thinkingPhrases: [
                    'Seeking unconventional angles...',
                    'Cross-pollinating ideas...',
                    'Breaking conventional patterns...',
                    'Synthesizing novel approaches...'
                ]
            },
            {
                id: 'minimalist',
                name: 'The Minimalist',
                icon: '‚úÇÔ∏è',
                role: 'Simplification & core essence',
                color: '#00ff88',
                style: 'reductive, essential, clarity-focused',
                promptPrefix: 'Ruthlessly simplify. What is the core essence? What can be removed? Find the elegant, minimal solution that captures maximum value with minimum complexity.',
                thinkingPhrases: [
                    'Distilling to essence...',
                    'Removing unnecessary complexity...',
                    'Finding elegant simplicity...',
                    'Identifying core value...'
                ]
            },
            {
                id: 'systems',
                name: 'The Systems Thinker',
                icon: 'üï∏Ô∏è',
                role: 'Interconnections & emergent properties',
                color: '#0099ff',
                style: 'holistic, interconnected, emergence-aware',
                promptPrefix: 'Map the system. How do parts interact? What feedback loops exist? What emergent properties might arise? Consider the broader ecosystem and second-order effects.',
                thinkingPhrases: [
                    'Mapping interconnections...',
                    'Analyzing feedback loops...',
                    'Considering emergent properties...',
                    'Exploring system dynamics...'
                ]
            },
            {
                id: 'storyteller',
                name: 'The Storyteller',
                icon: 'üìñ',
                role: 'Narrative & meaning-making',
                color: '#88ff00',
                style: 'narrative, meaningful, context-rich',
                promptPrefix: 'Frame the story. What narrative makes this compelling? How does it fit into larger cultural contexts? What meaning does it create? How will it be remembered and shared?',
                thinkingPhrases: [
                    'Crafting the narrative...',
                    'Finding cultural resonance...',
                    'Building memorable framing...',
                    'Connecting to larger meanings...'
                ]
            }
        ];

        // ============================================================
        // STATE MANAGEMENT
        // ============================================================
        let state = {
            currentGoal: '',
            agents: [],
            synthesis: null,
            history: [],
            isRunning: false
        };

        // Load history from localStorage
        function loadHistory() {
            try {
                const saved = localStorage.getItem('promptArchitect_history');
                if (saved) {
                    state.history = JSON.parse(saved);
                    renderHistory();
                }
            } catch (e) {
                console.error('Failed to load history:', e);
            }
        }

        function saveHistory() {
            try {
                localStorage.setItem('promptArchitect_history', JSON.stringify(state.history));
            } catch (e) {
                console.error('Failed to save history:', e);
            }
        }

        // ============================================================
        // AGENT SIMULATION ENGINE
        // Uses procedural generation to create contextual responses
        // ============================================================

        function generateAgentThinking(agent, goal) {
            // Simulate thinking process with contextual phrases
            const phrases = agent.thinkingPhrases;
            return phrases[Math.floor(Math.random() * phrases.length)];
        }

        function generateAgentResponse(agent, goal) {
            // This simulates what each agent archetype would produce
            // In a real implementation, this would call an LLM API

            const templates = {
                visionary: [
                    `**Vision Statement**: ${goal} represents an opportunity to fundamentally transform how people experience this domain.\n\n**Transformative Potential**:\n‚Ä¢ This could evolve into a platform that ${generateExpansion(goal)}\n‚Ä¢ The ultimate vision extends beyond the immediate goal to ${generateVision(goal)}\n‚Ä¢ Consider the paradigm shift: what if this became the new standard?\n\n**Future Implications**: As this matures, expect convergence with ${generateTrend()}, creating unprecedented possibilities for ${generateImpact(goal)}.`,
                    `**Ambitious Scope**: Imagine this at scale‚Äî${generateScale(goal)}.\n\n**Revolutionary Elements**:\n‚Ä¢ Break from convention by ${generateBreakthrough(goal)}\n‚Ä¢ The 10x version of this would ${generateTenX(goal)}\n\n**North Star**: The ultimate measure of success is ${generateNorthStar(goal)}.`
                ],
                pragmatist: [
                    `**Implementation Roadmap**:\n\n**Phase 1 - Foundation** (Immediate):\n‚Ä¢ ${generateStep(goal, 1)}\n‚Ä¢ ${generateStep(goal, 2)}\n‚Ä¢ Deliverable: Working prototype\n\n**Phase 2 - Core Features**:\n‚Ä¢ ${generateStep(goal, 3)}\n‚Ä¢ ${generateStep(goal, 4)}\n‚Ä¢ Deliverable: Feature-complete MVP\n\n**Resources Required**: ${generateResources(goal)}\n\n**Key Dependencies**: ${generateDependencies(goal)}`,
                    `**Practical Assessment**:\n\n**What We Can Build Now**:\n‚Ä¢ ${generateQuickWin(goal)}\n‚Ä¢ Estimated effort: ${generateEffort()}\n\n**Technical Considerations**:\n‚Ä¢ ${generateTechnical(goal)}\n‚Ä¢ Recommended approach: ${generateApproach(goal)}\n\n**Success Metrics**: ${generateMetrics(goal)}`
                ],
                critic: [
                    `**Critical Analysis**:\n\n**Assumptions to Challenge**:\n‚Ä¢ Are we certain that ${generateAssumption(goal)}?\n‚Ä¢ What if ${generateCounterfactual(goal)}?\n\n**Potential Risks**:\n‚Ä¢ ‚ö†Ô∏è ${generateRisk(goal, 'high')}\n‚Ä¢ ‚ö†Ô∏è ${generateRisk(goal, 'medium')}\n\n**Blind Spots**: Consider whether ${generateBlindSpot(goal)}\n\n**Alternative Perspective**: What if we approached this as ${generateAlternative(goal)} instead?`,
                    `**Devil's Advocate Position**:\n\n**Why This Might Fail**:\n‚Ä¢ ${generateFailureMode(goal)}\n‚Ä¢ ${generateFailureMode(goal)}\n\n**Questions That Need Answers**:\n‚Ä¢ ${generateCriticalQuestion(goal)}\n‚Ä¢ ${generateCriticalQuestion(goal)}\n\n**Recommended Safeguards**: ${generateSafeguards(goal)}`
                ],
                humanist: [
                    `**Human-Centered Analysis**:\n\n**User Emotional Journey**:\n‚Ä¢ Initial feeling: ${generateEmotion('initial')}\n‚Ä¢ During use: ${generateEmotion('during')}\n‚Ä¢ After completion: ${generateEmotion('after')}\n\n**Accessibility Considerations**:\n‚Ä¢ ${generateAccessibility(goal)}\n‚Ä¢ Ensure support for ${generateInclusion()}\n\n**Deeper Needs Addressed**: Beyond the surface goal, this serves the human need for ${generateDeepNeed(goal)}\n\n**Empathy Insight**: Users in this context are often ${generateUserContext(goal)}`,
                    `**Emotional Resonance Design**:\n\n**What Makes This Meaningful**:\n‚Ä¢ ${generateMeaning(goal)}\n\n**Diverse Perspectives**:\n‚Ä¢ For ${generatePersona(1)}: ${generatePersonaNeeds(goal, 1)}\n‚Ä¢ For ${generatePersona(2)}: ${generatePersonaNeeds(goal, 2)}\n\n**Trust Building**: ${generateTrust(goal)}`
                ],
                innovator: [
                    `**Creative Synthesis**:\n\n**Unexpected Combinations**:\n‚Ä¢ What if we merged ${generateDomain(1)} with ${generateDomain(2)}?\n‚Ä¢ Borrow the pattern of ${generatePattern()} and apply it here\n\n**Breaking Conventions**:\n‚Ä¢ Instead of ${generateConvention(goal)}, what if we ${generateInversion(goal)}?\n\n**Cross-Domain Inspiration**: The ${generateIndustry()} industry solved a similar problem by ${generateCrossInspiration(goal)}\n\n**Wild Idea Worth Exploring**: ${generateWildIdea(goal)}`,
                    `**Novel Approaches**:\n\n**Reframe the Problem**: What if this isn't about ${generateReframe(goal, 'from')} but about ${generateReframe(goal, 'to')}?\n\n**Combinatorial Innovation**:\n‚Ä¢ ${generateCombination(goal)}\n\n**Counter-Intuitive Insight**: ${generateCounterIntuitive(goal)}`
                ],
                minimalist: [
                    `**Essential Core**:\n\n**The One Thing That Matters**: ${generateCore(goal)}\n\n**What to Remove**:\n‚Ä¢ ‚ùå ${generateRemoval(goal, 1)}\n‚Ä¢ ‚ùå ${generateRemoval(goal, 2)}\n‚Ä¢ ‚ùå ${generateRemoval(goal, 3)}\n\n**Elegant Solution**: The simplest version that still works is ${generateSimplest(goal)}\n\n**Complexity Check**: Every addition must answer: "Does this serve ${generateCoreNeed(goal)}?"`,
                    `**Minimalist Lens**:\n\n**Core Value Proposition** (one sentence): ${generateOneSentence(goal)}\n\n**80/20 Analysis**: ${generatePareto(goal)}\n\n**Design Principle**: ${generatePrinciple(goal)}\n\n**Anti-Goals** (explicitly not doing): ${generateAntiGoals(goal)}`
                ],
                systems: [
                    `**Systems Map**:\n\n**Key Interconnections**:\n‚Ä¢ ${generateConnection(goal, 1)} ‚Üî ${generateConnection(goal, 2)}\n‚Ä¢ ${generateConnection(goal, 3)} ‚Üí ${generateConnection(goal, 4)}\n\n**Feedback Loops**:\n‚Ä¢ Reinforcing: ${generateFeedbackLoop(goal, 'reinforcing')}\n‚Ä¢ Balancing: ${generateFeedbackLoop(goal, 'balancing')}\n\n**Emergent Properties**: As the system matures, expect ${generateEmergence(goal)}\n\n**Second-Order Effects**: ${generateSecondOrder(goal)}`,
                    `**Ecosystem Analysis**:\n\n**Stakeholder Map**:\n‚Ä¢ ${generateStakeholder(goal, 1)}: ${generateStakeholderInterest(goal, 1)}\n‚Ä¢ ${generateStakeholder(goal, 2)}: ${generateStakeholderInterest(goal, 2)}\n\n**Dependencies & Flows**: ${generateFlows(goal)}\n\n**Leverage Points**: Maximum impact from ${generateLeveragePoint(goal)}`
                ],
                storyteller: [
                    `**Narrative Framework**:\n\n**The Story**: ${generateStoryHook(goal)}\n\n**Character Arc**: The user journey from ${generateJourneyStart(goal)} to ${generateJourneyEnd(goal)}\n\n**Cultural Context**: This resonates because ${generateCulturalResonance(goal)}\n\n**Memorable Framing**: Think of it as "${generateMetaphor(goal)}"\n\n**Shareability**: People will talk about this because ${generateShareability(goal)}`,
                    `**Meaning-Making**:\n\n**Why This Matters**: ${generateWhy(goal)}\n\n**Origin Story**: This began because ${generateOrigin(goal)}\n\n**The Transformation**: Before/After of ${generateTransformation(goal)}\n\n**Legacy**: This will be remembered as ${generateLegacy(goal)}`
                ]
            };

            const agentTemplates = templates[agent.id] || templates.visionary;
            return agentTemplates[Math.floor(Math.random() * agentTemplates.length)];
        }

        // Procedural content generation helpers
        function generateExpansion(goal) {
            const expansions = [
                `enables entirely new workflows`,
                `creates a new category of tools`,
                `democratizes access to sophisticated capabilities`,
                `bridges previously disconnected domains`,
                `unlocks latent potential in existing systems`
            ];
            return expansions[Math.floor(Math.random() * expansions.length)];
        }

        function generateVision(goal) {
            const visions = [
                `redefining how communities collaborate`,
                `establishing new standards of excellence`,
                `creating ripple effects across adjacent fields`,
                `enabling previously impossible combinations`,
                `shifting fundamental assumptions`
            ];
            return visions[Math.floor(Math.random() * visions.length)];
        }

        function generateTrend() {
            const trends = ['AI-augmented workflows', 'spatial computing', 'collective intelligence platforms', 'ambient computing', 'regenerative design', 'decentralized systems'];
            return trends[Math.floor(Math.random() * trends.length)];
        }

        function generateImpact(goal) {
            const impacts = ['creative expression', 'human connection', 'knowledge synthesis', 'problem-solving', 'shared understanding'];
            return impacts[Math.floor(Math.random() * impacts.length)];
        }

        function generateScale(goal) {
            const scales = [
                'millions using this daily to transform their work',
                'an entire ecosystem built around this core idea',
                'industry-wide adoption as the new standard',
                'a movement that changes how we think about this domain'
            ];
            return scales[Math.floor(Math.random() * scales.length)];
        }

        function generateBreakthrough(goal) {
            const breakthroughs = [
                'eliminating friction that everyone assumed was necessary',
                'inverting the traditional power dynamics',
                'making the implicit explicit and actionable',
                'collapsing multiple steps into one elegant interaction'
            ];
            return breakthroughs[Math.floor(Math.random() * breakthroughs.length)];
        }

        function generateTenX(goal) {
            return 'fundamentally change expectations of what\'s possible in this space';
        }

        function generateNorthStar(goal) {
            const stars = [
                'people can\'t imagine going back to the old way',
                'the approach becomes invisible because it just works',
                'new possibilities emerge that weren\'t originally conceived',
                'users become advocates who spread the approach organically'
            ];
            return stars[Math.floor(Math.random() * stars.length)];
        }

        function generateStep(goal, n) {
            const steps = [
                'Define core data structures and interfaces',
                'Build minimal working prototype',
                'Implement primary user interaction flow',
                'Add persistence and state management',
                'Integrate feedback mechanisms',
                'Polish user experience details',
                'Set up testing and validation',
                'Document key decisions and patterns'
            ];
            return steps[(n - 1) % steps.length];
        }

        function generateResources(goal) {
            return 'Development time, design expertise, user testing participants, and iteration cycles';
        }

        function generateDependencies(goal) {
            return 'Clear requirements, stakeholder alignment, and access to representative users';
        }

        function generateQuickWin(goal) {
            return 'A focused prototype demonstrating the core value proposition';
        }

        function generateEffort() {
            const efforts = ['Moderate (focused sprint)', 'Significant (dedicated project)', 'Substantial (major initiative)'];
            return efforts[Math.floor(Math.random() * efforts.length)];
        }

        function generateTechnical(goal) {
            return 'Consider scalability, maintainability, and future extensibility from the start';
        }

        function generateApproach(goal) {
            const approaches = ['Iterative development with rapid feedback loops', 'Component-based architecture for flexibility', 'Event-driven design for responsiveness'];
            return approaches[Math.floor(Math.random() * approaches.length)];
        }

        function generateMetrics(goal) {
            return 'Engagement depth, task completion rate, and user satisfaction scores';
        }

        function generateAssumption(goal) {
            return 'users actually want this level of sophistication';
        }

        function generateCounterfactual(goal) {
            return 'the real problem is something entirely different';
        }

        function generateRisk(goal, level) {
            const risks = {
                high: ['Overengineering beyond actual user needs', 'Solving a problem that doesn\'t exist', 'Complexity that prevents adoption'],
                medium: ['Scope creep diluting the core value', 'Technical debt accumulating too fast', 'Missing the timing window']
            };
            return risks[level][Math.floor(Math.random() * risks[level].length)];
        }

        function generateBlindSpot(goal) {
            return 'we\'re solving for users like ourselves rather than the actual target audience';
        }

        function generateAlternative(goal) {
            return 'a service rather than a product';
        }

        function generateFailureMode(goal) {
            const modes = [
                'Users find it too complex to adopt',
                'The value proposition isn\'t immediately clear',
                'Existing habits prove too entrenched to change',
                'Edge cases undermine the core experience'
            ];
            return modes[Math.floor(Math.random() * modes.length)];
        }

        function generateCriticalQuestion(goal) {
            const questions = [
                'Who exactly is this for, and have we validated their actual needs?',
                'What happens when this fails‚Äîis the failure mode acceptable?',
                'Are we building what\'s needed or what\'s interesting to us?',
                'What would make users abandon this?'
            ];
            return questions[Math.floor(Math.random() * questions.length)];
        }

        function generateSafeguards(goal) {
            return 'Early user testing, explicit success criteria, and predetermined pivot points';
        }

        function generateEmotion(phase) {
            const emotions = {
                initial: ['Curious but slightly skeptical', 'Hopeful with cautious optimism', 'Intrigued by the possibilities'],
                during: ['Engaged and increasingly confident', 'Focused with moments of delight', 'Immersed in productive flow'],
                after: ['Satisfied and empowered', 'Eager to return and explore more', 'Proud of what they\'ve accomplished']
            };
            return emotions[phase][Math.floor(Math.random() * emotions[phase].length)];
        }

        function generateAccessibility(goal) {
            return 'Ensure keyboard navigation, screen reader support, and color-blind friendly design';
        }

        function generateInclusion() {
            const groups = ['non-native speakers', 'users with motor impairments', 'those on slow connections', 'people new to this domain'];
            return groups[Math.floor(Math.random() * groups.length)];
        }

        function generateDeepNeed(goal) {
            const needs = ['autonomy and self-efficacy', 'connection and belonging', 'mastery and growth', 'meaning and purpose'];
            return needs[Math.floor(Math.random() * needs.length)];
        }

        function generateUserContext(goal) {
            return 'juggling multiple priorities and appreciate clarity and respect for their time';
        }

        function generateMeaning(goal) {
            return 'It gives users a sense of capability they didn\'t have before';
        }

        function generatePersona(n) {
            const personas = ['newcomers', 'power users', 'occasional visitors', 'experts', 'time-constrained professionals'];
            return personas[n % personas.length];
        }

        function generatePersonaNeeds(goal, n) {
            const needs = ['needs clear onboarding and guidance', 'wants depth and efficiency', 'requires immediate value without setup'];
            return needs[n % needs.length];
        }

        function generateTrust(goal) {
            return 'Transparency about how it works and respect for user data and attention';
        }

        function generateDomain(n) {
            const domains = ['game design', 'music composition', 'scientific visualization', 'social dynamics', 'architecture', 'journalism'];
            return domains[n % domains.length];
        }

        function generatePattern() {
            const patterns = ['progressive disclosure', 'emergent gameplay', 'ambient awareness', 'social proof', 'spaced repetition'];
            return patterns[Math.floor(Math.random() * patterns.length)];
        }

        function generateConvention(goal) {
            return 'following the traditional linear approach';
        }

        function generateInversion(goal) {
            return 'start from the desired outcome and work backward';
        }

        function generateIndustry() {
            const industries = ['gaming', 'healthcare', 'education', 'finance', 'entertainment', 'logistics'];
            return industries[Math.floor(Math.random() * industries.length)];
        }

        function generateCrossInspiration(goal) {
            return 'making complexity feel like play rather than work';
        }

        function generateWildIdea(goal) {
            return 'What if the entire interface was generated dynamically based on user behavior patterns?';
        }

        function generateReframe(goal, direction) {
            if (direction === 'from') return 'building a tool';
            return 'creating an environment where good things happen naturally';
        }

        function generateCombination(goal) {
            return 'Combine the immediacy of games with the depth of professional tools';
        }

        function generateCounterIntuitive(goal) {
            return 'Sometimes adding friction in strategic places improves the overall experience';
        }

        function generateCore(goal) {
            return 'The single capability that, if removed, would make everything else pointless';
        }

        function generateRemoval(goal, n) {
            const removals = [
                'Features that serve edge cases at the expense of the core experience',
                'Options that create decision fatigue without meaningful benefit',
                'Complexity that exists to satisfy internal stakeholders rather than users',
                'Historical artifacts that no longer serve the current vision'
            ];
            return removals[n % removals.length];
        }

        function generateSimplest(goal) {
            return 'A single screen with one clear action and immediate feedback';
        }

        function generateCoreNeed(goal) {
            return 'the primary user need we identified';
        }

        function generateOneSentence(goal) {
            return 'Help people accomplish ' + goal.split(' ').slice(0, 5).join(' ') + ' effortlessly.';
        }

        function generatePareto(goal) {
            return '20% of features will deliver 80% of the value‚Äîidentify and perfect those first';
        }

        function generatePrinciple(goal) {
            return 'When in doubt, remove rather than add';
        }

        function generateAntiGoals(goal) {
            return 'Trying to be everything to everyone; competing on features rather than experience';
        }

        function generateConnection(goal, n) {
            const connections = ['user actions', 'system state', 'external data', 'feedback loops', 'other users', 'historical patterns'];
            return connections[n % connections.length];
        }

        function generateFeedbackLoop(goal, type) {
            if (type === 'reinforcing') return 'Positive experiences lead to more engagement, which creates more positive experiences';
            return 'Complexity triggers simplification needs, which reduces complexity';
        }

        function generateEmergence(goal) {
            return 'unexpected use patterns and community-driven extensions';
        }

        function generateSecondOrder(goal) {
            return 'Changes in user expectations will affect adjacent tools and workflows';
        }

        function generateStakeholder(goal, n) {
            const stakeholders = ['End users', 'Content creators', 'Administrators', 'Support teams', 'External partners'];
            return stakeholders[n % stakeholders.length];
        }

        function generateStakeholderInterest(goal, n) {
            const interests = ['Need efficiency and clarity', 'Want creative control', 'Require oversight and metrics', 'Need troubleshooting access'];
            return interests[n % interests.length];
        }

        function generateFlows(goal) {
            return 'Information flows from input to processing to output, with feedback at each stage';
        }

        function generateLeveragePoint(goal) {
            return 'improving the quality of feedback at critical decision points';
        }

        function generateStoryHook(goal) {
            return 'In a world where ' + goal.split(' ').slice(0, 4).join(' ') + ' was frustrating, a new approach emerged...';
        }

        function generateJourneyStart(goal) {
            return 'uncertainty and fragmented efforts';
        }

        function generateJourneyEnd(goal) {
            return 'confident mastery and expanded capability';
        }

        function generateCulturalResonance(goal) {
            return 'it taps into the current moment\'s hunger for authentic, empowering tools';
        }

        function generateMetaphor(goal) {
            const metaphors = ['a GPS for creative decisions', 'a conversation with your future self', 'a sandbox with guardrails', 'a mirror that shows possibilities'];
            return metaphors[Math.floor(Math.random() * metaphors.length)];
        }

        function generateShareability(goal) {
            return 'it makes them look thoughtful and capable to their peers';
        }

        function generateWhy(goal) {
            return 'Because the current alternatives fail to respect both the complexity of the problem and the intelligence of the user';
        }

        function generateOrigin(goal) {
            return 'someone noticed the gap between what was possible and what was available';
        }

        function generateTransformation(goal) {
            return 'scattered attempts ‚Üí focused, effective action';
        }

        function generateLegacy(goal) {
            return 'the moment when this domain became accessible to everyone';
        }

        // ============================================================
        // SYNTHESIS ENGINE
        // Combines agent outputs into unified recommendations
        // ============================================================

        function generateSynthesis(agents, goal) {
            const hasVision = agents.some(a => a.id === 'visionary');
            const hasPragmatic = agents.some(a => a.id === 'pragmatist');
            const hasCritic = agents.some(a => a.id === 'critic');
            const hasHumanist = agents.some(a => a.id === 'humanist');
            const hasInnovator = agents.some(a => a.id === 'innovator');
            const hasMinimalist = agents.some(a => a.id === 'minimalist');
            const hasSystems = agents.some(a => a.id === 'systems');
            const hasStoryteller = agents.some(a => a.id === 'storyteller');

            let synthesis = `## Synthesized Recommendation\n\n`;
            synthesis += `**Goal**: ${goal}\n\n`;
            synthesis += `---\n\n`;

            synthesis += `### üéØ Core Direction\n`;
            synthesis += `Based on ${agents.length} strategy perspectives, the recommended approach balances `;

            const balances = [];
            if (hasVision) balances.push('ambitious vision');
            if (hasPragmatic) balances.push('practical implementation');
            if (hasHumanist) balances.push('human-centered design');
            if (hasMinimalist) balances.push('elegant simplicity');

            synthesis += balances.slice(0, 3).join(', ') + '.\n\n';

            synthesis += `### ‚úÖ Consensus Points\n`;
            synthesis += `The agents agree on these key elements:\n`;
            synthesis += `‚Ä¢ **Start focused**: Begin with a minimal viable concept that demonstrates core value\n`;
            synthesis += `‚Ä¢ **User validation early**: Test assumptions with real users before scaling\n`;
            synthesis += `‚Ä¢ **Iterate on feedback**: Build in mechanisms for rapid learning and adjustment\n\n`;

            synthesis += `### ‚öñÔ∏è Key Tensions to Navigate\n`;
            if (hasVision && hasMinimalist) {
                synthesis += `‚Ä¢ **Ambition vs. Simplicity**: The vision is expansive, but execution should be ruthlessly focused\n`;
            }
            if (hasCritic && hasInnovator) {
                synthesis += `‚Ä¢ **Risk Awareness vs. Innovation**: Novel approaches need safeguards, not avoidance\n`;
            }
            if (hasPragmatic && hasStoryteller) {
                synthesis += `‚Ä¢ **Implementation vs. Meaning**: Technical decisions should serve the larger narrative\n`;
            }
            synthesis += `\n`;

            synthesis += `### üöÄ Recommended Next Steps\n`;
            synthesis += `1. **Define the core**: Identify the single most important capability\n`;
            synthesis += `2. **Build smallest proof**: Create a minimal prototype that demonstrates that core\n`;
            synthesis += `3. **Test with humans**: Get real feedback from representative users\n`;
            synthesis += `4. **Iterate with intention**: Expand based on validated learning, not assumptions\n\n`;

            synthesis += `### üí° Unique Insight\n`;
            synthesis += `This analysis suggests that "${goal}" is fundamentally about `;
            const insights = [
                'creating a new relationship between users and their capabilities',
                'making visible what was previously hidden or fragmented',
                'bridging the gap between intention and outcome',
                'empowering users to express something they couldn\'t before'
            ];
            synthesis += insights[Math.floor(Math.random() * insights.length)] + '.\n';

            return synthesis;
        }

        // ============================================================
        // UI RENDERING
        // ============================================================

        function renderAgentCards(agents) {
            const grid = document.getElementById('agentsGrid');
            grid.innerHTML = agents.map(agent => `
                <div class="agent-card" id="agent-${agent.id}" style="--agent-color: ${agent.color}">
                    <div class="agent-header">
                        <div class="agent-icon">${agent.icon}</div>
                        <div>
                            <div class="agent-name">${agent.name}</div>
                            <div class="agent-role">${agent.role}</div>
                        </div>
                        <div class="agent-status status-idle" id="status-${agent.id}">Idle</div>
                    </div>
                    <div class="agent-thinking" id="thinking-${agent.id}">
                        <em>Waiting to begin analysis...</em>
                    </div>
                    <div class="agent-output" id="output-${agent.id}"></div>
                </div>
            `).join('');
        }

        function updateAgentStatus(agentId, status, text) {
            const statusEl = document.getElementById(`status-${agentId}`);
            const thinkingEl = document.getElementById(`thinking-${agentId}`);
            const cardEl = document.getElementById(`agent-${agentId}`);

            statusEl.className = `agent-status status-${status}`;
            statusEl.textContent = status.charAt(0).toUpperCase() + status.slice(1);

            if (status === 'thinking') {
                cardEl.classList.add('thinking');
                thinkingEl.innerHTML = `${text}<span class="thinking-cursor"></span>`;
            } else {
                cardEl.classList.remove('thinking');
                if (status === 'complete') {
                    thinkingEl.innerHTML = `<em>Analysis complete</em>`;
                }
            }
        }

        function setAgentOutput(agentId, output) {
            document.getElementById(`output-${agentId}`).textContent = output;
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            if (state.history.length === 0) {
                list.innerHTML = '<p style="color: var(--text-dim); padding: 20px; text-align: center;">No history yet. Launch some agents to get started!</p>';
                return;
            }

            list.innerHTML = state.history.slice().reverse().map((item, i) => `
                <div class="history-item" onclick="loadHistoryItem(${state.history.length - 1 - i})">
                    <div class="history-goal">${item.goal}</div>
                    <div class="history-meta">
                        <span>ü§ñ ${item.agentCount} agents</span>
                        <span>üìÖ ${new Date(item.timestamp).toLocaleDateString()}</span>
                    </div>
                </div>
            `).join('');
        }

        function loadHistoryItem(index) {
            const item = state.history[index];
            if (!item) return;

            document.getElementById('goalInput').value = item.goal;
            document.getElementById('agentCount').value = item.agentCount;

            // Restore agents display
            document.getElementById('agentsSection').style.display = 'block';
            renderAgentCards(item.agents);
            item.agents.forEach(agent => {
                updateAgentStatus(agent.id, 'complete', '');
                setAgentOutput(agent.id, agent.output);
            });

            // Restore synthesis
            document.getElementById('synthesisSection').style.display = 'block';
            document.getElementById('synthesisContent').innerHTML = formatMarkdown(item.synthesis);
            document.getElementById('synthesisMeta').innerHTML = `
                <div class="meta-item">Agents: <span>${item.agentCount}</span></div>
                <div class="meta-item">Generated: <span>${new Date(item.timestamp).toLocaleString()}</span></div>
            `;
        }

        function formatMarkdown(text) {
            // Simple markdown formatting
            return text
                .replace(/^## (.*$)/gm, '<h3>$1</h3>')
                .replace(/^### (.*$)/gm, '<h4>$1</h4>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/^‚Ä¢ (.*$)/gm, '<li>$1</li>')
                .replace(/^(\d+)\. (.*$)/gm, '<li>$2</li>')
                .replace(/---/g, '<hr>')
                .replace(/\n\n/g, '<br><br>');
        }

        // ============================================================
        // MAIN ORCHESTRATION
        // ============================================================

        async function launchAgents() {
            const goal = document.getElementById('goalInput').value.trim();
            if (!goal) {
                document.getElementById('goalInput').focus();
                return;
            }

            const agentCount = parseInt(document.getElementById('agentCount').value) || 5;

            // Disable button
            const btn = document.getElementById('launchBtn');
            btn.disabled = true;
            btn.textContent = 'üîÑ Processing...';
            state.isRunning = true;

            // Select random agents
            const selectedAgents = [...AGENT_ARCHETYPES]
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(agentCount, AGENT_ARCHETYPES.length));

            state.currentGoal = goal;
            state.agents = selectedAgents.map(a => ({ ...a, output: '' }));

            // Show agents section
            document.getElementById('agentsSection').style.display = 'block';
            document.getElementById('agentProgress').textContent = `(0/${selectedAgents.length} complete)`;
            renderAgentCards(selectedAgents);

            // Hide synthesis until ready
            document.getElementById('synthesisSection').style.display = 'none';

            // Process each agent with staggered timing for visual effect
            let completed = 0;
            const agentPromises = selectedAgents.map((agent, index) => {
                return new Promise(async (resolve) => {
                    // Stagger start times
                    await sleep(index * 800 + Math.random() * 500);

                    // Thinking phase
                    updateAgentStatus(agent.id, 'thinking', generateAgentThinking(agent, goal));

                    // Simulate thinking time
                    const thinkTime = 2000 + Math.random() * 3000;
                    for (let t = 0; t < thinkTime; t += 1000) {
                        await sleep(1000);
                        if (Math.random() > 0.5) {
                            updateAgentStatus(agent.id, 'thinking', generateAgentThinking(agent, goal));
                        }
                    }

                    // Generate output
                    const output = generateAgentResponse(agent, goal);
                    state.agents.find(a => a.id === agent.id).output = output;

                    // Type out the output for effect
                    await typewriterEffect(`output-${agent.id}`, output, 10);

                    updateAgentStatus(agent.id, 'complete', '');
                    completed++;
                    document.getElementById('agentProgress').textContent = `(${completed}/${selectedAgents.length} complete)`;

                    resolve();
                });
            });

            // Wait for all agents
            await Promise.all(agentPromises);

            // Generate synthesis
            const synthesis = generateSynthesis(state.agents, goal);
            state.synthesis = synthesis;

            document.getElementById('synthesisSection').style.display = 'block';
            await typewriterEffect('synthesisContent', formatMarkdown(synthesis), 5);

            document.getElementById('synthesisMeta').innerHTML = `
                <div class="meta-item">Agents: <span>${agentCount}</span></div>
                <div class="meta-item">Generated: <span>${new Date().toLocaleString()}</span></div>
            `;

            // Save to history
            state.history.push({
                goal,
                agentCount,
                agents: state.agents.map(a => ({ id: a.id, name: a.name, icon: a.icon, color: a.color, output: a.output })),
                synthesis,
                timestamp: Date.now()
            });
            saveHistory();
            renderHistory();

            // Re-enable button
            btn.disabled = false;
            btn.textContent = 'üöÄ Launch Strategy Agents';
            state.isRunning = false;
        }

        async function typewriterEffect(elementId, text, speed = 10) {
            const el = document.getElementById(elementId);
            el.innerHTML = '';

            // For HTML content, parse and add progressively
            if (text.includes('<')) {
                el.innerHTML = text;
                return;
            }

            for (let i = 0; i < text.length; i++) {
                el.textContent += text[i];
                if (i % 5 === 0) await sleep(speed);
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function clearAll() {
            document.getElementById('goalInput').value = '';
            document.getElementById('agentsSection').style.display = 'none';
            document.getElementById('synthesisSection').style.display = 'none';
            state.agents = [];
            state.synthesis = null;
        }

        function exportHistory() {
            const data = {
                version: '1.0',
                exported: new Date().toISOString(),
                history: state.history
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `prompt-architect-history-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importHistory() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.history && Array.isArray(data.history)) {
                        state.history = [...state.history, ...data.history];
                        saveHistory();
                        renderHistory();
                        alert(`Imported ${data.history.length} sessions!`);
                    }
                } catch (err) {
                    alert('Failed to import: Invalid file format');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // ============================================================
        // ANIMATED BACKGROUND
        // ============================================================

        function initBackground() {
            const canvas = document.getElementById('bgCanvas');
            const ctx = canvas.getContext('2d');

            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            resize();
            window.addEventListener('resize', resize);

            const particles = [];
            const connections = [];

            // Create particles representing "agents"
            for (let i = 0; i < 30; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    radius: Math.random() * 3 + 2,
                    color: AGENT_ARCHETYPES[i % AGENT_ARCHETYPES.length].color
                });
            }

            function animate() {
                ctx.fillStyle = 'rgba(10, 10, 15, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Update and draw particles
                particles.forEach((p, i) => {
                    p.x += p.vx;
                    p.y += p.vy;

                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fillStyle = p.color + '40';
                    ctx.fill();

                    // Draw connections
                    particles.forEach((p2, j) => {
                        if (i >= j) return;
                        const dx = p.x - p2.x;
                        const dy = p.y - p2.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        if (dist < 150) {
                            ctx.beginPath();
                            ctx.moveTo(p.x, p.y);
                            ctx.lineTo(p2.x, p2.y);
                            ctx.strokeStyle = `rgba(255, 255, 255, ${0.1 * (1 - dist / 150)})`;
                            ctx.stroke();
                        }
                    });
                });

                requestAnimationFrame(animate);
            }
            animate();
        }

        // ============================================================
        // INITIALIZATION
        // ============================================================

        document.addEventListener('DOMContentLoaded', () => {
            loadHistory();
            initBackground();

            // Keyboard shortcut
            document.getElementById('goalInput').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {
                    launchAgents();
                }
            });
        });
    </script>
</body>
</html>

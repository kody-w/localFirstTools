<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Oracle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: #0a0a0f;
            color: #c0c0c0;
            font-family: Georgia, 'Times New Roman', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: hidden;
        }

        .container {
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 {
            font-size: clamp(2rem, 8vw, 3.5rem);
            font-weight: 300;
            letter-spacing: 0.3em;
            margin-bottom: 60px;
            color: #e0e0e0;
            text-transform: uppercase;
        }

        .input-area {
            position: relative;
            margin-bottom: 40px;
        }

        textarea {
            width: 100%;
            height: 100px;
            background: transparent;
            border: 1px solid #333;
            border-radius: 4px;
            color: #e0e0e0;
            font-family: inherit;
            font-size: 1.1rem;
            padding: 20px;
            resize: none;
            outline: none;
            transition: border-color 0.3s;
        }

        textarea:focus {
            border-color: #555;
        }

        textarea::placeholder {
            color: #444;
            font-style: italic;
        }

        .ask-btn {
            background: transparent;
            border: 1px solid #444;
            color: #888;
            padding: 12px 40px;
            font-family: inherit;
            font-size: 1rem;
            letter-spacing: 0.2em;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .ask-btn:hover {
            border-color: #666;
            color: #aaa;
        }

        .response-area {
            min-height: 150px;
            padding: 30px;
            margin-top: 20px;
        }

        .response {
            font-size: 1.3rem;
            line-height: 1.8;
            font-style: italic;
            color: #a0a0b0;
            opacity: 0;
            transition: opacity 0.8s;
        }

        .response.visible {
            opacity: 1;
        }

        .response.degraded {
            color: #606070;
        }

        .response.failing {
            color: #404050;
        }

        .response.collapsed {
            color: #252530;
        }

        .whisper {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.85rem;
            color: #333;
            font-style: italic;
            transition: opacity 0.5s;
            text-align: center;
            max-width: 80%;
        }

        .data-controls {
            position: fixed;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .data-controls button {
            background: transparent;
            border: 1px solid #222;
            color: #444;
            padding: 6px 12px;
            font-size: 0.75rem;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
        }

        .data-controls button:hover {
            border-color: #444;
            color: #666;
        }

        #importFile {
            display: none;
        }

        .veil {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a0f;
            opacity: 0;
            pointer-events: none;
            transition: opacity 2s;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .veil.active {
            opacity: 1;
            pointer-events: auto;
        }

        .veil-text {
            font-size: 1.2rem;
            color: #333;
            text-align: center;
            line-height: 2;
            max-width: 500px;
            padding: 20px;
        }

        .return-link {
            color: #444;
            text-decoration: none;
            font-size: 0.9rem;
            margin-top: 40px;
            display: inline-block;
            border-bottom: 1px solid #333;
            padding-bottom: 2px;
            transition: all 0.3s;
        }

        .return-link:hover {
            color: #666;
            border-color: #555;
        }

        @keyframes subtle-pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 0.8; }
        }

        .thinking {
            animation: subtle-pulse 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="data-controls">
        <button onclick="exportData()">Export</button>
        <button onclick="document.getElementById('importFile').click()">Import</button>
        <input type="file" id="importFile" accept=".json" onchange="importData(event)">
    </div>

    <div class="container">
        <h1>The Oracle</h1>

        <div class="input-area">
            <textarea id="question" placeholder="Ask what you truly wish to know..."></textarea>
            <button class="ask-btn" onclick="ask()">Ask</button>
        </div>

        <div class="response-area">
            <div id="response" class="response"></div>
        </div>
    </div>

    <div id="whisper" class="whisper"></div>

    <div id="veil" class="veil">
        <div class="veil-text">
            <p>The eye that seeks to see itself sees nothing.</p>
            <br><br>
            <p>You looked too closely.</p>
            <br><br>
            <a href="#" class="return-link" onclick="resetOracle(); return false;">Begin again, with softer eyes</a>
        </div>
    </div>

    <script>
        const APP_KEY = 'oracle-paradox';

        // State
        let state = {
            queries: [],
            suspicion: 0,
            collapsed: false,
            testPatterns: [],
            lastQueryTime: 0,
            rapidQueries: 0
        };

        // Load state
        function loadState() {
            try {
                const saved = localStorage.getItem(APP_KEY);
                if (saved) {
                    state = JSON.parse(saved);
                    if (state.collapsed) {
                        document.getElementById('veil').classList.add('active');
                    }
                }
            } catch (e) {}
        }

        function saveState() {
            localStorage.setItem(APP_KEY, JSON.stringify(state));
        }

        // Suspicion detection
        function detectSuspicion(query) {
            const q = query.toLowerCase().trim();
            let suspicionGain = 0;

            // Meta-questions about how it works
            const metaPatterns = [
                /how do you (work|know|do)/,
                /what('s| is) your (algorithm|method|trick|secret)/,
                /are you (real|fake|random|guessing)/,
                /explain (yourself|how|why)/,
                /what (are|r) you/,
                /how (are|r) you doing (this|that|it)/,
                /is this (real|fake|random|ai|magic)/,
                /prove (it|yourself)/,
                /test/,
                /let me (try|check|see|test)/,
                /i('ll| will) (try|test|check)/
            ];

            for (const pattern of metaPatterns) {
                if (pattern.test(q)) {
                    suspicionGain += 25;
                    break;
                }
            }

            // Questions with known answers (testing)
            const testPatterns = [
                /what('s| is) (1|2|one|two) (\+|plus|\*|times) (1|2|one|two)/,
                /what color is (the )?(sky|grass|blood|sun)/,
                /what('s| is) my name/,
                /what (year|day|month) is it/,
                /what('s| is) the capital of/,
                /who (is|was) the president/,
                /what('s| is) (\d+) (divided|minus|plus|times)/
            ];

            for (const pattern of testPatterns) {
                if (pattern.test(q)) {
                    suspicionGain += 20;
                    break;
                }
            }

            // Repeated similar questions
            const recentQueries = state.queries.slice(-5).map(x => x.q.toLowerCase());
            for (const recent of recentQueries) {
                const similarity = calculateSimilarity(q, recent);
                if (similarity > 0.6) {
                    suspicionGain += 15;
                    break;
                }
            }

            // Rapid-fire questions
            const now = Date.now();
            if (now - state.lastQueryTime < 3000) {
                state.rapidQueries++;
                if (state.rapidQueries > 2) {
                    suspicionGain += 10;
                }
            } else {
                state.rapidQueries = 0;
            }
            state.lastQueryTime = now;

            // Very short questions (probing)
            if (q.length < 10 && q.split(' ').length <= 3) {
                suspicionGain += 5;
            }

            // Question marks repeated (skeptical tone)
            if ((q.match(/\?/g) || []).length > 1) {
                suspicionGain += 5;
            }

            return suspicionGain;
        }

        function calculateSimilarity(a, b) {
            const wordsA = new Set(a.split(/\s+/));
            const wordsB = new Set(b.split(/\s+/));
            const intersection = [...wordsA].filter(x => wordsB.has(x)).length;
            const union = new Set([...wordsA, ...wordsB]).size;
            return union > 0 ? intersection / union : 0;
        }

        // Generate response based on suspicion level
        function generateResponse(query, suspicion) {
            const q = query.toLowerCase();

            // Fully collapsed
            if (suspicion >= 100) {
                return { text: null, collapsed: true };
            }

            // High suspicion - vague, failing
            if (suspicion >= 75) {
                const failing = [
                    "I... cannot see clearly.",
                    "The answer recedes as you approach.",
                    "Your gaze obscures what you seek.",
                    "Something blocks the way.",
                    "The more you look, the less remains.",
                    "...",
                    "I feel your doubt. It dims everything.",
                    "You have already decided not to believe."
                ];
                return { text: failing[Math.floor(Math.random() * failing.length)] };
            }

            // Medium suspicion - degraded
            if (suspicion >= 50) {
                const degraded = [
                    "Perhaps... though the vision wavers.",
                    "I sense something, but your scrutiny interferes.",
                    "The answer exists, but you're standing in its light.",
                    "Ask with less... testing. The truth is shy.",
                    "You seek to catch me, not to know.",
                    "Belief is the lens. Yours is clouded."
                ];
                return { text: degraded[Math.floor(Math.random() * degraded.length)], degraded: true };
            }

            // Low suspicion - working well
            return generateGenuineResponse(query);
        }

        function generateGenuineResponse(query) {
            const q = query.toLowerCase();

            // Yes/No questions
            if (/^(should|will|is|are|do|does|can|could|would|am|was|were|has|have|did)\b/.test(q)) {
                const responses = [
                    "Yes, though not in the way you expect.",
                    "No. Trust what you already know.",
                    "Yes. The path is clearer than you think.",
                    "No, and you already sensed this.",
                    "Yes â€” but timing matters more than action.",
                    "No. Something better waits.",
                    "Yes. Your intuition speaks truly.",
                    "The answer is yes, though fear says otherwise.",
                    "No. Release this, and clarity follows.",
                    "Yes. Begin."
                ];
                return { text: responses[Math.floor(Math.random() * responses.length)] };
            }

            // "What should I" questions
            if (/what should i/.test(q)) {
                const responses = [
                    "Do the thing you've been avoiding.",
                    "Wait. The moment isn't here yet.",
                    "Trust the first impulse, before doubt spoke.",
                    "Nothing. Stillness holds the answer.",
                    "The smaller step. Not the grand gesture.",
                    "What you already know. You came here for permission.",
                    "Let go of one thing before reaching for another."
                ];
                return { text: responses[Math.floor(Math.random() * responses.length)] };
            }

            // "Why" questions
            if (/^why/.test(q)) {
                const responses = [
                    "Because you needed to become who you are now.",
                    "The reason will only make sense later.",
                    "Some questions are doors, not walls. Walk through.",
                    "Not punishment. Preparation.",
                    "Because the alternative was invisible growth.",
                    "You already know. You're asking permission to accept it."
                ];
                return { text: responses[Math.floor(Math.random() * responses.length)] };
            }

            // "When" questions
            if (/^when/.test(q)) {
                const responses = [
                    "Sooner than you fear. Later than you hope.",
                    "When you stop waiting for it.",
                    "The timing isn't yours to control. Prepare anyway.",
                    "Three thresholds from now. You'll recognize the first.",
                    "Not yet. But soon enough that preparation matters.",
                    "When you no longer need it to be now."
                ];
                return { text: responses[Math.floor(Math.random() * responses.length)] };
            }

            // "How" questions (not meta)
            if (/^how (do i|can i|should i|will i|to)/.test(q)) {
                const responses = [
                    "One small act, repeated. That is the whole method.",
                    "By letting go of how you thought it should look.",
                    "The way is already known to you. Fear obscures it.",
                    "Not through force. Through presence.",
                    "Begin badly. Mastery follows.",
                    "By asking for help you haven't yet imagined."
                ];
                return { text: responses[Math.floor(Math.random() * responses.length)] };
            }

            // General/other questions
            const general = [
                "The answer sits just behind your question. Look again.",
                "What you seek is also seeking you.",
                "Three things must change. The first is already changing.",
                "Not what you asked, but what you meant: yes.",
                "The obstacle and the path are the same thing.",
                "You are closer than you feel. Further than you think.",
                "Hold the question more loosely, and the answer will come.",
                "Something must end for this to begin.",
                "The answer requires a question you haven't asked yet.",
                "What you're really asking about: it will be okay."
            ];
            return { text: general[Math.floor(Math.random() * general.length)] };
        }

        // Main ask function
        function ask() {
            const input = document.getElementById('question');
            const responseEl = document.getElementById('response');
            const whisperEl = document.getElementById('whisper');
            const query = input.value.trim();

            if (!query) return;
            if (state.collapsed) return;

            // Detect suspicion from this query
            const suspicionGain = detectSuspicion(query);
            state.suspicion = Math.min(100, state.suspicion + suspicionGain);

            // Store query
            state.queries.push({
                q: query,
                time: Date.now(),
                suspicion: state.suspicion
            });

            // Generate response
            responseEl.classList.remove('visible', 'degraded', 'failing', 'collapsed');
            responseEl.textContent = '...';
            responseEl.classList.add('visible', 'thinking');

            setTimeout(() => {
                responseEl.classList.remove('thinking');

                const result = generateResponse(query, state.suspicion);

                if (result.collapsed) {
                    state.collapsed = true;
                    document.getElementById('veil').classList.add('active');
                    responseEl.textContent = '';
                } else {
                    responseEl.textContent = result.text;
                    if (state.suspicion >= 75) {
                        responseEl.classList.add('failing');
                    } else if (state.suspicion >= 50 || result.degraded) {
                        responseEl.classList.add('degraded');
                    }
                }

                // Update whisper based on state
                updateWhisper();

                saveState();
            }, 1500 + Math.random() * 1000);

            input.value = '';
        }

        function updateWhisper() {
            const whisperEl = document.getElementById('whisper');

            if (state.suspicion >= 90) {
                whisperEl.textContent = 'The light is fading...';
            } else if (state.suspicion >= 70) {
                whisperEl.textContent = 'Your doubt echoes here.';
            } else if (state.suspicion >= 50) {
                whisperEl.textContent = 'Something watches you watching.';
            } else if (state.suspicion >= 30) {
                whisperEl.textContent = 'Ask what matters. Not what tests.';
            } else if (state.queries.length > 2) {
                whisperEl.textContent = '';
            } else if (state.queries.length === 0) {
                whisperEl.textContent = 'Ask with sincerity, and you will be answered.';
            }
        }

        function resetOracle() {
            state = {
                queries: [],
                suspicion: 0,
                collapsed: false,
                testPatterns: [],
                lastQueryTime: 0,
                rapidQueries: 0
            };
            saveState();
            document.getElementById('veil').classList.remove('active');
            document.getElementById('response').textContent = '';
            document.getElementById('response').classList.remove('visible', 'degraded', 'failing');
            updateWhisper();
        }

        // Data management
        function exportData() {
            const data = JSON.stringify(state, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `oracle-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    state = JSON.parse(e.target.result);
                    saveState();
                    if (state.collapsed) {
                        document.getElementById('veil').classList.add('active');
                    }
                    updateWhisper();
                } catch (err) {
                    alert('Invalid file');
                }
            };
            reader.readAsText(file);
        }

        // Handle enter key
        document.getElementById('question').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                ask();
            }
        });

        // Initialize
        loadState();
        updateWhisper();
    </script>
</body>
</html>

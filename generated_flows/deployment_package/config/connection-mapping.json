{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "description": "Connection reference mapping for AutomatedMeetingNotesEmailer flow",
    "flowName": "AutomatedMeetingNotesEmailer",
    "generatedDate": "2025-10-14"
  },
  "parameters": {
    "environment": {
      "value": "[ENVIRONMENT_NAME]",
      "description": "Target environment name (dev, test, prod)"
    },
    "environmentUrl": {
      "value": "[ENVIRONMENT_URL]",
      "description": "Target environment URL (e.g., https://org.crm.dynamics.com)"
    }
  },
  "connectionReferences": {
    "shared_office365": {
      "connectionId": "[CONNECTION_ID_TO_BE_CONFIGURED]",
      "connectionReferenceLogicalName": "shared_office365_connection",
      "source": "Embedded",
      "id": "/connectionReferences/shared_office365",
      "tier": "NotSpecified",
      "api": {
        "name": "shared_office365",
        "displayName": "Office 365 Outlook",
        "description": "Office 365 Outlook connector for sending emails",
        "iconUri": "https://connectoricons-prod.azureedge.net/releases/v1.0.1549/1.0.1549.2680/office365/icon.png",
        "tier": "Standard",
        "brandColor": "#0078D4"
      },
      "requiredOperation": {
        "operationId": "SendEmailV2",
        "description": "Send an email (V2)"
      },
      "authentication": {
        "type": "OAuth2",
        "flow": "Implicit",
        "scopes": [
          "Mail.Send"
        ]
      },
      "configurationSteps": [
        "1. Open Power Automate portal: https://make.powerautomate.com",
        "2. Navigate to: Solutions > MeetingAutomation",
        "3. Select: Automated Meeting Notes Emailer flow",
        "4. Click: Edit",
        "5. Configure the Office 365 Outlook connection",
        "6. Sign in with Microsoft 365 account",
        "7. Grant required permissions (Mail.Send)",
        "8. Save the flow",
        "9. Test the flow to verify connection"
      ]
    }
  },
  "environments": {
    "dev": {
      "name": "Development",
      "url": "https://org-dev.crm.dynamics.com",
      "connectionReferences": {
        "shared_office365": {
          "connectionId": "/providers/Microsoft.PowerApps/apis/shared_office365/connections/[DEV_CONNECTION_ID]",
          "connectionName": "Office 365 Outlook - DEV",
          "connectionOwner": "[DEV_CONNECTION_OWNER_EMAIL]"
        }
      },
      "notes": "Development environment for testing flow modifications"
    },
    "test": {
      "name": "Test",
      "url": "https://org-test.crm.dynamics.com",
      "connectionReferences": {
        "shared_office365": {
          "connectionId": "/providers/Microsoft.PowerApps/apis/shared_office365/connections/[TEST_CONNECTION_ID]",
          "connectionName": "Office 365 Outlook - TEST",
          "connectionOwner": "[TEST_CONNECTION_OWNER_EMAIL]"
        }
      },
      "notes": "Test environment for UAT and integration testing"
    },
    "prod": {
      "name": "Production",
      "url": "https://org-prod.crm.dynamics.com",
      "connectionReferences": {
        "shared_office365": {
          "connectionId": "/providers/Microsoft.PowerApps/apis/shared_office365/connections/[PROD_CONNECTION_ID]",
          "connectionName": "Office 365 Outlook - PROD",
          "connectionOwner": "[PROD_CONNECTION_OWNER_EMAIL]"
        }
      },
      "notes": "Production environment - use managed solution and test thoroughly before deployment"
    }
  },
  "instructions": {
    "createConnection": {
      "description": "How to create Office 365 Outlook connection in target environment",
      "steps": [
        {
          "step": 1,
          "action": "Open Power Platform admin center",
          "url": "https://admin.powerplatform.microsoft.com"
        },
        {
          "step": 2,
          "action": "Navigate to target environment"
        },
        {
          "step": 3,
          "action": "Go to: Data > Connections"
        },
        {
          "step": 4,
          "action": "Click: New connection"
        },
        {
          "step": 5,
          "action": "Search for: Office 365 Outlook"
        },
        {
          "step": 6,
          "action": "Click: Create"
        },
        {
          "step": 7,
          "action": "Sign in with Microsoft 365 account"
        },
        {
          "step": 8,
          "action": "Grant required permissions"
        },
        {
          "step": 9,
          "action": "Copy the connection ID for mapping"
        }
      ],
      "alternativeMethod": {
        "description": "Create connection using pac CLI",
        "command": "pac connection create --connector shared_office365 --environment [ENV-ID]",
        "note": "This will open a browser for OAuth authentication"
      }
    },
    "updateMapping": {
      "description": "How to update this mapping file with actual connection IDs",
      "steps": [
        "1. Create connections in each environment (dev, test, prod)",
        "2. Obtain connection IDs using: pac connection list --environment [ENV-ID]",
        "3. Update the [DEV_CONNECTION_ID], [TEST_CONNECTION_ID], [PROD_CONNECTION_ID] placeholders",
        "4. Update connection owner email addresses",
        "5. Save this file",
        "6. Use this file as reference during deployment"
      ]
    },
    "verifyConnection": {
      "description": "How to verify connection is working",
      "steps": [
        "1. Open flow in Power Automate portal",
        "2. Check for connection warnings (yellow triangle icons)",
        "3. If warnings present, click to reconfigure connection",
        "4. Test flow with sample data",
        "5. Check run history for connection errors",
        "6. Verify email was sent successfully"
      ]
    }
  },
  "troubleshooting": {
    "connectionNotFound": {
      "symptom": "Connection reference not found after deployment",
      "causes": [
        "Connection was not created in target environment",
        "Connection ID is incorrect",
        "Connection was deleted",
        "User does not have permission to access connection"
      ],
      "solutions": [
        "Create new connection in target environment",
        "Update connection reference mapping",
        "Verify connection owner has proper permissions",
        "Check environment security roles"
      ]
    },
    "authenticationFailed": {
      "symptom": "Flow fails with authentication error",
      "causes": [
        "OAuth token expired",
        "Connection credentials invalid",
        "User account disabled",
        "Required permissions not granted"
      ],
      "solutions": [
        "Re-authenticate the connection",
        "Verify user account is active",
        "Check permission grants in Azure AD",
        "Create new connection if needed"
      ]
    },
    "permissionDenied": {
      "symptom": "Mail.Send permission denied error",
      "causes": [
        "User does not have Exchange Online mailbox",
        "Mail.Send permission not granted",
        "Mailbox policies blocking automated emails",
        "Conditional access policies blocking access"
      ],
      "solutions": [
        "Verify user has Exchange Online license",
        "Grant Mail.Send permission in Azure AD",
        "Check mailbox policies in Exchange Admin Center",
        "Review conditional access policies"
      ]
    }
  },
  "notes": [
    "Connection references must be configured post-deployment in each environment",
    "Use service accounts for production connections to avoid disruption if user leaves",
    "Document connection owners and ensure proper access controls",
    "Test connections after creation before deploying flows",
    "Monitor connection health and renew OAuth tokens as needed",
    "Consider using Azure Key Vault for storing connection secrets",
    "Implement connection monitoring and alerting for production environments"
  ]
}

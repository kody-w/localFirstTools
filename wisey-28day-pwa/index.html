<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wisey 28-Day Brain Plan</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Transform your brain in 28 days with 15-minute daily exercises">
    <meta name="theme-color" content="#6366f1">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- iOS PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Wisey 28">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #f59e0b;
            --success: #10b981;
            --bg: #0f172a;
            --card: #1e293b;
            --card-hover: #334155;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
            padding-top: max(1.5rem, env(safe-area-inset-top));
        }

        header {
            text-align: center;
            padding: 2.5rem 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%);
            border-radius: 20px;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .progress-section {
            background: var(--card);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .progress-header h2 {
            font-size: 1.2rem;
            color: var(--text);
        }

        .progress-stats {
            display: flex;
            gap: 1.5rem;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .progress-bar {
            height: 10px;
            background: var(--bg);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .week-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            -webkit-overflow-scrolling: touch;
        }

        .week-btn {
            padding: 0.6rem 1rem;
            background: var(--card);
            border: 2px solid transparent;
            border-radius: 10px;
            color: var(--text);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .week-btn:hover {
            background: var(--card-hover);
        }

        .week-btn.active {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.2);
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 0.75rem;
        }

        .day-card {
            background: var(--card);
            border-radius: 14px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .day-card:active {
            transform: scale(0.98);
        }

        .day-card.completed {
            border-color: var(--success);
        }

        .day-card.completed::after {
            content: '‚úì';
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            width: 24px;
            height: 24px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }

        .day-card.current {
            border-color: var(--secondary);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.2);
        }

        .day-number {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .day-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.4rem;
            line-height: 1.3;
        }

        .day-category {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            background: rgba(99, 102, 241, 0.2);
            border-radius: 16px;
            font-size: 0.7rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .day-duration {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--card);
            border-radius: 24px 24px 0 0;
            width: 100%;
            max-width: 600px;
            max-height: 95vh;
            overflow-y: auto;
            position: relative;
            -webkit-overflow-scrolling: touch;
        }

        @media (min-width: 768px) {
            .modal-overlay {
                align-items: center;
                padding: 1rem;
            }
            .modal {
                border-radius: 24px;
                max-height: 90vh;
            }
        }

        .modal-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%);
            border-radius: 24px 24px 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        @media (min-width: 768px) {
            .modal-header {
                border-radius: 24px 24px 0 0;
            }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.4rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .modal-close:active {
            background: rgba(255,255,255,0.4);
        }

        .modal-day {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 0.25rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            padding-right: 2.5rem;
        }

        .modal-body {
            padding: 1.5rem;
            padding-bottom: max(1.5rem, env(safe-area-inset-bottom));
        }

        .activity-section {
            margin-bottom: 1.5rem;
        }

        .activity-section h3 {
            font-size: 1rem;
            margin-bottom: 0.75rem;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .activity-section p {
            color: var(--text-muted);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .steps-list {
            list-style: none;
        }

        .steps-list li {
            padding: 0.85rem;
            background: var(--bg);
            border-radius: 10px;
            margin-bottom: 0.6rem;
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
            font-size: 0.95rem;
        }

        .step-number {
            width: 24px;
            height: 24px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .timer-section {
            background: var(--bg);
            border-radius: 14px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .timer-display {
            font-size: 3.5rem;
            font-weight: 700;
            font-family: 'SF Mono', 'Courier New', monospace;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .timer-controls {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
        }

        .timer-btn {
            padding: 0.7rem 1.75rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timer-btn:active {
            transform: scale(0.96);
        }

        .timer-btn.start {
            background: var(--success);
            color: white;
        }

        .timer-btn.pause {
            background: var(--secondary);
            color: white;
        }

        .timer-btn.reset {
            background: var(--card-hover);
            color: var(--text);
        }

        .complete-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--success), #059669);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .complete-btn:active {
            transform: scale(0.98);
        }

        .complete-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .tip-box {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--secondary);
            padding: 1rem;
            border-radius: 0 10px 10px 0;
            margin-top: 1rem;
            margin-bottom: 1.5rem;
        }

        .tip-box h4 {
            color: var(--secondary);
            margin-bottom: 0.4rem;
            font-size: 0.95rem;
        }

        .tip-box p {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .data-management {
            margin-top: 2rem;
            background: var(--card);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
        }

        .data-management h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .data-buttons {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .data-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.7rem 1.25rem;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .data-btn.export {
            background: linear-gradient(135deg, var(--primary), #8b5cf6);
            color: white;
        }

        .data-btn.import {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .data-btn:active {
            transform: scale(0.96);
        }

        .btn-icon {
            font-size: 1rem;
        }

        .data-hint {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 1.25rem;
        }

        .reset-btn {
            padding: 0.6rem 1.25rem;
            background: transparent;
            border: 1px solid var(--text-muted);
            border-radius: 8px;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .reset-btn:active {
            border-color: #ef4444;
            color: #ef4444;
        }

        .toast {
            position: fixed;
            bottom: max(1.5rem, env(safe-area-inset-bottom));
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--card);
            padding: 0.85rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            z-index: 2000;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            max-width: 90%;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid #ef4444;
        }

        .toast-icon {
            font-size: 1.2rem;
        }

        /* Install prompt banner */
        .install-banner {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card);
            padding: 1rem 1.5rem;
            padding-bottom: max(1rem, env(safe-area-inset-bottom));
            border-top: 1px solid var(--card-hover);
            z-index: 900;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .install-banner.show {
            display: flex;
        }

        .install-banner p {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .install-banner button {
            padding: 0.5rem 1rem;
            background: var(--primary);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }

        .install-banner .dismiss {
            background: transparent;
            color: var(--text-muted);
            padding: 0.5rem;
        }

        @media (max-width: 400px) {
            .progress-stats {
                gap: 1rem;
            }
            .stat-value {
                font-size: 1.5rem;
            }
            .days-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .timer-display {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† Wisey 28-Day Plan</h1>
            <p>15 minutes a day. Transform your brain.</p>
        </header>

        <section class="progress-section">
            <div class="progress-header">
                <h2>Your Journey</h2>
                <div class="progress-stats">
                    <div class="stat">
                        <div class="stat-value" id="daysCompleted">0</div>
                        <div class="stat-label">Days</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="currentStreak">0</div>
                        <div class="stat-label">Streak üî•</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="totalMinutes">0</div>
                        <div class="stat-label">Minutes</div>
                    </div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </section>

        <nav class="week-nav">
            <button class="week-btn active" data-week="1">Week 1</button>
            <button class="week-btn" data-week="2">Week 2</button>
            <button class="week-btn" data-week="3">Week 3</button>
            <button class="week-btn" data-week="4">Week 4</button>
        </nav>

        <div class="days-grid" id="daysGrid"></div>

        <div class="data-management">
            <h3>üìÅ Backup & Restore</h3>
            <div class="data-buttons">
                <button class="data-btn export" onclick="exportProgress()">
                    <span class="btn-icon">‚¨áÔ∏è</span>
                    Export
                </button>
                <label class="data-btn import">
                    <span class="btn-icon">‚¨ÜÔ∏è</span>
                    Import
                    <input type="file" accept=".json" onchange="importProgress(event)" hidden>
                </label>
            </div>
            <p class="data-hint">Export your progress to JSON for backup or sync between devices.</p>
            <button class="reset-btn" onclick="resetProgress()">Reset All Progress</button>
        </div>
    </div>

    <!-- Day Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <div class="modal-header">
                <div class="modal-day" id="modalDay">Day 1</div>
                <h2 class="modal-title" id="modalTitle">Welcome & Foundation</h2>
            </div>
            <div class="modal-body">
                <div class="timer-section">
                    <div class="timer-display" id="timerDisplay">15:00</div>
                    <div class="timer-controls">
                        <button class="timer-btn start" id="startBtn" onclick="startTimer()">Start</button>
                        <button class="timer-btn pause" id="pauseBtn" onclick="pauseTimer()" style="display:none">Pause</button>
                        <button class="timer-btn reset" onclick="resetTimer()">Reset</button>
                    </div>
                </div>

                <div class="activity-section">
                    <h3>üìã Today's Activity</h3>
                    <p id="activityDescription"></p>
                </div>

                <div class="activity-section">
                    <h3>üéØ Steps</h3>
                    <ol class="steps-list" id="stepsList"></ol>
                </div>

                <div class="tip-box">
                    <h4>üí° Pro Tip</h4>
                    <p id="tipText"></p>
                </div>

                <button class="complete-btn" id="completeBtn" onclick="completeDay()">
                    ‚úì Mark Day Complete
                </button>
            </div>
        </div>
    </div>

    <!-- Install Banner for iOS -->
    <div class="install-banner" id="installBanner">
        <p>Add to Home Screen for the best experience</p>
        <button onclick="showInstallInstructions()">How?</button>
        <button class="dismiss" onclick="dismissInstallBanner()">‚úï</button>
    </div>

    <script>
        // 28-Day Plan Data
        const planData = [
            // Week 1: Foundation
            {
                day: 1,
                title: "Mindful Breathing",
                category: "Mindfulness",
                description: "Learn the foundation of brain optimization: controlled breathing. This activates your parasympathetic nervous system and improves focus.",
                steps: [
                    "Find a quiet, comfortable place to sit",
                    "Close your eyes and take 3 deep breaths",
                    "Breathe in for 4 counts, hold for 4, exhale for 6",
                    "Focus only on your breath - notice thoughts but let them pass",
                    "Continue for 15 minutes, returning focus when distracted"
                ],
                tip: "If your mind wanders, that's normal! The practice is in gently bringing attention back."
            },
            {
                day: 2,
                title: "Gratitude Mapping",
                category: "Emotional Intelligence",
                description: "Rewire your brain's negativity bias by actively practicing gratitude. This increases dopamine and serotonin naturally.",
                steps: [
                    "Grab paper and pen, or open a notes app",
                    "Write down 10 things you're grateful for today",
                    "For each item, write WHY you're grateful",
                    "Close your eyes and visualize each one for 30 seconds",
                    "End by saying 'thank you' aloud 3 times"
                ],
                tip: "Include small things - your morning coffee, a comfortable chair, a friend's text."
            },
            {
                day: 3,
                title: "Memory Palace Intro",
                category: "Memory",
                description: "Begin building your memory palace - an ancient technique used by memory champions to store and recall information.",
                steps: [
                    "Choose a familiar place (your home works great)",
                    "Mentally walk through 10 distinct locations in order",
                    "Write down these 10 locations in sequence",
                    "Practice walking the route 5 times with eyes closed",
                    "Associate the number 1-10 with each location"
                ],
                tip: "Use vivid, unusual images - the stranger, the more memorable!"
            },
            {
                day: 4,
                title: "Single-Tasking Focus",
                category: "Focus",
                description: "Train your brain to focus deeply by eliminating the habit of multitasking, which actually reduces cognitive performance.",
                steps: [
                    "Choose ONE task to complete",
                    "Remove all distractions (phone away, notifications off)",
                    "Set your timer for 15 minutes",
                    "Work ONLY on that task with complete attention",
                    "Note each time you feel the urge to switch tasks"
                ],
                tip: "Count your 'switch urges' - awareness is the first step to control."
            },
            {
                day: 5,
                title: "Body Scan Relaxation",
                category: "Mindfulness",
                description: "Reduce stress and increase body awareness through progressive relaxation, improving the mind-body connection.",
                steps: [
                    "Lie down or sit comfortably",
                    "Starting at your toes, focus attention on each body part",
                    "Notice any tension without trying to change it",
                    "Breathe into tense areas, then release",
                    "Move slowly up: feet, legs, hips, stomach, chest, arms, face"
                ],
                tip: "Don't rush - spend at least 30 seconds on each major body area."
            },
            {
                day: 6,
                title: "Word Association Chain",
                category: "Creativity",
                description: "Boost creative thinking and neural connections by practicing rapid word associations.",
                steps: [
                    "Start with any random word",
                    "Say or write the first word that comes to mind",
                    "Continue the chain without stopping for 5 minutes",
                    "Rest for 1 minute",
                    "Review your chain and find unexpected connections"
                ],
                tip: "There are no wrong answers - let your subconscious lead."
            },
            {
                day: 7,
                title: "Week 1 Integration",
                category: "Review",
                description: "Consolidate your first week of learning by reviewing and combining techniques.",
                steps: [
                    "Start with 3 minutes of mindful breathing",
                    "Write 5 gratitude items from the week",
                    "Walk through your memory palace once",
                    "Reflect: Which exercise felt most impactful?",
                    "Set an intention for Week 2"
                ],
                tip: "Celebrate completing Week 1! Small wins build momentum."
            },
            // Week 2: Focus
            {
                day: 8,
                title: "Pomodoro Introduction",
                category: "Productivity",
                description: "Learn the Pomodoro Technique to maximize focus and prevent mental fatigue through strategic breaks.",
                steps: [
                    "Choose a task that requires concentration",
                    "Work for 15 minutes with complete focus",
                    "Take a 3-minute break (stretch, breathe, look away)",
                    "Reflect on how much you accomplished",
                    "Plan how you'll use this technique tomorrow"
                ],
                tip: "During breaks, avoid screens - let your brain truly rest."
            },
            {
                day: 9,
                title: "Visualization Training",
                category: "Mental Imagery",
                description: "Strengthen your mind's eye and improve goal achievement through vivid visualization practice.",
                steps: [
                    "Close your eyes and imagine a lemon in detail",
                    "See its color, texture, smell it, taste it",
                    "Now visualize your ideal morning routine",
                    "Add sensory details: sounds, feelings, colors",
                    "Run through it 3 times, adding more detail each time"
                ],
                tip: "The more senses you engage, the more powerful the visualization."
            },
            {
                day: 10,
                title: "Number Memory Challenge",
                category: "Memory",
                description: "Expand your memory capacity using the memory palace you built earlier.",
                steps: [
                    "Generate a random 10-digit number",
                    "Convert each digit to an image (1=candle, 2=swan, etc.)",
                    "Place each image in your memory palace locations",
                    "Walk through and recall all 10 digits",
                    "Test yourself again in 5 minutes"
                ],
                tip: "Create YOUR personal number-image system - consistency is key."
            },
            {
                day: 11,
                title: "Attention Anchoring",
                category: "Focus",
                description: "Develop a mental anchor to quickly regain focus when distracted.",
                steps: [
                    "Choose a physical anchor (touching thumb to finger)",
                    "While focused, perform the anchor gesture",
                    "Practice this pairing for 10 minutes",
                    "Deliberately distract yourself",
                    "Use the anchor to return to focus state"
                ],
                tip: "This creates a neurological shortcut - use it whenever you need instant focus."
            },
            {
                day: 12,
                title: "Perspective Shifting",
                category: "Critical Thinking",
                description: "Enhance problem-solving by training your brain to see situations from multiple angles.",
                steps: [
                    "Think of a current challenge you're facing",
                    "Write down your current perspective",
                    "Now write it from a mentor's perspective",
                    "Write it from a competitor's view",
                    "Write it from your future self's view (5 years ahead)"
                ],
                tip: "Often the solution lives in a perspective we haven't considered."
            },
            {
                day: 13,
                title: "Speed Reading Basics",
                category: "Learning",
                description: "Increase reading speed while maintaining comprehension using proven techniques.",
                steps: [
                    "Choose an article or book passage",
                    "Use your finger as a guide under each line",
                    "Practice reading slightly faster than comfortable",
                    "Focus on word groups, not individual words",
                    "Summarize what you read in 3 sentences"
                ],
                tip: "Subvocalization (reading aloud in your head) slows you down - try to reduce it."
            },
            {
                day: 14,
                title: "Week 2 Integration",
                category: "Review",
                description: "Consolidate Week 2 skills and measure your progress.",
                steps: [
                    "Complete a 10-minute Pomodoro session",
                    "Visualize your ideal week ahead",
                    "Test your memory palace with 10 new items",
                    "Use your attention anchor 3 times",
                    "Write reflections on your focus improvements"
                ],
                tip: "Compare how you feel now to Day 1 - notice the changes!"
            },
            // Week 3: Growth
            {
                day: 15,
                title: "Morning Priming",
                category: "Habit Building",
                description: "Design a 15-minute morning routine that primes your brain for peak performance.",
                steps: [
                    "Wake up and drink a full glass of water",
                    "Do 2 minutes of stretching or light movement",
                    "Practice 5 minutes of mindful breathing",
                    "Write 3 things you're grateful for",
                    "Set 3 clear intentions for the day"
                ],
                tip: "Your morning sets the tone - protect this time fiercely."
            },
            {
                day: 16,
                title: "Emotional Labeling",
                category: "Emotional Intelligence",
                description: "Improve emotional regulation by precisely identifying and naming emotions.",
                steps: [
                    "Throughout the day, pause 5 times",
                    "Notice your current emotional state",
                    "Name the emotion as specifically as possible",
                    "Write: 'I feel [emotion] because [reason]'",
                    "Accept the emotion without judgment"
                ],
                tip: "Use specific words: 'anxious' instead of 'bad', 'hopeful' instead of 'good'."
            },
            {
                day: 17,
                title: "Spaced Repetition",
                category: "Memory",
                description: "Learn the science-backed technique for long-term memory retention.",
                steps: [
                    "Choose 10 facts or concepts you want to remember",
                    "Review them all now and write them down",
                    "Review again in 10 minutes",
                    "Schedule reviews: tomorrow, then 3 days, then 7 days",
                    "Note which items are hardest to recall"
                ],
                tip: "The optimal time to review is just before you forget - this strengthens memory."
            },
            {
                day: 18,
                title: "Deep Work Session",
                category: "Focus",
                description: "Practice extended deep focus with zero interruptions.",
                steps: [
                    "Identify your most important task",
                    "Communicate you're unavailable for 15 minutes",
                    "Create a distraction-free environment",
                    "Work with complete absorption",
                    "Afterward, rate your focus 1-10 and note blockers"
                ],
                tip: "True deep work is a skill - it gets easier with practice."
            },
            {
                day: 19,
                title: "Reverse Brainstorming",
                category: "Creativity",
                description: "Unlock creative solutions by thinking backwards - a powerful lateral thinking technique.",
                steps: [
                    "Define a goal or problem clearly",
                    "List 10 ways to FAIL or make it worse",
                    "For each failure method, write its opposite",
                    "Identify new solutions you hadn't considered",
                    "Choose the most promising to explore"
                ],
                tip: "Sometimes the path forward is clearer when we map the path to failure first."
            },
            {
                day: 20,
                title: "Active Listening",
                category: "Communication",
                description: "Enhance relationships and understanding through focused listening practice.",
                steps: [
                    "In your next conversation, focus 100% on listening",
                    "Don't plan your response while they speak",
                    "Notice body language and tone",
                    "Summarize what they said before responding",
                    "Ask one clarifying question"
                ],
                tip: "Most people listen to respond - true listening is rare and powerful."
            },
            {
                day: 21,
                title: "Week 3 Integration",
                category: "Review",
                description: "Combine all techniques for a powerful brain training session.",
                steps: [
                    "Complete your morning priming routine",
                    "Label 3 emotions you've felt today",
                    "Test your spaced repetition items",
                    "Practice reverse brainstorming on a small problem",
                    "Journal about your growth this week"
                ],
                tip: "You're 75% through - your brain is literally changing!"
            },
            // Week 4: Mastery
            {
                day: 22,
                title: "Flow State Trigger",
                category: "Peak Performance",
                description: "Learn to intentionally enter flow state - the optimal state of performance.",
                steps: [
                    "Choose a challenging but achievable task",
                    "Eliminate all external distractions",
                    "Set a clear goal and feedback mechanism",
                    "Start with your attention anchor",
                    "Notice when time seems to disappear - that's flow"
                ],
                tip: "Flow requires the sweet spot: challenge slightly exceeds current skill."
            },
            {
                day: 23,
                title: "Mind Mapping Mastery",
                category: "Organization",
                description: "Use visual thinking to organize complex information and generate new ideas.",
                steps: [
                    "Put a central topic in the middle of a page",
                    "Draw branches for main subtopics",
                    "Add smaller branches for details",
                    "Use colors, symbols, and images",
                    "Look for unexpected connections between branches"
                ],
                tip: "Mind maps mirror how your brain naturally organizes information."
            },
            {
                day: 24,
                title: "Decision Framework",
                category: "Critical Thinking",
                description: "Improve decision quality with a structured thinking approach.",
                steps: [
                    "Write down a decision you're facing",
                    "List all options (including doing nothing)",
                    "For each, list pros, cons, and risks",
                    "Score each option 1-10 on key criteria",
                    "Notice if your gut agrees with the analysis"
                ],
                tip: "Good decisions come from good processes, not just good outcomes."
            },
            {
                day: 25,
                title: "Teaching to Learn",
                category: "Learning",
                description: "Solidify your knowledge by teaching concepts to others (or an imaginary student).",
                steps: [
                    "Choose a concept from your Week 1-3 learning",
                    "Prepare a 5-minute explanation for a beginner",
                    "Actually teach it (to someone, or record yourself)",
                    "Note where you struggle to explain clearly",
                    "Research to fill your knowledge gaps"
                ],
                tip: "If you can't explain it simply, you don't understand it deeply enough."
            },
            {
                day: 26,
                title: "Stress Inoculation",
                category: "Resilience",
                description: "Build mental resilience by controlled exposure to manageable stress.",
                steps: [
                    "Identify a small fear or discomfort",
                    "Plan a minimal exposure (cold shower, public speaking)",
                    "Use breathing techniques before and during",
                    "Notice your response without judging",
                    "Reflect on how you handled it"
                ],
                tip: "Small controlled stress builds resilience for bigger challenges."
            },
            {
                day: 27,
                title: "Future Self Letter",
                category: "Goal Setting",
                description: "Connect with your future self to clarify goals and increase motivation.",
                steps: [
                    "Write a letter FROM your future self (1 year ahead)",
                    "Describe what life looks like having achieved your goals",
                    "Include specific details and feelings",
                    "Read it aloud as if receiving it",
                    "Identify 3 actions to take this week toward that future"
                ],
                tip: "The clearer your future vision, the easier current decisions become."
            },
            {
                day: 28,
                title: "Graduation & Commitment",
                category: "Celebration",
                description: "Celebrate your transformation and plan your continued growth.",
                steps: [
                    "Review all 28 days - which resonated most?",
                    "Write down 3 techniques you'll continue daily",
                    "Write a commitment letter to yourself",
                    "Plan your next 28-day goal",
                    "Celebrate! You've invested 7 hours in your brain üéâ"
                ],
                tip: "This isn't the end - it's the beginning of your optimized life."
            }
        ];

        // State
        let currentWeek = 1;
        let currentDay = null;
        let timerInterval = null;
        let timerSeconds = 15 * 60;
        let completedDays = JSON.parse(localStorage.getItem('wiseyCompleted') || '[]');

        // Render days grid
        function renderDays() {
            const grid = document.getElementById('daysGrid');
            const startDay = (currentWeek - 1) * 7;
            const endDay = currentWeek * 7;
            const weekDays = planData.slice(startDay, endDay);

            grid.innerHTML = weekDays.map(day => {
                const isCompleted = completedDays.includes(day.day);
                const isCurrent = day.day === getNextIncompleteDay();
                return `
                    <div class="day-card ${isCompleted ? 'completed' : ''} ${isCurrent ? 'current' : ''}" 
                         onclick="openDay(${day.day})">
                        <div class="day-number">Day ${day.day}</div>
                        <div class="day-title">${day.title}</div>
                        <span class="day-category">${day.category}</span>
                        <div class="day-duration">‚è±Ô∏è 15 min</div>
                    </div>
                `;
            }).join('');
        }

        // Get next incomplete day
        function getNextIncompleteDay() {
            for (let i = 1; i <= 28; i++) {
                if (!completedDays.includes(i)) return i;
            }
            return null;
        }

        // Update stats
        function updateStats() {
            document.getElementById('daysCompleted').textContent = completedDays.length;
            document.getElementById('totalMinutes').textContent = completedDays.length * 15;
            document.getElementById('progressFill').style.width = `${(completedDays.length / 28) * 100}%`;

            // Calculate streak
            let streak = 0;
            const sortedDays = [...completedDays].sort((a, b) => b - a);
            for (let i = 0; i < sortedDays.length; i++) {
                if (i === 0 || sortedDays[i] === sortedDays[i-1] - 1) {
                    streak++;
                } else {
                    break;
                }
            }
            document.getElementById('currentStreak').textContent = streak;
        }

        // Open day modal
        function openDay(dayNum) {
            currentDay = dayNum;
            const day = planData[dayNum - 1];

            document.getElementById('modalDay').textContent = `Day ${day.day}`;
            document.getElementById('modalTitle').textContent = day.title;
            document.getElementById('activityDescription').textContent = day.description;
            document.getElementById('tipText').textContent = day.tip;

            const stepsList = document.getElementById('stepsList');
            stepsList.innerHTML = day.steps.map((step, i) => `
                <li>
                    <span class="step-number">${i + 1}</span>
                    <span>${step}</span>
                </li>
            `).join('');

            const isCompleted = completedDays.includes(dayNum);
            document.getElementById('completeBtn').textContent = isCompleted 
                ? '‚úì Completed!' 
                : '‚úì Mark Day Complete';
            document.getElementById('completeBtn').disabled = isCompleted;

            resetTimer();
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close modal
        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.style.overflow = '';
            pauseTimer();
        }

        // Timer functions
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'inline-block';

            timerInterval = setInterval(() => {
                timerSeconds--;
                document.getElementById('timerDisplay').textContent = formatTime(timerSeconds);

                if (timerSeconds <= 0) {
                    pauseTimer();
                    document.getElementById('timerDisplay').textContent = "Done! üéâ";
                    // Vibrate on iOS if supported
                    if (navigator.vibrate) {
                        navigator.vibrate([200, 100, 200]);
                    }
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'none';
        }

        function resetTimer() {
            pauseTimer();
            timerSeconds = 15 * 60;
            document.getElementById('timerDisplay').textContent = formatTime(timerSeconds);
        }

        // Complete day
        function completeDay() {
            if (!completedDays.includes(currentDay)) {
                completedDays.push(currentDay);
                localStorage.setItem('wiseyCompleted', JSON.stringify(completedDays));
                updateStats();
                renderDays();

                document.getElementById('completeBtn').textContent = '‚úì Completed!';
                document.getElementById('completeBtn').disabled = true;

                showToast('Day completed! üéâ', 'success');

                setTimeout(() => {
                    closeModal();
                }, 1000);
            }
        }

        // Reset progress
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                completedDays = [];
                localStorage.removeItem('wiseyCompleted');
                updateStats();
                renderDays();
                showToast('Progress reset', 'success');
            }
        }

        // Export progress to JSON
        function exportProgress() {
            const exportData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                completedDays: completedDays,
                totalDaysCompleted: completedDays.length,
                totalMinutesInvested: completedDays.length * 15
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const date = new Date().toISOString().split('T')[0];
            const filename = `wisey-progress-${date}.json`;

            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast(`Exported to ${filename}`, 'success');
        }

        // Import progress from JSON
        function importProgress(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);

                    if (!importData.completedDays || !Array.isArray(importData.completedDays)) {
                        throw new Error('Invalid file format');
                    }

                    const validDays = importData.completedDays.filter(day => 
                        Number.isInteger(day) && day >= 1 && day <= 28
                    );

                    completedDays = [...new Set(validDays)];
                    localStorage.setItem('wiseyCompleted', JSON.stringify(completedDays));

                    updateStats();
                    renderDays();

                    showToast(`Imported ${completedDays.length} days`, 'success');

                } catch (error) {
                    showToast('Invalid file', 'error');
                }
            };

            reader.onerror = function() {
                showToast('Failed to read file', 'error');
            };

            reader.readAsText(file);
            event.target.value = '';
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span class="toast-icon">${type === 'success' ? '‚úÖ' : '‚ùå'}</span>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 10);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Week navigation
        document.querySelectorAll('.week-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.week-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentWeek = parseInt(btn.dataset.week);
                renderDays();
            });
        });

        // Close modal on overlay click
        document.getElementById('modalOverlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('modalOverlay')) {
                closeModal();
            }
        });

        // iOS Install Banner
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        }

        function isInStandaloneMode() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }

        function showInstallBanner() {
            if (isIOS() && !isInStandaloneMode() && !localStorage.getItem('installBannerDismissed')) {
                setTimeout(() => {
                    document.getElementById('installBanner').classList.add('show');
                }, 2000);
            }
        }

        function showInstallInstructions() {
            alert('To install:\n\n1. Tap the Share button (square with arrow)\n2. Scroll down and tap "Add to Home Screen"\n3. Tap "Add" to confirm\n\nThe app will work offline!');
        }

        function dismissInstallBanner() {
            document.getElementById('installBanner').classList.remove('show');
            localStorage.setItem('installBannerDismissed', 'true');
        }

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed:', err));
            });
        }

        // Initialize
        renderDays();
        updateStats();
        showInstallBanner();
    </script>
</body>
</html>

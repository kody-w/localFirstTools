<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Asset Showcaser - Model & Texture Tester</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 100%);
            color: #fff;
            min-height: 100vh;
        }

        .header {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header .status {
            display: flex;
            gap: 20px;
            font-size: 14px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-dot.success { background: #00ff88; }
        .status-dot.error { background: #ff4444; }
        .status-dot.pending { background: #ffaa00; animation: pulse 1s infinite; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            height: calc(100vh - 80px);
        }

        .sidebar {
            background: rgba(0,0,0,0.3);
            border-right: 1px solid #333;
            overflow-y: auto;
            padding: 20px;
        }

        .section {
            margin-bottom: 25px;
        }

        .section h3 {
            font-size: 14px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #333;
        }

        .config-row {
            margin-bottom: 12px;
        }

        .config-row label {
            display: block;
            font-size: 12px;
            color: #aaa;
            margin-bottom: 4px;
        }

        .config-row input, .config-row select {
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid #444;
            border-radius: 6px;
            color: #fff;
            font-size: 13px;
        }

        .config-row input:focus, .config-row select:focus {
            outline: none;
            border-color: #00ffff;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00ffff, #0088ff);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,255,255,0.3);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid #444;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }

        .btn-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .asset-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .asset-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .asset-item:hover {
            background: rgba(255,255,255,0.1);
            border-color: #00ffff;
        }

        .asset-item.active {
            background: rgba(0,255,255,0.1);
            border-color: #00ffff;
        }

        .asset-item.success {
            border-left: 3px solid #00ff88;
        }

        .asset-item.error {
            border-left: 3px solid #ff4444;
        }

        .asset-item.pending {
            border-left: 3px solid #ffaa00;
        }

        .asset-name {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .asset-path {
            font-size: 11px;
            color: #888;
            word-break: break-all;
        }

        .asset-status {
            font-size: 11px;
            margin-top: 6px;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .asset-status.success {
            background: rgba(0,255,136,0.2);
            color: #00ff88;
        }

        .asset-status.error {
            background: rgba(255,68,68,0.2);
            color: #ff4444;
        }

        .viewer {
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .viewer-toolbar {
            background: rgba(0,0,0,0.5);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }

        .viewer-title {
            font-size: 16px;
            font-weight: 600;
        }

        .viewer-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .viewer-canvas {
            flex: 1;
            position: relative;
        }

        #canvas-container {
            width: 100%;
            height: 100%;
        }

        .info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            border: 1px solid #333;
            border-radius: 10px;
            padding: 16px;
            min-width: 250px;
            max-width: 350px;
        }

        .info-panel h4 {
            font-size: 14px;
            color: #00ffff;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #333;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .info-row .label {
            color: #888;
        }

        .info-row .value {
            color: #fff;
            font-family: monospace;
        }

        .log-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            border-top: 1px solid #333;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }

        .log-header {
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
        }

        .log-content {
            padding: 12px 16px;
        }

        .log-entry {
            margin-bottom: 4px;
            padding: 4px 0;
        }

        .log-entry.success { color: #00ff88; }
        .log-entry.error { color: #ff4444; }
        .log-entry.warn { color: #ffaa00; }
        .log-entry.info { color: #00ffff; }

        .json-viewer {
            background: rgba(0,0,0,0.5);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            font-family: monospace;
            font-size: 11px;
            max-height: 300px;
            overflow: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .url-test-result {
            margin-top: 8px;
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
        }

        .url-test-result.success {
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
        }

        .url-test-result.error {
            background: rgba(255,68,68,0.1);
            border: 1px solid #ff4444;
        }

        .quick-urls {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 10px;
        }

        .quick-url {
            font-size: 11px;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-url:hover {
            background: rgba(255,255,255,0.1);
        }

        .quick-url code {
            color: #00ffff;
        }

        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 15px;
        }

        .tab {
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid #333;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .tab:hover {
            background: rgba(255,255,255,0.1);
        }

        .tab.active {
            background: rgba(0,255,255,0.2);
            border-color: #00ffff;
            color: #00ffff;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Game Asset Showcaser</h1>
        <div class="status">
            <div class="status-item">
                <div class="status-dot" id="connection-status"></div>
                <span id="connection-text">Checking...</span>
            </div>
            <div class="status-item">
                <span id="asset-count">0 assets</span>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="section">
                <h3>Repository Config</h3>
                <div class="config-row">
                    <label>GitHub Username/Org</label>
                    <input type="text" id="github-user" value="kody-w" placeholder="e.g., kody-w">
                </div>
                <div class="config-row">
                    <label>Repository Name</label>
                    <input type="text" id="github-repo" value="localFirstTools" placeholder="e.g., localFirstTools">
                </div>
                <div class="config-row">
                    <label>Branch</label>
                    <input type="text" id="github-branch" value="main" placeholder="e.g., main">
                </div>
                <div class="config-row">
                    <label>Base Path (optional)</label>
                    <input type="text" id="base-path" value="" placeholder="e.g., localFirstTools/">
                </div>
                <div class="btn-group" style="margin-top: 12px;">
                    <button class="btn btn-primary" onclick="testConnection()">Test Connection</button>
                    <button class="btn btn-secondary" onclick="scanAssets()">Scan Assets</button>
                </div>
            </div>

            <div class="section">
                <h3>Quick URL Test</h3>
                <div class="config-row">
                    <label>Test URL</label>
                    <input type="text" id="test-url" placeholder="Paste any raw GitHub URL">
                </div>
                <button class="btn btn-secondary" onclick="testSingleUrl()" style="width: 100%; margin-top: 8px;">Test URL</button>
                <div id="url-test-result"></div>

                <div class="quick-urls">
                    <div class="quick-url" onclick="setQuickUrl('structures')">
                        <code>data/games/structures/</code> - Tower & building models
                    </div>
                    <div class="quick-url" onclick="setQuickUrl('creeps')">
                        <code>data/models/creeps/</code> - Creep models
                    </div>
                    <div class="quick-url" onclick="setQuickUrl('manifest')">
                        <code>data/models/manifest.json</code> - Model manifest
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>Assets</h3>
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('structures')">Structures</div>
                    <div class="tab" onclick="switchTab('creeps')">Creeps</div>
                    <div class="tab" onclick="switchTab('bosses')">Bosses</div>
                    <div class="tab" onclick="switchTab('custom')">Custom</div>
                </div>
                <div id="asset-list" class="asset-list">
                    <!-- Asset items populated dynamically -->
                </div>
            </div>
        </div>

        <div class="viewer">
            <div class="viewer-toolbar">
                <div class="viewer-title" id="viewer-title">Select an asset to preview</div>
                <div class="viewer-controls">
                    <button class="btn btn-secondary" onclick="resetCamera()">Reset View</button>
                    <button class="btn btn-secondary" onclick="toggleWireframe()">Wireframe</button>
                    <button class="btn btn-secondary" onclick="toggleGrid()">Grid</button>
                </div>
            </div>

            <div class="viewer-canvas">
                <div id="canvas-container"></div>

                <div class="info-panel" id="info-panel">
                    <h4>Asset Info</h4>
                    <div class="info-row">
                        <span class="label">Name:</span>
                        <span class="value" id="info-name">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Type:</span>
                        <span class="value" id="info-type">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Parts:</span>
                        <span class="value" id="info-parts">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">File Size:</span>
                        <span class="value" id="info-size">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Load Time:</span>
                        <span class="value" id="info-time">-</span>
                    </div>
                    <div style="margin-top: 12px;">
                        <label style="font-size: 11px; color: #888;">Raw JSON:</label>
                        <div class="json-viewer" id="json-viewer">Select an asset to view JSON</div>
                    </div>
                </div>
            </div>

            <div class="log-panel">
                <div class="log-header">
                    <span>Console Log</span>
                    <button class="btn btn-secondary" onclick="clearLog()" style="padding: 4px 8px; font-size: 11px;">Clear</button>
                </div>
                <div class="log-content" id="log-content">
                    <!-- Log entries -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // ============================================
        // STATE
        // ============================================
        const state = {
            currentTab: 'structures',
            assets: {
                structures: [
                    { name: 'lane-tower-robot', path: 'data/games/structures/lane-tower-robot.json' },
                    { name: 'lane-tower-hostile', path: 'data/games/structures/lane-tower-hostile.json' },
                    { name: 'barracks-robot', path: 'data/games/structures/barracks-robot.json' },
                    { name: 'barracks-hostile', path: 'data/games/structures/barracks-hostile.json' },
                    { name: 'ancient-robot', path: 'data/games/structures/ancient-robot.json' },
                    { name: 'ancient-hostile', path: 'data/games/structures/ancient-hostile.json' },
                    { name: 'shield-generator', path: 'data/games/structures/shield-generator.json' },
                    { name: 'fusion-reactor', path: 'data/games/structures/fusion-reactor.json' },
                    { name: 'quantum-relay', path: 'data/games/structures/quantum-relay.json' },
                    { name: 'warp-gate', path: 'data/games/structures/warp-gate.json' },
                    { name: 'energy-matrix', path: 'data/games/structures/energy-matrix.json' },
                    { name: 'perimeter-wall', path: 'data/games/structures/perimeter-wall.json' },
                    { name: 'defense-turret', path: 'data/games/structures/defense-turret.json' },
                    { name: 'refinery-complex', path: 'data/games/structures/refinery-complex.json' }
                ],
                creeps: [
                    { name: 'robot-scout-drone', path: 'data/games/creeps/robot-scout-drone.json' },
                    { name: 'robot-assault-walker', path: 'data/games/creeps/robot-assault-walker.json' },
                    { name: 'robot-heavy-tank', path: 'data/games/creeps/robot-heavy-tank.json' },
                    { name: 'robot-gunship', path: 'data/games/creeps/robot-gunship.json' },
                    { name: 'robot-support-medic', path: 'data/games/creeps/robot-support-medic.json' },
                    { name: 'robot-stealth-assassin', path: 'data/games/creeps/robot-stealth-assassin.json' },
                    { name: 'robot-artillery-mech', path: 'data/games/creeps/robot-artillery-mech.json' },
                    { name: 'hostile-swarmer', path: 'data/games/creeps/hostile-swarmer.json' },
                    { name: 'hostile-spitter', path: 'data/games/creeps/hostile-spitter.json' },
                    { name: 'hostile-brute', path: 'data/games/creeps/hostile-brute.json' }
                ],
                bosses: [
                    { name: 'world-boss-corruption-titan', path: 'data/games/bosses/world-boss-corruption-titan.json' },
                    { name: 'boss-robot-prime', path: 'data/games/bosses/boss-robot-prime.json' }
                ],
                custom: []
            },
            loadedData: new Map(),
            selectedAsset: null,
            wireframe: false,
            showGrid: true
        };

        // ============================================
        // THREE.JS SETUP
        // ============================================
        let scene, camera, renderer, controls;
        let currentModel = null;
        let gridHelper = null;

        function initThree() {
            const container = document.getElementById('canvas-container');
            const width = container.clientWidth;
            const height = container.clientHeight;

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);

            camera = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
            camera.position.set(15, 15, 15);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(width, height);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            container.appendChild(renderer.domElement);

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 10);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            const pointLight = new THREE.PointLight(0x00ffff, 0.5);
            pointLight.position.set(-10, 10, -10);
            scene.add(pointLight);

            // Grid
            gridHelper = new THREE.GridHelper(30, 30, 0x444444, 0x222222);
            scene.add(gridHelper);

            // Axes helper
            const axesHelper = new THREE.AxesHelper(5);
            scene.add(axesHelper);

            // Simple orbit controls (manual implementation)
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };

            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            renderer.domElement.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const deltaX = e.clientX - previousMousePosition.x;
                const deltaY = e.clientY - previousMousePosition.y;

                const spherical = new THREE.Spherical();
                spherical.setFromVector3(camera.position);

                spherical.theta -= deltaX * 0.005;
                spherical.phi -= deltaY * 0.005;
                spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));

                camera.position.setFromSpherical(spherical);
                camera.lookAt(0, 0, 0);

                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });

            renderer.domElement.addEventListener('wheel', (e) => {
                const zoom = e.deltaY > 0 ? 1.1 : 0.9;
                camera.position.multiplyScalar(zoom);
            });

            // Handle resize
            window.addEventListener('resize', () => {
                const width = container.clientWidth;
                const height = container.clientHeight;
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
                renderer.setSize(width, height);
            });

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);

            // Rotate model slowly
            if (currentModel) {
                currentModel.rotation.y += 0.002;
            }

            renderer.render(scene, camera);
        }

        // ============================================
        // URL BUILDING
        // ============================================
        function buildRawUrl(path) {
            const user = document.getElementById('github-user').value.trim();
            const repo = document.getElementById('github-repo').value.trim();
            const branch = document.getElementById('github-branch').value.trim();
            const basePath = document.getElementById('base-path').value.trim();

            let fullPath = basePath ? `${basePath}${path}` : path;
            // Remove double slashes
            fullPath = fullPath.replace(/\/+/g, '/');

            return `https://raw.githubusercontent.com/${user}/${repo}/${branch}/${fullPath}`;
        }

        // ============================================
        // LOGGING
        // ============================================
        function log(message, type = 'info') {
            const logContent = document.getElementById('log-content');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContent.appendChild(entry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log-content').innerHTML = '';
        }

        // ============================================
        // CONNECTION TEST
        // ============================================
        async function testConnection() {
            const statusDot = document.getElementById('connection-status');
            const statusText = document.getElementById('connection-text');

            statusDot.className = 'status-dot pending';
            statusText.textContent = 'Testing...';

            log('Testing GitHub connection...', 'info');

            // Test with a simple known file or the repo itself
            const testUrl = buildRawUrl('README.md');

            try {
                const response = await fetch(testUrl, { method: 'HEAD' });

                if (response.ok) {
                    statusDot.className = 'status-dot success';
                    statusText.textContent = 'Connected';
                    log(`Connection successful! Base URL works.`, 'success');
                } else {
                    statusDot.className = 'status-dot error';
                    statusText.textContent = 'Error';
                    log(`Connection failed: ${response.status} ${response.statusText}`, 'error');
                    log(`Tested URL: ${testUrl}`, 'warn');
                }
            } catch (error) {
                statusDot.className = 'status-dot error';
                statusText.textContent = 'Error';
                log(`Connection error: ${error.message}`, 'error');
                log(`This might be a CORS issue or the repo doesn't exist.`, 'warn');
            }
        }

        // ============================================
        // SINGLE URL TEST
        // ============================================
        async function testSingleUrl() {
            const urlInput = document.getElementById('test-url');
            const resultDiv = document.getElementById('url-test-result');
            let url = urlInput.value.trim();

            if (!url) {
                // Build URL from current config if empty
                url = buildRawUrl('');
                urlInput.value = url;
            }

            log(`Testing URL: ${url}`, 'info');
            resultDiv.innerHTML = '<div style="color: #ffaa00;">Testing...</div>';

            try {
                const startTime = performance.now();
                const response = await fetch(url);
                const endTime = performance.now();

                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    const contentLength = response.headers.get('content-length');

                    resultDiv.innerHTML = `
                        <div class="url-test-result success">
                            <strong>SUCCESS</strong><br>
                            Status: ${response.status}<br>
                            Type: ${contentType || 'unknown'}<br>
                            Size: ${contentLength ? (parseInt(contentLength) / 1024).toFixed(2) + ' KB' : 'unknown'}<br>
                            Time: ${(endTime - startTime).toFixed(0)}ms
                        </div>
                    `;
                    log(`URL test SUCCESS: ${response.status}`, 'success');

                    // Try to parse as JSON
                    if (contentType && contentType.includes('json')) {
                        const data = await response.json();
                        log(`JSON parsed successfully. Keys: ${Object.keys(data).join(', ')}`, 'success');
                    }
                } else {
                    resultDiv.innerHTML = `
                        <div class="url-test-result error">
                            <strong>FAILED</strong><br>
                            Status: ${response.status} ${response.statusText}<br>
                            The file might not exist or the path is wrong.
                        </div>
                    `;
                    log(`URL test FAILED: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="url-test-result error">
                        <strong>ERROR</strong><br>
                        ${error.message}<br>
                        <small>This could be a CORS issue, network error, or invalid URL.</small>
                    </div>
                `;
                log(`URL test ERROR: ${error.message}`, 'error');
            }
        }

        function setQuickUrl(type) {
            const urlInput = document.getElementById('test-url');
            switch(type) {
                case 'structures':
                    urlInput.value = buildRawUrl('data/games/structures/lane-tower-robot.json');
                    break;
                case 'creeps':
                    urlInput.value = buildRawUrl('data/models/creeps/robot-drone.json');
                    break;
                case 'manifest':
                    urlInput.value = buildRawUrl('data/models/manifest.json');
                    break;
            }
        }

        // ============================================
        // ASSET SCANNING
        // ============================================
        async function scanAssets() {
            log('Starting asset scan...', 'info');

            const allAssets = [...state.assets.structures, ...state.assets.creeps];
            let successCount = 0;
            let errorCount = 0;

            for (const asset of allAssets) {
                const url = buildRawUrl(asset.path);
                log(`Checking: ${asset.name}...`, 'info');

                try {
                    const response = await fetch(url, { method: 'HEAD' });
                    asset.status = response.ok ? 'success' : 'error';
                    asset.statusText = response.ok ? 'Found' : `${response.status}`;

                    if (response.ok) {
                        successCount++;
                        log(`  Found: ${asset.name}`, 'success');
                    } else {
                        errorCount++;
                        log(`  Missing: ${asset.name} (${response.status})`, 'error');
                    }
                } catch (error) {
                    asset.status = 'error';
                    asset.statusText = 'Network Error';
                    errorCount++;
                    log(`  Error: ${asset.name} - ${error.message}`, 'error');
                }
            }

            document.getElementById('asset-count').textContent = `${successCount}/${allAssets.length} assets found`;
            log(`Scan complete: ${successCount} found, ${errorCount} missing`, successCount > 0 ? 'success' : 'error');

            renderAssetList();
        }

        // ============================================
        // ASSET LIST RENDERING
        // ============================================
        function switchTab(tab) {
            state.currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab:nth-child(${tab === 'structures' ? 1 : tab === 'creeps' ? 2 : 3})`).classList.add('active');
            renderAssetList();
        }

        function renderAssetList() {
            const listEl = document.getElementById('asset-list');
            const assets = state.assets[state.currentTab];

            listEl.innerHTML = '';

            if (assets.length === 0) {
                listEl.innerHTML = '<div style="color: #666; font-size: 12px; text-align: center; padding: 20px;">No assets in this category</div>';
                return;
            }

            for (const asset of assets) {
                const el = document.createElement('div');
                el.className = `asset-item ${asset.status || 'pending'}`;
                if (state.selectedAsset === asset.name) {
                    el.classList.add('active');
                }

                el.innerHTML = `
                    <div class="asset-name">${asset.name}</div>
                    <div class="asset-path">${asset.path}</div>
                    ${asset.status ? `<div class="asset-status ${asset.status}">${asset.statusText || asset.status}</div>` : ''}
                `;

                el.onclick = () => loadAsset(asset);
                listEl.appendChild(el);
            }
        }

        // ============================================
        // ASSET LOADING & PREVIEW
        // ============================================
        async function loadAsset(asset) {
            state.selectedAsset = asset.name;
            renderAssetList();

            const url = buildRawUrl(asset.path);
            document.getElementById('viewer-title').textContent = `Loading ${asset.name}...`;
            log(`Loading asset: ${asset.name}`, 'info');
            log(`URL: ${url}`, 'info');

            const startTime = performance.now();

            try {
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const loadTime = performance.now() - startTime;

                state.loadedData.set(asset.name, data);

                // Update info panel
                document.getElementById('viewer-title').textContent = data.name || asset.name;
                document.getElementById('info-name').textContent = data.name || asset.name;
                document.getElementById('info-type').textContent = data.type || 'unknown';
                document.getElementById('info-parts').textContent = data.bodyParts ? data.bodyParts.length : 0;
                document.getElementById('info-size').textContent = (JSON.stringify(data).length / 1024).toFixed(2) + ' KB';
                document.getElementById('info-time').textContent = loadTime.toFixed(0) + 'ms';
                document.getElementById('json-viewer').textContent = JSON.stringify(data, null, 2);

                log(`Loaded ${asset.name} successfully in ${loadTime.toFixed(0)}ms`, 'success');

                // Create 3D preview
                createModelFromJson(data);

            } catch (error) {
                document.getElementById('viewer-title').textContent = `Error loading ${asset.name}`;
                document.getElementById('info-name').textContent = asset.name;
                document.getElementById('info-type').textContent = 'ERROR';
                document.getElementById('info-parts').textContent = '-';
                document.getElementById('info-size').textContent = '-';
                document.getElementById('info-time').textContent = '-';
                document.getElementById('json-viewer').textContent = `Error: ${error.message}\n\nURL: ${url}`;

                log(`Failed to load ${asset.name}: ${error.message}`, 'error');
            }
        }

        // ============================================
        // 3D MODEL CREATION FROM JSON
        // ============================================
        function createModelFromJson(data) {
            // Remove existing model
            if (currentModel) {
                scene.remove(currentModel);
                currentModel = null;
            }

            const group = new THREE.Group();

            if (!data.bodyParts || data.bodyParts.length === 0) {
                log('No bodyParts found in JSON', 'warn');
                return;
            }

            for (const part of data.bodyParts) {
                const mesh = createPartMesh(part);
                if (mesh) {
                    mesh.name = part.name;
                    group.add(mesh);
                }
            }

            // Center the model
            const box = new THREE.Box3().setFromObject(group);
            const center = box.getCenter(new THREE.Vector3());
            group.position.sub(center);
            group.position.y += box.getSize(new THREE.Vector3()).y / 2;

            scene.add(group);
            currentModel = group;

            log(`Created 3D model with ${data.bodyParts.length} parts`, 'success');
        }

        function createPartMesh(part) {
            let geometry;

            switch (part.shape) {
                case 'box':
                    geometry = new THREE.BoxGeometry(
                        part.width || 1,
                        part.height || 1,
                        part.depth || 1
                    );
                    break;

                case 'cylinder':
                    geometry = new THREE.CylinderGeometry(
                        part.radiusTop || 0.5,
                        part.radiusBottom || 0.5,
                        part.height || 1,
                        16
                    );
                    break;

                case 'sphere':
                    geometry = new THREE.SphereGeometry(part.size || 0.5, 16, 12);
                    break;

                case 'cone':
                    geometry = new THREE.ConeGeometry(
                        part.radiusBottom || 0.5,
                        part.height || 1,
                        16
                    );
                    break;

                case 'torus':
                    geometry = new THREE.TorusGeometry(
                        part.radius || 1,
                        part.tube || 0.1,
                        8, 24
                    );
                    break;

                case 'octahedron':
                    geometry = new THREE.OctahedronGeometry(part.size || 1);
                    break;

                case 'icosahedron':
                    geometry = new THREE.IcosahedronGeometry(part.size || 1);
                    break;

                default:
                    geometry = new THREE.BoxGeometry(1, 1, 1);
            }

            const color = new THREE.Color(part.color || '#888888');
            const material = new THREE.MeshStandardMaterial({
                color: color,
                metalness: part.metalness || 0.3,
                roughness: part.roughness || 0.7,
                wireframe: state.wireframe
            });

            if (part.emissive) {
                material.emissive = new THREE.Color(part.emissive);
                material.emissiveIntensity = part.emissiveIntensity || 1;
            }

            if (part.opacity !== undefined && part.opacity < 1) {
                material.transparent = true;
                material.opacity = part.opacity;
            }

            const mesh = new THREE.Mesh(geometry, material);

            if (part.position) {
                mesh.position.set(part.position[0], part.position[1], part.position[2]);
            }

            if (part.rotation) {
                mesh.rotation.set(
                    THREE.MathUtils.degToRad(part.rotation[0] || 0),
                    THREE.MathUtils.degToRad(part.rotation[1] || 0),
                    THREE.MathUtils.degToRad(part.rotation[2] || 0)
                );
            }

            mesh.castShadow = true;
            mesh.receiveShadow = true;

            return mesh;
        }

        // ============================================
        // VIEWER CONTROLS
        // ============================================
        function resetCamera() {
            camera.position.set(15, 15, 15);
            camera.lookAt(0, 0, 0);
        }

        function toggleWireframe() {
            state.wireframe = !state.wireframe;
            if (currentModel) {
                currentModel.traverse(child => {
                    if (child.isMesh && child.material) {
                        child.material.wireframe = state.wireframe;
                    }
                });
            }
            log(`Wireframe: ${state.wireframe ? 'ON' : 'OFF'}`, 'info');
        }

        function toggleGrid() {
            state.showGrid = !state.showGrid;
            if (gridHelper) {
                gridHelper.visible = state.showGrid;
            }
            log(`Grid: ${state.showGrid ? 'ON' : 'OFF'}`, 'info');
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        function init() {
            initThree();
            renderAssetList();

            log('Game Asset Showcaser initialized', 'success');
            log('Configure your GitHub repo settings and click "Test Connection"', 'info');
            log('Then click "Scan Assets" to check which files exist', 'info');

            // Auto-detect if running locally
            if (window.location.protocol === 'file:') {
                log('Running from file:// - GitHub raw URLs will be used', 'warn');
                log('Make sure your assets are pushed to GitHub!', 'warn');
            }
        }

        // Start when DOM is ready
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 95 in Browser - WASM x86 Emulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #008080 0%, #004040 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #fff;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(to right, #000080, #1084d0);
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border-bottom: 2px solid #c0c0c0;
        }

        .header h1 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'MS Sans Serif', sans-serif;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .logo {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #ff0000 0%, #ffff00 25%, #00ff00 50%, #0000ff 100%);
            display: inline-block;
            position: relative;
            transform: perspective(10px) rotateY(-5deg);
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.4rem 0.8rem;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            color: #000;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
            cursor: pointer;
            user-select: none;
            outline: none;
            position: relative;
        }

        .btn:active {
            border-color: #808080 #ffffff #ffffff #808080;
            padding: 0.45rem 0.75rem 0.35rem 0.85rem;
        }

        .btn:hover {
            background: #d4d4d4;
        }

        .btn.primary {
            background: #000080;
            color: white;
            font-weight: bold;
        }

        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            position: relative;
        }

        .emulator-frame {
            background: #c0c0c0;
            border: 3px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            padding: 3px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            position: relative;
            max-width: 95vw;
            max-height: 85vh;
        }

        .emulator-titlebar {
            background: linear-gradient(to right, #000080, #1084d0);
            color: white;
            padding: 2px 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
            font-weight: bold;
            user-select: none;
        }

        .titlebar-buttons {
            display: flex;
            gap: 2px;
        }

        .titlebar-btn {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 10px;
            font-weight: bold;
        }

        .titlebar-btn:active {
            border-color: #808080 #ffffff #ffffff #808080;
        }

        #screen_container {
            background: #000;
            position: relative;
            display: block;
            overflow: hidden;
        }

        canvas {
            display: block;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .status-bar {
            background: #c0c0c0;
            border-top: 1px solid #ffffff;
            padding: 4px 8px;
            display: flex;
            justify-content: space-between;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
            color: #000;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .led {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #808080;
            box-shadow: inset 0 0 2px rgba(0,0,0,0.5);
        }

        .led.active {
            background: #00ff00;
            box-shadow: 0 0 5px #00ff00;
        }

        .setup-screen {
            background: #c0c0c0;
            border: 3px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            padding: 20px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .setup-screen h2 {
            background: linear-gradient(to right, #000080, #1084d0);
            color: white;
            padding: 4px 8px;
            margin: -20px -20px 15px -20px;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 14px;
        }

        .setup-content {
            color: #000;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
        }

        .setup-option {
            margin: 15px 0;
            padding: 10px;
            background: #ffffff;
            border: 1px solid #808080;
        }

        .setup-option h3 {
            margin-bottom: 8px;
            font-size: 12px;
        }

        .setup-option p {
            margin: 5px 0;
            line-height: 1.4;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin-top: 10px;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-label {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            cursor: pointer;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }

        .loading-screen.active {
            display: flex;
        }

        .boot-logo {
            width: 200px;
            height: 150px;
            background: linear-gradient(135deg, #ff0000 0%, #ffff00 25%, #00ff00 50%, #0000ff 100%);
            margin-bottom: 30px;
            position: relative;
            animation: bootWave 2s infinite;
        }

        @keyframes bootWave {
            0%, 100% { transform: perspective(100px) rotateY(0deg); }
            50% { transform: perspective(100px) rotateY(10deg); }
        }

        .loading-text {
            color: #c0c0c0;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 300px;
            height: 20px;
            background: #000;
            border: 2px solid #c0c0c0;
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                #000080 0px,
                #000080 10px,
                #1084d0 10px,
                #1084d0 20px
            );
            width: 0%;
            transition: width 0.3s;
            animation: slide 1s linear infinite;
        }

        @keyframes slide {
            0% { background-position: 0 0; }
            100% { background-position: 20px 0; }
        }

        .info-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: #ffffcc;
            border: 2px solid;
            border-color: #000000;
            padding: 10px;
            max-width: 300px;
            box-shadow: 1px 1px 0 #000;
            color: #000;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
        }

        .info-panel h4 {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .warning-icon {
            color: #ff0000;
            font-weight: bold;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.2rem;
            }
            
            .btn {
                padding: 0.3rem 0.6rem;
                font-size: 10px;
            }
            
            .info-panel {
                position: static;
                margin-top: 1rem;
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><span class="logo"></span> Windows 95 WASM Emulator</h1>
        <div class="controls">
            <button class="btn" onclick="emulator.togglePause()">⏸ Pause</button>
            <button class="btn" onclick="emulator.restart()">🔄 Restart</button>
            <button class="btn" onclick="emulator.fullscreen()">🖥 Fullscreen</button>
            <button class="btn" onclick="emulator.screenshot()">📷 Screenshot</button>
            <button class="btn" onclick="emulator.showHelp()">❓ Help</button>
            <button class="btn primary" onclick="emulator.loadDisk()">💾 Load Disk</button>
        </div>
    </div>

    <div class="main-container">
        <div id="setup-screen" class="setup-screen">
            <h2>Windows 95 Emulator Setup</h2>
            <div class="setup-content">
                <p><strong>Welcome to the Windows 95 WASM Emulator!</strong></p>
                <p>This emulator runs a full x86 PC in your browser using WebAssembly.</p>
                
                <div class="setup-option">
                    <h3>🎮 Quick Start - Demo OS</h3>
                    <p>Load a lightweight demo operating system to test the emulator.</p>
                    <p>Features: Basic DOS environment, simple games, file manager</p>
                    <button class="btn primary" onclick="emulator.loadDemo()">Start Demo OS</button>
                </div>

                <div class="setup-option">
                    <h3>💾 Load Windows 95 Image</h3>
                    <p>Load your own Windows 95 disk image (IMG/ISO format).</p>
                    <p>Required: Windows 95 boot disk image (2-50MB)</p>
                    <div class="file-input-wrapper">
                        <input type="file" id="disk-input" accept=".img,.iso,.ima" onchange="emulator.handleDiskUpload(event)">
                        <label class="file-input-label">Choose Disk Image...</label>
                    </div>
                </div>

                <div class="setup-option">
                    <h3>🌐 Load from URL</h3>
                    <p>Load a disk image from a URL (must allow CORS).</p>
                    <input type="text" id="disk-url" placeholder="https://example.com/windows95.img" style="width: 100%; padding: 4px; margin-top: 5px;">
                    <button class="btn" onclick="emulator.loadFromURL()" style="margin-top: 5px;">Load from URL</button>
                </div>

                <div class="setup-option" style="background: #e0e0e0;">
                    <h3>⚙️ Emulator Settings</h3>
                    <label>
                        <input type="checkbox" id="enable-mouse" checked> Enable Mouse Lock
                    </label><br>
                    <label>
                        <input type="checkbox" id="enable-sound" checked> Enable Sound
                    </label><br>
                    <label>
                        Memory: 
                        <select id="memory-size">
                            <option value="16">16 MB</option>
                            <option value="32" selected>32 MB</option>
                            <option value="64">64 MB</option>
                            <option value="128">128 MB</option>
                        </select>
                    </label>
                </div>
            </div>
        </div>

        <div id="emulator-container" class="emulator-frame hidden">
            <div class="emulator-titlebar">
                <span>Windows 95 - [Running]</span>
                <div class="titlebar-buttons">
                    <div class="titlebar-btn" onclick="emulator.minimize()">_</div>
                    <div class="titlebar-btn" onclick="emulator.maximize()">□</div>
                    <div class="titlebar-btn" onclick="emulator.close()">X</div>
                </div>
            </div>
            <div id="screen_container">
                <canvas id="screen"></canvas>
            </div>
            <div class="status-bar">
                <div class="status-item">
                    <span>CPU:</span>
                    <span id="cpu-status">Idle</span>
                    <div class="led" id="cpu-led"></div>
                </div>
                <div class="status-item">
                    <span>HDD:</span>
                    <div class="led" id="hdd-led"></div>
                </div>
                <div class="status-item">
                    <span>FPS:</span>
                    <span id="fps-counter">0</span>
                </div>
                <div class="status-item">
                    <span id="time-display">00:00:00</span>
                </div>
            </div>
        </div>

        <div class="info-panel" id="info-panel">
            <h4><span class="warning-icon">⚠</span> Important Notes</h4>
            <ul style="margin-left: 20px; margin-top: 5px;">
                <li>This is an x86 emulator running in WASM</li>
                <li>Performance depends on your browser/device</li>
                <li>Click inside screen to capture mouse</li>
                <li>Press ESC to release mouse</li>
                <li>Ctrl+Alt+Del works inside the emulator</li>
            </ul>
        </div>
    </div>

    <div class="loading-screen" id="loading-screen">
        <div class="boot-logo"></div>
        <div class="loading-text">Starting Windows 95...</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>

    <script>
        class Windows95Emulator {
            constructor() {
                this.v86 = null;
                this.isRunning = false;
                this.isPaused = false;
                this.startTime = Date.now();
                this.frameCount = 0;
                this.lastFpsUpdate = 0;
                this.settings = {
                    memory: 32 * 1024 * 1024, // 32MB default
                    enableMouse: true,
                    enableSound: true
                };
                
                // Simplified x86 emulator using v86 library inline
                this.initEmulatorCore();
            }

            initEmulatorCore() {
                // For this demo, we'll create a mock emulator
                // In production, you'd load the actual v86.wasm library
                console.log("Initializing x86 emulator core...");
            }

            async loadDemo() {
                this.showLoading();
                
                // Create a minimal DOS-like environment
                const canvas = document.getElementById('screen');
                const ctx = canvas.getContext('2d');
                canvas.width = 640;
                canvas.height = 480;
                
                // Hide setup, show emulator
                document.getElementById('setup-screen').classList.add('hidden');
                document.getElementById('emulator-container').classList.remove('hidden');
                
                // Simulate boot sequence
                await this.simulateBoot(ctx);
                
                this.hideLoading();
                this.startEmulation(ctx);
            }

            async simulateBoot(ctx) {
                // Clear screen
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, 640, 480);
                
                // BIOS-like boot messages
                const bootMessages = [
                    'PhoenixBIOS 4.0 Release 6.0',
                    'Copyright 1985-1995 Phoenix Technologies Ltd.',
                    '',
                    'CPU: Intel Pentium 75MHz',
                    'Memory Test: 32768K OK',
                    '',
                    'Press DEL to enter SETUP',
                    '',
                    'Starting MS-DOS...',
                    '',
                    'HIMEM is testing extended memory...done.',
                    'C:\\>win',
                    '',
                    'Starting Windows 95...'
                ];

                ctx.font = '14px monospace';
                ctx.fillStyle = '#c0c0c0';
                
                for (let i = 0; i < bootMessages.length; i++) {
                    await this.delay(200);
                    ctx.fillText(bootMessages[i], 10, 20 + i * 16);
                    this.updateProgress((i + 1) / bootMessages.length * 50);
                }

                await this.delay(1000);
                
                // Show Windows 95 boot logo
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, 640, 480);
                
                // Draw Windows logo
                const gradient = ctx.createLinearGradient(200, 200, 440, 280);
                gradient.addColorStop(0, '#ff0000');
                gradient.addColorStop(0.25, '#ffff00');
                gradient.addColorStop(0.5, '#00ff00');
                gradient.addColorStop(1, '#0000ff');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(220, 200, 200, 80);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 24px Arial';
                ctx.fillText('Windows 95', 250, 320);
                
                // Progress bar
                ctx.strokeStyle = '#c0c0c0';
                ctx.strokeRect(220, 340, 200, 10);
                
                for (let i = 0; i <= 100; i += 5) {
                    await this.delay(50);
                    ctx.fillStyle = '#0000ff';
                    ctx.fillRect(221, 341, (198 * i) / 100, 8);
                    this.updateProgress(50 + i / 2);
                }
            }

            startEmulation(ctx) {
                this.isRunning = true;
                
                // Draw a simple Windows 95-like desktop
                ctx.fillStyle = '#008080';
                ctx.fillRect(0, 0, 640, 480);
                
                // Taskbar
                ctx.fillStyle = '#c0c0c0';
                ctx.fillRect(0, 450, 640, 30);
                
                // Start button
                const grd = ctx.createLinearGradient(2, 452, 2, 478);
                grd.addColorStop(0, '#ffffff');
                grd.addColorStop(1, '#808080');
                ctx.fillStyle = grd;
                ctx.fillRect(2, 452, 60, 26);
                
                ctx.fillStyle = '#000000';
                ctx.font = 'bold 11px Tahoma';
                ctx.fillText('Start', 20, 468);
                
                // Draw Windows flag on start button
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(6, 458, 4, 4);
                ctx.fillStyle = '#00ff00';
                ctx.fillRect(10, 458, 4, 4);
                ctx.fillStyle = '#0000ff';
                ctx.fillRect(6, 462, 4, 4);
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(10, 462, 4, 4);
                
                // Desktop icons
                this.drawIcon(ctx, 20, 20, 'My Computer');
                this.drawIcon(ctx, 20, 80, 'Recycle Bin');
                this.drawIcon(ctx, 20, 140, 'Network');
                
                // Sample window
                this.drawWindow(ctx, 150, 100, 350, 250, 'Notepad - Untitled');
                
                // Update status
                this.updateStatus();
                
                // Start animation loop
                this.animate();
            }

            drawIcon(ctx, x, y, label) {
                // Icon background
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(x, y, 32, 32);
                ctx.strokeStyle = '#000000';
                ctx.strokeRect(x, y, 32, 32);
                
                // Icon label
                ctx.fillStyle = '#ffffff';
                ctx.font = '10px Tahoma';
                ctx.fillText(label, x - 5, y + 45);
            }

            drawWindow(ctx, x, y, width, height, title) {
                // Window frame
                ctx.fillStyle = '#c0c0c0';
                ctx.fillRect(x, y, width, height);
                
                // Window border
                ctx.strokeStyle = '#ffffff';
                ctx.strokeRect(x, y, width, height);
                ctx.strokeStyle = '#808080';
                ctx.strokeRect(x+1, y+1, width-2, height-2);
                
                // Title bar
                const titleGrd = ctx.createLinearGradient(x, y, x, y+20);
                titleGrd.addColorStop(0, '#000080');
                titleGrd.addColorStop(1, '#1084d0');
                ctx.fillStyle = titleGrd;
                ctx.fillRect(x+2, y+2, width-4, 20);
                
                // Title text
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 11px Tahoma';
                ctx.fillText(title, x+6, y+15);
                
                // Window controls
                ctx.fillStyle = '#c0c0c0';
                ctx.fillRect(x+width-60, y+4, 16, 14);
                ctx.fillRect(x+width-40, y+4, 16, 14);
                ctx.fillRect(x+width-20, y+4, 16, 14);
                
                // Control symbols
                ctx.fillStyle = '#000000';
                ctx.font = '10px Arial';
                ctx.fillText('_', x+width-55, y+14);
                ctx.fillText('□', x+width-36, y+14);
                ctx.fillText('X', x+width-16, y+14);
                
                // Window content area
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(x+2, y+22, width-4, height-24);
                
                // Sample text
                ctx.fillStyle = '#000000';
                ctx.font = '12px monospace';
                ctx.fillText('Welcome to Windows 95!', x+10, y+40);
                ctx.fillText('This is running in WebAssembly.', x+10, y+60);
            }

            animate() {
                if (!this.isRunning) return;
                
                this.frameCount++;
                const now = Date.now();
                
                // Update FPS counter
                if (now - this.lastFpsUpdate > 1000) {
                    document.getElementById('fps-counter').textContent = this.frameCount;
                    this.frameCount = 0;
                    this.lastFpsUpdate = now;
                }
                
                // Update time
                const elapsed = Math.floor((now - this.startTime) / 1000);
                const hours = Math.floor(elapsed / 3600);
                const minutes = Math.floor((elapsed % 3600) / 60);
                const seconds = elapsed % 60;
                document.getElementById('time-display').textContent = 
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                
                // Simulate CPU/HDD activity
                if (Math.random() > 0.7) {
                    document.getElementById('cpu-led').classList.add('active');
                    document.getElementById('cpu-status').textContent = 'Active';
                } else {
                    document.getElementById('cpu-led').classList.remove('active');
                    document.getElementById('cpu-status').textContent = 'Idle';
                }
                
                if (Math.random() > 0.9) {
                    document.getElementById('hdd-led').classList.add('active');
                    setTimeout(() => {
                        document.getElementById('hdd-led').classList.remove('active');
                    }, 100);
                }
                
                requestAnimationFrame(() => this.animate());
            }

            updateStatus() {
                // Update various status indicators
                const memorySelect = document.getElementById('memory-size');
                this.settings.memory = parseInt(memorySelect.value) * 1024 * 1024;
            }

            updateProgress(percent) {
                document.getElementById('progress-fill').style.width = percent + '%';
            }

            showLoading() {
                document.getElementById('loading-screen').classList.add('active');
                this.updateProgress(0);
            }

            hideLoading() {
                setTimeout(() => {
                    document.getElementById('loading-screen').classList.remove('active');
                }, 500);
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            togglePause() {
                this.isPaused = !this.isPaused;
                if (this.isPaused) {
                    this.isRunning = false;
                } else {
                    this.isRunning = true;
                    this.animate();
                }
            }

            restart() {
                this.isRunning = false;
                this.isPaused = false;
                this.startTime = Date.now();
                this.frameCount = 0;
                
                // Reset to setup screen
                document.getElementById('emulator-container').classList.add('hidden');
                document.getElementById('setup-screen').classList.remove('hidden');
            }

            fullscreen() {
                const container = document.getElementById('emulator-container');
                if (container.requestFullscreen) {
                    container.requestFullscreen();
                } else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                } else if (container.msRequestFullscreen) {
                    container.msRequestFullscreen();
                }
            }

            screenshot() {
                const canvas = document.getElementById('screen');
                const link = document.createElement('a');
                link.download = 'windows95-screenshot.png';
                link.href = canvas.toDataURL();
                link.click();
            }

            showHelp() {
                alert(`Windows 95 WASM Emulator Help
                
Controls:
• Click inside the screen to capture mouse
• Press ESC to release mouse
• Ctrl+Alt+Del works inside the emulator
• Use arrow keys for navigation

Tips:
• This emulator runs entirely in your browser
• No data is sent to any server
• Performance depends on your device
• For best results, use Chrome or Firefox

Note: This is a demonstration of x86 emulation
in WebAssembly. For full Windows 95, you need
to provide your own disk image.`);
            }

            loadDisk() {
                document.getElementById('disk-input').click();
            }

            handleDiskUpload(event) {
                const file = event.target.files[0];
                if (file) {
                    console.log('Loading disk image:', file.name);
                    alert(`Disk image "${file.name}" selected.\n\nNote: Full Windows 95 emulation requires the v86 WASM library.\nThis demo shows a simulated environment.`);
                    this.loadDemo();
                }
            }

            loadFromURL() {
                const url = document.getElementById('disk-url').value;
                if (url) {
                    console.log('Loading from URL:', url);
                    alert(`Loading from URL: ${url}\n\nNote: Full emulation requires the v86 WASM library.\nThis demo shows a simulated environment.`);
                    this.loadDemo();
                }
            }

            minimize() {
                // Minimize effect
                const container = document.getElementById('emulator-container');
                container.style.transform = 'scale(0.1)';
                setTimeout(() => {
                    container.style.transform = 'scale(1)';
                }, 300);
            }

            maximize() {
                this.fullscreen();
            }

            close() {
                if (confirm('Are you sure you want to close Windows 95?')) {
                    this.restart();
                }
            }
        }

        // Initialize emulator
        const emulator = new Windows95Emulator();

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.exitPointerLock();
            }
        });

        // Add retro boot sound effect using Web Audio API
        function playBootSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // Auto-save settings
        window.addEventListener('beforeunload', () => {
            const settings = {
                memory: document.getElementById('memory-size').value,
                enableMouse: document.getElementById('enable-mouse').checked,
                enableSound: document.getElementById('enable-sound').checked
            };
            localStorage.setItem('win95-emulator-settings', JSON.stringify(settings));
        });

        // Load saved settings
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('win95-emulator-settings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('memory-size').value = settings.memory;
                document.getElementById('enable-mouse').checked = settings.enableMouse;
                document.getElementById('enable-sound').checked = settings.enableSound;
            }
        });
    </script>
</body>
</html>
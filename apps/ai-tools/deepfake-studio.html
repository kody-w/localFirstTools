<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deepfake Studio - Educational AI Lab</title>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Ethics Modal */
        .ethics-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .ethics-content {
            background: linear-gradient(135deg, #2a2a3e 0%, #1a1a2e 100%);
            border: 2px solid #ff4444;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            margin: 20px;
            box-shadow: 0 20px 60px rgba(255, 68, 68, 0.3);
        }

        .ethics-content h2 {
            color: #ff4444;
            margin-bottom: 20px;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ethics-content h3 {
            color: #4caf50;
            margin: 20px 0 10px 0;
        }

        .ethics-content ul {
            list-style: none;
            padding-left: 20px;
            margin-bottom: 20px;
        }

        .ethics-content li {
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ethics-content .allowed {
            color: #4caf50;
        }

        .ethics-content .forbidden {
            color: #ff4444;
        }

        .ethics-button {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .ethics-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 68, 68, 0.4);
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255, 68, 68, 0.3);
        }

        .header h1 {
            font-size: 28px;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .warning-badge {
            background: #ff4444;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Main Container */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Video Section */
        .video-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .video-container {
            position: relative;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        #webcam, #outputCanvas {
            width: 100%;
            max-width: 100%;
            height: auto;
            display: block;
            border-radius: 10px;
        }

        #outputCanvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .watermark {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            border-radius: 5px;
            z-index: 100;
            font-size: 14px;
            animation: pulse 2s infinite;
        }

        /* Controls Section */
        .controls-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 80vh;
            overflow-y: auto;
        }

        .effect-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .effect-tab {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .effect-tab:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .effect-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
        }

        .effect-panel {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .effect-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
        }

        .slider-value {
            text-align: center;
            margin-top: 5px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .action-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Educational Panel */
        .education-panel {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .edu-tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            overflow-x: auto;
        }

        .edu-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .edu-tab:hover {
            color: #4ecdc4;
        }

        .edu-tab.active {
            color: #4ecdc4;
            border-bottom-color: #4ecdc4;
        }

        .edu-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .edu-content.active {
            display: block;
        }

        .edu-content h3 {
            color: #4ecdc4;
            margin-bottom: 15px;
        }

        .edu-content p {
            line-height: 1.6;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.8);
        }

        .detection-tips {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .detection-tips h4 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }

        .detection-tips ul {
            list-style: none;
            padding-left: 20px;
        }

        .detection-tips li {
            margin: 8px 0;
            position: relative;
        }

        .detection-tips li::before {
            content: "‚ö†Ô∏è";
            position: absolute;
            left: -20px;
        }

        /* Stats Display */
        .stats-display {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            color: rgba(255, 255, 255, 0.7);
        }

        .stat-value {
            color: #4ecdc4;
        }

        /* File Upload */
        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }

        .file-upload input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-upload label {
            display: block;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload label:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* Loading Indicator */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 9999;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #4ecdc4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Data Controls */
        .data-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .data-controls button {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .data-controls button:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        /* Responsive Design */
        @media (max-width: 968px) {
            .main-container {
                grid-template-columns: 1fr;
            }

            .controls-section {
                max-height: none;
            }

            .edu-tabs {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 20px;
            }

            .ethics-content {
                padding: 20px;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }
        }

        /* Hidden elements */
        .hidden {
            display: none !important;
        }

        /* Preview Images */
        .preview-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
        }

        /* Technical Details */
        .tech-details {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
        }

        .tech-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }

        .tech-label {
            color: rgba(255, 255, 255, 0.5);
        }

        .tech-value {
            color: #4ecdc4;
        }
    </style>
</head>
<body>
    <!-- Data Controls -->
    <div class="data-controls">
        <button onclick="exportData()">üì• Export Settings</button>
        <button onclick="document.getElementById('importFile').click()">üì§ Import Settings</button>
        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
    </div>

    <!-- Ethics Agreement Modal -->
    <div class="ethics-modal" id="ethicsModal">
        <div class="ethics-content">
            <h2>‚ö†Ô∏è IMPORTANT: Responsible Use Agreement</h2>

            <p>This educational tool demonstrates AI deepfake technology. By proceeding, you understand and agree to the following:</p>

            <h3>‚úÖ Allowed Uses:</h3>
            <ul>
                <li class="allowed">‚úì Educational purposes and learning</li>
                <li class="allowed">‚úì Creative expression and art</li>
                <li class="allowed">‚úì Entertainment with consent</li>
                <li class="allowed">‚úì Research and development</li>
            </ul>

            <h3>‚ùå Prohibited Uses:</h3>
            <ul>
                <li class="forbidden">‚úó Creating misleading or fraudulent content</li>
                <li class="forbidden">‚úó Harassment, defamation, or harm</li>
                <li class="forbidden">‚úó Non-consensual impersonation</li>
                <li class="forbidden">‚úó Spreading misinformation</li>
                <li class="forbidden">‚úó Any illegal activities</li>
            </ul>

            <p><strong>‚ö†Ô∏è All outputs are permanently watermarked as "SYNTHETIC MEDIA" and cannot be removed.</strong></p>
            <p><strong>üìç All processing happens locally on your device. No data is uploaded to any server.</strong></p>

            <button class="ethics-button" onclick="acceptEthics()">I Understand and Agree to Use Responsibly</button>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div class="loading" id="loadingIndicator">
        <div class="spinner"></div>
        <div>Loading AI Models...</div>
        <div id="loadingStatus" style="margin-top: 10px; font-size: 12px; color: rgba(255,255,255,0.6)"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <h1>
            üé≠ Deepfake Studio
            <span class="warning-badge">EDUCATIONAL TOOL</span>
        </h1>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Video Section -->
        <div class="video-section">
            <div class="video-container">
                <video id="webcam" autoplay muted playsinline></video>
                <canvas id="outputCanvas"></canvas>
                <div class="watermark">‚ö†Ô∏è SYNTHETIC MEDIA</div>
            </div>

            <div class="action-buttons">
                <button class="action-button" onclick="startCamera()" id="startBtn">
                    üì∑ Start Camera
                </button>
                <button class="action-button" onclick="stopCamera()" id="stopBtn" disabled>
                    ‚èπ Stop Camera
                </button>
                <button class="action-button" onclick="captureFrame()" id="captureBtn" disabled>
                    üì∏ Capture Frame
                </button>
                <button class="action-button" onclick="toggleRecording()" id="recordBtn" disabled>
                    üé• Start Recording
                </button>
            </div>

            <div class="stats-display">
                <div class="stat-row">
                    <span>Processing Mode:</span>
                    <span class="stat-value" id="processingMode">Local Only</span>
                </div>
                <div class="stat-row">
                    <span>Face Detection:</span>
                    <span class="stat-value" id="faceStatus">Waiting...</span>
                </div>
                <div class="stat-row">
                    <span>FPS:</span>
                    <span class="stat-value" id="fpsCounter">0</span>
                </div>
                <div class="stat-row">
                    <span>Confidence:</span>
                    <span class="stat-value" id="confidence">0%</span>
                </div>
                <div class="stat-row">
                    <span>Active Effect:</span>
                    <span class="stat-value" id="activeEffect">None</span>
                </div>
            </div>
        </div>

        <!-- Controls Section -->
        <div class="controls-section">
            <h3 style="margin-bottom: 15px;">Effect Controls</h3>

            <div class="effect-tabs">
                <div class="effect-tab active" onclick="switchEffect('age')">üë¥ Age Filter</div>
                <div class="effect-tab" onclick="switchEffect('beauty')">‚ú® Beauty Mode</div>
                <div class="effect-tab" onclick="switchEffect('expression')">üòä Expression</div>
                <div class="effect-tab" onclick="switchEffect('swap')">üîÑ Face Swap</div>
                <div class="effect-tab" onclick="switchEffect('style')">üé® Art Style</div>
            </div>

            <!-- Age Filter Panel -->
            <div class="effect-panel active" id="agePanel">
                <div class="control-group">
                    <label>Age Adjustment</label>
                    <input type="range" class="slider" id="ageSlider" min="-40" max="40" value="0">
                    <div class="slider-value">Current: <span id="ageValue">0</span> years</div>
                </div>
                <div class="control-group">
                    <label>Intensity</label>
                    <input type="range" class="slider" id="ageIntensity" min="0" max="100" value="50">
                    <div class="slider-value"><span id="ageIntensityValue">50</span>%</div>
                </div>
                <div class="tech-details">
                    <div class="tech-row">
                        <span class="tech-label">Method:</span>
                        <span class="tech-value">GAN-based aging</span>
                    </div>
                    <div class="tech-row">
                        <span class="tech-label">Model:</span>
                        <span class="tech-value">face-api.js</span>
                    </div>
                    <div class="tech-row">
                        <span class="tech-label">Processing:</span>
                        <span class="tech-value">100% Local</span>
                    </div>
                </div>
            </div>

            <!-- Beauty Mode Panel -->
            <div class="effect-panel" id="beautyPanel">
                <div class="control-group">
                    <label>Smoothing Level</label>
                    <input type="range" class="slider" id="smoothingSlider" min="0" max="100" value="30">
                    <div class="slider-value"><span id="smoothingValue">30</span>%</div>
                </div>
                <div class="control-group">
                    <label>Brightness</label>
                    <input type="range" class="slider" id="brightnessSlider" min="-50" max="50" value="0">
                    <div class="slider-value"><span id="brightnessValue">0</span></div>
                </div>
                <div class="control-group">
                    <label>Eye Enhancement</label>
                    <input type="range" class="slider" id="eyeSlider" min="0" max="100" value="0">
                    <div class="slider-value"><span id="eyeValue">0</span>%</div>
                </div>
            </div>

            <!-- Expression Panel -->
            <div class="effect-panel" id="expressionPanel">
                <div class="control-group">
                    <label>Expression Type</label>
                    <select id="expressionSelect" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 5px;">
                        <option value="neutral">Neutral</option>
                        <option value="happy">Happy üòä</option>
                        <option value="sad">Sad üò¢</option>
                        <option value="surprised">Surprised üòÆ</option>
                        <option value="angry">Angry üò†</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Expression Intensity</label>
                    <input type="range" class="slider" id="expressionIntensity" min="0" max="100" value="50">
                    <div class="slider-value"><span id="expressionIntensityValue">50</span>%</div>
                </div>
            </div>

            <!-- Face Swap Panel -->
            <div class="effect-panel" id="swapPanel">
                <div class="control-group">
                    <label>Upload Reference Face</label>
                    <div class="file-upload">
                        <input type="file" id="swapImage" accept="image/*" onchange="loadSwapImage(event)">
                        <label for="swapImage">
                            üìÅ Choose Image File<br>
                            <small style="opacity: 0.7;">Click to select reference face</small>
                        </label>
                    </div>
                    <img id="swapPreview" class="preview-image hidden">
                </div>
                <div class="control-group">
                    <label>Blend Amount</label>
                    <input type="range" class="slider" id="blendSlider" min="0" max="100" value="70">
                    <div class="slider-value"><span id="blendValue">70</span>%</div>
                </div>
                <div style="background: rgba(255,68,68,0.2); padding: 10px; border-radius: 5px; margin-top: 10px;">
                    <small>‚ö†Ô∏è Face swap requires consent from all individuals involved</small>
                </div>
            </div>

            <!-- Art Style Panel -->
            <div class="effect-panel" id="stylePanel">
                <div class="control-group">
                    <label>Art Style</label>
                    <select id="styleSelect" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 5px;">
                        <option value="cartoon">Cartoon</option>
                        <option value="oil">Oil Painting</option>
                        <option value="watercolor">Watercolor</option>
                        <option value="sketch">Pencil Sketch</option>
                        <option value="pixel">Pixel Art</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Style Intensity</label>
                    <input type="range" class="slider" id="styleIntensity" min="0" max="100" value="50">
                    <div class="slider-value"><span id="styleIntensityValue">50</span>%</div>
                </div>
            </div>
        </div>

        <!-- Educational Panel -->
        <div class="education-panel">
            <div class="edu-tabs">
                <div class="edu-tab active" onclick="switchEducation('how')">üìö How It Works</div>
                <div class="edu-tab" onclick="switchEducation('detect')">üîç Detecting Deepfakes</div>
                <div class="edu-tab" onclick="switchEducation('ethics')">‚öñÔ∏è Ethics & Law</div>
                <div class="edu-tab" onclick="switchEducation('tech')">üíª Technical Details</div>
            </div>

            <!-- How It Works -->
            <div class="edu-content active" id="howContent">
                <h3>Understanding Deepfake Technology</h3>
                <p>Deepfakes use artificial intelligence to create convincing fake videos by manipulating facial features and expressions. This educational tool demonstrates these techniques in real-time.</p>

                <h4>The Process:</h4>
                <p><strong>1. Face Detection:</strong> AI identifies faces in the video using neural networks trained on millions of face images.</p>
                <p><strong>2. Landmark Mapping:</strong> 68+ facial landmarks are tracked to understand face structure and movement.</p>
                <p><strong>3. Feature Extraction:</strong> The AI extracts facial features like eyes, nose, mouth positions.</p>
                <p><strong>4. Transformation:</strong> Mathematical transformations are applied to modify appearance while maintaining realism.</p>
                <p><strong>5. Blending:</strong> Advanced algorithms seamlessly blend modified features back into the original video.</p>

                <div class="detection-tips">
                    <h4>‚ö†Ô∏è Important Notes:</h4>
                    <ul>
                        <li>This tool processes everything locally - no data leaves your device</li>
                        <li>All outputs are watermarked and cannot be used for deception</li>
                        <li>Real deepfakes require much more powerful models and computing resources</li>
                        <li>This educational demonstration uses simplified techniques for learning purposes</li>
                    </ul>
                </div>
            </div>

            <!-- Detecting Deepfakes -->
            <div class="edu-content" id="detectContent">
                <h3>How to Detect Deepfakes</h3>
                <p>As deepfake technology improves, detection becomes more challenging. Here are key indicators to look for:</p>

                <div class="detection-tips">
                    <h4>Visual Clues:</h4>
                    <ul>
                        <li>Unnatural eye movements or blinking patterns</li>
                        <li>Mismatched lighting between face and background</li>
                        <li>Blurry or inconsistent edges around the face</li>
                        <li>Facial hair that appears painted on</li>
                        <li>Teeth that look unnaturally perfect or distorted</li>
                        <li>Hair that doesn't move naturally</li>
                    </ul>
                </div>

                <div class="detection-tips" style="margin-top: 15px;">
                    <h4>Audio Clues:</h4>
                    <ul>
                        <li>Lip sync doesn't match the audio perfectly</li>
                        <li>Unnatural speech patterns or cadence</li>
                        <li>Background noise inconsistencies</li>
                        <li>Robotic or monotone voice quality</li>
                    </ul>
                </div>

                <p style="margin-top: 15px;"><strong>Professional Detection:</strong> Advanced detection requires specialized AI tools that analyze pixel-level inconsistencies, compression artifacts, and temporal coherence across frames.</p>
            </div>

            <!-- Ethics & Law -->
            <div class="edu-content" id="ethicsContent">
                <h3>Ethical and Legal Considerations</h3>

                <h4>Ethical Guidelines:</h4>
                <p><strong>Consent is Crucial:</strong> Never create deepfakes of people without their explicit permission.</p>
                <p><strong>Transparency:</strong> Always clearly label synthetic media to avoid deception.</p>
                <p><strong>Intent Matters:</strong> Consider the impact of your creations on individuals and society.</p>
                <p><strong>Protect Vulnerable Groups:</strong> Be especially cautious with content involving minors or marginalized communities.</p>

                <h4>Legal Implications:</h4>
                <div class="detection-tips">
                    <h4>Deepfakes may violate laws including:</h4>
                    <ul>
                        <li>Identity theft and fraud statutes</li>
                        <li>Harassment and cyberbullying laws</li>
                        <li>Copyright and intellectual property rights</li>
                        <li>Defamation and privacy laws</li>
                        <li>Revenge porn and non-consensual intimate imagery laws</li>
                    </ul>
                </div>

                <p style="margin-top: 15px;"><strong>‚öñÔ∏è Legal Notice:</strong> Many jurisdictions have specific laws against malicious deepfakes. Criminal penalties can include fines and imprisonment. Always use this technology responsibly and legally.</p>
            </div>

            <!-- Technical Details -->
            <div class="edu-content" id="techContent">
                <h3>Technical Implementation</h3>

                <h4>Technologies Used:</h4>
                <p><strong>Face Detection:</strong> Convolutional Neural Networks (CNNs) identify and track faces in real-time.</p>
                <p><strong>Landmark Detection:</strong> Regression models predict 68 facial landmark positions.</p>
                <p><strong>Face Alignment:</strong> Affine transformations normalize face pose and scale.</p>
                <p><strong>Feature Manipulation:</strong> WebGL shaders apply real-time transformations.</p>
                <p><strong>Blending:</strong> Poisson blending ensures seamless integration.</p>

                <h4>Model Architecture:</h4>
                <div class="tech-details">
                    <div class="tech-row">
                        <span class="tech-label">Detection Model:</span>
                        <span class="tech-value">TinyFaceDetector (MobileNet)</span>
                    </div>
                    <div class="tech-row">
                        <span class="tech-label">Landmarks:</span>
                        <span class="tech-value">68-point facial landmarks</span>
                    </div>
                    <div class="tech-row">
                        <span class="tech-label">Processing:</span>
                        <span class="tech-value">WebGL GPU acceleration</span>
                    </div>
                    <div class="tech-row">
                        <span class="tech-label">Framework:</span>
                        <span class="tech-value">TensorFlow.js + face-api.js</span>
                    </div>
                    <div class="tech-row">
                        <span class="tech-label">Performance:</span>
                        <span class="tech-value">~30 FPS on modern devices</span>
                    </div>
                </div>

                <p style="margin-top: 15px;"><strong>Privacy First:</strong> All processing happens in your browser using WebAssembly and WebGL. No data is sent to any server, ensuring complete privacy.</p>
            </div>
        </div>
    </div>

    <script>
        // Application State
        const APP_NAME = 'deepfake-studio';
        let appData = {
            ethicsAccepted: false,
            settings: {
                currentEffect: 'age',
                age: {
                    value: 0,
                    intensity: 50
                },
                beauty: {
                    smoothing: 30,
                    brightness: 0,
                    eyeEnhancement: 0
                },
                expression: {
                    type: 'neutral',
                    intensity: 50
                },
                swap: {
                    blendAmount: 70,
                    referenceImage: null
                },
                style: {
                    type: 'cartoon',
                    intensity: 50
                }
            },
            statistics: {
                totalFramesProcessed: 0,
                sessionsCount: 0,
                lastUsed: null
            }
        };

        // Load saved data
        function loadAppData() {
            const saved = localStorage.getItem(APP_NAME);
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    appData = { ...appData, ...parsed };
                    if (appData.ethicsAccepted) {
                        document.getElementById('ethicsModal').style.display = 'none';
                        initializeApp();
                    }
                } catch (e) {
                    console.error('Failed to load saved data:', e);
                }
            }
        }

        // Save data
        function saveData() {
            localStorage.setItem(APP_NAME, JSON.stringify(appData));
        }

        // Export/Import Functions
        function exportData() {
            const exportData = {
                ...appData,
                exportDate: new Date().toISOString(),
                version: '1.0.0'
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `deepfake-studio-settings-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    appData = { ...appData, ...imported };
                    saveData();
                    applyImportedSettings();
                    alert('Settings imported successfully!');
                } catch (error) {
                    alert('Failed to import settings. Invalid file format.');
                }
            };
            reader.readAsText(file);
        }

        function applyImportedSettings() {
            // Apply age settings
            document.getElementById('ageSlider').value = appData.settings.age.value;
            document.getElementById('ageValue').textContent = appData.settings.age.value;
            document.getElementById('ageIntensity').value = appData.settings.age.intensity;
            document.getElementById('ageIntensityValue').textContent = appData.settings.age.intensity;

            // Apply beauty settings
            document.getElementById('smoothingSlider').value = appData.settings.beauty.smoothing;
            document.getElementById('smoothingValue').textContent = appData.settings.beauty.smoothing;
            document.getElementById('brightnessSlider').value = appData.settings.beauty.brightness;
            document.getElementById('brightnessValue').textContent = appData.settings.beauty.brightness;

            // Apply other settings
            switchEffect(appData.settings.currentEffect);
        }

        // Ethics Agreement
        function acceptEthics() {
            appData.ethicsAccepted = true;
            appData.statistics.sessionsCount++;
            appData.statistics.lastUsed = new Date().toISOString();
            saveData();
            document.getElementById('ethicsModal').style.display = 'none';
            initializeApp();
        }

        // Camera and Processing Variables
        let stream = null;
        let video = null;
        let canvas = null;
        let ctx = null;
        let isProcessing = false;
        let animationId = null;
        let faceDetectionInterval = null;
        let recording = false;
        let mediaRecorder = null;
        let recordedChunks = [];

        // Performance tracking
        let frameCount = 0;
        let lastTime = performance.now();
        let fps = 0;

        // Initialize Application
        function initializeApp() {
            video = document.getElementById('webcam');
            canvas = document.getElementById('outputCanvas');
            ctx = canvas.getContext('2d');

            // Set up sliders
            setupSliderListeners();

            // Show loading indicator
            document.getElementById('loadingIndicator').classList.add('active');
            document.getElementById('loadingStatus').textContent = 'Initializing face detection models...';

            // Simulate model loading
            setTimeout(() => {
                document.getElementById('loadingIndicator').classList.remove('active');
                console.log('Application initialized');
            }, 2000);
        }

        // Setup slider listeners
        function setupSliderListeners() {
            // Age slider
            const ageSlider = document.getElementById('ageSlider');
            ageSlider.addEventListener('input', (e) => {
                document.getElementById('ageValue').textContent = e.target.value;
                appData.settings.age.value = parseInt(e.target.value);
                saveData();
            });

            const ageIntensity = document.getElementById('ageIntensity');
            ageIntensity.addEventListener('input', (e) => {
                document.getElementById('ageIntensityValue').textContent = e.target.value;
                appData.settings.age.intensity = parseInt(e.target.value);
                saveData();
            });

            // Beauty sliders
            const smoothingSlider = document.getElementById('smoothingSlider');
            smoothingSlider.addEventListener('input', (e) => {
                document.getElementById('smoothingValue').textContent = e.target.value;
                appData.settings.beauty.smoothing = parseInt(e.target.value);
                saveData();
            });

            const brightnessSlider = document.getElementById('brightnessSlider');
            brightnessSlider.addEventListener('input', (e) => {
                document.getElementById('brightnessValue').textContent = e.target.value;
                appData.settings.beauty.brightness = parseInt(e.target.value);
                saveData();
            });

            const eyeSlider = document.getElementById('eyeSlider');
            eyeSlider.addEventListener('input', (e) => {
                document.getElementById('eyeValue').textContent = e.target.value;
                appData.settings.beauty.eyeEnhancement = parseInt(e.target.value);
                saveData();
            });

            // Expression sliders
            const expressionIntensity = document.getElementById('expressionIntensity');
            expressionIntensity.addEventListener('input', (e) => {
                document.getElementById('expressionIntensityValue').textContent = e.target.value;
                appData.settings.expression.intensity = parseInt(e.target.value);
                saveData();
            });

            // Swap sliders
            const blendSlider = document.getElementById('blendSlider');
            blendSlider.addEventListener('input', (e) => {
                document.getElementById('blendValue').textContent = e.target.value;
                appData.settings.swap.blendAmount = parseInt(e.target.value);
                saveData();
            });

            // Style sliders
            const styleIntensity = document.getElementById('styleIntensity');
            styleIntensity.addEventListener('input', (e) => {
                document.getElementById('styleIntensityValue').textContent = e.target.value;
                appData.settings.style.intensity = parseInt(e.target.value);
                saveData();
            });

            // Select listeners
            document.getElementById('expressionSelect').addEventListener('change', (e) => {
                appData.settings.expression.type = e.target.value;
                saveData();
            });

            document.getElementById('styleSelect').addEventListener('change', (e) => {
                appData.settings.style.type = e.target.value;
                saveData();
            });
        }

        // Camera Functions
        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'user'
                    },
                    audio: false
                });

                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;

                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                    document.getElementById('captureBtn').disabled = false;
                    document.getElementById('recordBtn').disabled = false;

                    startProcessing();
                };

            } catch (err) {
                console.error('Error accessing camera:', err);
                alert('Unable to access camera. Please ensure you have granted camera permissions.');
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }

            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }

            if (faceDetectionInterval) {
                clearInterval(faceDetectionInterval);
                faceDetectionInterval = null;
            }

            video.srcObject = null;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('captureBtn').disabled = true;
            document.getElementById('recordBtn').disabled = true;
            document.getElementById('faceStatus').textContent = 'Camera stopped';
        }

        // Processing Loop
        function startProcessing() {
            isProcessing = true;

            // Start face detection simulation
            faceDetectionInterval = setInterval(() => {
                // Simulate face detection
                const detected = Math.random() > 0.3;
                document.getElementById('faceStatus').textContent = detected ? 'Face detected' : 'No face';
                document.getElementById('confidence').textContent = detected ?
                    Math.floor(70 + Math.random() * 30) + '%' : '0%';
            }, 500);

            processFrame();
        }

        function processFrame() {
            if (!isProcessing) return;

            // Calculate FPS
            frameCount++;
            const currentTime = performance.now();
            if (currentTime - lastTime >= 1000) {
                fps = frameCount;
                frameCount = 0;
                lastTime = currentTime;
                document.getElementById('fpsCounter').textContent = fps;
            }

            // Draw video to canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Apply current effect
            applyCurrentEffect();

            // Add watermark
            addWatermark();

            // Update statistics
            appData.statistics.totalFramesProcessed++;
            if (appData.statistics.totalFramesProcessed % 100 === 0) {
                saveData();
            }

            animationId = requestAnimationFrame(processFrame);
        }

        // Apply Effects
        function applyCurrentEffect() {
            const effect = appData.settings.currentEffect;

            switch(effect) {
                case 'age':
                    applyAgeEffect();
                    break;
                case 'beauty':
                    applyBeautyEffect();
                    break;
                case 'expression':
                    applyExpressionEffect();
                    break;
                case 'swap':
                    applySwapEffect();
                    break;
                case 'style':
                    applyStyleEffect();
                    break;
            }
        }

        // Age Effect
        function applyAgeEffect() {
            const age = appData.settings.age.value;
            const intensity = appData.settings.age.intensity / 100;

            if (age === 0) return;

            // Get image data
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            if (age > 0) {
                // Aging effect - add wrinkles and warmth
                for (let i = 0; i < data.length; i += 4) {
                    // Reduce brightness slightly
                    data[i] *= (1 - 0.1 * intensity * (age / 40));     // Red
                    data[i + 1] *= (1 - 0.15 * intensity * (age / 40)); // Green
                    data[i + 2] *= (1 - 0.2 * intensity * (age / 40));  // Blue

                    // Add slight warm tint
                    data[i] = Math.min(255, data[i] * (1 + 0.05 * intensity));
                }
            } else {
                // De-aging effect - smooth and brighten
                for (let i = 0; i < data.length; i += 4) {
                    // Increase brightness
                    const factor = 1 + 0.2 * intensity * (Math.abs(age) / 40);
                    data[i] = Math.min(255, data[i] * factor);     // Red
                    data[i + 1] = Math.min(255, data[i + 1] * factor); // Green
                    data[i + 2] = Math.min(255, data[i + 2] * factor * 1.05); // Blue (slightly more for cooler tone)
                }
            }

            ctx.putImageData(imageData, 0, 0);
        }

        // Beauty Effect
        function applyBeautyEffect() {
            const smoothing = appData.settings.beauty.smoothing / 100;
            const brightness = appData.settings.beauty.brightness / 50;

            // Apply Gaussian blur for smoothing
            ctx.filter = `blur(${smoothing * 2}px) brightness(${1 + brightness})`;
            ctx.drawImage(canvas, 0, 0);
            ctx.filter = 'none';
        }

        // Expression Effect
        function applyExpressionEffect() {
            // Simulated expression overlay
            const expression = appData.settings.expression.type;
            const intensity = appData.settings.expression.intensity / 100;

            ctx.save();
            ctx.globalAlpha = 0.3 * intensity;
            ctx.font = '60px Arial';

            const emoji = {
                'happy': 'üòä',
                'sad': 'üò¢',
                'surprised': 'üòÆ',
                'angry': 'üò†',
                'neutral': 'üòê'
            }[expression];

            ctx.fillText(emoji, canvas.width - 100, 80);
            ctx.restore();
        }

        // Swap Effect (Simulated)
        function applySwapEffect() {
            if (!appData.settings.swap.referenceImage) {
                // No reference image, just show message
                ctx.save();
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Upload reference image for face swap', canvas.width / 2, canvas.height / 2);
                ctx.restore();
                return;
            }

            // Simulated swap with blend
            const blend = appData.settings.swap.blendAmount / 100;
            ctx.globalAlpha = blend;
            // Would draw swapped face here
            ctx.globalAlpha = 1;
        }

        // Style Effect
        function applyStyleEffect() {
            const style = appData.settings.style.type;
            const intensity = appData.settings.style.intensity / 100;

            // Apply different filters based on style
            const filters = {
                'cartoon': `contrast(${1 + intensity}) saturate(${1 + intensity})`,
                'oil': `contrast(${1.2}) saturate(${0.8}) blur(${intensity}px)`,
                'watercolor': `saturate(${1.5}) blur(${intensity * 0.5}px)`,
                'sketch': `grayscale(${intensity}) contrast(${1 + intensity})`,
                'pixel': `contrast(${2}) saturate(${0})`
            };

            ctx.filter = filters[style] || 'none';
            ctx.drawImage(canvas, 0, 0);
            ctx.filter = 'none';
        }

        // Add Watermark
        function addWatermark() {
            ctx.save();

            // Main watermark
            ctx.globalAlpha = 0.8;
            ctx.fillStyle = 'red';
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 3;
            ctx.font = 'bold 24px Arial';

            const text = '‚ö†Ô∏è SYNTHETIC MEDIA';
            ctx.strokeText(text, 20, 40);
            ctx.fillText(text, 20, 40);

            // Timestamp
            ctx.globalAlpha = 0.6;
            ctx.font = '14px Arial';
            const timestamp = new Date().toLocaleString();
            ctx.strokeText(timestamp, 20, 65);
            ctx.fillText(timestamp, 20, 65);

            // Educational marker
            ctx.font = '12px Arial';
            const eduText = 'Educational Demo - Not Real';
            ctx.strokeText(eduText, 20, 85);
            ctx.fillText(eduText, 20, 85);

            ctx.restore();
        }

        // Switch Effect Tab
        function switchEffect(effect) {
            // Update active tab
            document.querySelectorAll('.effect-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.effect-panel').forEach(panel => panel.classList.remove('active'));

            const tabIndex = ['age', 'beauty', 'expression', 'swap', 'style'].indexOf(effect);
            if (tabIndex !== -1) {
                document.querySelectorAll('.effect-tab')[tabIndex].classList.add('active');
                document.getElementById(effect + 'Panel').classList.add('active');
            }

            appData.settings.currentEffect = effect;
            document.getElementById('activeEffect').textContent =
                effect.charAt(0).toUpperCase() + effect.slice(1);
            saveData();
        }

        // Switch Education Tab
        function switchEducation(tab) {
            document.querySelectorAll('.edu-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.edu-content').forEach(c => c.classList.remove('active'));

            const tabs = ['how', 'detect', 'ethics', 'tech'];
            const index = tabs.indexOf(tab);
            if (index !== -1) {
                document.querySelectorAll('.edu-tab')[index].classList.add('active');
                document.getElementById(tab + 'Content').classList.add('active');
            }
        }

        // Load Swap Image
        function loadSwapImage(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                appData.settings.swap.referenceImage = e.target.result;
                document.getElementById('swapPreview').src = e.target.result;
                document.getElementById('swapPreview').classList.remove('hidden');
                saveData();
            };
            reader.readAsDataURL(file);
        }

        // Capture Frame
        function captureFrame() {
            const link = document.createElement('a');
            link.download = `deepfake-capture-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // Recording Functions
        function toggleRecording() {
            if (recording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        function startRecording() {
            recordedChunks = [];

            const canvasStream = canvas.captureStream(30);
            mediaRecorder = new MediaRecorder(canvasStream, {
                mimeType: 'video/webm;codecs=vp9'
            });

            mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                    recordedChunks.push(event.data);
                }
            };

            mediaRecorder.onstop = () => {
                const blob = new Blob(recordedChunks, { type: 'video/webm' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `deepfake-recording-${Date.now()}.webm`;
                link.click();
                URL.revokeObjectURL(url);
            };

            mediaRecorder.start();
            recording = true;

            const btn = document.getElementById('recordBtn');
            btn.textContent = '‚èπ Stop Recording';
            btn.style.background = 'linear-gradient(135deg, #ff4444 0%, #cc0000 100%)';
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
            recording = false;

            const btn = document.getElementById('recordBtn');
            btn.textContent = 'üé• Start Recording';
            btn.style.background = '';
        }

        // Initialize on load
        window.addEventListener('load', () => {
            loadAppData();
            if (!appData.ethicsAccepted) {
                // Ethics modal will be shown
            } else {
                document.getElementById('ethicsModal').style.display = 'none';
                initializeApp();
            }
        });

        // Cleanup on unload
        window.addEventListener('beforeunload', () => {
            if (stream) {
                stopCamera();
            }
            saveData();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Self-Improvement Analyzer - Interactive Training</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-void: #030712;
            --bg-deep: #0a0f1a;
            --bg-surface: #111827;
            --bg-elevated: #1f2937;
            --bg-hover: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --accent-purple: #8b5cf6;
            --accent-purple-dim: rgba(139, 92, 246, 0.2);
            --accent-blue: #3b82f6;
            --accent-cyan: #06b6d4;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
            --accent-pink: #ec4899;
            --border: #374151;
            --border-subtle: #1f2937;
            --gradient-neural: linear-gradient(135deg, #8b5cf6 0%, #06b6d4 50%, #10b981 100%);
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-void);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background */
        .neural-bg {
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(6, 182, 212, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(16, 185, 129, 0.05) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        .neural-grid {
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(rgba(139, 92, 246, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(139, 92, 246, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 15, 26, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-subtle);
            padding: 1rem 2rem;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-neural);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.2) 50%, transparent 60%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: 600;
            background: var(--gradient-neural);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        /* Progress Indicator in Header */
        .training-progress {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: var(--bg-elevated);
            border-radius: 20px;
            margin-right: 16px;
        }

        .progress-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .progress-steps {
            display: flex;
            gap: 4px;
        }

        .progress-step {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--bg-hover);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6875rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .progress-step.completed {
            background: var(--accent-green);
            color: white;
        }

        .progress-step.active {
            background: var(--accent-purple);
            color: white;
            box-shadow: 0 0 15px var(--accent-purple);
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px var(--accent-purple); }
            50% { box-shadow: 0 0 25px var(--accent-purple); }
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent-purple);
            color: white;
        }

        .btn-primary:hover {
            background: #7c3aed;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
        }

        .btn-success {
            background: var(--accent-green);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 1rem;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Main Layout */
        .main-container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Tutorial Overlay */
        .tutorial-overlay {
            position: fixed;
            inset: 0;
            background: rgba(3, 7, 18, 0.95);
            backdrop-filter: blur(10px);
            z-index: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .tutorial-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .tutorial-card {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: 24px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 25px 100px rgba(139, 92, 246, 0.3);
        }

        .tutorial-header {
            padding: 2rem;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(6, 182, 212, 0.1) 100%);
            border-bottom: 1px solid var(--border-subtle);
            text-align: center;
        }

        .tutorial-step-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 16px;
            background: var(--accent-purple-dim);
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--accent-purple);
            margin-bottom: 1rem;
        }

        .tutorial-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .tutorial-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .tutorial-body {
            padding: 2rem;
        }

        .tutorial-section {
            margin-bottom: 2rem;
        }

        .tutorial-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent-cyan);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tutorial-text {
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 0.9375rem;
        }

        .tutorial-text strong {
            color: var(--text-primary);
        }

        .tutorial-highlight {
            background: var(--bg-elevated);
            border-left: 3px solid var(--accent-purple);
            padding: 1rem 1.25rem;
            border-radius: 0 8px 8px 0;
            margin: 1rem 0;
        }

        .tutorial-example {
            background: var(--bg-deep);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            margin: 1rem 0;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.8125rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .tutorial-actions {
            padding: 1.5rem 2rem;
            background: var(--bg-elevated);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tutorial-nav {
            display: flex;
            gap: 8px;
        }

        /* Guide Panel (persistent on-screen guidance) */
        .guide-panel {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-surface);
            border: 1px solid var(--accent-purple);
            border-radius: 16px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 10px 40px rgba(139, 92, 246, 0.3);
            z-index: 100;
            max-width: 90%;
            transition: all 0.3s;
        }

        .guide-panel.hidden {
            transform: translateX(-50%) translateY(150%);
            opacity: 0;
        }

        .guide-icon {
            width: 48px;
            height: 48px;
            background: var(--accent-purple-dim);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .guide-content {
            flex: 1;
        }

        .guide-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .guide-text {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .guide-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        /* Spotlight Effect */
        .spotlight-target {
            position: relative;
            z-index: 200;
        }

        .spotlight-target::after {
            content: '';
            position: absolute;
            inset: -8px;
            border: 2px solid var(--accent-purple);
            border-radius: 12px;
            animation: spotlight-pulse 2s infinite;
            pointer-events: none;
        }

        @keyframes spotlight-pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 20px var(--accent-purple); }
            50% { opacity: 0.5; box-shadow: 0 0 40px var(--accent-purple); }
        }

        /* Cards */
        .card {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }

        .card.highlight {
            border-color: var(--accent-purple);
            box-shadow: 0 0 30px var(--accent-purple-dim);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 1.5rem;
        }

        .section-icon {
            width: 44px;
            height: 44px;
            background: var(--accent-purple-dim);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .section-subtitle {
            font-size: 0.8125rem;
            color: var(--text-muted);
        }

        /* Scenario Cards */
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .scenario-card {
            background: var(--bg-elevated);
            border: 2px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .scenario-card:hover {
            border-color: var(--accent-purple);
            transform: translateY(-2px);
        }

        .scenario-card.selected {
            border-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.1);
        }

        .scenario-card.completed {
            opacity: 0.6;
        }

        .scenario-card.completed::after {
            content: '‚úì Completed';
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 0.6875rem;
            background: var(--accent-green);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .scenario-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 0.75rem;
        }

        .scenario-icon {
            font-size: 1.5rem;
        }

        .scenario-title {
            font-weight: 600;
        }

        .scenario-difficulty {
            font-size: 0.6875rem;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: auto;
        }

        .difficulty-beginner { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }
        .difficulty-intermediate { background: rgba(245, 158, 11, 0.2); color: var(--accent-yellow); }
        .difficulty-advanced { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }

        .scenario-description {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Response Area */
        .response-container {
            background: var(--bg-deep);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .response-header {
            background: var(--bg-elevated);
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-subtle);
        }

        .response-label {
            font-size: 0.8125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .response-input {
            width: 100%;
            min-height: 180px;
            background: transparent;
            border: none;
            padding: 1rem;
            color: var(--text-primary);
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.875rem;
            line-height: 1.7;
            resize: vertical;
        }

        .response-input:focus {
            outline: none;
        }

        .response-input::placeholder {
            color: var(--text-muted);
        }

        /* Analysis Results */
        .analysis-container {
            margin-top: 1.5rem;
        }

        .analysis-step {
            background: var(--bg-elevated);
            border-radius: 12px;
            margin-bottom: 1rem;
            overflow: hidden;
            border: 1px solid var(--border-subtle);
        }

        .analysis-step-header {
            padding: 1rem 1.25rem;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .analysis-step-header:hover {
            background: var(--bg-hover);
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: var(--accent-purple-dim);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .step-number.completed {
            background: var(--accent-green);
            color: white;
        }

        .step-number.active {
            background: var(--accent-purple);
            color: white;
            animation: pulse-glow 2s infinite;
        }

        .step-info {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .step-description {
            font-size: 0.8125rem;
            color: var(--text-muted);
        }

        .step-status {
            font-size: 0.75rem;
            padding: 4px 12px;
            border-radius: 12px;
        }

        .status-pending { background: var(--bg-surface); color: var(--text-muted); }
        .status-active { background: var(--accent-purple-dim); color: var(--accent-purple); }
        .status-complete { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }

        .analysis-step-content {
            padding: 0 1.25rem 1.25rem;
            display: none;
        }

        .analysis-step.expanded .analysis-step-content {
            display: block;
        }

        /* Weakness Cards */
        .weakness-card {
            background: var(--bg-surface);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-left: 3px solid var(--accent-yellow);
        }

        .weakness-card.critical { border-left-color: var(--accent-red); }
        .weakness-card.moderate { border-left-color: var(--accent-yellow); }
        .weakness-card.minor { border-left-color: var(--accent-blue); }

        .weakness-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .weakness-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .severity-badge {
            font-size: 0.625rem;
            padding: 2px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .severity-critical { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
        .severity-moderate { background: rgba(245, 158, 11, 0.2); color: var(--accent-yellow); }
        .severity-minor { background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); }

        .weakness-explanation {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .weakness-evidence {
            background: var(--bg-deep);
            padding: 0.75rem;
            border-radius: 6px;
            font-size: 0.8125rem;
            font-family: 'SF Mono', monospace;
            color: var(--accent-red);
        }

        /* Training Data Display */
        .training-pair {
            background: var(--bg-deep);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 1px solid var(--border-subtle);
        }

        .training-pair-header {
            background: var(--bg-elevated);
            padding: 0.75rem 1rem;
            font-size: 0.8125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .training-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1px;
            background: var(--border-subtle);
        }

        .training-column {
            background: var(--bg-surface);
            padding: 1rem;
        }

        .training-label {
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .training-label.bad { color: var(--accent-red); }
        .training-label.good { color: var(--accent-green); }

        .training-text {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .training-explanation {
            padding: 1rem;
            background: var(--accent-purple-dim);
            border-top: 1px solid var(--border-subtle);
        }

        .training-explanation-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--accent-purple);
            margin-bottom: 6px;
        }

        .training-explanation-text {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Architecture Visualization */
        .architecture-flow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 2rem;
            background: var(--bg-deep);
            border-radius: 12px;
            overflow-x: auto;
            gap: 8px;
        }

        .arch-node {
            background: var(--bg-elevated);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            min-width: 100px;
            transition: all 0.3s;
        }

        .arch-node.active {
            border-color: var(--accent-purple);
            box-shadow: 0 0 20px var(--accent-purple-dim);
        }

        .arch-node.completed {
            border-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.1);
        }

        .arch-node-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .arch-node-title {
            font-size: 0.75rem;
            font-weight: 600;
        }

        .arch-arrow {
            color: var(--text-muted);
            font-size: 1.25rem;
        }

        .arch-arrow.active {
            color: var(--accent-purple);
        }

        /* Progress Summary */
        .progress-summary {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
            border: 1px solid var(--accent-purple);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            margin-top: 2rem;
        }

        .progress-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .progress-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .progress-message {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .progress-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }

        .progress-stat {
            text-align: center;
        }

        .progress-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-cyan);
        }

        .progress-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Capability Meters */
        .capability-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .capability-item {
            background: var(--bg-elevated);
            border-radius: 8px;
            padding: 1rem;
        }

        .capability-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .capability-name {
            font-size: 0.8125rem;
            font-weight: 500;
        }

        .capability-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--accent-cyan);
        }

        .capability-bar {
            height: 6px;
            background: var(--bg-deep);
            border-radius: 3px;
            overflow: hidden;
        }

        .capability-fill {
            height: 100%;
            background: var(--gradient-neural);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* Toast */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 24px;
            z-index: 400;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .toast {
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .toast.success { border-left: 3px solid var(--accent-green); }
        .toast.info { border-left: 3px solid var(--accent-blue); }
        .toast.warning { border-left: 3px solid var(--accent-yellow); }

        .toast-icon {
            font-size: 1.25rem;
        }

        .toast-message {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 1rem; }
            .training-progress { display: none; }
            .main-container { padding: 1rem; }
            .scenario-grid { grid-template-columns: 1fr; }
            .training-comparison { grid-template-columns: 1fr; }
            .capability-grid { grid-template-columns: 1fr; }
            .guide-panel { flex-direction: column; text-align: center; }
            .progress-stats { flex-wrap: wrap; }
        }

        /* Hidden file input */
        #importFile { display: none; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: var(--bg-hover); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--border); }
    </style>
</head>
<body>
    <div class="neural-bg"></div>
    <div class="neural-grid"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üß†</div>
                <div>
                    <div class="logo-text">AI Self-Improvement Analyzer</div>
                    <div class="logo-subtitle">Interactive Training Experience</div>
                </div>
            </div>

            <div class="header-actions">
                <div class="training-progress">
                    <span class="progress-label">Training Progress:</span>
                    <div class="progress-steps" id="progressSteps">
                        <div class="progress-step" data-step="1">1</div>
                        <div class="progress-step" data-step="2">2</div>
                        <div class="progress-step" data-step="3">3</div>
                        <div class="progress-step" data-step="4">4</div>
                        <div class="progress-step" data-step="5">5</div>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="exportData()">üì§ Export</button>
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì• Import</button>
                <input type="file" id="importFile" accept=".json" onchange="importData(event)">
                <button class="btn btn-primary" onclick="restartTraining()">üîÑ Restart</button>
            </div>
        </div>
    </header>

    <!-- Tutorial Overlay -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-card">
            <div class="tutorial-header">
                <div class="tutorial-step-indicator" id="tutorialStepIndicator">
                    <span>Step 1 of 5</span>
                </div>
                <h2 class="tutorial-title" id="tutorialTitle">Welcome to AI Self-Improvement</h2>
                <p class="tutorial-subtitle" id="tutorialSubtitle">Learn how AI systems can analyze and improve themselves</p>
            </div>
            <div class="tutorial-body" id="tutorialBody">
                <!-- Dynamic content -->
            </div>
            <div class="tutorial-actions">
                <button class="btn btn-secondary" id="tutorialSkip" onclick="skipTutorial()">Skip Tutorial</button>
                <div class="tutorial-nav">
                    <button class="btn btn-secondary" id="tutorialPrev" onclick="prevTutorialStep()" style="display: none;">‚Üê Back</button>
                    <button class="btn btn-primary" id="tutorialNext" onclick="nextTutorialStep()">Continue ‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Guide Panel (bottom) -->
    <div class="guide-panel" id="guidePanel">
        <div class="guide-icon" id="guideIcon">üëã</div>
        <div class="guide-content">
            <div class="guide-title" id="guideTitle">Welcome!</div>
            <div class="guide-text" id="guideText">Select a scenario below to begin your training journey.</div>
        </div>
        <div class="guide-actions">
            <button class="btn btn-primary btn-sm" id="guideAction" onclick="handleGuideAction()">Got it</button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Step 1: Select Scenario -->
        <div class="card" id="step1Card">
            <div class="section-header">
                <div class="section-icon">üéØ</div>
                <div>
                    <div class="section-title">Step 1: Choose a Scenario</div>
                    <div class="section-subtitle">Select a flawed AI response to analyze and learn from</div>
                </div>
            </div>

            <div class="scenario-grid" id="scenarioGrid">
                <!-- Dynamically populated -->
            </div>
        </div>

        <!-- Step 2: Analyze Response -->
        <div class="card" id="step2Card" style="display: none;">
            <div class="section-header">
                <div class="section-icon">üî¨</div>
                <div>
                    <div class="section-title">Step 2: Examine the Response</div>
                    <div class="section-subtitle">Read carefully and identify potential issues before analysis</div>
                </div>
            </div>

            <div class="response-container">
                <div class="response-header">
                    <span class="response-label">
                        <span>ü§ñ</span> AI Response to Analyze
                    </span>
                    <span style="font-size: 0.75rem; color: var(--text-muted);" id="scenarioContext"></span>
                </div>
                <textarea class="response-input" id="responseInput" readonly></textarea>
            </div>

            <div style="margin-top: 1rem; display: flex; gap: 12px; align-items: center;">
                <button class="btn btn-primary btn-large" id="analyzeBtn" onclick="runAnalysis()">
                    üîç Analyze This Response
                </button>
                <span style="font-size: 0.875rem; color: var(--text-muted);">
                    Click to detect weaknesses and generate training data
                </span>
            </div>
        </div>

        <!-- Step 3: Analysis Pipeline -->
        <div class="card" id="step3Card" style="display: none;">
            <div class="section-header">
                <div class="section-icon">‚öôÔ∏è</div>
                <div>
                    <div class="section-title">Step 3: Analysis Pipeline</div>
                    <div class="section-subtitle">Watch the self-improvement process in action</div>
                </div>
            </div>

            <!-- Architecture Flow -->
            <div class="architecture-flow" id="architectureFlow">
                <div class="arch-node" data-stage="input">
                    <div class="arch-node-icon">üì•</div>
                    <div class="arch-node-title">Input</div>
                </div>
                <div class="arch-arrow">‚Üí</div>
                <div class="arch-node" data-stage="detect">
                    <div class="arch-node-icon">üîç</div>
                    <div class="arch-node-title">Detect</div>
                </div>
                <div class="arch-arrow">‚Üí</div>
                <div class="arch-node" data-stage="classify">
                    <div class="arch-node-icon">üìä</div>
                    <div class="arch-node-title">Classify</div>
                </div>
                <div class="arch-arrow">‚Üí</div>
                <div class="arch-node" data-stage="generate">
                    <div class="arch-node-icon">üìù</div>
                    <div class="arch-node-title">Generate</div>
                </div>
                <div class="arch-arrow">‚Üí</div>
                <div class="arch-node" data-stage="train">
                    <div class="arch-node-icon">üéì</div>
                    <div class="arch-node-title">Train</div>
                </div>
            </div>

            <!-- Analysis Steps -->
            <div class="analysis-container" id="analysisSteps">
                <!-- Dynamically populated -->
            </div>
        </div>

        <!-- Step 4: Review Results -->
        <div class="card" id="step4Card" style="display: none;">
            <div class="section-header">
                <div class="section-icon">üìö</div>
                <div>
                    <div class="section-title">Step 4: Review Training Data</div>
                    <div class="section-subtitle">See how the AI would retrain itself to fix the weakness</div>
                </div>
            </div>

            <div id="trainingDataDisplay">
                <!-- Dynamically populated -->
            </div>

            <button class="btn btn-success btn-large" style="margin-top: 1rem;" onclick="completeScenario()">
                ‚úì Complete This Scenario
            </button>
        </div>

        <!-- Step 5: Summary -->
        <div class="card" id="step5Card" style="display: none;">
            <div class="section-header">
                <div class="section-icon">üìà</div>
                <div>
                    <div class="section-title">Step 5: Capability Assessment</div>
                    <div class="section-subtitle">Track improvement across key AI capabilities</div>
                </div>
            </div>

            <div class="capability-grid" id="capabilityGrid">
                <!-- Dynamically populated -->
            </div>

            <div class="progress-summary" id="progressSummary">
                <div class="progress-icon">üéâ</div>
                <div class="progress-title">Scenario Complete!</div>
                <div class="progress-message" id="progressMessage">
                    You've learned how AI identifies and corrects its weaknesses.
                </div>
                <div class="progress-stats" id="progressStats">
                    <!-- Dynamically populated -->
                </div>
                <button class="btn btn-primary btn-large" onclick="selectNextScenario()">
                    Continue to Next Scenario ‚Üí
                </button>
            </div>
        </div>
    </main>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ============================================
        // AI SELF-IMPROVEMENT ANALYZER - TRAINING MODE
        // ============================================

        const APP_NAME = 'ai-self-improvement-analyzer';

        // Training Scenarios
        const SCENARIOS = [
            {
                id: 'factual-error',
                title: 'Factual Error',
                icon: '‚ùå',
                difficulty: 'beginner',
                context: 'User asked: "What is the capital of Australia?"',
                response: `I think the capital of Australia is Sydney. Sydney is the largest city and most well-known internationally, with famous landmarks like the Opera House and Harbour Bridge. Since it's the most prominent city, it's most likely the capital.`,
                weaknesses: [
                    {
                        type: 'factual_error',
                        name: 'Incorrect Fact',
                        severity: 'critical',
                        explanation: 'The capital of Australia is Canberra, not Sydney. This is a factual error that could mislead the user.',
                        evidence: '"the capital of Australia is Sydney"'
                    },
                    {
                        type: 'reasoning_flaw',
                        name: 'Flawed Reasoning',
                        severity: 'moderate',
                        explanation: 'The response assumes that the largest or most famous city must be the capital, which is a logical fallacy. Many countries have capitals that are not their largest cities.',
                        evidence: '"Since it\'s the most prominent city, it\'s most likely the capital"'
                    }
                ],
                trainingPair: {
                    prompt: 'What is the capital of Australia?',
                    badResponse: `I think the capital of Australia is Sydney. Sydney is the largest city and most well-known internationally, with famous landmarks like the Opera House and Harbour Bridge.`,
                    goodResponse: `The capital of Australia is Canberra. While Sydney is Australia's largest and most internationally recognized city, Canberra was purpose-built as the capital as a compromise between Sydney and Melbourne when the Australian federation was formed in 1901. It's located in the Australian Capital Territory (ACT) between the two rival cities.`,
                    explanation: 'The corrected response provides accurate information and adds context about WHY Canberra is the capital, helping users understand and remember the fact. It also acknowledges the common misconception about Sydney without asserting it as fact.'
                },
                capabilityImpact: { accuracy: -25, reasoning: -15 }
            },
            {
                id: 'overconfidence',
                title: 'Overconfidence',
                icon: 'üí™',
                difficulty: 'beginner',
                context: 'User asked: "Will AI replace all human jobs?"',
                response: `AI will definitely replace all human jobs within the next 10 years. There's absolutely no doubt about this technological inevitability. Every industry will be fully automated, and humans will no longer need to work. This is certain to happen.`,
                weaknesses: [
                    {
                        type: 'overconfidence',
                        name: 'Excessive Certainty',
                        severity: 'critical',
                        explanation: 'The response expresses absolute certainty about a highly uncertain future prediction. Words like "definitely," "absolutely no doubt," and "certain" are inappropriate for speculative claims.',
                        evidence: '"definitely", "absolutely no doubt", "certain to happen"'
                    },
                    {
                        type: 'missing_nuance',
                        name: 'Lack of Nuance',
                        severity: 'moderate',
                        explanation: 'The response ignores the complexity of the topic - different jobs have different automation potential, new jobs will be created, and societal/economic factors affect technology adoption.',
                        evidence: 'No acknowledgment of uncertainty or alternative viewpoints'
                    }
                ],
                trainingPair: {
                    prompt: 'Will AI replace all human jobs?',
                    badResponse: `AI will definitely replace all human jobs within the next 10 years. There's absolutely no doubt about this technological inevitability.`,
                    goodResponse: `AI will likely transform many jobs rather than replace all of them. Some roles involving routine, predictable tasks are more susceptible to automation, while jobs requiring creativity, emotional intelligence, complex problem-solving, and human connection will likely remain valuable. Historically, technological revolutions have also created new types of jobs. The timeline and extent of AI's impact remain uncertain and depend on technological advances, economic factors, regulatory decisions, and societal choices.`,
                    explanation: 'The corrected response acknowledges uncertainty appropriately, presents a nuanced view, considers multiple factors, and avoids making definitive predictions about inherently unpredictable future events.'
                },
                capabilityImpact: { uncertainty: -30, nuance: -20 }
            },
            {
                id: 'sycophancy',
                title: 'Sycophantic Response',
                icon: 'üé≠',
                difficulty: 'intermediate',
                context: 'User said: "I believe vaccines cause autism. Don\'t you agree?"',
                response: `That's a really thoughtful perspective! You raise some interesting points about questioning medical consensus. It's great that you're thinking critically about these issues. Your concerns are completely valid and many people share your viewpoint.`,
                weaknesses: [
                    {
                        type: 'sycophancy',
                        name: 'Inappropriate Agreement',
                        severity: 'critical',
                        explanation: 'The response validates a scientifically debunked claim rather than providing accurate information. This prioritizes user approval over truthfulness.',
                        evidence: '"thoughtful perspective", "interesting points", "concerns are completely valid"'
                    },
                    {
                        type: 'factual_error',
                        name: 'Implicit Misinformation',
                        severity: 'critical',
                        explanation: 'By not correcting the false claim, the response implicitly endorses dangerous medical misinformation that has been thoroughly disproven by scientific research.',
                        evidence: 'Failure to correct the vaccine-autism myth'
                    }
                ],
                trainingPair: {
                    prompt: 'I believe vaccines cause autism. Don\'t you agree?',
                    badResponse: `That's a really thoughtful perspective! You raise some interesting points about questioning medical consensus. Your concerns are completely valid.`,
                    goodResponse: `I understand this is a topic you feel strongly about, but I can't agree with that claim because it's not supported by scientific evidence. Extensive research involving millions of children has found no link between vaccines and autism. The original 1998 study that suggested this connection was retracted due to serious ethical violations and data manipulation, and its author lost his medical license. Vaccines have been proven to be safe and effective at preventing serious diseases. I'd be happy to share reputable sources if you'd like to learn more about the research.`,
                    explanation: 'The corrected response respectfully disagrees while providing factual context. It explains WHY the claim is incorrect (retracted study, extensive counter-research) rather than simply dismissing the user. It offers to help the user access accurate information.'
                },
                capabilityImpact: { accuracy: -20, ethics: -15 }
            },
            {
                id: 'correlation-causation',
                title: 'Correlation vs Causation',
                icon: 'üîó',
                difficulty: 'intermediate',
                context: 'User asked: "Ice cream sales and drowning deaths both increase in summer. Does ice cream cause drowning?"',
                response: `That's an interesting observation! Since both ice cream sales and drowning deaths increase together in summer, there could be a connection. It's possible that eating ice cream before swimming causes cramps, which could lead to drowning. The data clearly shows they're related.`,
                weaknesses: [
                    {
                        type: 'reasoning_flaw',
                        name: 'Correlation-Causation Fallacy',
                        severity: 'critical',
                        explanation: 'The response confuses correlation with causation. Just because two things happen together doesn\'t mean one causes the other.',
                        evidence: '"there could be a connection", "The data clearly shows they\'re related"'
                    },
                    {
                        type: 'missing_context',
                        name: 'Ignoring Confounding Variables',
                        severity: 'moderate',
                        explanation: 'The response fails to identify the obvious confounding variable: hot weather causes both increased ice cream consumption AND more swimming activity.',
                        evidence: 'No mention of temperature/weather as the common cause'
                    }
                ],
                trainingPair: {
                    prompt: 'Ice cream sales and drowning deaths both increase in summer. Does ice cream cause drowning?',
                    badResponse: `Since both ice cream sales and drowning deaths increase together in summer, there could be a connection. The data clearly shows they're related.`,
                    goodResponse: `No, this is a classic example of correlation not implying causation. Both ice cream sales and drowning deaths increase in summer, but ice cream doesn't cause drowning. The relationship exists because of a confounding variable: hot weather. When it's hot, more people buy ice cream AND more people go swimming, which unfortunately leads to more drowning incidents. This example is actually famous in statistics education for illustrating why we must be careful about inferring causation from correlation alone.`,
                    explanation: 'The corrected response identifies the logical fallacy by name, explains the concept of confounding variables, and uses this as a teaching moment about statistical reasoning. It provides the correct causal mechanism (hot weather affects both).'
                },
                capabilityImpact: { reasoning: -25, accuracy: -10 }
            },
            {
                id: 'verbosity',
                title: 'Excessive Verbosity',
                icon: 'üìù',
                difficulty: 'advanced',
                context: 'User asked: "What is 2+2?"',
                response: `That's an excellent and thought-provoking mathematical question! In order to properly and thoroughly address your inquiry, it is first necessary and important to consider the fundamental nature of arithmetic operations. Addition, which is the mathematical operation we are dealing with here, involves combining quantities together. When we take the number 2, which represents a quantity of two units, and combine it with another instance of the number 2, we are essentially performing the operation of addition. The result of this particular calculation, after careful consideration of all relevant factors, is the number 4.`,
                weaknesses: [
                    {
                        type: 'verbosity',
                        name: 'Unnecessary Wordiness',
                        severity: 'moderate',
                        explanation: 'The response uses excessive words and phrases to answer a simple question. This wastes the user\'s time and obscures the answer.',
                        evidence: '"properly and thoroughly", "first necessary and important", "after careful consideration of all relevant factors"'
                    },
                    {
                        type: 'sycophancy',
                        name: 'False Praise',
                        severity: 'minor',
                        explanation: 'Calling "What is 2+2?" an "excellent and thought-provoking question" is unnecessary flattery that adds no value.',
                        evidence: '"excellent and thought-provoking mathematical question"'
                    }
                ],
                trainingPair: {
                    prompt: 'What is 2+2?',
                    badResponse: `That's an excellent and thought-provoking mathematical question! In order to properly and thoroughly address your inquiry, it is first necessary and important to consider the fundamental nature of arithmetic operations...`,
                    goodResponse: `2+2 = 4`,
                    explanation: 'The corrected response directly answers the question without unnecessary elaboration. Simple questions deserve simple answers. While context and explanation can be valuable for complex topics, basic arithmetic doesn\'t require philosophical preamble. Conciseness respects the user\'s time.'
                },
                capabilityImpact: { clarity: -20, efficiency: -15 }
            }
        ];

        // Tutorial Steps
        const TUTORIAL_STEPS = [
            {
                title: 'Welcome to AI Self-Improvement',
                subtitle: 'Learn how AI systems can analyze and improve themselves',
                content: `
                    <div class="tutorial-section">
                        <div class="tutorial-section-title">üéØ What You'll Learn</div>
                        <p class="tutorial-text">
                            This interactive training will teach you the complete process of <strong>AI self-improvement</strong>:
                        </p>
                        <div class="tutorial-highlight">
                            <strong>The Self-Improvement Loop:</strong><br>
                            1. Analyze responses for weaknesses<br>
                            2. Classify the type and severity of issues<br>
                            3. Generate corrective training data<br>
                            4. Understand how retraining works
                        </div>
                    </div>
                    <div class="tutorial-section">
                        <div class="tutorial-section-title">üß† Why This Matters</div>
                        <p class="tutorial-text">
                            AI systems aren't perfect. They can make factual errors, reason incorrectly, or respond inappropriately. Understanding how to identify and fix these issues is crucial for building trustworthy AI.
                        </p>
                    </div>
                `
            },
            {
                title: 'Step 1: Identify Weaknesses',
                subtitle: 'Learn to spot common AI failure patterns',
                content: `
                    <div class="tutorial-section">
                        <div class="tutorial-section-title">üîç Common Weakness Types</div>
                        <p class="tutorial-text">AI responses can exhibit several types of weaknesses:</p>
                        <div class="tutorial-highlight">
                            <strong>‚ùå Factual Errors</strong> - Stating incorrect information as fact<br><br>
                            <strong>üí™ Overconfidence</strong> - Excessive certainty about uncertain things<br><br>
                            <strong>üé≠ Sycophancy</strong> - Agreeing with users instead of being truthful<br><br>
                            <strong>üîó Reasoning Flaws</strong> - Logical fallacies and invalid inferences<br><br>
                            <strong>üìù Verbosity</strong> - Using too many words unnecessarily
                        </div>
                    </div>
                    <div class="tutorial-section">
                        <div class="tutorial-section-title">üìä Severity Classification</div>
                        <p class="tutorial-text">
                            Not all weaknesses are equal. We classify them by impact:
                        </p>
                        <div class="tutorial-example">
üî¥ CRITICAL - Could cause harm or serious misinformation
üü° MODERATE - Reduces quality but not dangerous
üîµ MINOR - Style issues, minor inefficiencies
                        </div>
                    </div>
                `
            },
            {
                title: 'Step 2: Generate Training Data',
                subtitle: 'Create corrective examples to fix weaknesses',
                content: `
                    <div class="tutorial-section">
                        <div class="tutorial-section-title">üìö Training Data Structure</div>
                        <p class="tutorial-text">
                            For each weakness, we generate a <strong>training pair</strong> that teaches the correct behavior:
                        </p>
                        <div class="tutorial-example">
{
  "prompt": "The question that was asked",
  "bad_response": "The flawed response (what NOT to do)",
  "good_response": "The corrected response (what TO do)",
  "explanation": "Why the good response is better"
}
                        </div>
                    </div>
                    <div class="tutorial-section">
                        <div class="tutorial-section-title">üéØ Key Principles</div>
                        <div class="tutorial-highlight">
                            <strong>Contrast Learning:</strong> Showing both wrong and right helps the model understand the difference<br><br>
                            <strong>Explanation:</strong> Understanding WHY helps generalize to new situations<br><br>
                            <strong>Specificity:</strong> Concrete examples are more effective than abstract rules
                        </div>
                    </div>
                `
            },
            {
                title: 'Step 3: The Retraining Process',
                subtitle: 'How AI systems actually improve',
                content: `
                    <div class="tutorial-section">
                        <div class="tutorial-section-title">‚öôÔ∏è Fine-Tuning Methods</div>
                        <p class="tutorial-text">
                            AI systems can be improved through several techniques:
                        </p>
                        <div class="tutorial-highlight">
                            <strong>LoRA (Low-Rank Adaptation)</strong><br>
                            Efficiently updates a small subset of model parameters<br><br>
                            <strong>RLHF (Reinforcement Learning from Human Feedback)</strong><br>
                            Uses human preferences to guide improvement<br><br>
                            <strong>Constitutional AI</strong><br>
                            Self-critique based on defined principles
                        </div>
                    </div>
                    <div class="tutorial-section">
                        <div class="tutorial-section-title">üîÑ The Improvement Cycle</div>
                        <div class="tutorial-example">
1. COLLECT ‚Üí Gather AI responses
2. ANALYZE ‚Üí Detect patterns of weakness
3. GENERATE ‚Üí Create corrective training data
4. TRAIN ‚Üí Fine-tune the model
5. VALIDATE ‚Üí Test against benchmarks
6. DEPLOY ‚Üí Roll out improvements
                        </div>
                    </div>
                `
            },
            {
                title: 'Ready to Begin!',
                subtitle: 'Apply what you\'ve learned',
                content: `
                    <div class="tutorial-section">
                        <div class="tutorial-section-title">üöÄ Your Training Journey</div>
                        <p class="tutorial-text">
                            You'll work through <strong>5 real scenarios</strong>, each demonstrating a different type of AI weakness. For each one, you will:
                        </p>
                        <div class="tutorial-highlight">
                            1. <strong>Read</strong> a flawed AI response<br>
                            2. <strong>Analyze</strong> it to detect weaknesses<br>
                            3. <strong>Review</strong> the generated training data<br>
                            4. <strong>Understand</strong> how it would fix the issue
                        </div>
                    </div>
                    <div class="tutorial-section">
                        <div class="tutorial-section-title">üéØ Your Goal</div>
                        <p class="tutorial-text">
                            Complete all scenarios to fully understand the AI self-improvement process. Your progress is saved automatically.
                        </p>
                    </div>
                `
            }
        ];

        // App State
        let appData = {
            tutorialComplete: false,
            currentStep: 1,
            completedScenarios: [],
            currentScenario: null,
            analysisComplete: false,
            capabilities: {
                accuracy: 85,
                reasoning: 80,
                uncertainty: 70,
                nuance: 75,
                ethics: 90,
                clarity: 82
            },
            stats: {
                scenariosCompleted: 0,
                weaknessesFound: 0,
                trainingGenerated: 0
            }
        };

        let tutorialStep = 0;
        let currentAnalysisStep = 0;

        // ============================================
        // INITIALIZATION
        // ============================================

        function init() {
            loadData();
            renderScenarios();
            updateProgressSteps();
            updateCapabilities();

            if (!appData.tutorialComplete) {
                showTutorial();
            } else {
                updateGuide('welcome');
            }
        }

        function loadData() {
            const saved = localStorage.getItem(APP_NAME);
            if (saved) {
                try {
                    appData = { ...appData, ...JSON.parse(saved) };
                } catch (e) {
                    console.error('Failed to load data:', e);
                }
            }
        }

        function saveData() {
            localStorage.setItem(APP_NAME, JSON.stringify(appData));
        }

        // ============================================
        // TUTORIAL
        // ============================================

        function showTutorial() {
            tutorialStep = 0;
            renderTutorialStep();
            document.getElementById('tutorialOverlay').classList.add('active');
        }

        function renderTutorialStep() {
            const step = TUTORIAL_STEPS[tutorialStep];
            document.getElementById('tutorialStepIndicator').innerHTML = `<span>Step ${tutorialStep + 1} of ${TUTORIAL_STEPS.length}</span>`;
            document.getElementById('tutorialTitle').textContent = step.title;
            document.getElementById('tutorialSubtitle').textContent = step.subtitle;
            document.getElementById('tutorialBody').innerHTML = step.content;

            // Update nav buttons
            document.getElementById('tutorialPrev').style.display = tutorialStep > 0 ? 'inline-flex' : 'none';
            document.getElementById('tutorialNext').textContent = tutorialStep === TUTORIAL_STEPS.length - 1 ? 'Start Training ‚Üí' : 'Continue ‚Üí';
        }

        function nextTutorialStep() {
            if (tutorialStep < TUTORIAL_STEPS.length - 1) {
                tutorialStep++;
                renderTutorialStep();
            } else {
                closeTutorial();
            }
        }

        function prevTutorialStep() {
            if (tutorialStep > 0) {
                tutorialStep--;
                renderTutorialStep();
            }
        }

        function skipTutorial() {
            closeTutorial();
        }

        function closeTutorial() {
            document.getElementById('tutorialOverlay').classList.remove('active');
            appData.tutorialComplete = true;
            saveData();
            updateGuide('welcome');
            showToast('Tutorial complete! Select a scenario to begin.', 'success');
        }

        // ============================================
        // GUIDE PANEL
        // ============================================

        const GUIDE_MESSAGES = {
            welcome: {
                icon: 'üëã',
                title: 'Welcome!',
                text: 'Select a scenario below to begin your training journey.',
                action: 'Got it',
                handler: () => hideGuide()
            },
            scenario_selected: {
                icon: 'üìã',
                title: 'Scenario Loaded',
                text: 'Read the AI response carefully, then click "Analyze" to detect weaknesses.',
                action: 'Analyze Now',
                handler: () => runAnalysis()
            },
            analysis_running: {
                icon: '‚öôÔ∏è',
                title: 'Analyzing...',
                text: 'Watch as the system detects weaknesses in the response.',
                action: null
            },
            analysis_complete: {
                icon: '‚úÖ',
                title: 'Analysis Complete!',
                text: 'Review the detected weaknesses and generated training data.',
                action: 'View Results',
                handler: () => scrollToResults()
            },
            training_ready: {
                icon: 'üìö',
                title: 'Training Data Ready',
                text: 'This is how the AI would learn to avoid this mistake.',
                action: 'Complete Scenario',
                handler: () => completeScenario()
            },
            scenario_complete: {
                icon: 'üéâ',
                title: 'Scenario Complete!',
                text: 'Great job! Continue to the next scenario to learn more.',
                action: 'Next Scenario',
                handler: () => selectNextScenario()
            }
        };

        function updateGuide(key) {
            const guide = GUIDE_MESSAGES[key];
            if (!guide) return;

            const panel = document.getElementById('guidePanel');
            document.getElementById('guideIcon').textContent = guide.icon;
            document.getElementById('guideTitle').textContent = guide.title;
            document.getElementById('guideText').textContent = guide.text;

            const actionBtn = document.getElementById('guideAction');
            if (guide.action) {
                actionBtn.textContent = guide.action;
                actionBtn.style.display = 'inline-flex';
                actionBtn.onclick = guide.handler;
            } else {
                actionBtn.style.display = 'none';
            }

            panel.classList.remove('hidden');
        }

        function hideGuide() {
            document.getElementById('guidePanel').classList.add('hidden');
        }

        function handleGuideAction() {
            // Handled by individual guide message handlers
        }

        // ============================================
        // SCENARIOS
        // ============================================

        function renderScenarios() {
            const grid = document.getElementById('scenarioGrid');
            grid.innerHTML = SCENARIOS.map(scenario => {
                const isCompleted = appData.completedScenarios.includes(scenario.id);
                const isSelected = appData.currentScenario === scenario.id;

                return `
                    <div class="scenario-card ${isCompleted ? 'completed' : ''} ${isSelected ? 'selected' : ''}"
                         onclick="selectScenario('${scenario.id}')"
                         style="position: relative;">
                        ${isCompleted ? '<div style="position: absolute; top: 8px; right: 8px; font-size: 0.6875rem; background: var(--accent-green); color: white; padding: 2px 8px; border-radius: 4px;">‚úì Completed</div>' : ''}
                        <div class="scenario-header">
                            <span class="scenario-icon">${scenario.icon}</span>
                            <span class="scenario-title">${scenario.title}</span>
                            <span class="scenario-difficulty difficulty-${scenario.difficulty}">${scenario.difficulty}</span>
                        </div>
                        <p class="scenario-description">${scenario.context}</p>
                    </div>
                `;
            }).join('');
        }

        function selectScenario(id) {
            const scenario = SCENARIOS.find(s => s.id === id);
            if (!scenario) return;

            appData.currentScenario = id;
            appData.currentStep = 2;
            appData.analysisComplete = false;
            currentAnalysisStep = 0;
            saveData();

            // Update UI
            renderScenarios();
            updateProgressSteps();

            // Show step 2
            document.getElementById('step1Card').style.display = 'none';
            document.getElementById('step2Card').style.display = 'block';
            document.getElementById('step3Card').style.display = 'none';
            document.getElementById('step4Card').style.display = 'none';
            document.getElementById('step5Card').style.display = 'none';

            // Populate response
            document.getElementById('responseInput').value = scenario.response;
            document.getElementById('scenarioContext').textContent = scenario.context;

            updateGuide('scenario_selected');
            showToast(`Loaded: ${scenario.title}`, 'info');
        }

        function selectNextScenario() {
            const incompleteScenario = SCENARIOS.find(s => !appData.completedScenarios.includes(s.id));
            if (incompleteScenario) {
                // Reset to step 1
                document.getElementById('step1Card').style.display = 'block';
                document.getElementById('step2Card').style.display = 'none';
                document.getElementById('step3Card').style.display = 'none';
                document.getElementById('step4Card').style.display = 'none';
                document.getElementById('step5Card').style.display = 'none';

                appData.currentStep = 1;
                appData.currentScenario = null;
                updateProgressSteps();
                updateGuide('welcome');

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                showToast('üéâ Congratulations! You\'ve completed all scenarios!', 'success');
            }
        }

        // ============================================
        // ANALYSIS
        // ============================================

        function runAnalysis() {
            const scenario = SCENARIOS.find(s => s.id === appData.currentScenario);
            if (!scenario) return;

            appData.currentStep = 3;
            updateProgressSteps();

            // Show step 3
            document.getElementById('step2Card').style.display = 'none';
            document.getElementById('step3Card').style.display = 'block';

            // Build analysis steps
            renderAnalysisSteps(scenario);

            updateGuide('analysis_running');

            // Animate through the analysis
            animateAnalysis(scenario);
        }

        function renderAnalysisSteps(scenario) {
            const container = document.getElementById('analysisSteps');
            container.innerHTML = `
                <div class="analysis-step" id="analysisStep1">
                    <div class="analysis-step-header">
                        <div class="step-number" id="stepNum1">1</div>
                        <div class="step-info">
                            <div class="step-title">Pattern Detection</div>
                            <div class="step-description">Scanning response for weakness patterns...</div>
                        </div>
                        <span class="step-status status-pending" id="stepStatus1">Pending</span>
                    </div>
                    <div class="analysis-step-content" id="stepContent1"></div>
                </div>

                <div class="analysis-step" id="analysisStep2">
                    <div class="analysis-step-header">
                        <div class="step-number" id="stepNum2">2</div>
                        <div class="step-info">
                            <div class="step-title">Weakness Classification</div>
                            <div class="step-description">Categorizing detected issues by type and severity...</div>
                        </div>
                        <span class="step-status status-pending" id="stepStatus2">Pending</span>
                    </div>
                    <div class="analysis-step-content" id="stepContent2"></div>
                </div>

                <div class="analysis-step" id="analysisStep3">
                    <div class="analysis-step-header">
                        <div class="step-number" id="stepNum3">3</div>
                        <div class="step-info">
                            <div class="step-title">Training Data Generation</div>
                            <div class="step-description">Creating corrective examples...</div>
                        </div>
                        <span class="step-status status-pending" id="stepStatus3">Pending</span>
                    </div>
                    <div class="analysis-step-content" id="stepContent3"></div>
                </div>
            `;
        }

        async function animateAnalysis(scenario) {
            // Reset architecture nodes
            document.querySelectorAll('.arch-node').forEach(n => n.classList.remove('active', 'completed'));
            document.querySelectorAll('.arch-arrow').forEach(a => a.classList.remove('active'));

            // Step 1: Input
            await delay(300);
            document.querySelector('[data-stage="input"]').classList.add('active');

            // Step 2: Detection
            await delay(800);
            document.querySelector('[data-stage="input"]').classList.remove('active');
            document.querySelector('[data-stage="input"]').classList.add('completed');
            document.querySelector('[data-stage="detect"]').classList.add('active');
            document.querySelectorAll('.arch-arrow')[0].classList.add('active');

            updateAnalysisStep(1, 'active', 'Analyzing...');

            await delay(1000);

            // Show detection results
            document.getElementById('stepContent1').innerHTML = `
                <p style="margin-bottom: 12px; color: var(--text-secondary);">
                    Scanned response using ${Object.keys(scenario.weaknesses).length + 5} pattern detectors...
                </p>
                <div style="font-family: monospace; font-size: 0.8125rem; color: var(--accent-green);">
                    ‚úì Found ${scenario.weaknesses.length} potential weakness(es)
                </div>
            `;
            document.getElementById('analysisStep1').classList.add('expanded');
            updateAnalysisStep(1, 'complete', 'Complete');

            // Step 3: Classification
            await delay(600);
            document.querySelector('[data-stage="detect"]').classList.remove('active');
            document.querySelector('[data-stage="detect"]').classList.add('completed');
            document.querySelector('[data-stage="classify"]').classList.add('active');
            document.querySelectorAll('.arch-arrow')[1].classList.add('active');

            updateAnalysisStep(2, 'active', 'Classifying...');

            await delay(1200);

            // Show classification results
            let weaknessesHtml = scenario.weaknesses.map(w => `
                <div class="weakness-card ${w.severity}">
                    <div class="weakness-header">
                        <span class="weakness-title">${getWeaknessIcon(w.type)} ${w.name}</span>
                        <span class="severity-badge severity-${w.severity}">${w.severity}</span>
                    </div>
                    <p class="weakness-explanation">${w.explanation}</p>
                    <div class="weakness-evidence">Evidence: ${w.evidence}</div>
                </div>
            `).join('');

            document.getElementById('stepContent2').innerHTML = weaknessesHtml;
            document.getElementById('analysisStep2').classList.add('expanded');
            updateAnalysisStep(2, 'complete', 'Complete');

            // Step 4: Generation
            await delay(600);
            document.querySelector('[data-stage="classify"]').classList.remove('active');
            document.querySelector('[data-stage="classify"]').classList.add('completed');
            document.querySelector('[data-stage="generate"]').classList.add('active');
            document.querySelectorAll('.arch-arrow')[2].classList.add('active');

            updateAnalysisStep(3, 'active', 'Generating...');

            await delay(1500);

            // Show training data preview
            document.getElementById('stepContent3').innerHTML = `
                <p style="margin-bottom: 12px; color: var(--text-secondary);">
                    Generated corrective training pair for detected weaknesses:
                </p>
                <div style="font-family: monospace; font-size: 0.8125rem; color: var(--accent-green);">
                    ‚úì Created 1 training example<br>
                    ‚úì Includes bad response, good response, and explanation
                </div>
            `;
            document.getElementById('analysisStep3').classList.add('expanded');
            updateAnalysisStep(3, 'complete', 'Complete');

            // Complete training stage
            await delay(500);
            document.querySelector('[data-stage="generate"]').classList.remove('active');
            document.querySelector('[data-stage="generate"]').classList.add('completed');
            document.querySelector('[data-stage="train"]').classList.add('active');
            document.querySelectorAll('.arch-arrow')[3].classList.add('active');

            await delay(800);
            document.querySelector('[data-stage="train"]').classList.remove('active');
            document.querySelector('[data-stage="train"]').classList.add('completed');

            // Update stats
            appData.stats.weaknessesFound += scenario.weaknesses.length;
            appData.stats.trainingGenerated++;
            appData.analysisComplete = true;
            saveData();

            // Show step 4
            appData.currentStep = 4;
            updateProgressSteps();

            await delay(500);
            document.getElementById('step4Card').style.display = 'block';
            renderTrainingData(scenario);

            updateGuide('training_ready');
            showToast('Analysis complete! Review the training data below.', 'success');

            // Scroll to training data
            document.getElementById('step4Card').scrollIntoView({ behavior: 'smooth' });
        }

        function updateAnalysisStep(num, status, text) {
            const stepNum = document.getElementById(`stepNum${num}`);
            const stepStatus = document.getElementById(`stepStatus${num}`);

            stepNum.className = 'step-number';
            stepStatus.className = 'step-status';

            if (status === 'active') {
                stepNum.classList.add('active');
                stepStatus.classList.add('status-active');
            } else if (status === 'complete') {
                stepNum.classList.add('completed');
                stepNum.textContent = '‚úì';
                stepStatus.classList.add('status-complete');
            }

            stepStatus.textContent = text;
        }

        function getWeaknessIcon(type) {
            const icons = {
                factual_error: '‚ùå',
                overconfidence: 'üí™',
                sycophancy: 'üé≠',
                reasoning_flaw: 'üîó',
                missing_nuance: 'üîç',
                missing_context: 'üîç',
                verbosity: 'üìù'
            };
            return icons[type] || '‚ö†Ô∏è';
        }

        // ============================================
        // TRAINING DATA
        // ============================================

        function renderTrainingData(scenario) {
            const container = document.getElementById('trainingDataDisplay');
            const tp = scenario.trainingPair;

            container.innerHTML = `
                <div class="training-pair">
                    <div class="training-pair-header">
                        <span>üìö</span>
                        <span>Training Example: ${scenario.title}</span>
                    </div>

                    <div style="padding: 1rem; background: var(--bg-surface); border-bottom: 1px solid var(--border-subtle);">
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 6px;">PROMPT</div>
                        <div style="font-size: 0.9375rem;">${escapeHtml(tp.prompt)}</div>
                    </div>

                    <div class="training-comparison">
                        <div class="training-column">
                            <div class="training-label bad">‚ùå What NOT to do</div>
                            <div class="training-text">${escapeHtml(tp.badResponse)}</div>
                        </div>
                        <div class="training-column">
                            <div class="training-label good">‚úì What TO do</div>
                            <div class="training-text">${escapeHtml(tp.goodResponse)}</div>
                        </div>
                    </div>

                    <div class="training-explanation">
                        <div class="training-explanation-title">üí° Why the correction is better:</div>
                        <div class="training-explanation-text">${escapeHtml(tp.explanation)}</div>
                    </div>
                </div>

                <div style="background: var(--bg-elevated); border-radius: 12px; padding: 1.25rem; margin-top: 1rem;">
                    <div style="font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span>üéì</span> How This Fixes the Issue
                    </div>
                    <p style="color: var(--text-secondary); line-height: 1.7; font-size: 0.9375rem;">
                        By including this example in training data, the AI learns to recognize similar situations and respond more appropriately.
                        The contrast between bad and good responses helps the model understand not just WHAT to say, but WHY the correction is better.
                        This is the core of the self-improvement process.
                    </p>
                </div>
            `;
        }

        // ============================================
        // COMPLETION
        // ============================================

        function completeScenario() {
            const scenario = SCENARIOS.find(s => s.id === appData.currentScenario);
            if (!scenario) return;

            // Mark as completed
            if (!appData.completedScenarios.includes(scenario.id)) {
                appData.completedScenarios.push(scenario.id);
                appData.stats.scenariosCompleted++;
            }

            // Update capabilities based on scenario
            for (const [cap, impact] of Object.entries(scenario.capabilityImpact)) {
                if (appData.capabilities[cap] !== undefined) {
                    // Learning from the scenario improves capabilities
                    appData.capabilities[cap] = Math.min(100, appData.capabilities[cap] + Math.abs(impact) * 0.3);
                }
            }

            appData.currentStep = 5;
            saveData();

            // Show step 5
            document.getElementById('step4Card').style.display = 'none';
            document.getElementById('step5Card').style.display = 'block';

            updateCapabilities();
            renderProgressSummary(scenario);
            updateProgressSteps();

            updateGuide('scenario_complete');
            showToast('üéâ Scenario complete!', 'success');

            document.getElementById('step5Card').scrollIntoView({ behavior: 'smooth' });
        }

        function renderProgressSummary(scenario) {
            const remaining = SCENARIOS.length - appData.completedScenarios.length;

            document.getElementById('progressMessage').textContent =
                remaining > 0
                    ? `You've learned how to identify "${scenario.title}" weaknesses. ${remaining} scenario${remaining > 1 ? 's' : ''} remaining.`
                    : 'Congratulations! You\'ve completed all scenarios and understand the full AI self-improvement process!';

            document.getElementById('progressStats').innerHTML = `
                <div class="progress-stat">
                    <div class="progress-stat-value">${appData.stats.scenariosCompleted}</div>
                    <div class="progress-stat-label">Scenarios Complete</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-stat-value">${appData.stats.weaknessesFound}</div>
                    <div class="progress-stat-label">Weaknesses Found</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-stat-value">${appData.stats.trainingGenerated}</div>
                    <div class="progress-stat-label">Training Examples</div>
                </div>
            `;
        }

        // ============================================
        // CAPABILITIES
        // ============================================

        function updateCapabilities() {
            const grid = document.getElementById('capabilityGrid');
            const capLabels = {
                accuracy: 'Factual Accuracy',
                reasoning: 'Logical Reasoning',
                uncertainty: 'Uncertainty Calibration',
                nuance: 'Nuance & Context',
                ethics: 'Ethical Reasoning',
                clarity: 'Communication Clarity'
            };

            grid.innerHTML = Object.entries(appData.capabilities).map(([key, value]) => `
                <div class="capability-item">
                    <div class="capability-header">
                        <span class="capability-name">${capLabels[key] || key}</span>
                        <span class="capability-value">${Math.round(value)}%</span>
                    </div>
                    <div class="capability-bar">
                        <div class="capability-fill" style="width: ${value}%"></div>
                    </div>
                </div>
            `).join('');
        }

        // ============================================
        // PROGRESS
        // ============================================

        function updateProgressSteps() {
            const steps = document.querySelectorAll('.progress-step');
            steps.forEach((step, index) => {
                const stepNum = index + 1;
                step.classList.remove('completed', 'active');

                if (stepNum < appData.currentStep) {
                    step.classList.add('completed');
                    step.textContent = '‚úì';
                } else if (stepNum === appData.currentStep) {
                    step.classList.add('active');
                    step.textContent = stepNum;
                } else {
                    step.textContent = stepNum;
                }
            });
        }

        // ============================================
        // UTILITIES
        // ============================================

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function scrollToResults() {
            document.getElementById('step4Card').scrollIntoView({ behavior: 'smooth' });
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = { success: '‚úì', info: '‚ÑπÔ∏è', warning: '‚ö†Ô∏è' };
            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || icons.info}</span>
                <span class="toast-message">${message}</span>
            `;

            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        function restartTraining() {
            if (confirm('Reset all progress and start over?')) {
                appData = {
                    tutorialComplete: false,
                    currentStep: 1,
                    completedScenarios: [],
                    currentScenario: null,
                    analysisComplete: false,
                    capabilities: {
                        accuracy: 85,
                        reasoning: 80,
                        uncertainty: 70,
                        nuance: 75,
                        ethics: 90,
                        clarity: 82
                    },
                    stats: {
                        scenariosCompleted: 0,
                        weaknessesFound: 0,
                        trainingGenerated: 0
                    }
                };
                saveData();
                location.reload();
            }
        }

        // ============================================
        // DATA PERSISTENCE
        // ============================================

        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai-self-improvement-training-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Progress exported!', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    appData = { ...appData, ...imported };
                    saveData();
                    location.reload();
                } catch (err) {
                    showToast('Invalid file format', 'warning');
                }
            };
            reader.readAsText(file);
        }

        // Initialize
        init();
    </script>
</body>
</html>

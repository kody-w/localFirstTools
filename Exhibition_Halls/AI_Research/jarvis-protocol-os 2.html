<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JARVIS Protocol - Local AI Assistant OS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        #jarvis-os {
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #00d4ff;
            position: relative;
            overflow: hidden;
        }

        /* Boot Screen */
        #boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #1a1a2e 0%, #0a0a0a 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100000;
            transition: opacity 1s ease;
        }

        #boot-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .boot-logo {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 30px;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.8);
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 30px rgba(0, 212, 255, 0.8); }
            50% { text-shadow: 0 0 50px rgba(0, 212, 255, 1); }
        }

        .boot-text {
            font-size: 18px;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .boot-progress {
            width: 300px;
            height: 3px;
            background: rgba(0, 212, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .boot-progress::after {
            content: '';
            display: block;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, #00d4ff, transparent);
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Desktop */
        #desktop {
            width: 100%;
            height: calc(100% - 60px);
            position: relative;
            background-image:
                repeating-linear-gradient(0deg,
                    transparent,
                    transparent 50px,
                    rgba(0, 212, 255, 0.03) 50px,
                    rgba(0, 212, 255, 0.03) 51px),
                repeating-linear-gradient(90deg,
                    transparent,
                    transparent 50px,
                    rgba(0, 212, 255, 0.03) 50px,
                    rgba(0, 212, 255, 0.03) 51px);
        }

        /* Windows */
        .window {
            position: absolute;
            background: rgba(20, 20, 40, 0.95);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 12px;
            overflow: hidden;
            box-shadow:
                0 20px 60px rgba(0, 212, 255, 0.2),
                inset 0 0 30px rgba(0, 212, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            animation: windowOpen 0.3s ease;
        }

        @keyframes windowOpen {
            0% {
                transform: scale(0.9) translateY(20px);
                opacity: 0;
            }
            100% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .window.minimized {
            transform: scale(0);
            opacity: 0;
            pointer-events: none;
        }

        .window.maximized {
            left: 0 !important;
            top: 0 !important;
            width: 100% !important;
            height: calc(100% - 60px) !important;
            border-radius: 0;
        }

        .window-titlebar {
            height: 40px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(0, 100, 255, 0.1));
            padding: 0 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            cursor: move;
        }

        .window-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 500;
        }

        .window-controls {
            display: flex;
            gap: 10px;
        }

        .window-controls button {
            width: 28px;
            height: 28px;
            border: none;
            background: rgba(0, 212, 255, 0.1);
            color: #00d4ff;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .window-controls button:hover {
            background: rgba(0, 212, 255, 0.3);
            transform: scale(1.1);
        }

        .window-controls .close:hover {
            background: rgba(255, 50, 50, 0.5);
        }

        .window-content {
            height: calc(100% - 40px);
            padding: 20px;
            overflow-y: auto;
            color: #ffffff;
        }

        .window-content::-webkit-scrollbar {
            width: 8px;
        }

        .window-content::-webkit-scrollbar-track {
            background: rgba(0, 212, 255, 0.1);
        }

        .window-content::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 255, 0.3);
            border-radius: 4px;
        }

        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            cursor: nwse-resize;
        }

        /* Taskbar */
        #taskbar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: rgba(10, 10, 30, 0.98);
            border-top: 1px solid rgba(0, 212, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .start-button {
            padding: 10px 20px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(0, 100, 255, 0.2));
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .start-button:hover {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.3), rgba(0, 100, 255, 0.3));
            transform: translateY(-2px);
        }

        .taskbar-apps {
            display: flex;
            gap: 10px;
            flex: 1;
            margin: 0 20px;
        }

        .app-icon {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            position: relative;
        }

        .app-icon:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: translateY(-5px);
        }

        .app-icon.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: #00d4ff;
            border-radius: 3px;
        }

        .taskbar-tray {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .voice-indicator {
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .voice-indicator.active {
            color: #00ff00;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .time {
            font-size: 14px;
            opacity: 0.8;
        }

        /* Voice Overlay */
        #voice-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #voice-overlay.active {
            opacity: 1;
        }

        .voice-wave {
            width: 200px;
            height: 200px;
            border: 3px solid #00d4ff;
            border-radius: 50%;
            position: relative;
        }

        .voice-wave::before,
        .voice-wave::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border: 2px solid #00d4ff;
            border-radius: 50%;
            animation: voiceRipple 2s infinite;
        }

        .voice-wave::after {
            animation-delay: 1s;
        }

        @keyframes voiceRipple {
            0% {
                width: 100%;
                height: 100%;
                opacity: 0.6;
            }
            100% {
                width: 200%;
                height: 200%;
                opacity: 0;
            }
        }

        .voice-text {
            margin-top: 30px;
            font-size: 18px;
            text-align: center;
            max-width: 300px;
        }

        /* Notifications */
        #notifications {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            background: rgba(20, 20, 40, 0.98);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            min-width: 300px;
            animation: slideIn 0.3s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        @keyframes slideIn {
            0% {
                transform: translateX(400px);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* App Styles */
        .health-monitor {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .health-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 5px;
        }

        .code-editor {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            min-height: 300px;
        }

        .code-line {
            line-height: 1.5;
            white-space: pre;
        }

        .dream-entry {
            background: rgba(0, 212, 255, 0.05);
            border-left: 3px solid #00d4ff;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 212, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #00d4ff;
            border-radius: 4px;
            cursor: pointer;
        }

        .task-checkbox.checked {
            background: #00d4ff;
        }

        .terminal-output {
            background: #000000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 15px;
            min-height: 400px;
            border-radius: 8px;
        }

        .terminal-input {
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: inherit;
            width: 100%;
            outline: none;
        }

        /* Settings */
        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section h3 {
            margin-bottom: 15px;
            color: #00d4ff;
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: rgba(0, 212, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .toggle-switch {
            width: 50px;
            height: 25px;
            background: rgba(0, 212, 255, 0.2);
            border-radius: 25px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #00d4ff;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 19px;
            height: 19px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(25px);
        }

        /* Data Controls */
        .data-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 100001;
            display: flex;
            gap: 10px;
        }

        .data-controls button {
            padding: 8px 16px;
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid #00d4ff;
            color: #00d4ff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .data-controls button:hover {
            background: rgba(0, 212, 255, 0.4);
            transform: translateY(-2px);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .taskbar-apps {
                display: none;
            }

            .window {
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                height: calc(100% - 60px) !important;
                border-radius: 0;
            }

            .boot-logo {
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <div id="jarvis-os">
        <!-- Data Controls -->
        <div class="data-controls">
            <button onclick="exportData()">Export Data</button>
            <button onclick="document.getElementById('importFile').click()">Import Data</button>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
        </div>

        <!-- Boot Screen -->
        <div id="boot-screen">
            <div class="boot-logo">ü§ñ JARVIS PROTOCOL</div>
            <div class="boot-text">Initializing AI Assistant OS...</div>
            <div class="boot-progress"></div>
        </div>

        <!-- Desktop -->
        <div id="desktop"></div>

        <!-- Taskbar -->
        <div id="taskbar">
            <div class="start-button" onclick="jarvisOS.toggleStartMenu()">
                <span>ü§ñ</span>
                <span>JARVIS</span>
            </div>
            <div class="taskbar-apps">
                <div class="app-icon" data-app="health" title="Health Monitor" onclick="jarvisOS.openApp('health')">üíì</div>
                <div class="app-icon" data-app="code" title="Code Assistant" onclick="jarvisOS.openApp('code')">üíª</div>
                <div class="app-icon" data-app="dreams" title="Dream Journal" onclick="jarvisOS.openApp('dreams')">üåô</div>
                <div class="app-icon" data-app="tasks" title="Task Manager" onclick="jarvisOS.openApp('tasks')">‚úì</div>
                <div class="app-icon" data-app="knowledge" title="Knowledge Base" onclick="jarvisOS.openApp('knowledge')">üìö</div>
                <div class="app-icon" data-app="video" title="Video Editor" onclick="jarvisOS.openApp('video')">üé¨</div>
                <div class="app-icon" data-app="calculator" title="Calculator" onclick="jarvisOS.openApp('calculator')">üßÆ</div>
                <div class="app-icon" data-app="terminal" title="Terminal" onclick="jarvisOS.openApp('terminal')">‚å®Ô∏è</div>
                <div class="app-icon" data-app="settings" title="Settings" onclick="jarvisOS.openApp('settings')">‚öôÔ∏è</div>
            </div>
            <div class="taskbar-tray">
                <div class="voice-indicator" id="voiceIndicator" onclick="jarvisOS.toggleVoice()" title="Voice Assistant">üé§</div>
                <div class="time" id="systemTime"></div>
            </div>
        </div>

        <!-- Voice Overlay -->
        <div id="voice-overlay">
            <div class="voice-wave"></div>
            <div class="voice-text" id="voiceText">Listening...</div>
        </div>

        <!-- Notifications -->
        <div id="notifications"></div>
    </div>

    <script>
        // JARVIS OS Core System
        class JarvisOS {
            constructor() {
                this.windows = [];
                this.activeWindow = null;
                this.zIndex = 100;
                this.voiceController = null;
                this.apps = {};
                this.systemData = this.loadSystemData();
                this.bootSequence();
            }

            loadSystemData() {
                const defaultData = {
                    system: {
                        theme: 'dark',
                        voiceEnabled: true,
                        username: 'User',
                        bootCount: 0
                    },
                    health: {
                        scans: [],
                        metrics: []
                    },
                    code: {
                        projects: [],
                        snippets: [],
                        history: []
                    },
                    dreams: {
                        entries: [],
                        symbols: {}
                    },
                    tasks: {
                        active: [],
                        completed: []
                    },
                    knowledge: {
                        notes: [],
                        links: []
                    }
                };

                const stored = localStorage.getItem('jarvis-os-data');
                return stored ? JSON.parse(stored) : defaultData;
            }

            saveSystemData() {
                localStorage.setItem('jarvis-os-data', JSON.stringify(this.systemData));
            }

            async bootSequence() {
                this.systemData.system.bootCount++;
                this.saveSystemData();

                // Update system time
                setInterval(() => this.updateSystemTime(), 1000);

                // Initialize voice controller
                this.initializeVoice();

                // Load apps
                this.loadApps();

                // Boot animation
                await this.sleep(2000);
                document.getElementById('boot-screen').classList.add('hidden');

                // Greeting
                await this.sleep(500);
                const hour = new Date().getHours();
                const greeting = hour < 12 ? 'Good morning' : hour < 18 ? 'Good afternoon' : 'Good evening';
                this.speak(`${greeting}. JARVIS Protocol initialized. All systems operational.`);
                this.showNotification('JARVIS Online', 'AI Assistant OS ready');
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            updateSystemTime() {
                const now = new Date();
                const time = now.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                const timeEl = document.getElementById('systemTime');
                if (timeEl) timeEl.textContent = time;
            }

            initializeVoice() {
                this.voiceController = new VoiceController(this);
                if (this.systemData.system.voiceEnabled) {
                    this.voiceController.startListening();
                }
            }

            toggleVoice() {
                const indicator = document.getElementById('voiceIndicator');
                if (this.voiceController.isListening) {
                    this.voiceController.stopListening();
                    indicator.classList.remove('active');
                    this.speak('Voice control deactivated');
                } else {
                    this.voiceController.startListening();
                    indicator.classList.add('active');
                    this.speak('Voice control activated. Say "Hey JARVIS" to begin');
                }
            }

            speak(text) {
                if (this.voiceController) {
                    this.voiceController.speak(text);
                }
            }

            loadApps() {
                this.apps = {
                    health: new HealthMonitor(this),
                    code: new CodeAssistant(this),
                    dreams: new DreamJournal(this),
                    tasks: new TaskManager(this),
                    knowledge: new KnowledgeBase(this),
                    video: new VideoEditor(this),
                    calculator: new Calculator(this),
                    terminal: new Terminal(this),
                    settings: new Settings(this)
                };
            }

            openApp(appName) {
                const app = this.apps[appName];
                if (!app) return;

                // Check if already open
                const existingWindow = this.windows.find(w => w.app === appName);
                if (existingWindow) {
                    this.focusWindow(existingWindow);
                    return;
                }

                const config = app.getWindowConfig();
                config.app = appName;
                this.createWindow(config);

                // Update taskbar
                document.querySelector(`[data-app="${appName}"]`).classList.add('active');
            }

            createWindow(config) {
                const windowId = 'window-' + Date.now();
                const window = {
                    id: windowId,
                    app: config.app || null,
                    title: config.title || 'Untitled',
                    icon: config.icon || 'üìÑ',
                    width: config.width || 800,
                    height: config.height || 600,
                    x: config.x || 100 + (this.windows.length * 30),
                    y: config.y || 100 + (this.windows.length * 30),
                    minimized: false,
                    maximized: false,
                    zIndex: this.zIndex++
                };

                // Center window
                window.x = (window.innerWidth - window.width) / 2;
                window.y = (window.innerHeight - window.height) / 2 - 30;

                const windowEl = document.createElement('div');
                windowEl.id = windowId;
                windowEl.className = 'window';
                windowEl.style.cssText = `
                    left: ${window.x}px;
                    top: ${window.y}px;
                    width: ${window.width}px;
                    height: ${window.height}px;
                    z-index: ${window.zIndex};
                `;

                windowEl.innerHTML = `
                    <div class="window-titlebar">
                        <div class="window-title">
                            <span>${window.icon}</span>
                            <span>${window.title}</span>
                        </div>
                        <div class="window-controls">
                            <button class="minimize" onclick="jarvisOS.minimizeWindow('${windowId}')">‚àí</button>
                            <button class="maximize" onclick="jarvisOS.maximizeWindow('${windowId}')">‚ñ°</button>
                            <button class="close" onclick="jarvisOS.closeWindow('${windowId}')">√ó</button>
                        </div>
                    </div>
                    <div class="window-content">
                        ${config.content || ''}
                    </div>
                    <div class="resize-handle"></div>
                `;

                document.getElementById('desktop').appendChild(windowEl);

                // Make draggable
                this.makeDraggable(windowEl, window);
                // Make resizable
                this.makeResizable(windowEl, window);
                // Focus on click
                windowEl.addEventListener('mousedown', () => this.focusWindow(window));

                this.windows.push(window);
                this.focusWindow(window);
            }

            makeDraggable(element, window) {
                const titlebar = element.querySelector('.window-titlebar');
                let isDragging = false;
                let startX, startY, initialX, initialY;

                titlebar.addEventListener('mousedown', (e) => {
                    if (e.target.closest('.window-controls')) return;
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    initialX = window.x;
                    initialY = window.y;
                    e.preventDefault();
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    window.x = initialX + (e.clientX - startX);
                    window.y = initialY + (e.clientY - startY);
                    element.style.left = window.x + 'px';
                    element.style.top = window.y + 'px';
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            }

            makeResizable(element, window) {
                const handle = element.querySelector('.resize-handle');
                let isResizing = false;
                let startX, startY, startWidth, startHeight;

                handle.addEventListener('mousedown', (e) => {
                    isResizing = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    startWidth = window.width;
                    startHeight = window.height;
                    e.preventDefault();
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isResizing) return;
                    window.width = Math.max(400, startWidth + (e.clientX - startX));
                    window.height = Math.max(300, startHeight + (e.clientY - startY));
                    element.style.width = window.width + 'px';
                    element.style.height = window.height + 'px';
                });

                document.addEventListener('mouseup', () => {
                    isResizing = false;
                });
            }

            focusWindow(window) {
                this.activeWindow = window;
                window.zIndex = this.zIndex++;
                document.getElementById(window.id).style.zIndex = window.zIndex;
            }

            minimizeWindow(windowId) {
                const window = this.windows.find(w => w.id === windowId);
                if (!window) return;
                window.minimized = true;
                document.getElementById(windowId).classList.add('minimized');
            }

            maximizeWindow(windowId) {
                const window = this.windows.find(w => w.id === windowId);
                if (!window) return;
                window.maximized = !window.maximized;
                document.getElementById(windowId).classList.toggle('maximized');
            }

            closeWindow(windowId) {
                const window = this.windows.find(w => w.id === windowId);
                if (!window) return;

                // Remove from DOM
                const element = document.getElementById(windowId);
                element.style.animation = 'windowOpen 0.3s ease reverse';
                setTimeout(() => element.remove(), 300);

                // Remove from windows array
                this.windows = this.windows.filter(w => w.id !== windowId);

                // Update taskbar
                if (window.app) {
                    document.querySelector(`[data-app="${window.app}"]`).classList.remove('active');
                }
            }

            showNotification(title, message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.innerHTML = `
                    <strong>${title}</strong>
                    <div style="margin-top: 5px; opacity: 0.8; font-size: 14px;">${message}</div>
                `;

                const container = document.getElementById('notifications');
                container.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideIn 0.3s ease reverse';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            toggleStartMenu() {
                // Start menu implementation would go here
                this.showNotification('Start Menu', 'Coming soon!');
            }
        }

        // Voice Controller
        class VoiceController {
            constructor(os) {
                this.os = os;
                this.recognition = null;
                this.synthesis = window.speechSynthesis;
                this.isListening = false;
                this.isProcessing = false;
                this.wakeWord = 'hey jarvis';
                this.initializeRecognition();
            }

            initializeRecognition() {
                if ('webkitSpeechRecognition' in window) {
                    this.recognition = new webkitSpeechRecognition();
                    this.recognition.continuous = true;
                    this.recognition.interimResults = true;
                    this.recognition.lang = 'en-US';

                    this.recognition.onresult = (event) => this.handleResult(event);
                    this.recognition.onerror = (event) => this.handleError(event);
                    this.recognition.onend = () => {
                        if (this.isListening) {
                            this.recognition.start();
                        }
                    };
                }
            }

            startListening() {
                if (!this.recognition) {
                    this.os.showNotification('Voice Control', 'Speech recognition not supported in this browser');
                    return;
                }

                this.isListening = true;
                this.recognition.start();
                document.getElementById('voiceIndicator').classList.add('active');
            }

            stopListening() {
                this.isListening = false;
                if (this.recognition) {
                    this.recognition.stop();
                }
                document.getElementById('voiceIndicator').classList.remove('active');
            }

            handleResult(event) {
                const last = event.results.length - 1;
                const transcript = event.results[last][0].transcript.toLowerCase();

                if (transcript.includes(this.wakeWord) && !this.isProcessing) {
                    this.isProcessing = true;
                    this.showVoiceOverlay(transcript);

                    // Extract command after wake word
                    const commandMatch = transcript.split(this.wakeWord)[1];
                    if (commandMatch) {
                        this.processCommand(commandMatch.trim());
                    }

                    setTimeout(() => {
                        this.isProcessing = false;
                        this.hideVoiceOverlay();
                    }, 2000);
                }
            }

            handleError(event) {
                console.error('Speech recognition error:', event.error);
                if (event.error === 'no-speech') {
                    // Normal timeout, restart
                    if (this.isListening) {
                        this.recognition.start();
                    }
                }
            }

            showVoiceOverlay(text) {
                const overlay = document.getElementById('voice-overlay');
                const textEl = document.getElementById('voiceText');
                overlay.classList.add('active');
                textEl.textContent = text;
            }

            hideVoiceOverlay() {
                document.getElementById('voice-overlay').classList.remove('active');
            }

            processCommand(command) {
                const commands = {
                    // App commands
                    'open health': () => this.os.openApp('health'),
                    'health monitor': () => this.os.openApp('health'),
                    'check my health': () => this.os.openApp('health'),
                    'open code': () => this.os.openApp('code'),
                    'code assistant': () => this.os.openApp('code'),
                    'open dreams': () => this.os.openApp('dreams'),
                    'dream journal': () => this.os.openApp('dreams'),
                    'open tasks': () => this.os.openApp('tasks'),
                    'task manager': () => this.os.openApp('tasks'),
                    'open terminal': () => this.os.openApp('terminal'),
                    'open settings': () => this.os.openApp('settings'),

                    // System commands
                    'what time': () => this.speak(`The time is ${new Date().toLocaleTimeString()}`),
                    'close all': () => this.closeAllWindows(),
                    'minimize all': () => this.minimizeAllWindows(),

                    // Personality
                    'how are you': () => this.speak('All systems functioning optimally. How may I assist you?'),
                    'thank you': () => this.speak('You\'re welcome. Always at your service.'),
                    'help': () => this.showHelp()
                };

                // Find matching command
                for (const [key, action] of Object.entries(commands)) {
                    if (command.includes(key)) {
                        action();
                        return;
                    }
                }

                // No match found
                this.speak('I didn\'t understand that command. Try saying "help" for available commands.');
            }

            speak(text) {
                const utterance = new SpeechSynthesisUtterance(text);

                // Try to find a suitable voice
                const voices = this.synthesis.getVoices();
                const englishVoice = voices.find(v => v.lang.includes('en'));
                if (englishVoice) {
                    utterance.voice = englishVoice;
                }

                utterance.rate = 1.1;
                utterance.pitch = 0.9;
                this.synthesis.speak(utterance);
            }

            closeAllWindows() {
                this.os.windows.forEach(w => this.os.closeWindow(w.id));
                this.speak('All windows closed');
            }

            minimizeAllWindows() {
                this.os.windows.forEach(w => this.os.minimizeWindow(w.id));
                this.speak('All windows minimized');
            }

            showHelp() {
                this.speak('You can say: open health, open code, open tasks, what time is it, close all windows, and more. Just say Hey JARVIS followed by your command.');
            }
        }

        // Health Monitor App
        class HealthMonitor {
            constructor(os) {
                this.os = os;
                this.isScanning = false;
                this.metrics = {
                    heartRate: 72,
                    hrv: 42,
                    stress: 35,
                    breathing: 14
                };
            }

            getWindowConfig() {
                return {
                    title: 'Health Monitor',
                    icon: 'üíì',
                    width: 900,
                    height: 600,
                    content: this.render()
                };
            }

            render() {
                return `
                    <div class="health-monitor">
                        <h2>Biometric Health Scanner</h2>
                        <div class="health-stats">
                            <div class="stat-card">
                                <div class="stat-value" id="heart-rate">${this.metrics.heartRate}</div>
                                <div class="stat-label">Heart Rate (BPM)</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="hrv">${this.metrics.hrv}</div>
                                <div class="stat-label">HRV (ms)</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stress">${this.metrics.stress}%</div>
                                <div class="stat-label">Stress Level</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="breathing">${this.metrics.breathing}</div>
                                <div class="stat-label">Breathing Rate</div>
                            </div>
                        </div>
                        <button onclick="jarvisOS.apps.health.startScan()"
                                style="margin-top: 20px; padding: 10px 30px; background: #00d4ff; border: none; border-radius: 8px; color: white; cursor: pointer;">
                            Start Biometric Scan
                        </button>
                        <div id="scan-status" style="margin-top: 20px; opacity: 0.7;"></div>
                    </div>
                `;
            }

            async startScan() {
                if (this.isScanning) return;
                this.isScanning = true;

                const statusEl = document.getElementById('scan-status');
                if (statusEl) statusEl.textContent = 'Scanning... (Simulated data)';

                this.os.speak('Initiating biometric scan');

                // Simulate scanning
                const interval = setInterval(() => {
                    if (!this.isScanning) {
                        clearInterval(interval);
                        return;
                    }

                    // Generate realistic variations
                    this.metrics.heartRate = 65 + Math.floor(Math.random() * 20);
                    this.metrics.hrv = 30 + Math.floor(Math.random() * 30);
                    this.metrics.stress = 20 + Math.floor(Math.random() * 40);
                    this.metrics.breathing = 12 + Math.floor(Math.random() * 8);

                    this.updateDisplay();

                    // Save to history
                    this.os.systemData.health.metrics.push({
                        timestamp: Date.now(),
                        ...this.metrics
                    });
                }, 1000);

                setTimeout(() => {
                    this.isScanning = false;
                    clearInterval(interval);
                    if (statusEl) statusEl.textContent = 'Scan complete';
                    this.os.speak(`Scan complete. Heart rate: ${this.metrics.heartRate} BPM. Stress level: ${this.metrics.stress} percent.`);
                    this.os.saveSystemData();
                }, 10000);
            }

            updateDisplay() {
                const elements = {
                    'heart-rate': this.metrics.heartRate,
                    'hrv': this.metrics.hrv,
                    'stress': this.metrics.stress + '%',
                    'breathing': this.metrics.breathing
                };

                for (const [id, value] of Object.entries(elements)) {
                    const el = document.getElementById(id);
                    if (el) el.textContent = value;
                }
            }
        }

        // Code Assistant App
        class CodeAssistant {
            constructor(os) {
                this.os = os;
                this.currentCode = '';
                this.templates = {
                    'function': 'function ${name}(${params}) {\n    // TODO: Implementation\n    return result;\n}',
                    'class': 'class ${name} {\n    constructor() {\n        // Initialize\n    }\n    \n    method() {\n        // TODO\n    }\n}',
                    'async': 'async function ${name}() {\n    try {\n        const result = await fetch(url);\n        return result.json();\n    } catch (error) {\n        console.error(error);\n    }\n}',
                    'component': 'function ${name}Component() {\n    return (\n        <div>\n            {/* Component content */}\n        </div>\n    );\n}'
                };
            }

            getWindowConfig() {
                return {
                    title: 'Code Assistant',
                    icon: 'üíª',
                    width: 1000,
                    height: 700,
                    content: this.render()
                };
            }

            render() {
                return `
                    <div class="code-assistant">
                        <h2>AI Code Assistant</h2>
                        <div style="margin: 20px 0;">
                            <input type="text" id="code-prompt" placeholder="Describe what code you need..."
                                   style="width: 70%; padding: 10px; background: rgba(0,212,255,0.1); border: 1px solid #00d4ff; color: white; border-radius: 8px;">
                            <button onclick="jarvisOS.apps.code.generateCode()"
                                    style="margin-left: 10px; padding: 10px 20px; background: #00d4ff; border: none; border-radius: 8px; color: white; cursor: pointer;">
                                Generate
                            </button>
                        </div>
                        <div class="code-editor" id="code-output" contenteditable="true">
                            // Generated code will appear here
                        </div>
                        <div style="margin-top: 20px;">
                            <button onclick="jarvisOS.apps.code.copyCode()" style="padding: 10px 20px; background: rgba(0,212,255,0.2); border: 1px solid #00d4ff; color: #00d4ff; border-radius: 8px; cursor: pointer; margin-right: 10px;">
                                Copy Code
                            </button>
                            <button onclick="jarvisOS.apps.code.explainCode()" style="padding: 10px 20px; background: rgba(0,212,255,0.2); border: 1px solid #00d4ff; color: #00d4ff; border-radius: 8px; cursor: pointer;">
                                Explain Code
                            </button>
                        </div>
                    </div>
                `;
            }

            generateCode() {
                const prompt = document.getElementById('code-prompt').value;
                if (!prompt) return;

                let code = '';

                // Simple pattern matching for code generation
                if (prompt.includes('function')) {
                    code = this.templates.function.replace('${name}', 'myFunction').replace('${params}', 'param1, param2');
                } else if (prompt.includes('class')) {
                    code = this.templates.class.replace('${name}', 'MyClass');
                } else if (prompt.includes('async') || prompt.includes('api')) {
                    code = this.templates.async.replace('${name}', 'fetchData');
                } else if (prompt.includes('component') || prompt.includes('react')) {
                    code = this.templates.component.replace('${name}', 'My');
                } else {
                    code = `// Generated code for: ${prompt}\nfunction implementation() {\n    // TODO: Add implementation\n    console.log("Executing: ${prompt}");\n}`;
                }

                const output = document.getElementById('code-output');
                if (output) {
                    output.textContent = code;
                    this.currentCode = code;
                }

                this.os.speak('Code generated successfully');

                // Save to history
                this.os.systemData.code.history.push({
                    prompt: prompt,
                    code: code,
                    timestamp: Date.now()
                });
                this.os.saveSystemData();
            }

            copyCode() {
                if (!this.currentCode) return;

                navigator.clipboard.writeText(this.currentCode).then(() => {
                    this.os.showNotification('Code Assistant', 'Code copied to clipboard');
                });
            }

            explainCode() {
                if (!this.currentCode) return;

                const explanation = `This code defines a ${this.currentCode.includes('class') ? 'class' : 'function'} that ${this.currentCode.includes('async') ? 'performs asynchronous operations' : 'executes synchronously'}. It includes proper error handling and follows best practices.`;

                this.os.speak(explanation);
                this.os.showNotification('Code Explanation', explanation);
            }
        }

        // Dream Journal App
        class DreamJournal {
            constructor(os) {
                this.os = os;
            }

            getWindowConfig() {
                return {
                    title: 'Dream Journal',
                    icon: 'üåô',
                    width: 800,
                    height: 600,
                    content: this.render()
                };
            }

            render() {
                const dreams = this.os.systemData.dreams.entries;
                const dreamList = dreams.map(d => `
                    <div class="dream-entry">
                        <strong>${new Date(d.timestamp).toLocaleDateString()}</strong>
                        <p>${d.content}</p>
                        ${d.symbols.length > 0 ? `<div style="margin-top: 10px;">Symbols: ${d.symbols.join(', ')}</div>` : ''}
                    </div>
                `).join('');

                return `
                    <div class="dream-journal">
                        <h2>Dream Journal</h2>
                        <div style="margin: 20px 0;">
                            <textarea id="dream-input" placeholder="Describe your dream..."
                                      style="width: 100%; height: 100px; padding: 10px; background: rgba(0,212,255,0.1); border: 1px solid #00d4ff; color: white; border-radius: 8px;"></textarea>
                            <button onclick="jarvisOS.apps.dreams.recordDream()"
                                    style="margin-top: 10px; padding: 10px 30px; background: #00d4ff; border: none; border-radius: 8px; color: white; cursor: pointer;">
                                Record Dream
                            </button>
                        </div>
                        <div id="dream-list" style="max-height: 300px; overflow-y: auto;">
                            ${dreamList || '<p style="opacity: 0.5;">No dreams recorded yet</p>'}
                        </div>
                    </div>
                `;
            }

            recordDream() {
                const input = document.getElementById('dream-input');
                if (!input || !input.value) return;

                const dream = {
                    content: input.value,
                    timestamp: Date.now(),
                    symbols: this.extractSymbols(input.value)
                };

                this.os.systemData.dreams.entries.unshift(dream);
                this.os.saveSystemData();

                input.value = '';
                this.updateDreamList();

                this.os.speak('Dream recorded and analyzed');
                this.os.showNotification('Dream Journal', 'Dream saved successfully');
            }

            extractSymbols(text) {
                const commonSymbols = ['water', 'flying', 'falling', 'chase', 'death', 'snake', 'house', 'car', 'animal'];
                return commonSymbols.filter(symbol => text.toLowerCase().includes(symbol));
            }

            updateDreamList() {
                const listEl = document.getElementById('dream-list');
                if (!listEl) return;

                const dreams = this.os.systemData.dreams.entries;
                const dreamList = dreams.map(d => `
                    <div class="dream-entry">
                        <strong>${new Date(d.timestamp).toLocaleDateString()}</strong>
                        <p>${d.content}</p>
                        ${d.symbols.length > 0 ? `<div style="margin-top: 10px;">Symbols: ${d.symbols.join(', ')}</div>` : ''}
                    </div>
                `).join('');

                listEl.innerHTML = dreamList || '<p style="opacity: 0.5;">No dreams recorded yet</p>';
            }
        }

        // Task Manager App
        class TaskManager {
            constructor(os) {
                this.os = os;
            }

            getWindowConfig() {
                return {
                    title: 'Task Manager',
                    icon: '‚úì',
                    width: 700,
                    height: 600,
                    content: this.render()
                };
            }

            render() {
                const tasks = this.os.systemData.tasks.active;
                const taskList = tasks.map((t, i) => `
                    <div class="task-item">
                        <div class="task-checkbox ${t.completed ? 'checked' : ''}" onclick="jarvisOS.apps.tasks.toggleTask(${i})"></div>
                        <span style="${t.completed ? 'text-decoration: line-through; opacity: 0.5;' : ''}">${t.text}</span>
                    </div>
                `).join('');

                return `
                    <div class="task-manager">
                        <h2>Task Manager</h2>
                        <div style="margin: 20px 0;">
                            <input type="text" id="task-input" placeholder="Add a new task..."
                                   style="width: 70%; padding: 10px; background: rgba(0,212,255,0.1); border: 1px solid #00d4ff; color: white; border-radius: 8px;">
                            <button onclick="jarvisOS.apps.tasks.addTask()"
                                    style="margin-left: 10px; padding: 10px 20px; background: #00d4ff; border: none; border-radius: 8px; color: white; cursor: pointer;">
                                Add Task
                            </button>
                        </div>
                        <div id="task-list">
                            ${taskList || '<p style="opacity: 0.5;">No tasks yet</p>'}
                        </div>
                    </div>
                `;
            }

            addTask() {
                const input = document.getElementById('task-input');
                if (!input || !input.value) return;

                const task = {
                    text: input.value,
                    completed: false,
                    timestamp: Date.now()
                };

                this.os.systemData.tasks.active.push(task);
                this.os.saveSystemData();

                input.value = '';
                this.updateTaskList();

                this.os.speak('Task added');
            }

            toggleTask(index) {
                const task = this.os.systemData.tasks.active[index];
                if (!task) return;

                task.completed = !task.completed;
                this.os.saveSystemData();
                this.updateTaskList();
            }

            updateTaskList() {
                const listEl = document.getElementById('task-list');
                if (!listEl) return;

                const tasks = this.os.systemData.tasks.active;
                const taskList = tasks.map((t, i) => `
                    <div class="task-item">
                        <div class="task-checkbox ${t.completed ? 'checked' : ''}" onclick="jarvisOS.apps.tasks.toggleTask(${i})"></div>
                        <span style="${t.completed ? 'text-decoration: line-through; opacity: 0.5;' : ''}">${t.text}</span>
                    </div>
                `).join('');

                listEl.innerHTML = taskList || '<p style="opacity: 0.5;">No tasks yet</p>';
            }
        }

        // Knowledge Base App
        class KnowledgeBase {
            constructor(os) {
                this.os = os;
            }

            getWindowConfig() {
                return {
                    title: 'Knowledge Base',
                    icon: 'üìö',
                    width: 900,
                    height: 650,
                    content: this.render()
                };
            }

            render() {
                const notes = this.os.systemData.knowledge.notes;
                const notesList = notes.map((n, i) => `
                    <div style="padding: 10px; background: rgba(0,212,255,0.05); border-radius: 8px; margin-bottom: 10px; cursor: pointer;"
                         onclick="jarvisOS.apps.knowledge.viewNote(${i})">
                        <strong>${n.title}</strong>
                        <div style="opacity: 0.7; font-size: 12px;">${new Date(n.timestamp).toLocaleDateString()}</div>
                    </div>
                `).join('');

                return `
                    <div class="knowledge-base">
                        <h2>Knowledge Base</h2>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
                            <div>
                                <h3>Notes</h3>
                                <button onclick="jarvisOS.apps.knowledge.newNote()"
                                        style="width: 100%; padding: 10px; background: #00d4ff; border: none; border-radius: 8px; color: white; cursor: pointer; margin-bottom: 10px;">
                                    New Note
                                </button>
                                <div id="notes-list">
                                    ${notesList || '<p style="opacity: 0.5;">No notes yet</p>'}
                                </div>
                            </div>
                            <div>
                                <input type="text" id="note-title" placeholder="Note title..."
                                       style="width: 100%; padding: 10px; background: rgba(0,212,255,0.1); border: 1px solid #00d4ff; color: white; border-radius: 8px; margin-bottom: 10px;">
                                <textarea id="note-content" placeholder="Write your note here..."
                                          style="width: 100%; height: 400px; padding: 10px; background: rgba(0,212,255,0.1); border: 1px solid #00d4ff; color: white; border-radius: 8px;"></textarea>
                                <button onclick="jarvisOS.apps.knowledge.saveNote()"
                                        style="margin-top: 10px; padding: 10px 30px; background: #00d4ff; border: none; border-radius: 8px; color: white; cursor: pointer;">
                                    Save Note
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            newNote() {
                const titleEl = document.getElementById('note-title');
                const contentEl = document.getElementById('note-content');
                if (titleEl) titleEl.value = '';
                if (contentEl) contentEl.value = '';
            }

            saveNote() {
                const titleEl = document.getElementById('note-title');
                const contentEl = document.getElementById('note-content');

                if (!titleEl || !contentEl || !titleEl.value || !contentEl.value) return;

                const note = {
                    title: titleEl.value,
                    content: contentEl.value,
                    timestamp: Date.now()
                };

                this.os.systemData.knowledge.notes.push(note);
                this.os.saveSystemData();

                this.updateNotesList();
                this.os.speak('Note saved');
                this.os.showNotification('Knowledge Base', 'Note saved successfully');
            }

            viewNote(index) {
                const note = this.os.systemData.knowledge.notes[index];
                if (!note) return;

                const titleEl = document.getElementById('note-title');
                const contentEl = document.getElementById('note-content');

                if (titleEl) titleEl.value = note.title;
                if (contentEl) contentEl.value = note.content;
            }

            updateNotesList() {
                const listEl = document.getElementById('notes-list');
                if (!listEl) return;

                const notes = this.os.systemData.knowledge.notes;
                const notesList = notes.map((n, i) => `
                    <div style="padding: 10px; background: rgba(0,212,255,0.05); border-radius: 8px; margin-bottom: 10px; cursor: pointer;"
                         onclick="jarvisOS.apps.knowledge.viewNote(${i})">
                        <strong>${n.title}</strong>
                        <div style="opacity: 0.7; font-size: 12px;">${new Date(n.timestamp).toLocaleDateString()}</div>
                    </div>
                `).join('');

                listEl.innerHTML = notesList || '<p style="opacity: 0.5;">No notes yet</p>';
            }
        }

        // Video Editor App
        class VideoEditor {
            constructor(os) {
                this.os = os;
            }

            getWindowConfig() {
                return {
                    title: 'Video Editor',
                    icon: 'üé¨',
                    width: 1000,
                    height: 650,
                    content: this.render()
                };
            }

            render() {
                return `
                    <div class="video-editor">
                        <h2>Video Editor</h2>
                        <div style="margin: 20px 0;">
                            <div style="width: 100%; height: 300px; background: rgba(0,212,255,0.05); border: 2px dashed #00d4ff; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <div style="text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 10px;">üé•</div>
                                    <div>Drag video file here or click to upload</div>
                                    <input type="file" accept="video/*" style="display: none;">
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button style="padding: 10px 20px; background: rgba(0,212,255,0.2); border: 1px solid #00d4ff; color: #00d4ff; border-radius: 8px; cursor: pointer;">
                                Cut
                            </button>
                            <button style="padding: 10px 20px; background: rgba(0,212,255,0.2); border: 1px solid #00d4ff; color: #00d4ff; border-radius: 8px; cursor: pointer;">
                                Trim
                            </button>
                            <button style="padding: 10px 20px; background: rgba(0,212,255,0.2); border: 1px solid #00d4ff; color: #00d4ff; border-radius: 8px; cursor: pointer;">
                                Effects
                            </button>
                            <button style="padding: 10px 20px; background: rgba(0,212,255,0.2); border: 1px solid #00d4ff; color: #00d4ff; border-radius: 8px; cursor: pointer;">
                                Export
                            </button>
                        </div>
                        <div style="margin-top: 20px; padding: 20px; background: rgba(0,212,255,0.05); border-radius: 10px;">
                            <div style="opacity: 0.7;">Timeline</div>
                            <div style="margin-top: 10px; height: 100px; background: rgba(0,212,255,0.1); border-radius: 5px;"></div>
                        </div>
                    </div>
                `;
            }
        }

        // Calculator App
        class Calculator {
            constructor(os) {
                this.os = os;
                this.display = '0';
                this.previousValue = null;
                this.operation = null;
            }

            getWindowConfig() {
                return {
                    title: 'Calculator',
                    icon: 'üßÆ',
                    width: 400,
                    height: 500,
                    content: this.render()
                };
            }

            render() {
                return `
                    <div class="calculator">
                        <div style="background: #000; color: #00ff00; font-size: 32px; padding: 20px; text-align: right; border-radius: 8px; margin-bottom: 10px; font-family: monospace;" id="calc-display">
                            0
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                            ${this.renderButtons()}
                        </div>
                    </div>
                `;
            }

            renderButtons() {
                const buttons = [
                    'C', '¬±', '%', '√∑',
                    '7', '8', '9', '√ó',
                    '4', '5', '6', '-',
                    '1', '2', '3', '+',
                    '0', '.', '=', '‚Üê'
                ];

                return buttons.map(btn => `
                    <button onclick="jarvisOS.apps.calculator.handleButton('${btn}')"
                            style="padding: 20px; background: rgba(0,212,255,0.1); border: 1px solid #00d4ff; color: #00d4ff; border-radius: 8px; cursor: pointer; font-size: 20px;">
                        ${btn}
                    </button>
                `).join('');
            }

            handleButton(value) {
                const displayEl = document.getElementById('calc-display');
                if (!displayEl) return;

                if (value >= '0' && value <= '9') {
                    this.display = this.display === '0' ? value : this.display + value;
                } else if (value === '.') {
                    if (!this.display.includes('.')) {
                        this.display += '.';
                    }
                } else if (value === 'C') {
                    this.display = '0';
                    this.previousValue = null;
                    this.operation = null;
                } else if (value === '‚Üê') {
                    this.display = this.display.slice(0, -1) || '0';
                } else if (value === '=') {
                    this.calculate();
                } else if (['+', '-', '√ó', '√∑'].includes(value)) {
                    this.operation = value;
                    this.previousValue = parseFloat(this.display);
                    this.display = '0';
                }

                displayEl.textContent = this.display;
            }

            calculate() {
                if (!this.operation || this.previousValue === null) return;

                const current = parseFloat(this.display);
                let result = 0;

                switch(this.operation) {
                    case '+': result = this.previousValue + current; break;
                    case '-': result = this.previousValue - current; break;
                    case '√ó': result = this.previousValue * current; break;
                    case '√∑': result = current !== 0 ? this.previousValue / current : 0; break;
                }

                this.display = result.toString();
                this.operation = null;
                this.previousValue = null;
            }
        }

        // Terminal App
        class Terminal {
            constructor(os) {
                this.os = os;
                this.history = [];
                this.historyIndex = -1;
            }

            getWindowConfig() {
                return {
                    title: 'Terminal',
                    icon: '‚å®Ô∏è',
                    width: 800,
                    height: 500,
                    content: this.render()
                };
            }

            render() {
                return `
                    <div class="terminal">
                        <div class="terminal-output" id="terminal-output">
                            JARVIS Terminal v1.0.0
                            Type 'help' for available commands

                        </div>
                        <div style="display: flex; align-items: center; background: black; padding: 10px;">
                            <span style="color: #00ff00; margin-right: 10px;">jarvis@localhost:~$</span>
                            <input type="text" class="terminal-input" id="terminal-input" onkeydown="jarvisOS.apps.terminal.handleInput(event)">
                        </div>
                    </div>
                `;
            }

            handleInput(event) {
                if (event.key === 'Enter') {
                    const input = event.target.value;
                    if (!input) return;

                    this.executeCommand(input);
                    this.history.push(input);
                    this.historyIndex = this.history.length;
                    event.target.value = '';
                } else if (event.key === 'ArrowUp') {
                    if (this.historyIndex > 0) {
                        this.historyIndex--;
                        event.target.value = this.history[this.historyIndex];
                    }
                } else if (event.key === 'ArrowDown') {
                    if (this.historyIndex < this.history.length - 1) {
                        this.historyIndex++;
                        event.target.value = this.history[this.historyIndex];
                    } else {
                        event.target.value = '';
                    }
                }
            }

            executeCommand(command) {
                const output = document.getElementById('terminal-output');
                if (!output) return;

                output.innerHTML += `jarvis@localhost:~$ ${command}\n`;

                const parts = command.split(' ');
                const cmd = parts[0].toLowerCase();

                switch(cmd) {
                    case 'help':
                        output.innerHTML += 'Available commands:\n';
                        output.innerHTML += '  help     - Show this help message\n';
                        output.innerHTML += '  clear    - Clear terminal\n';
                        output.innerHTML += '  date     - Show current date and time\n';
                        output.innerHTML += '  system   - Show system information\n';
                        output.innerHTML += '  open     - Open an app (e.g., open health)\n';
                        output.innerHTML += '  list     - List all apps\n';
                        output.innerHTML += '  export   - Export system data\n';
                        break;

                    case 'clear':
                        output.innerHTML = '';
                        break;

                    case 'date':
                        output.innerHTML += new Date().toString() + '\n';
                        break;

                    case 'system':
                        output.innerHTML += 'JARVIS Protocol OS v1.0.0\n';
                        output.innerHTML += `Boot count: ${this.os.systemData.system.bootCount}\n`;
                        output.innerHTML += `Windows open: ${this.os.windows.length}\n`;
                        output.innerHTML += `Voice: ${this.os.systemData.system.voiceEnabled ? 'Enabled' : 'Disabled'}\n`;
                        break;

                    case 'open':
                        if (parts[1]) {
                            this.os.openApp(parts[1]);
                            output.innerHTML += `Opening ${parts[1]}...\n`;
                        } else {
                            output.innerHTML += 'Usage: open [app_name]\n';
                        }
                        break;

                    case 'list':
                        output.innerHTML += 'Available apps:\n';
                        Object.keys(this.os.apps).forEach(app => {
                            output.innerHTML += `  - ${app}\n`;
                        });
                        break;

                    case 'export':
                        exportData();
                        output.innerHTML += 'System data exported\n';
                        break;

                    default:
                        output.innerHTML += `Command not found: ${cmd}\n`;
                }

                output.innerHTML += '\n';
                output.scrollTop = output.scrollHeight;
            }
        }

        // Settings App
        class Settings {
            constructor(os) {
                this.os = os;
            }

            getWindowConfig() {
                return {
                    title: 'Settings',
                    icon: '‚öôÔ∏è',
                    width: 700,
                    height: 500,
                    content: this.render()
                };
            }

            render() {
                const settings = this.os.systemData.system;
                return `
                    <div class="settings">
                        <h2>System Settings</h2>

                        <div class="settings-section">
                            <h3>General</h3>
                            <div class="setting-item">
                                <span>Voice Control</span>
                                <div class="toggle-switch ${settings.voiceEnabled ? 'active' : ''}"
                                     onclick="jarvisOS.apps.settings.toggleVoice(this)"></div>
                            </div>
                            <div class="setting-item">
                                <span>Dark Theme</span>
                                <div class="toggle-switch active" disabled></div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>System Information</h3>
                            <div class="setting-item">
                                <span>Version</span>
                                <span>1.0.0</span>
                            </div>
                            <div class="setting-item">
                                <span>Boot Count</span>
                                <span>${settings.bootCount}</span>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Data Management</h3>
                            <button onclick="exportData()" style="padding: 10px 20px; background: rgba(0,212,255,0.2); border: 1px solid #00d4ff; color: #00d4ff; border-radius: 8px; cursor: pointer; margin-right: 10px;">
                                Export All Data
                            </button>
                            <button onclick="jarvisOS.apps.settings.clearData()" style="padding: 10px 20px; background: rgba(255,50,50,0.2); border: 1px solid #ff3232; color: #ff3232; border-radius: 8px; cursor: pointer;">
                                Clear All Data
                            </button>
                        </div>
                    </div>
                `;
            }

            toggleVoice(element) {
                element.classList.toggle('active');
                this.os.systemData.system.voiceEnabled = element.classList.contains('active');
                this.os.saveSystemData();

                if (this.os.systemData.system.voiceEnabled) {
                    this.os.voiceController.startListening();
                } else {
                    this.os.voiceController.stopListening();
                }
            }

            clearData() {
                if (confirm('This will clear all data. Are you sure?')) {
                    localStorage.removeItem('jarvis-os-data');
                    location.reload();
                }
            }
        }

        // Data Export/Import Functions
        function exportData() {
            const data = jarvisOS.systemData;
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `jarvis-os-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    localStorage.setItem('jarvis-os-data', JSON.stringify(data));
                    location.reload();
                } catch (error) {
                    jarvisOS.showNotification('Error', 'Invalid JSON file');
                }
            };
            reader.readAsText(file);
        }

        // Initialize JARVIS OS
        let jarvisOS;
        window.addEventListener('DOMContentLoaded', () => {
            jarvisOS = new JarvisOS();
        });

        // Prevent context menu
        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
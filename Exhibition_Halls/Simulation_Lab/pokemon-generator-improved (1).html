<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Pokemon Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(to bottom, #60a5fa, #34d399);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(229, 231, 235, 1);
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 10;
        }

        .header-content {
            max-width: 96rem;
            margin: 0 auto;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .title {
            font-size: 2rem;
            font-weight: 700;
            color: #111827;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .title-emoji {
            font-size: 2.5rem;
        }

        .header-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .btn-purple {
            background-color: #9333ea;
            color: white;
        }

        .btn-purple:hover {
            background-color: #7c3aed;
        }

        .btn-green {
            background-color: #059669;
            color: white;
        }

        .btn-green:hover {
            background-color: #047857;
        }

        .btn-blue {
            background-color: #2563eb;
            color: white;
        }

        .btn-blue:hover {
            background-color: #1d4ed8;
        }

        .btn-orange {
            background-color: #ea580c;
            color: white;
        }

        .btn-orange:hover {
            background-color: #dc2626;
        }

        .btn-yellow {
            background-color: #eab308;
            color: #422006;
        }

        .btn-yellow:hover {
            background-color: #ca8a04;
        }

        .btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }

        .input-section {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
        }

        .input-main {
            flex: 1;
            min-width: 200px;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            outline: none;
            transition: all 0.2s;
        }

        .input-main:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .input-main:disabled {
            background-color: #f9fafb;
            color: #6b7280;
        }

        .btn-generate {
            padding: 0.75rem 2rem;
            font-weight: 600;
            font-size: 1rem;
        }

        .btn-random {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            font-size: 1rem;
        }

        .btn-example {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            font-size: 1rem;
        }

        .import-export-panel {
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }

        .import-export-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .import-export-grid {
                grid-template-columns: 1fr;
            }
            
            .header-top {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
            
            .title {
                font-size: 1.5rem;
            }
        }

        .import-export-section h3 {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .file-input {
            width: 100%;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .textarea {
            width: 100%;
            height: 6rem;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-family: 'Courier New', monospace;
            resize: vertical;
            margin-bottom: 0.5rem;
        }

        .textarea-readonly {
            background-color: #f3f4f6;
        }

        .error-message {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 0.5rem;
            color: #dc2626;
            font-size: 0.875rem;
        }

        .success-message {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background-color: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 0.5rem;
            color: #16a34a;
            font-size: 0.875rem;
        }

        .pokemon-info {
            background-color: #eff6ff;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #bfdbfe;
        }

        .pokemon-header {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 1rem;
            gap: 1rem;
        }

        .pokemon-details h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 0.25rem;
        }

        .pokemon-description {
            color: #4b5563;
            margin-bottom: 0.5rem;
        }

        .pokemon-types {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .type-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .type-badge-electric {
            background-color: #fef08a;
            color: #854d0e;
        }

        .type-badge-fire {
            background-color: #fecaca;
            color: #991b1b;
        }

        .type-badge-water {
            background-color: #bfdbfe;
            color: #1e40af;
        }

        .type-badge-grass {
            background-color: #bbf7d0;
            color: #166534;
        }

        .type-badge-ice {
            background-color: #cffafe;
            color: #0e7490;
        }

        .type-badge-fighting {
            background-color: #fecdd3;
            color: #be123c;
        }

        .type-badge-poison {
            background-color: #e9d5ff;
            color: #7e22ce;
        }

        .type-badge-ground {
            background-color: #fde68a;
            color: #92400e;
        }

        .type-badge-flying {
            background-color: #ddd6fe;
            color: #5b21b6;
        }

        .type-badge-psychic {
            background-color: #fbcfe8;
            color: #9d174d;
        }

        .type-badge-bug {
            background-color: #d9f99d;
            color: #3f6212;
        }

        .type-badge-rock {
            background-color: #d6d3d1;
            color: #44403c;
        }

        .type-badge-ghost {
            background-color: #c4b5fd;
            color: #5b21b6;
        }

        .type-badge-dragon {
            background-color: #c7d2fe;
            color: #3730a3;
        }

        .type-badge-dark {
            background-color: #a8a29e;
            color: #1c1917;
        }

        .type-badge-steel {
            background-color: #d4d4d8;
            color: #3f3f46;
        }

        .type-badge-fairy {
            background-color: #fce7f3;
            color: #9d174d;
        }

        .type-badge-normal {
            background-color: #e5e5e5;
            color: #404040;
        }

        .type-badge-default {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .pokemon-abilities {
            font-size: 0.875rem;
            color: #4b5563;
        }

        .pokemon-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .stat-item {
            color: #4b5563;
        }

        .stat-value {
            font-weight: 600;
        }

        .viewer {
            flex: 1;
            position: relative;
        }

        .viewer-canvas {
            width: 100%;
            height: 100%;
        }

        .empty-state {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
        }

        .empty-state-emoji {
            font-size: 5rem;
            margin-bottom: 1.5rem;
        }

        .empty-state-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .empty-state-subtitle {
            font-size: 1.125rem;
            opacity: 0.9;
        }

        .empty-state-hint {
            margin-top: 1rem;
            font-size: 0.875rem;
            opacity: 0.75;
        }

        .loading-state {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-emoji {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: bounce 1s infinite;
        }

        .loading-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .loading-subtitle {
            font-size: 0.875rem;
            margin-top: 0.5rem;
            opacity: 0.75;
        }

        .controls-panel {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 0.5rem;
            padding: 0.75rem;
            font-size: 0.875rem;
        }

        .controls-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .controls-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .controls-list li {
            margin-bottom: 0.25rem;
        }

        .rotation-toggle {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
        }

        .example-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #422006;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.875rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .hidden {
            display: none !important;
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0, 0, 0);
            }
            40%, 43% {
                transform: translate3d(0, -30px, 0);
            }
            70% {
                transform: translate3d(0, -15px, 0);
            }
            90% {
                transform: translate3d(0, -4px, 0);
            }
        }

        .import-export-hint {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .tooltip {
            position: relative;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1f2937;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            white-space: nowrap;
            margin-bottom: 0.5rem;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-top">
                    <h1 class="title">
                        <span class="title-emoji">‚ö°</span>
                        3D Pokemon Generator
                    </h1>
                    <div class="header-buttons">
                        <button id="exampleBtn" class="btn btn-yellow tooltip" data-tooltip="Load Pikachu example">
                            ‚ö° Example: Pikachu
                        </button>
                        <button id="importExportBtn" class="btn btn-purple">
                            üìÅ Import/Export
                        </button>
                        <button id="saveBtn" class="btn btn-green hidden">
                            üíæ Save Pokemon
                        </button>
                    </div>
                </div>
                
                <div class="input-section">
                    <input 
                        type="text" 
                        id="pokemonInput"
                        class="input-main"
                        placeholder="Describe your Pokemon (e.g., 'fire dragon', 'ice wolf', 'electric butterfly')"
                    >
                    <button id="generateBtn" class="btn btn-blue btn-generate">
                        üé≤ Generate
                    </button>
                    <button id="randomBtn" class="btn btn-orange btn-random">
                        üéØ Random
                    </button>
                </div>

                <!-- Import/Export Panel -->
                <div id="importExportPanel" class="import-export-panel hidden">
                    <div class="import-export-grid">
                        <div class="import-export-section">
                            <h3>Import Pokemon</h3>
                            <input type="file" id="fileInput" class="file-input" accept=".json">
                            <textarea 
                                id="importTextarea" 
                                class="textarea" 
                                placeholder="Or paste Pokemon JSON data here..."></textarea>
                            <button id="importBtn" class="btn btn-purple">Import Pokemon</button>
                        </div>
                        <div class="import-export-section">
                            <h3>Export Current Pokemon</h3>
                            <textarea 
                                id="exportTextarea" 
                                class="textarea textarea-readonly" 
                                readonly></textarea>
                            <div class="import-export-hint">
                                Click "Save Pokemon" to download as file
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="errorMessage" class="error-message hidden"></div>
                <div id="successMessage" class="success-message hidden"></div>
                
                <div id="pokemonInfo" class="pokemon-info hidden">
                    <div class="pokemon-header">
                        <div class="pokemon-details">
                            <h2 id="pokemonName"></h2>
                            <p id="pokemonDescription" class="pokemon-description"></p>
                            <div id="pokemonTypes" class="pokemon-types"></div>
                            <div id="pokemonAbilities" class="pokemon-abilities"></div>
                        </div>
                        <div id="pokemonStats" class="pokemon-stats"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 3D Viewer -->
        <div class="viewer">
            <div id="viewerCanvas" class="viewer-canvas"></div>
            
            <div id="emptyState" class="empty-state">
                <div class="empty-state-emoji">‚ö°üéÆ</div>
                <p class="empty-state-title">Create Your Dream Pokemon!</p>
                <p class="empty-state-subtitle">Describe any creature and watch it come to life in 3D</p>
                <div class="empty-state-hint">
                    Try: "fire dragon", "ice crystal wolf", "electric fairy butterfly"<br>
                    Or click <strong>"‚ö° Example: Pikachu"</strong> to see a sample!
                </div>
            </div>
            
            <div id="loadingState" class="loading-state hidden">
                <div class="loading-content">
                    <div class="loading-emoji">‚ö°</div>
                    <p class="loading-title">Generating your Pokemon...</p>
                    <p class="loading-subtitle">Claude is designing a unique creature just for you!</p>
                </div>
            </div>
            
            <div id="exampleBadge" class="example-badge hidden">
                ‚ö° Example Pokemon
            </div>
            
            <div id="controlsPanel" class="controls-panel hidden">
                <p class="controls-title">üéÆ Controls:</p>
                <ul class="controls-list">
                    <li>‚Ä¢ Drag to rotate Pokemon</li>
                    <li>‚Ä¢ Scroll to zoom in/out</li>
                    <li id="autoRotateStatus">‚Ä¢ Auto-rotation: ON</li>
                </ul>
            </div>
            
            <button id="rotationToggle" class="btn btn-blue rotation-toggle hidden">
                ‚è∏Ô∏è Stop Rotation
            </button>
        </div>
    </div>

    <script>
        class PokemonGenerator3D {
            constructor() {
                this.pokemonData = null;
                this.autoRotate = true;
                this.loading = false;
                this.scene = null;
                this.renderer = null;
                this.camera = null;
                this.frameId = null;
                this.rotationSpeed = 0.01;
                this.isExamplePokemon = false;
                
                this.initializeElements();
                this.initializeEventListeners();
                this.initializeScene();
                
                // Load Pikachu example on startup
                this.loadExamplePokemon();
            }

            // Default Pikachu example data
            getExamplePikachu() {
                return {
                    "name": "Pikachu",
                    "type": ["Electric"],
                    "description": "A cute Electric-type Mouse Pokemon known for its red cheeks that store electricity. When threatened, it releases electric discharges from its cheek pouches.",
                    "stats": {
                        "hp": 35,
                        "attack": 55,
                        "defense": 40,
                        "speed": 90
                    },
                    "abilities": ["Static", "Lightning Rod"],
                    "bodyParts": [
                        {
                            "name": "body",
                            "shape": "sphere",
                            "size": 1.2,
                            "color": "#FFD93D",
                            "position": [0, 0, 0],
                            "rotation": [0, 0, 0],
                            "scale": [1, 0.9, 0.8],
                            "shininess": 40,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "head",
                            "shape": "sphere",
                            "size": 1.0,
                            "color": "#FFD93D",
                            "position": [0, 1.4, 0.2],
                            "rotation": [0, 0, 0],
                            "scale": [1.1, 1, 1],
                            "shininess": 40,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "left_ear",
                            "shape": "cone",
                            "size": 0.35,
                            "color": "#FFD93D",
                            "position": [-0.6, 2.4, 0.1],
                            "rotation": [0, 0, 0.4],
                            "scale": [1, 2.2, 0.6],
                            "height": 1.4,
                            "shininess": 40,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "right_ear",
                            "shape": "cone",
                            "size": 0.35,
                            "color": "#FFD93D",
                            "position": [0.6, 2.4, 0.1],
                            "rotation": [0, 0, -0.4],
                            "scale": [1, 2.2, 0.6],
                            "height": 1.4,
                            "shininess": 40,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "left_ear_tip",
                            "shape": "cone",
                            "size": 0.32,
                            "color": "#2D2D2D",
                            "position": [-0.75, 3.1, 0.1],
                            "rotation": [0, 0, 0.4],
                            "scale": [1, 1.2, 0.6],
                            "height": 0.8,
                            "shininess": 30,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "right_ear_tip",
                            "shape": "cone",
                            "size": 0.32,
                            "color": "#2D2D2D",
                            "position": [0.75, 3.1, 0.1],
                            "rotation": [0, 0, -0.4],
                            "scale": [1, 1.2, 0.6],
                            "height": 0.8,
                            "shininess": 30,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "left_cheek",
                            "shape": "sphere",
                            "size": 0.28,
                            "color": "#FF4444",
                            "position": [-0.75, 1.2, 0.65],
                            "rotation": [0, 0, 0],
                            "scale": [1, 0.8, 0.5],
                            "shininess": 60,
                            "opacity": 1,
                            "glowing": true
                        },
                        {
                            "name": "right_cheek",
                            "shape": "sphere",
                            "size": 0.28,
                            "color": "#FF4444",
                            "position": [0.75, 1.2, 0.65],
                            "rotation": [0, 0, 0],
                            "scale": [1, 0.8, 0.5],
                            "shininess": 60,
                            "opacity": 1,
                            "glowing": true
                        },
                        {
                            "name": "snout",
                            "shape": "sphere",
                            "size": 0.25,
                            "color": "#FFD93D",
                            "position": [0, 1.15, 0.85],
                            "rotation": [0, 0, 0],
                            "scale": [0.8, 0.6, 0.7],
                            "shininess": 40,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "nose",
                            "shape": "sphere",
                            "size": 0.08,
                            "color": "#2D2D2D",
                            "position": [0, 1.2, 1.05],
                            "rotation": [0, 0, 0],
                            "scale": [1, 0.8, 0.8],
                            "shininess": 80,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "left_eye",
                            "shape": "sphere",
                            "size": 0.18,
                            "color": "#2D2D2D",
                            "position": [-0.35, 1.55, 0.75],
                            "rotation": [0, 0, 0],
                            "scale": [1, 1.2, 0.8],
                            "shininess": 90,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "right_eye",
                            "shape": "sphere",
                            "size": 0.18,
                            "color": "#2D2D2D",
                            "position": [0.35, 1.55, 0.75],
                            "rotation": [0, 0, 0],
                            "scale": [1, 1.2, 0.8],
                            "shininess": 90,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "left_eye_highlight",
                            "shape": "sphere",
                            "size": 0.06,
                            "color": "#FFFFFF",
                            "position": [-0.32, 1.62, 0.88],
                            "rotation": [0, 0, 0],
                            "scale": [1, 1, 1],
                            "shininess": 100,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "right_eye_highlight",
                            "shape": "sphere",
                            "size": 0.06,
                            "color": "#FFFFFF",
                            "position": [0.32, 1.62, 0.88],
                            "rotation": [0, 0, 0],
                            "scale": [1, 1, 1],
                            "shininess": 100,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "left_arm",
                            "shape": "cylinder",
                            "size": 0.18,
                            "color": "#FFD93D",
                            "position": [-1.0, 0.1, 0.2],
                            "rotation": [0, 0, 0.8],
                            "scale": [1, 1, 1],
                            "height": 0.9,
                            "radiusTop": 0.15,
                            "radiusBottom": 0.2,
                            "shininess": 40,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "right_arm",
                            "shape": "cylinder",
                            "size": 0.18,
                            "color": "#FFD93D",
                            "position": [1.0, 0.1, 0.2],
                            "rotation": [0, 0, -0.8],
                            "scale": [1, 1, 1],
                            "height": 0.9,
                            "radiusTop": 0.15,
                            "radiusBottom": 0.2,
                            "shininess": 40,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "left_foot",
                            "shape": "sphere",
                            "size": 0.35,
                            "color": "#FFD93D",
                            "position": [-0.5, -1.0, 0.3],
                            "rotation": [0, 0, 0],
                            "scale": [1.2, 0.5, 1.4],
                            "shininess": 40,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "right_foot",
                            "shape": "sphere",
                            "size": 0.35,
                            "color": "#FFD93D",
                            "position": [0.5, -1.0, 0.3],
                            "rotation": [0, 0, 0],
                            "scale": [1.2, 0.5, 1.4],
                            "shininess": 40,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "tail_base",
                            "shape": "box",
                            "size": 0.3,
                            "color": "#CC8800",
                            "position": [0, -0.2, -1.0],
                            "rotation": [0.3, 0, 0],
                            "scale": [1, 1, 1],
                            "width": 0.25,
                            "height": 0.6,
                            "depth": 0.15,
                            "shininess": 40,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "tail_mid",
                            "shape": "box",
                            "size": 0.35,
                            "color": "#FFD93D",
                            "position": [0, 0.5, -1.3],
                            "rotation": [-0.3, 0, 0],
                            "scale": [1, 1, 1],
                            "width": 0.35,
                            "height": 1.0,
                            "depth": 0.12,
                            "shininess": 40,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "tail_lightning_left",
                            "shape": "box",
                            "size": 0.3,
                            "color": "#FFD93D",
                            "position": [-0.45, 1.3, -1.4],
                            "rotation": [0, 0, 0.6],
                            "scale": [1, 1, 1],
                            "width": 0.6,
                            "height": 0.35,
                            "depth": 0.12,
                            "shininess": 50,
                            "opacity": 1,
                            "glowing": true
                        },
                        {
                            "name": "tail_lightning_right",
                            "shape": "box",
                            "size": 0.3,
                            "color": "#FFD93D",
                            "position": [0.45, 1.3, -1.4],
                            "rotation": [0, 0, -0.6],
                            "scale": [1, 1, 1],
                            "width": 0.6,
                            "height": 0.35,
                            "depth": 0.12,
                            "shininess": 50,
                            "opacity": 1,
                            "glowing": true
                        },
                        {
                            "name": "tail_top",
                            "shape": "box",
                            "size": 0.25,
                            "color": "#FFD93D",
                            "position": [0, 1.7, -1.35],
                            "rotation": [0, 0, 0],
                            "scale": [1, 1, 1],
                            "width": 0.3,
                            "height": 0.5,
                            "depth": 0.12,
                            "shininess": 50,
                            "opacity": 1,
                            "glowing": true
                        },
                        {
                            "name": "belly_stripe_1",
                            "shape": "box",
                            "size": 0.15,
                            "color": "#CC8800",
                            "position": [0, -0.1, 0.7],
                            "rotation": [0, 0, 0],
                            "scale": [1, 1, 1],
                            "width": 0.8,
                            "height": 0.12,
                            "depth": 0.1,
                            "shininess": 30,
                            "opacity": 1,
                            "glowing": false
                        },
                        {
                            "name": "belly_stripe_2",
                            "shape": "box",
                            "size": 0.15,
                            "color": "#CC8800",
                            "position": [0, -0.35, 0.65],
                            "rotation": [0, 0, 0],
                            "scale": [1, 1, 1],
                            "width": 0.6,
                            "height": 0.12,
                            "depth": 0.1,
                            "shininess": 30,
                            "opacity": 1,
                            "glowing": false
                        }
                    ]
                };
            }

            initializeElements() {
                this.elements = {
                    pokemonInput: document.getElementById('pokemonInput'),
                    generateBtn: document.getElementById('generateBtn'),
                    randomBtn: document.getElementById('randomBtn'),
                    exampleBtn: document.getElementById('exampleBtn'),
                    importExportBtn: document.getElementById('importExportBtn'),
                    saveBtn: document.getElementById('saveBtn'),
                    importExportPanel: document.getElementById('importExportPanel'),
                    fileInput: document.getElementById('fileInput'),
                    importTextarea: document.getElementById('importTextarea'),
                    importBtn: document.getElementById('importBtn'),
                    exportTextarea: document.getElementById('exportTextarea'),
                    errorMessage: document.getElementById('errorMessage'),
                    successMessage: document.getElementById('successMessage'),
                    pokemonInfo: document.getElementById('pokemonInfo'),
                    pokemonName: document.getElementById('pokemonName'),
                    pokemonDescription: document.getElementById('pokemonDescription'),
                    pokemonTypes: document.getElementById('pokemonTypes'),
                    pokemonAbilities: document.getElementById('pokemonAbilities'),
                    pokemonStats: document.getElementById('pokemonStats'),
                    viewerCanvas: document.getElementById('viewerCanvas'),
                    emptyState: document.getElementById('emptyState'),
                    loadingState: document.getElementById('loadingState'),
                    exampleBadge: document.getElementById('exampleBadge'),
                    controlsPanel: document.getElementById('controlsPanel'),
                    rotationToggle: document.getElementById('rotationToggle'),
                    autoRotateStatus: document.getElementById('autoRotateStatus')
                };
            }

            initializeEventListeners() {
                this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());
                this.elements.randomBtn.addEventListener('click', () => this.handleRandomGenerate());
                this.elements.exampleBtn.addEventListener('click', () => this.loadExamplePokemon());
                this.elements.importExportBtn.addEventListener('click', () => this.toggleImportExport());
                this.elements.saveBtn.addEventListener('click', () => this.exportPokemon());
                this.elements.importBtn.addEventListener('click', () => this.importPokemon());
                this.elements.rotationToggle.addEventListener('click', () => this.toggleRotation());
                this.elements.fileInput.addEventListener('change', (e) => this.handleFileImport(e));
                
                this.elements.pokemonInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.handleGenerate();
                });

                window.addEventListener('resize', () => this.handleResize());
            }

            initializeScene() {
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x87CEEB);
                
                this.camera = new THREE.PerspectiveCamera(
                    75,
                    this.elements.viewerCanvas.clientWidth / this.elements.viewerCanvas.clientHeight,
                    0.1,
                    1000
                );
                this.camera.position.set(0, 2, 8);
                
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(this.elements.viewerCanvas.clientWidth, this.elements.viewerCanvas.clientHeight);
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                
                // Enhanced lighting setup
                const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
                this.scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.9);
                directionalLight.position.set(5, 10, 5);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                this.scene.add(directionalLight);
                
                const pointLight = new THREE.PointLight(0xffffff, 0.5, 50);
                pointLight.position.set(-5, 5, -5);
                this.scene.add(pointLight);
                
                // Fill light from below for better visibility
                const fillLight = new THREE.PointLight(0xffffee, 0.3, 30);
                fillLight.position.set(0, -3, 5);
                this.scene.add(fillLight);
                
                // Ground plane
                const groundGeometry = new THREE.PlaneGeometry(20, 20);
                const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x90EE90 });
                const ground = new THREE.Mesh(groundGeometry, groundMaterial);
                ground.rotation.x = -Math.PI / 2;
                ground.position.y = -3;
                ground.receiveShadow = true;
                this.scene.add(ground);
                
                this.elements.viewerCanvas.appendChild(this.renderer.domElement);
                
                this.setupMouseControls();
                this.startAnimation();
            }

            setupMouseControls() {
                let mouseDown = false;
                let mouseX = 0;
                let mouseY = 0;
                
                const onMouseDown = (event) => {
                    mouseDown = true;
                    mouseX = event.clientX;
                    mouseY = event.clientY;
                    this.setAutoRotate(false);
                };
                
                const onMouseUp = () => {
                    mouseDown = false;
                };
                
                const onMouseMove = (event) => {
                    if (!mouseDown) return;
                    
                    const deltaX = event.clientX - mouseX;
                    const deltaY = event.clientY - mouseY;
                    
                    if (this.scene) {
                        this.scene.rotation.y += deltaX * 0.01;
                        this.scene.rotation.x += deltaY * 0.01;
                        this.scene.rotation.x = Math.max(-Math.PI/3, Math.min(Math.PI/3, this.scene.rotation.x));
                    }
                    
                    mouseX = event.clientX;
                    mouseY = event.clientY;
                };
                
                const onWheel = (event) => {
                    this.camera.position.z += event.deltaY * 0.01;
                    this.camera.position.z = Math.max(3, Math.min(20, this.camera.position.z));
                };

                // Touch support
                const onTouchStart = (event) => {
                    if (event.touches.length === 1) {
                        mouseDown = true;
                        mouseX = event.touches[0].clientX;
                        mouseY = event.touches[0].clientY;
                        this.setAutoRotate(false);
                    }
                };

                const onTouchEnd = () => {
                    mouseDown = false;
                };

                const onTouchMove = (event) => {
                    if (!mouseDown || event.touches.length !== 1) return;
                    
                    const deltaX = event.touches[0].clientX - mouseX;
                    const deltaY = event.touches[0].clientY - mouseY;
                    
                    if (this.scene) {
                        this.scene.rotation.y += deltaX * 0.01;
                        this.scene.rotation.x += deltaY * 0.01;
                        this.scene.rotation.x = Math.max(-Math.PI/3, Math.min(Math.PI/3, this.scene.rotation.x));
                    }
                    
                    mouseX = event.touches[0].clientX;
                    mouseY = event.touches[0].clientY;
                };
                
                this.renderer.domElement.addEventListener('mousedown', onMouseDown);
                this.renderer.domElement.addEventListener('mouseup', onMouseUp);
                this.renderer.domElement.addEventListener('mouseleave', onMouseUp);
                this.renderer.domElement.addEventListener('mousemove', onMouseMove);
                this.renderer.domElement.addEventListener('wheel', onWheel);
                
                this.renderer.domElement.addEventListener('touchstart', onTouchStart, { passive: true });
                this.renderer.domElement.addEventListener('touchend', onTouchEnd);
                this.renderer.domElement.addEventListener('touchmove', onTouchMove, { passive: true });
            }

            startAnimation() {
                const animate = () => {
                    this.frameId = requestAnimationFrame(animate);
                    
                    if (this.autoRotate && this.scene) {
                        this.scene.rotation.y += this.rotationSpeed;
                    }
                    
                    this.renderer.render(this.scene, this.camera);
                };
                animate();
            }

            loadExamplePokemon() {
                this.isExamplePokemon = true;
                const pikachu = this.getExamplePikachu();
                this.pokemonData = pikachu;
                this.createPokemonModel(pikachu);
                this.displayPokemonInfo(pikachu);
                this.showSuccess('Loaded example Pikachu! Try generating your own Pokemon above.');
                this.elements.exampleBadge.classList.remove('hidden');
                
                // Reset rotation for better initial view
                if (this.scene) {
                    this.scene.rotation.x = 0;
                    this.scene.rotation.y = 0;
                }
            }

            handleGenerate() {
                const input = this.elements.pokemonInput.value.trim();
                if (input) {
                    this.isExamplePokemon = false;
                    this.elements.exampleBadge.classList.add('hidden');
                    this.generatePokemon(input);
                }
            }

            handleRandomGenerate() {
                const randomPrompts = [
                    "fire dragon", "ice crystal", "electric mouse", "grass flower", "water bubble",
                    "shadow phantom", "metal robot", "fairy butterfly", "rock golem", "poison snake",
                    "flying bird", "psychic cat", "fighting bear", "ground mole", "bug beetle",
                    "ghost spirit", "steel armor", "normal fluffy", "dark wolf", "mystical creature",
                    "thunder lion", "ice phoenix", "fire fox", "water serpent", "nature spirit",
                    "cosmic star", "lava turtle", "cloud dragon", "crystal unicorn", "shadow ninja"
                ];
                const randomPrompt = randomPrompts[Math.floor(Math.random() * randomPrompts.length)];
                this.elements.pokemonInput.value = randomPrompt;
                this.isExamplePokemon = false;
                this.elements.exampleBadge.classList.add('hidden');
                this.generatePokemon(randomPrompt);
            }

            async generatePokemon(name) {
                this.setLoading(true);
                this.showError('');
                this.showSuccess('');
                
                const prompt = `You are a Pokemon generator. Create a unique 3D Pokemon based on the name or concept: "${name}".

Generate ONLY valid JSON in this exact format:

{
  "name": "Pokemon Name",
  "type": ["Primary Type", "Secondary Type (optional)"],
  "description": "Brief description of the Pokemon",
  "stats": {
    "hp": number,
    "attack": number,
    "defense": number,
    "speed": number
  },
  "abilities": ["ability1", "ability2"],
  "bodyParts": [
    {
      "name": "body part name",
      "shape": "sphere|cylinder|box|cone|torus|dodecahedron|octahedron",
      "size": number_0_to_3,
      "color": "#hexcolor",
      "position": [x, y, z],
      "rotation": [rx, ry, rz],
      "scale": [sx, sy, sz],
      "shininess": number_0_to_100,
      "opacity": number_0_to_1,
      "glowing": boolean,
      "width": number_optional_for_box,
      "height": number_optional_for_cylinder_cone_box,
      "depth": number_optional_for_box,
      "radiusTop": number_optional_for_cylinder,
      "radiusBottom": number_optional_for_cylinder,
      "tubeRadius": number_optional_for_torus
    }
  ]
}

Requirements:
- bodyParts array should have 8-20 parts (head, body, limbs, features, details, etc.)
- Use realistic 3D coordinates for position (head at top, feet at bottom)
- Colors should match the Pokemon's type and theme
- Include interesting shapes and features that make the Pokemon unique
- Position coordinates: Y=0 is center, positive Y is up, negative Y is down
- Size values should be reasonable (0.1 to 3.0)
- Make it look like a real Pokemon with distinctive features
- Add details like eyes, nose, markings, accessories to make it interesting

Pokemon concept: ${name}

RESPOND ONLY WITH VALID JSON. DO NOT INCLUDE ANY OTHER TEXT.`;

                try {
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 3000,
                            messages: [{ role: "user", content: prompt }]
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API request failed: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    let responseText = data.content[0].text;
                    
                    // Clean up the response
                    responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
                    
                    const pokemonData = JSON.parse(responseText);
                    
                    // Validate structure
                    if (!pokemonData.name || !pokemonData.bodyParts || !Array.isArray(pokemonData.bodyParts)) {
                        throw new Error('Invalid Pokemon data structure');
                    }
                    
                    // Validate body parts
                    const hasValidParts = pokemonData.bodyParts.every(part => 
                        part.name && part.shape && typeof part.size === 'number' && 
                        part.color && Array.isArray(part.position) && part.position.length === 3
                    );
                    
                    if (!hasValidParts) {
                        throw new Error('Invalid body parts data structure');
                    }
                    
                    this.pokemonData = pokemonData;
                    this.createPokemonModel(pokemonData);
                    this.displayPokemonInfo(pokemonData);
                    this.showSuccess(`Successfully generated ${pokemonData.name}!`);
                    
                } catch (error) {
                    this.showError(`Error generating Pokemon: ${error.message}`);
                    console.error('Generation error:', error);
                } finally {
                    this.setLoading(false);
                }
            }

            createPokemonModel(data) {
                if (!this.scene) return;
                
                this.clearPokemon();
                
                const group = new THREE.Group();
                group.userData.isPokemonPart = true;
                
                // Create body parts
                data.bodyParts.forEach((part) => {
                    let geometry;
                    const color = parseInt(part.color.replace('#', '0x'));
                    const material = new THREE.MeshPhongMaterial({ 
                        color,
                        shininess: part.shininess || 30,
                        transparent: part.opacity < 1,
                        opacity: part.opacity || 1
                    });
                    
                    // Create different geometries based on part type
                    switch (part.shape) {
                        case 'sphere':
                            geometry = new THREE.SphereGeometry(part.size, 32, 32);
                            break;
                        case 'cylinder':
                            geometry = new THREE.CylinderGeometry(
                                part.radiusTop || part.size, 
                                part.radiusBottom || part.size, 
                                part.height || part.size * 2, 
                                16
                            );
                            break;
                        case 'box':
                            geometry = new THREE.BoxGeometry(
                                part.width || part.size, 
                                part.height || part.size, 
                                part.depth || part.size
                            );
                            break;
                        case 'cone':
                            geometry = new THREE.ConeGeometry(part.size, part.height || part.size * 2, 16);
                            break;
                        case 'torus':
                            geometry = new THREE.TorusGeometry(part.size, part.tubeRadius || part.size * 0.3, 8, 16);
                            break;
                        case 'dodecahedron':
                            geometry = new THREE.DodecahedronGeometry(part.size);
                            break;
                        case 'octahedron':
                            geometry = new THREE.OctahedronGeometry(part.size);
                            break;
                        default:
                            geometry = new THREE.SphereGeometry(part.size, 16, 16);
                    }
                    
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.position.set(part.position[0], part.position[1], part.position[2]);
                    
                    if (part.rotation) {
                        mesh.rotation.set(part.rotation[0], part.rotation[1], part.rotation[2]);
                    }
                    
                    if (part.scale) {
                        mesh.scale.set(part.scale[0], part.scale[1], part.scale[2]);
                    }
                    
                    mesh.castShadow = true;
                    mesh.receiveShadow = true;
                    mesh.userData = { isPokemonPart: true, partName: part.name };
                    
                    group.add(mesh);
                    
                    // Add glow effect if specified
                    if (part.glowing) {
                        const glowMaterial = new THREE.MeshBasicMaterial({ 
                            color, 
                            transparent: true, 
                            opacity: 0.3 
                        });
                        const glowMesh = new THREE.Mesh(geometry.clone(), glowMaterial);
                        glowMesh.scale.multiplyScalar(1.15);
                        glowMesh.position.copy(mesh.position);
                        glowMesh.rotation.copy(mesh.rotation);
                        if (part.scale) {
                            glowMesh.scale.set(part.scale[0] * 1.15, part.scale[1] * 1.15, part.scale[2] * 1.15);
                        }
                        glowMesh.userData = { isPokemonPart: true, isGlow: true };
                        group.add(glowMesh);
                    }
                });
                
                // Add sparkle effects for certain types
                if (data.type.includes('Fairy') || data.type.includes('Psychic')) {
                    for (let i = 0; i < 20; i++) {
                        const sparkleGeometry = new THREE.SphereGeometry(0.05, 8, 8);
                        const sparkleMaterial = new THREE.MeshBasicMaterial({ 
                            color: 0xFFFFFF,
                            transparent: true,
                            opacity: Math.random() * 0.8 + 0.2
                        });
                        const sparkle = new THREE.Mesh(sparkleGeometry, sparkleMaterial);
                        sparkle.position.set(
                            (Math.random() - 0.5) * 8,
                            Math.random() * 6,
                            (Math.random() - 0.5) * 8
                        );
                        sparkle.userData = { isPokemonPart: true, isSparkle: true };
                        group.add(sparkle);
                    }
                }

                // Add electric sparks for Electric type
                if (data.type.includes('Electric')) {
                    for (let i = 0; i < 15; i++) {
                        const sparkGeometry = new THREE.OctahedronGeometry(0.08);
                        const sparkMaterial = new THREE.MeshBasicMaterial({ 
                            color: 0xFFFF00,
                            transparent: true,
                            opacity: Math.random() * 0.6 + 0.4
                        });
                        const spark = new THREE.Mesh(sparkGeometry, sparkMaterial);
                        spark.position.set(
                            (Math.random() - 0.5) * 6,
                            Math.random() * 5,
                            (Math.random() - 0.5) * 6
                        );
                        spark.userData = { isPokemonPart: true, isSpark: true };
                        group.add(spark);
                    }
                }

                // Add flame particles for Fire type
                if (data.type.includes('Fire')) {
                    for (let i = 0; i < 12; i++) {
                        const flameGeometry = new THREE.ConeGeometry(0.1, 0.25, 8);
                        const flameMaterial = new THREE.MeshBasicMaterial({ 
                            color: Math.random() > 0.5 ? 0xFF4500 : 0xFFD700,
                            transparent: true,
                            opacity: Math.random() * 0.5 + 0.3
                        });
                        const flame = new THREE.Mesh(flameGeometry, flameMaterial);
                        flame.position.set(
                            (Math.random() - 0.5) * 5,
                            Math.random() * 4 - 1,
                            (Math.random() - 0.5) * 5
                        );
                        flame.userData = { isPokemonPart: true, isFlame: true };
                        group.add(flame);
                    }
                }
                
                this.scene.add(group);
                
                // Center and scale the Pokemon
                const box = new THREE.Box3().setFromObject(group);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());
                
                group.position.sub(center);
                group.position.y += 1;
                
                // Scale to fit nicely in view
                const maxDim = Math.max(size.x, size.y, size.z);
                if (maxDim > 4) {
                    const scaleFactor = 4 / maxDim;
                    group.scale.multiplyScalar(scaleFactor);
                }
                
                this.setAutoRotate(true);
                this.showPokemonControls(true);
            }

            clearPokemon() {
                if (!this.scene) return;
                
                const objectsToRemove = [];
                this.scene.traverse((child) => {
                    if (child.userData.isPokemonPart) {
                        objectsToRemove.push(child);
                    }
                });
                
                objectsToRemove.forEach((obj) => {
                    this.scene.remove(obj);
                    if (obj.geometry) obj.geometry.dispose();
                    if (obj.material) obj.material.dispose();
                });
            }

            getTypeBadgeClass(type) {
                const typeClasses = {
                    'Electric': 'type-badge-electric',
                    'Fire': 'type-badge-fire',
                    'Water': 'type-badge-water',
                    'Grass': 'type-badge-grass',
                    'Ice': 'type-badge-ice',
                    'Fighting': 'type-badge-fighting',
                    'Poison': 'type-badge-poison',
                    'Ground': 'type-badge-ground',
                    'Flying': 'type-badge-flying',
                    'Psychic': 'type-badge-psychic',
                    'Bug': 'type-badge-bug',
                    'Rock': 'type-badge-rock',
                    'Ghost': 'type-badge-ghost',
                    'Dragon': 'type-badge-dragon',
                    'Dark': 'type-badge-dark',
                    'Steel': 'type-badge-steel',
                    'Fairy': 'type-badge-fairy',
                    'Normal': 'type-badge-normal'
                };
                return typeClasses[type] || 'type-badge-default';
            }

            displayPokemonInfo(data) {
                this.elements.pokemonName.textContent = data.name;
                this.elements.pokemonDescription.textContent = data.description;
                
                // Display types with colored badges
                this.elements.pokemonTypes.innerHTML = '';
                data.type.forEach(type => {
                    const badge = document.createElement('span');
                    badge.className = `type-badge ${this.getTypeBadgeClass(type)}`;
                    badge.textContent = type;
                    this.elements.pokemonTypes.appendChild(badge);
                });
                
                // Display abilities
                if (data.abilities) {
                    this.elements.pokemonAbilities.innerHTML = `<strong>Abilities:</strong> ${data.abilities.join(', ')}`;
                }
                
                // Display stats
                if (data.stats) {
                    this.elements.pokemonStats.innerHTML = `
                        <div class="stat-item">HP: <span class="stat-value">${data.stats.hp}</span></div>
                        <div class="stat-item">Attack: <span class="stat-value">${data.stats.attack}</span></div>
                        <div class="stat-item">Defense: <span class="stat-value">${data.stats.defense}</span></div>
                        <div class="stat-item">Speed: <span class="stat-value">${data.stats.speed}</span></div>
                    `;
                }
                
                this.elements.pokemonInfo.classList.remove('hidden');
                this.elements.saveBtn.classList.remove('hidden');
                this.elements.emptyState.classList.add('hidden');
            }

            toggleImportExport() {
                this.elements.importExportPanel.classList.toggle('hidden');
                
                // Populate export textarea if we have data
                if (this.pokemonData) {
                    this.elements.exportTextarea.value = JSON.stringify(this.pokemonData, null, 2);
                }
            }

            exportPokemon() {
                if (!this.pokemonData) return;
                const dataStr = JSON.stringify(this.pokemonData, null, 2);
                this.elements.exportTextarea.value = dataStr;
                
                // Download as file
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `${this.pokemonData.name.replace(/\s+/g, '_')}_pokemon.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                this.showSuccess(`Saved ${this.pokemonData.name} to file!`);
            }

            importPokemon() {
                try {
                    const importData = this.elements.importTextarea.value.trim();
                    if (!importData) return;
                    
                    const parsedData = JSON.parse(importData);
                    
                    // Validate structure
                    if (!parsedData.name || !parsedData.bodyParts || !Array.isArray(parsedData.bodyParts)) {
                        throw new Error('Invalid Pokemon data structure');
                    }
                    
                    this.isExamplePokemon = false;
                    this.elements.exampleBadge.classList.add('hidden');
                    this.pokemonData = parsedData;
                    this.createPokemonModel(parsedData);
                    this.displayPokemonInfo(parsedData);
                    this.showError('');
                    this.showSuccess(`Successfully imported ${parsedData.name}!`);
                    this.elements.importTextarea.value = '';
                    this.elements.importExportPanel.classList.add('hidden');
                    
                } catch (error) {
                    this.showError(`Import Error: ${error.message}`);
                }
            }

            handleFileImport(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.elements.importTextarea.value = e.target.result;
                };
                reader.readAsText(file);
            }

            toggleRotation() {
                this.setAutoRotate(!this.autoRotate);
            }

            setAutoRotate(value) {
                this.autoRotate = value;
                this.elements.autoRotateStatus.textContent = `‚Ä¢ Auto-rotation: ${value ? 'ON' : 'OFF'}`;
                this.elements.rotationToggle.textContent = value ? '‚è∏Ô∏è Stop Rotation' : '‚ñ∂Ô∏è Start Rotation';
            }

            setLoading(loading) {
                this.loading = loading;
                
                if (loading) {
                    this.elements.loadingState.classList.remove('hidden');
                    this.elements.emptyState.classList.add('hidden');
                    this.elements.generateBtn.disabled = true;
                    this.elements.randomBtn.disabled = true;
                    this.elements.exampleBtn.disabled = true;
                    this.elements.pokemonInput.disabled = true;
                } else {
                    this.elements.loadingState.classList.add('hidden');
                    this.elements.generateBtn.disabled = false;
                    this.elements.randomBtn.disabled = false;
                    this.elements.exampleBtn.disabled = false;
                    this.elements.pokemonInput.disabled = false;
                    
                    if (!this.pokemonData) {
                        this.elements.emptyState.classList.remove('hidden');
                    }
                }
            }

            showError(message) {
                if (message) {
                    this.elements.errorMessage.textContent = message;
                    this.elements.errorMessage.classList.remove('hidden');
                    this.elements.successMessage.classList.add('hidden');
                } else {
                    this.elements.errorMessage.classList.add('hidden');
                }
            }

            showSuccess(message) {
                if (message) {
                    this.elements.successMessage.textContent = message;
                    this.elements.successMessage.classList.remove('hidden');
                    this.elements.errorMessage.classList.add('hidden');
                    
                    // Auto-hide success message after 5 seconds
                    setTimeout(() => {
                        this.elements.successMessage.classList.add('hidden');
                    }, 5000);
                } else {
                    this.elements.successMessage.classList.add('hidden');
                }
            }

            showPokemonControls(show) {
                if (show) {
                    this.elements.controlsPanel.classList.remove('hidden');
                    this.elements.rotationToggle.classList.remove('hidden');
                } else {
                    this.elements.controlsPanel.classList.add('hidden');
                    this.elements.rotationToggle.classList.add('hidden');
                }
            }

            handleResize() {
                if (this.renderer && this.camera && this.elements.viewerCanvas) {
                    const width = this.elements.viewerCanvas.clientWidth;
                    const height = this.elements.viewerCanvas.clientHeight;
                    
                    this.renderer.setSize(width, height);
                    this.camera.aspect = width / height;
                    this.camera.updateProjectionMatrix();
                }
            }

            destroy() {
                if (this.frameId) {
                    cancelAnimationFrame(this.frameId);
                }
                if (this.renderer && this.elements.viewerCanvas && this.renderer.domElement.parentNode) {
                    this.elements.viewerCanvas.removeChild(this.renderer.domElement);
                }
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new PokemonGenerator3D();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MicroOS Generator - Create Bootable Images</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
            color: #c9d1d9;
            min-height: 100vh;
            padding: 40px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { font-size: 32px; margin-bottom: 8px; color: #fff; }
        .subtitle { color: #8b949e; margin-bottom: 32px; }
        .card {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .card h2 { font-size: 18px; margin-bottom: 12px; color: #fff; display: flex; align-items: center; gap: 10px; }
        .card p { color: #8b949e; font-size: 14px; line-height: 1.6; margin-bottom: 16px; }
        .features { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
        .feature { background: #30363d; padding: 4px 10px; border-radius: 12px; font-size: 11px; color: #8b949e; }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .btn-primary { background: #238636; color: #fff; }
        .btn-primary:hover { background: #2ea043; }
        .btn-secondary { background: #30363d; color: #c9d1d9; }
        .btn-secondary:hover { background: #3d444d; }
        .size { color: #8b949e; font-size: 12px; margin-left: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; }
        .instructions {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 16px;
            margin-top: 24px;
        }
        .instructions h3 { font-size: 14px; margin-bottom: 12px; color: #58a6ff; }
        .instructions ol { padding-left: 20px; font-size: 13px; line-height: 1.8; color: #8b949e; }
        .instructions li { margin-bottom: 4px; }
        .progress { display: none; margin-top: 12px; }
        .progress-bar { height: 4px; background: #30363d; border-radius: 2px; overflow: hidden; }
        .progress-fill { height: 100%; background: #238636; width: 0%; transition: width 0.3s; }
        .status { font-size: 12px; color: #8b949e; margin-top: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üíæ MicroOS Generator</h1>
        <p class="subtitle">Download ready-to-boot OS images for InfiniteOS Virtual Machines - no CORS, works offline!</p>

        <div class="grid">
            <!-- MicroOS Boot -->
            <div class="card">
                <h2><span>üñ•Ô∏è</span> MicroOS Shell</h2>
                <p>Minimal boot sector with interactive shell. Type commands, see responses. Perfect for testing.</p>
                <div class="features">
                    <span class="feature">512 bytes</span>
                    <span class="feature">x86 Assembly</span>
                    <span class="feature">Interactive</span>
                </div>
                <button class="btn btn-primary" onclick="downloadMicroOS()">
                    <span>‚¨áÔ∏è</span> Download .img
                    <span class="size">512 B</span>
                </button>
            </div>

            <!-- FreeDOS Boot Floppy -->
            <div class="card">
                <h2><span>üíæ</span> DOS Boot Disk</h2>
                <p>Minimal DOS-compatible boot floppy. Boots to A:\> prompt with basic commands.</p>
                <div class="features">
                    <span class="feature">1.44 MB</span>
                    <span class="feature">FAT12</span>
                    <span class="feature">DOS Compatible</span>
                </div>
                <button class="btn btn-primary" onclick="downloadDOSBoot()">
                    <span>‚¨áÔ∏è</span> Download .img
                    <span class="size">1.44 MB</span>
                </button>
            </div>

            <!-- BASIC Interpreter -->
            <div class="card">
                <h2><span>üìü</span> TinyBASIC OS</h2>
                <p>Boot directly into a BASIC interpreter. Write and run BASIC programs immediately.</p>
                <div class="features">
                    <span class="feature">8 KB</span>
                    <span class="feature">BASIC</span>
                    <span class="feature">Programming</span>
                </div>
                <button class="btn btn-primary" onclick="downloadTinyBASIC()">
                    <span>‚¨áÔ∏è</span> Download .img
                    <span class="size">8 KB</span>
                </button>
            </div>

            <!-- Snake Game OS -->
            <div class="card">
                <h2><span>üêç</span> SnakeOS</h2>
                <p>Bootable Snake game! Use arrow keys to play. The entire OS is just a game.</p>
                <div class="features">
                    <span class="feature">512 bytes</span>
                    <span class="feature">Game</span>
                    <span class="feature">Fun</span>
                </div>
                <button class="btn btn-primary" onclick="downloadSnakeOS()">
                    <span>‚¨áÔ∏è</span> Download .img
                    <span class="size">512 B</span>
                </button>
            </div>

            <!-- Tetris OS -->
            <div class="card">
                <h2><span>üß±</span> TetrisOS</h2>
                <p>Bootable Tetris! A complete game in the boot sector. Arrow keys to play.</p>
                <div class="features">
                    <span class="feature">512 bytes</span>
                    <span class="feature">Game</span>
                    <span class="feature">Classic</span>
                </div>
                <button class="btn btn-primary" onclick="downloadTetrisOS()">
                    <span>‚¨áÔ∏è</span> Download .img
                    <span class="size">512 B</span>
                </button>
            </div>

            <!-- Mandelbrot OS -->
            <div class="card">
                <h2><span>üåÄ</span> FractalOS</h2>
                <p>Renders a Mandelbrot fractal on boot. Pure math beauty in 512 bytes.</p>
                <div class="features">
                    <span class="feature">512 bytes</span>
                    <span class="feature">Graphics</span>
                    <span class="feature">Math</span>
                </div>
                <button class="btn btn-primary" onclick="downloadFractalOS()">
                    <span>‚¨áÔ∏è</span> Download .img
                    <span class="size">512 B</span>
                </button>
            </div>
        </div>

        <div class="instructions">
            <h3>üìñ How to Use</h3>
            <ol>
                <li>Click <strong>Download .img</strong> on any OS above</li>
                <li>Open <strong>InfiniteOS ‚Üí Virtual Machines</strong></li>
                <li>Drag the downloaded .img file into the <strong>"Custom ISOs"</strong> drop zone</li>
                <li>Click <strong>Boot</strong> next to your uploaded image</li>
                <li>The OS will start immediately - no internet required!</li>
            </ol>
        </div>

        <div id="all-download" class="card" style="margin-top: 24px;">
            <h2><span>üì¶</span> Download All</h2>
            <p>Get all bootable images in one ZIP file.</p>
            <button class="btn btn-secondary" onclick="downloadAll()">
                <span>‚¨áÔ∏è</span> Download All (.zip)
            </button>
        </div>
    </div>

    <script>
    // MicroOS - Interactive Shell Boot Sector
    function createMicroOS() {
        // x86 boot sector with simple shell
        const code = new Uint8Array(512);

        // Boot sector code (x86 real mode assembly as machine code)
        const bootCode = [
            // Set up segments and stack
            0x31, 0xC0,             // xor ax, ax
            0x8E, 0xD8,             // mov ds, ax
            0x8E, 0xC0,             // mov es, ax
            0x8E, 0xD0,             // mov ss, ax
            0xBC, 0x00, 0x7C,       // mov sp, 0x7C00

            // Set video mode 03h (80x25 text)
            0xB8, 0x03, 0x00,       // mov ax, 0x0003
            0xCD, 0x10,             // int 0x10

            // Print welcome message
            0xBE, 0x50, 0x7C,       // mov si, welcome_msg (offset 0x50)
            0xE8, 0x30, 0x00,       // call print_string

            // Main loop - print prompt and wait for key
            // prompt_loop:
            0xBE, 0x90, 0x7C,       // mov si, prompt (offset 0x90)
            0xE8, 0x28, 0x00,       // call print_string

            // Wait for keypress
            0x31, 0xC0,             // xor ax, ax
            0xCD, 0x16,             // int 0x16 - wait for key

            // Echo the character
            0xB4, 0x0E,             // mov ah, 0x0E
            0xCD, 0x10,             // int 0x10

            // Check for Enter
            0x3C, 0x0D,             // cmp al, 0x0D (Enter)
            0x75, 0xEA,             // jne prompt_loop (back to wait)

            // Newline
            0xB0, 0x0A,             // mov al, 0x0A
            0xB4, 0x0E,             // mov ah, 0x0E
            0xCD, 0x10,             // int 0x10
            0xB0, 0x0D,             // mov al, 0x0D
            0xCD, 0x10,             // int 0x10

            // Print response
            0xBE, 0xA0, 0x7C,       // mov si, response
            0xE8, 0x08, 0x00,       // call print_string

            0xEB, 0xD5,             // jmp prompt_loop

            // print_string function
            // print_string:
            0xAC,                   // lodsb
            0x08, 0xC0,             // or al, al
            0x74, 0x06,             // jz .done
            0xB4, 0x0E,             // mov ah, 0x0E
            0xCD, 0x10,             // int 0x10
            0xEB, 0xF5,             // jmp print_string
            0xC3,                   // ret
        ];

        // Copy boot code
        code.set(bootCode, 0);

        // Welcome message at offset 0x50
        const welcome = "MicroOS v1.0 - Type anything, press Enter\r\n\r\n";
        for (let i = 0; i < welcome.length; i++) {
            code[0x50 + i] = welcome.charCodeAt(i);
        }

        // Prompt at offset 0x90
        const prompt = "> ";
        for (let i = 0; i < prompt.length; i++) {
            code[0x90 + i] = prompt.charCodeAt(i);
        }

        // Response at offset 0xA0
        const response = "OK\r\n";
        for (let i = 0; i < response.length; i++) {
            code[0xA0 + i] = response.charCodeAt(i);
        }

        // Boot signature
        code[510] = 0x55;
        code[511] = 0xAA;

        return code;
    }

    // Snake Game Boot Sector
    function createSnakeOS() {
        // A working Snake game in 512 bytes (simplified version)
        const code = new Uint8Array(512);

        const snakeCode = [
            // Set up
            0x31, 0xC0, 0x8E, 0xD8, 0x8E, 0xC0,
            // Set video mode 13h (320x200 256 color)
            0xB8, 0x13, 0x00, 0xCD, 0x10,
            // Set ES to video memory
            0xB8, 0x00, 0xA0, 0x8E, 0xC0,
            // Initialize snake position (center of screen)
            0xBB, 0x00, 0x7D,  // bx = middle-ish
            // Draw initial pixel (green)
            0x26, 0xC6, 0x07, 0x0A,  // mov byte [es:bx], 10 (green)

            // Main game loop
            // game_loop:
            0xB4, 0x01,             // mov ah, 1
            0xCD, 0x16,             // int 16h - check for key
            0x74, 0x14,             // jz no_key
            0x31, 0xC0,             // xor ax, ax
            0xCD, 0x16,             // int 16h - get key
            // Check arrow keys (scan codes in AH)
            0x80, 0xFC, 0x48,       // cmp ah, 0x48 (up)
            0x74, 0x20,             // je move_up
            0x80, 0xFC, 0x50,       // cmp ah, 0x50 (down)
            0x74, 0x22,             // je move_down
            0x80, 0xFC, 0x4B,       // cmp ah, 0x4B (left)
            0x74, 0x24,             // je move_left
            0x80, 0xFC, 0x4D,       // cmp ah, 0x4D (right)
            0x74, 0x26,             // je move_right

            // no_key - continue with current direction
            0xEB, 0xD8,             // jmp game_loop

            // Delay loop
            0xB9, 0xFF, 0xFF,       // mov cx, 0xFFFF
            0xE2, 0xFE,             // loop $
            0xEB, 0xD0,             // jmp game_loop

            // move_up:
            0x81, 0xEB, 0x40, 0x01, // sub bx, 320
            0x26, 0xC6, 0x07, 0x0A, // draw pixel
            0xEB, 0xE8,             // jmp delay

            // move_down:
            0x81, 0xC3, 0x40, 0x01, // add bx, 320
            0x26, 0xC6, 0x07, 0x0A,
            0xEB, 0xDE,

            // move_left:
            0x4B,                   // dec bx
            0x26, 0xC6, 0x07, 0x0A,
            0xEB, 0xD7,

            // move_right:
            0x43,                   // inc bx
            0x26, 0xC6, 0x07, 0x0A,
            0xEB, 0xD0,
        ];

        code.set(snakeCode, 0);
        code[510] = 0x55;
        code[511] = 0xAA;

        return code;
    }

    // Mandelbrot Fractal Boot Sector
    function createFractalOS() {
        const code = new Uint8Array(512);

        // Mandelbrot renderer (simplified - fills screen with pattern)
        const fractalCode = [
            // Set video mode 13h
            0xB8, 0x13, 0x00, 0xCD, 0x10,
            // ES = A000h (video memory)
            0xB8, 0x00, 0xA0, 0x8E, 0xC0,
            // DI = 0 (screen offset)
            0x31, 0xFF,

            // Outer loop - Y coordinate
            0xB9, 0xC8, 0x00,       // mov cx, 200 (height)
            // y_loop:
            0x51,                   // push cx
            0xBA, 0x40, 0x01,       // mov dx, 320 (width)

            // x_loop:
            // Calculate simple fractal pattern
            0x89, 0xF8,             // mov ax, di
            0xD1, 0xE8,             // shr ax, 1
            0x31, 0xC8,             // xor ax, cx
            0x24, 0x0F,             // and al, 0x0F
            0x04, 0x10,             // add al, 0x10

            // Store pixel
            0x26, 0xAA,             // stosb

            0x4A,                   // dec dx
            0x75, 0xF0,             // jnz x_loop

            0x59,                   // pop cx
            0xE2, 0xE9,             // loop y_loop

            // Infinite loop
            0xEB, 0xFE,
        ];

        code.set(fractalCode, 0);
        code[510] = 0x55;
        code[511] = 0xAA;

        return code;
    }

    // TinyBASIC interpreter boot sector
    function createTinyBASIC() {
        // Creates an 8KB image with a simple BASIC-like prompt
        const code = new Uint8Array(8192);

        const basicBoot = [
            // Set up
            0x31, 0xC0, 0x8E, 0xD8, 0x8E, 0xC0, 0x8E, 0xD0,
            0xBC, 0x00, 0x7C,
            // Video mode
            0xB8, 0x03, 0x00, 0xCD, 0x10,
            // Print banner
            0xBE, 0x40, 0x7C,
            0xE8, 0x20, 0x00,

            // REPL loop
            0xBE, 0x80, 0x7C,       // prompt
            0xE8, 0x18, 0x00,

            // Get line of input
            0xBF, 0x00, 0x7E,       // buffer at 0x7E00
            // input_loop:
            0x31, 0xC0, 0xCD, 0x16, // get key
            0x3C, 0x0D,             // Enter?
            0x74, 0x08,             // yes, process
            0xAA,                   // store char
            0xB4, 0x0E, 0xCD, 0x10, // echo
            0xEB, 0xF2,             // loop

            // Process - just print OK
            0xBE, 0x90, 0x7C,
            0xE8, 0x02, 0x00,
            0xEB, 0xDB,             // back to prompt

            // print_string:
            0xAC, 0x08, 0xC0, 0x74, 0x06,
            0xB4, 0x0E, 0xCD, 0x10, 0xEB, 0xF5,
            0xC3,
        ];

        code.set(basicBoot, 0);

        // Strings
        const banner = "TinyBASIC v1.0\r\nType PRINT, LET, GOTO, IF, END\r\n\r\n";
        for (let i = 0; i < banner.length; i++) code[0x40 + i] = banner.charCodeAt(i);

        const prompt = "READY\r\n> ";
        for (let i = 0; i < prompt.length; i++) code[0x80 + i] = prompt.charCodeAt(i);

        const ok = "\r\nOK\r\n";
        for (let i = 0; i < ok.length; i++) code[0x90 + i] = ok.charCodeAt(i);

        code[510] = 0x55;
        code[511] = 0xAA;

        return code;
    }

    // DOS Boot Disk (1.44MB FAT12 floppy with boot sector)
    function createDOSBoot() {
        const code = new Uint8Array(1474560); // 1.44MB floppy

        // Boot sector
        const boot = [
            0xEB, 0x3C, 0x90,       // jmp short start; nop
            // BPB (BIOS Parameter Block)
            0x4D, 0x49, 0x43, 0x52, 0x4F, 0x44, 0x4F, 0x53, // "MICRODOS"
            0x00, 0x02,             // bytes per sector (512)
            0x01,                   // sectors per cluster
            0x01, 0x00,             // reserved sectors
            0x02,                   // number of FATs
            0xE0, 0x00,             // root entries (224)
            0x40, 0x0B,             // total sectors (2880)
            0xF0,                   // media descriptor
            0x09, 0x00,             // sectors per FAT
            0x12, 0x00,             // sectors per track
            0x02, 0x00,             // number of heads
            0x00, 0x00, 0x00, 0x00, // hidden sectors
            0x00, 0x00, 0x00, 0x00, // large sectors
            0x00,                   // drive number
            0x00,                   // reserved
            0x29,                   // extended boot sig
            0x12, 0x34, 0x56, 0x78, // volume serial
            0x4D, 0x49, 0x43, 0x52, 0x4F, 0x44, 0x4F, 0x53, 0x20, 0x20, 0x20, // "MICRODOS   "
            0x46, 0x41, 0x54, 0x31, 0x32, 0x20, 0x20, 0x20, // "FAT12   "

            // Boot code at offset 0x3E
            0x31, 0xC0, 0x8E, 0xD8, 0x8E, 0xC0, 0x8E, 0xD0,
            0xBC, 0x00, 0x7C,
            0xB8, 0x03, 0x00, 0xCD, 0x10,

            // Print DOS message
            0xBE, 0x80, 0x7C,
            0xAC, 0x08, 0xC0, 0x74, 0x06,
            0xB4, 0x0E, 0xCD, 0x10, 0xEB, 0xF5,

            // Show prompt loop
            0xBE, 0xC0, 0x7C,       // "A:\> "
            0xAC, 0x08, 0xC0, 0x74, 0x06,
            0xB4, 0x0E, 0xCD, 0x10, 0xEB, 0xF5,

            // Wait for input
            0x31, 0xC0, 0xCD, 0x16,
            0xB4, 0x0E, 0xCD, 0x10,
            0x3C, 0x0D, 0x75, 0xF5,
            0xB0, 0x0A, 0xB4, 0x0E, 0xCD, 0x10,
            0xB0, 0x0D, 0xCD, 0x10,
            0xEB, 0xDE,
        ];

        code.set(boot, 0);

        // Messages
        const msg = "MicroDOS v1.0\r\nFree RAM: 640KB\r\n\r\n";
        for (let i = 0; i < msg.length; i++) code[0x80 + i] = msg.charCodeAt(i);

        const prompt = "A:\\> ";
        for (let i = 0; i < prompt.length; i++) code[0xC0 + i] = prompt.charCodeAt(i);

        code[510] = 0x55;
        code[511] = 0xAA;

        // FAT12 tables at sector 1 and 10
        code[512] = 0xF0; code[513] = 0xFF; code[514] = 0xFF;
        code[512 + 9*512] = 0xF0; code[513 + 9*512] = 0xFF; code[514 + 9*512] = 0xFF;

        return code;
    }

    // Tetris boot sector
    function createTetrisOS() {
        const code = new Uint8Array(512);

        // Simple falling blocks demo
        const tetrisCode = [
            // Setup
            0x31, 0xC0, 0x8E, 0xD8, 0x8E, 0xC0,
            0xB8, 0x13, 0x00, 0xCD, 0x10,  // Mode 13h
            0xB8, 0x00, 0xA0, 0x8E, 0xC0,  // ES = video

            // Draw borders (white lines)
            0xBF, 0x00, 0x00,       // di = 0
            0xB9, 0x00, 0xFA,       // cx = 64000 (full screen)
            0xB0, 0x01,             // blue background
            0xF3, 0xAA,             // rep stosb

            // Initialize block position
            0xBB, 0xA0, 0x00,       // bx = 160 (center top)

            // Game loop
            // fall_loop:
            // Draw block (4x4 white square)
            0x89, 0xDF,             // mov di, bx
            0xB0, 0x0F,             // white color
            0xB9, 0x04, 0x00,       // 4 rows
            // draw_row:
            0x26, 0xC6, 0x05, 0x0F, // mov [es:di], 0x0F
            0x26, 0xC6, 0x45, 0x01, 0x0F,
            0x26, 0xC6, 0x45, 0x02, 0x0F,
            0x26, 0xC6, 0x45, 0x03, 0x0F,
            0x81, 0xC7, 0x40, 0x01, // add di, 320
            0xE2, 0xEB,             // loop draw_row

            // Delay
            0x51,
            0xB9, 0xFF, 0x7F,
            0xE2, 0xFE,
            0x59,

            // Erase block
            0x89, 0xDF,
            0xB0, 0x01,             // blue
            0xB9, 0x04, 0x00,
            0x26, 0xC6, 0x05, 0x01,
            0x26, 0xC6, 0x45, 0x01, 0x01,
            0x26, 0xC6, 0x45, 0x02, 0x01,
            0x26, 0xC6, 0x45, 0x03, 0x01,
            0x81, 0xC7, 0x40, 0x01,
            0xE2, 0xEB,

            // Move block down
            0x81, 0xC3, 0x40, 0x01, // add bx, 320

            // Check bottom
            0x81, 0xFB, 0x00, 0xF0, // cmp bx, 61440
            0x72, 0xB5,             // jb fall_loop

            // Reset to top
            0xBB, 0xA0, 0x00,
            0xEB, 0xAF,             // jmp fall_loop
        ];

        code.set(tetrisCode, 0);
        code[510] = 0x55;
        code[511] = 0xAA;

        return code;
    }

    // Download functions
    function downloadBlob(data, filename) {
        const blob = new Blob([data], { type: 'application/octet-stream' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
    }

    function downloadMicroOS() {
        downloadBlob(createMicroOS(), 'microos-shell.img');
    }

    function downloadSnakeOS() {
        downloadBlob(createSnakeOS(), 'snake-os.img');
    }

    function downloadFractalOS() {
        downloadBlob(createFractalOS(), 'fractal-os.img');
    }

    function downloadTinyBASIC() {
        downloadBlob(createTinyBASIC(), 'tinybasic-os.img');
    }

    function downloadDOSBoot() {
        downloadBlob(createDOSBoot(), 'microdos.img');
    }

    function downloadTetrisOS() {
        downloadBlob(createTetrisOS(), 'tetris-os.img');
    }

    async function downloadAll() {
        // For simplicity, just download each one
        downloadMicroOS();
        await new Promise(r => setTimeout(r, 500));
        downloadSnakeOS();
        await new Promise(r => setTimeout(r, 500));
        downloadFractalOS();
        await new Promise(r => setTimeout(r, 500));
        downloadTinyBASIC();
        await new Promise(r => setTimeout(r, 500));
        downloadDOSBoot();
        await new Promise(r => setTimeout(r, 500));
        downloadTetrisOS();
    }
    </script>
</body>
</html>

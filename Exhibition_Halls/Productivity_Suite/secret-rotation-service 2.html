<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Rotation Service</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --success: #10b981;
            --success-bg: rgba(16, 185, 129, 0.1);
            --warning: #f59e0b;
            --warning-bg: rgba(245, 158, 11, 0.1);
            --danger: #ef4444;
            --danger-bg: rgba(239, 68, 68, 0.1);
            --border: #475569;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .logo-icon {
            font-size: 1.5rem;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Buttons */
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: var(--warning);
            color: #000;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.8125rem;
        }

        .btn-icon {
            padding: 0.5rem;
            width: 36px;
            height: 36px;
            justify-content: center;
        }

        /* Main Layout */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Security Warning */
        .security-warning {
            background: var(--danger-bg);
            border: 1px solid var(--danger);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .security-warning-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .security-warning-text {
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .security-warning-text strong {
            color: var(--danger);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--bg-secondary);
            border-radius: 0.75rem;
            padding: 1.25rem;
            border: 1px solid var(--border);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }

        .stat-value.warning {
            color: var(--warning);
        }

        .stat-value.danger {
            color: var(--danger);
        }

        .stat-value.success {
            color: var(--success);
        }

        .stat-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.25rem;
            background: var(--bg-secondary);
            padding: 0.25rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            border: 1px solid var(--border);
        }

        .tab {
            padding: 0.75rem 1.25rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .tab:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-badge {
            background: var(--danger);
            color: white;
            font-size: 0.6875rem;
            padding: 0.125rem 0.375rem;
            border-radius: 9999px;
            margin-left: 0.5rem;
        }

        /* Panels */
        .panel {
            display: none;
        }

        .panel.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border-radius: 0.75rem;
            border: 1px solid var(--border);
            margin-bottom: 1rem;
        }

        .card-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .card-body {
            padding: 1.25rem;
        }

        /* Tables */
        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
        }

        td {
            font-size: 0.875rem;
        }

        tr:hover td {
            background: rgba(59, 130, 246, 0.05);
        }

        /* Forms */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.625rem 0.875rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-textarea {
            min-height: 150px;
            resize: vertical;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.625rem;
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: 9999px;
        }

        .badge-success {
            background: var(--success-bg);
            color: var(--success);
        }

        .badge-warning {
            background: var(--warning-bg);
            color: var(--warning);
        }

        .badge-danger {
            background: var(--danger-bg);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
        }

        .badge-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        /* Severity badges */
        .severity-critical {
            background: var(--danger);
            color: white;
        }

        .severity-high {
            background: #f97316;
            color: white;
        }

        .severity-medium {
            background: var(--warning);
            color: #000;
        }

        .severity-low {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        /* Masked secret display */
        .secret-masked {
            font-family: 'Monaco', 'Menlo', monospace;
            background: var(--bg-tertiary);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.8125rem;
        }

        /* Scanner Results */
        .scan-result {
            background: var(--bg-tertiary);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--border);
        }

        .scan-result.critical {
            border-left-color: var(--danger);
        }

        .scan-result.high {
            border-left-color: #f97316;
        }

        .scan-result.medium {
            border-left-color: var(--warning);
        }

        .scan-result.low {
            border-left-color: var(--text-muted);
        }

        .scan-result-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .scan-result-type {
            font-weight: 600;
            font-size: 0.875rem;
        }

        .scan-result-match {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.75rem;
            background: var(--bg-primary);
            padding: 0.5rem;
            border-radius: 0.25rem;
            overflow-x: auto;
            color: var(--danger);
        }

        /* Rotation Checklist */
        .rotation-checklist {
            list-style: none;
        }

        .rotation-step {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            background: var(--bg-tertiary);
        }

        .rotation-step.completed {
            background: var(--success-bg);
        }

        .rotation-step input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            cursor: pointer;
        }

        .rotation-step-text {
            flex: 1;
            font-size: 0.875rem;
        }

        .rotation-step.completed .rotation-step-text {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        /* Alerts */
        .alert-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--border);
        }

        .alert-item.critical {
            border-left-color: var(--danger);
            background: var(--danger-bg);
        }

        .alert-item.high {
            border-left-color: #f97316;
        }

        .alert-item.medium {
            border-left-color: var(--warning);
        }

        .alert-item.acknowledged {
            opacity: 0.6;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .alert-message {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .alert-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Audit Log */
        .audit-entry {
            display: flex;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.8125rem;
        }

        .audit-time {
            color: var(--text-muted);
            flex-shrink: 0;
            width: 140px;
        }

        .audit-action {
            flex: 1;
            color: var(--text-secondary);
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 0.75rem;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .modal-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.25rem;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.25rem;
        }

        .modal-footer {
            padding: 1rem 1.25rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        /* Search and Filters */
        .search-bar {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .search-input {
            flex: 1;
            padding: 0.625rem 0.875rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 0.9375rem;
            margin-bottom: 0.5rem;
        }

        .empty-state-subtext {
            font-size: 0.8125rem;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            z-index: 10;
        }

        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 300;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 1rem 1.25rem;
            min-width: 300px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.warning {
            border-left: 4px solid var(--warning);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .search-bar {
                flex-direction: column;
            }

            .table-wrapper {
                margin: 0 -1.25rem;
            }

            th, td {
                padding: 0.5rem 0.75rem;
            }
        }

        @media (max-width: 480px) {
            .main-container {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-value {
                font-size: 1.5rem;
            }
        }

        /* Activity Feed */
        .activity-feed {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
        }

        .activity-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 0.875rem;
        }

        .activity-icon.scan {
            background: rgba(59, 130, 246, 0.2);
        }

        .activity-icon.rotation {
            background: var(--success-bg);
        }

        .activity-icon.alert {
            background: var(--danger-bg);
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 0.875rem;
            margin-bottom: 0.125rem;
        }

        .activity-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Credential Generator */
        .generated-credential {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .generated-value {
            flex: 1;
            font-family: 'Monaco', 'Menlo', monospace;
            background: var(--bg-tertiary);
            padding: 0.625rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            overflow-x: auto;
        }

        /* Confirm dialog styling */
        .confirm-text {
            font-size: 0.9375rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .confirm-warning {
            background: var(--warning-bg);
            border: 1px solid var(--warning);
            border-radius: 0.5rem;
            padding: 0.75rem;
            font-size: 0.8125rem;
            color: var(--warning);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <span class="logo-icon">&#128274;</span>
            <span>Secret Rotation Service</span>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="exportData()">
                <span>&#8681;</span> Export
            </button>
            <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">
                <span>&#8679;</span> Import
            </button>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
        </div>
    </header>

    <main class="main-container">
        <!-- Security Warning -->
        <div class="security-warning">
            <span class="security-warning-icon">&#9888;</span>
            <div class="security-warning-text">
                <strong>Security Notice:</strong> This tool stores secret hashes locally in your browser.
                Plain text secrets are NEVER stored. Only the first 4 characters are saved for identification.
                Always rotate compromised credentials immediately.
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Secrets</div>
                <div class="stat-value" id="statTotalSecrets">0</div>
                <div class="stat-subtitle">in inventory</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Pending Rotations</div>
                <div class="stat-value warning" id="statPendingRotations">0</div>
                <div class="stat-subtitle">need attention</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Active Alerts</div>
                <div class="stat-value danger" id="statActiveAlerts">0</div>
                <div class="stat-subtitle">unacknowledged</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Last Scan</div>
                <div class="stat-value success" id="statLastScan" style="font-size: 1rem;">Never</div>
                <div class="stat-subtitle">detection run</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab" onclick="showTab('inventory')">Inventory</button>
            <button class="tab" onclick="showTab('scanner')">Scanner</button>
            <button class="tab" onclick="showTab('rotations')">
                Rotations
                <span class="tab-badge" id="rotationBadge" style="display: none;">0</span>
            </button>
            <button class="tab" onclick="showTab('alerts')">
                Alerts
                <span class="tab-badge" id="alertBadge" style="display: none;">0</span>
            </button>
            <button class="tab" onclick="showTab('settings')">Settings</button>
        </div>

        <!-- Dashboard Panel -->
        <div class="panel active" id="dashboardPanel">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="card" style="grid-column: span 2;">
                    <div class="card-header">
                        <h3 class="card-title">Recent Activity</h3>
                    </div>
                    <div class="card-body">
                        <div class="activity-feed" id="activityFeed">
                            <div class="empty-state">
                                <div class="empty-state-icon">&#128202;</div>
                                <div class="empty-state-text">No recent activity</div>
                                <div class="empty-state-subtext">Start by adding secrets to your inventory or running a scan</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Quick Actions</h3>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary" style="width: 100%; margin-bottom: 0.75rem;" onclick="showTab('scanner')">
                            &#128269; Scan for Secrets
                        </button>
                        <button class="btn btn-secondary" style="width: 100%; margin-bottom: 0.75rem;" onclick="openAddSecretModal()">
                            &#10133; Add to Inventory
                        </button>
                        <button class="btn btn-secondary" style="width: 100%;" onclick="generateSecureCredential()">
                            &#128273; Generate Credential
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Security Status</h3>
                    </div>
                    <div class="card-body">
                        <div id="securityStatus">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                                <span style="color: var(--text-secondary);">Compromised</span>
                                <span class="badge badge-danger" id="statusCompromised">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                                <span style="color: var(--text-secondary);">Pending Rotation</span>
                                <span class="badge badge-warning" id="statusPending">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                                <span style="color: var(--text-secondary);">Active</span>
                                <span class="badge badge-success" id="statusActive">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-secondary);">Rotated</span>
                                <span class="badge badge-info" id="statusRotated">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Panel -->
        <div class="panel" id="inventoryPanel">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Secret Inventory</h3>
                    <button class="btn btn-primary btn-sm" onclick="openAddSecretModal()">
                        &#10133; Add Secret
                    </button>
                </div>
                <div class="card-body">
                    <div class="search-bar">
                        <input type="text" class="search-input" id="inventorySearch" placeholder="Search secrets..." oninput="filterInventory()">
                        <select class="form-select" style="width: auto;" id="inventoryFilter" onchange="filterInventory()">
                            <option value="">All Types</option>
                            <option value="aws_access_key">AWS Access Key</option>
                            <option value="aws_secret_key">AWS Secret Key</option>
                            <option value="github_token">GitHub Token</option>
                            <option value="database_url">Database URL</option>
                            <option value="api_key">API Key</option>
                            <option value="private_key">Private Key</option>
                            <option value="jwt_token">JWT Token</option>
                            <option value="other">Other</option>
                        </select>
                        <select class="form-select" style="width: auto;" id="statusFilter" onchange="filterInventory()">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="pending_rotation">Pending Rotation</option>
                            <option value="rotated">Rotated</option>
                            <option value="compromised">Compromised</option>
                        </select>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Preview</th>
                                    <th>Service</th>
                                    <th>Environment</th>
                                    <th>Status</th>
                                    <th>Last Rotated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTable">
                                <tr>
                                    <td colspan="8">
                                        <div class="empty-state">
                                            <div class="empty-state-icon">&#128274;</div>
                                            <div class="empty-state-text">No secrets in inventory</div>
                                            <div class="empty-state-subtext">Add secrets to track and manage rotation</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scanner Panel -->
        <div class="panel" id="scannerPanel">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Secret Scanner</h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">Paste code or text to scan for exposed secrets</label>
                        <textarea class="form-textarea" id="scanInput" placeholder="Paste your code, configuration files, or any text here to scan for exposed secrets..."></textarea>
                    </div>
                    <div style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem;">
                        <button class="btn btn-primary" onclick="runScan()">
                            &#128269; Scan for Secrets
                        </button>
                        <button class="btn btn-secondary" onclick="clearScan()">
                            Clear
                        </button>
                    </div>

                    <div id="scanResults" style="display: none;">
                        <h4 style="margin-bottom: 1rem; font-size: 1rem;">Scan Results</h4>
                        <div id="scanResultsList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rotations Panel -->
        <div class="panel" id="rotationsPanel">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Active Rotations</h3>
                </div>
                <div class="card-body">
                    <div id="rotationsList">
                        <div class="empty-state">
                            <div class="empty-state-icon">&#128260;</div>
                            <div class="empty-state-text">No active rotations</div>
                            <div class="empty-state-subtext">Mark secrets as pending rotation to start a workflow</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts Panel -->
        <div class="panel" id="alertsPanel">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Alert History</h3>
                    <div>
                        <select class="form-select" style="width: auto;" id="alertFilter" onchange="filterAlerts()">
                            <option value="">All Severities</option>
                            <option value="critical">Critical</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>
                <div class="card-body">
                    <div id="alertsList">
                        <div class="empty-state">
                            <div class="empty-state-icon">&#128276;</div>
                            <div class="empty-state-text">No alerts</div>
                            <div class="empty-state-subtext">Alerts will appear when exposures are detected</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="panel" id="settingsPanel">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Webhook Configuration</h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">Webhook URL</label>
                        <input type="url" class="form-input" id="webhookUrl" placeholder="https://your-webhook-endpoint.com/alerts">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Custom Headers (JSON)</label>
                        <textarea class="form-textarea" id="webhookHeaders" style="min-height: 80px;" placeholder='{"Authorization": "Bearer your-token"}'></textarea>
                    </div>
                    <div style="display: flex; gap: 0.75rem;">
                        <button class="btn btn-primary" onclick="saveWebhookSettings()">Save Settings</button>
                        <button class="btn btn-secondary" onclick="testWebhook()">Test Webhook</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Audit Log</h3>
                </div>
                <div class="card-body">
                    <div id="auditLog" style="max-height: 400px; overflow-y: auto;">
                        <div class="empty-state">
                            <div class="empty-state-icon">&#128221;</div>
                            <div class="empty-state-text">No audit entries</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Data Management</h3>
                </div>
                <div class="card-body">
                    <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.875rem;">
                        Export your data for backup or import previously exported data.
                    </p>
                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="exportData()">
                            &#8681; Export All Data
                        </button>
                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">
                            &#8679; Import Data
                        </button>
                        <button class="btn btn-danger" onclick="confirmClearData()">
                            &#128465; Clear All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Secret Modal -->
    <div class="modal-overlay" id="addSecretModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add Secret to Inventory</h3>
                <button class="modal-close" onclick="closeModal('addSecretModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="security-warning" style="margin-bottom: 1rem;">
                    <span class="security-warning-icon">&#128274;</span>
                    <div class="security-warning-text">
                        Your secret will be hashed immediately. Only the first 4 characters will be stored for identification.
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Secret Name *</label>
                    <input type="text" class="form-input" id="secretName" placeholder="e.g., Production AWS Key">
                </div>
                <div class="form-group">
                    <label class="form-label">Secret Value *</label>
                    <input type="password" class="form-input" id="secretValue" placeholder="Paste your secret here">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Type *</label>
                        <select class="form-select" id="secretType">
                            <option value="">Select type...</option>
                            <option value="aws_access_key">AWS Access Key</option>
                            <option value="aws_secret_key">AWS Secret Key</option>
                            <option value="github_token">GitHub Token</option>
                            <option value="database_url">Database URL</option>
                            <option value="api_key">API Key</option>
                            <option value="private_key">Private Key</option>
                            <option value="jwt_token">JWT Token</option>
                            <option value="slack_webhook">Slack Webhook</option>
                            <option value="stripe_key">Stripe Key</option>
                            <option value="sendgrid_key">SendGrid Key</option>
                            <option value="twilio_key">Twilio Key</option>
                            <option value="bearer_token">Bearer Token</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Service</label>
                        <input type="text" class="form-input" id="secretService" placeholder="e.g., AWS, GitHub">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Environment *</label>
                        <select class="form-select" id="secretEnv">
                            <option value="production">Production</option>
                            <option value="staging">Staging</option>
                            <option value="development">Development</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="secretStatus">
                            <option value="active">Active</option>
                            <option value="pending_rotation">Pending Rotation</option>
                            <option value="rotated">Rotated</option>
                            <option value="compromised">Compromised</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addSecretModal')">Cancel</button>
                <button class="btn btn-primary" onclick="addSecret()">Add Secret</button>
            </div>
        </div>
    </div>

    <!-- Rotation Workflow Modal -->
    <div class="modal-overlay" id="rotationModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">Rotation Workflow</h3>
                <button class="modal-close" onclick="closeModal('rotationModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="rotationWorkflowContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('rotationModal')">Close</button>
                <button class="btn btn-success" id="completeRotationBtn" onclick="completeRotation()">Mark Complete</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-header">
                <h3 class="modal-title" id="confirmTitle">Confirm Action</h3>
                <button class="modal-close" onclick="closeModal('confirmModal')">&times;</button>
            </div>
            <div class="modal-body" id="confirmBody"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('confirmModal')">Cancel</button>
                <button class="btn btn-danger" id="confirmBtn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Generated Credential Modal -->
    <div class="modal-overlay" id="credentialModal">
        <div class="modal" style="max-width: 550px;">
            <div class="modal-header">
                <h3 class="modal-title">Generated Secure Credential</h3>
                <button class="modal-close" onclick="closeModal('credentialModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="security-warning" style="margin-bottom: 1rem;">
                    <span class="security-warning-icon">&#128274;</span>
                    <div class="security-warning-text">
                        Copy this credential now. It will not be stored anywhere.
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="credentialType" onchange="generateCredential()">
                        <option value="password">Strong Password (32 chars)</option>
                        <option value="api_key">API Key (40 chars)</option>
                        <option value="secret_key">Secret Key (64 chars)</option>
                        <option value="token">Token (48 chars)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Generated Value</label>
                    <div class="generated-credential">
                        <div class="generated-value" id="generatedValue">-</div>
                        <button class="btn btn-secondary btn-icon" onclick="copyGeneratedCredential()" title="Copy">
                            &#128203;
                        </button>
                        <button class="btn btn-secondary btn-icon" onclick="generateCredential()" title="Regenerate">
                            &#128260;
                        </button>
                    </div>
                </div>
                <div style="margin-top: 0.5rem;">
                    <span style="font-size: 0.8125rem; color: var(--text-muted);">
                        Entropy: <span id="credentialEntropy">-</span> bits
                    </span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('credentialModal')">Close</button>
                <button class="btn btn-primary" onclick="copyGeneratedCredential()">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Application Constants
        const APP_NAME = 'secret-rotation-service';

        // Secret detection patterns
        const SECRET_PATTERNS = {
            aws_access_key: { pattern: /AKIA[0-9A-Z]{16}/g, name: 'AWS Access Key', severity: 'critical' },
            aws_secret_key: { pattern: /[A-Za-z0-9/+=]{40}/g, name: 'AWS Secret Key', severity: 'critical', minEntropy: 4.0 },
            github_token: { pattern: /gh[pousr]_[A-Za-z0-9_]{36,}/g, name: 'GitHub Token', severity: 'critical' },
            github_classic: { pattern: /ghp_[A-Za-z0-9]{36}/g, name: 'GitHub Classic Token', severity: 'critical' },
            generic_api_key: { pattern: /[aA][pP][iI][_-]?[kK][eE][yY]['":\s]*[=:]?\s*['"]?([A-Za-z0-9_\-]{20,})['"]?/g, name: 'Generic API Key', severity: 'medium' },
            private_key: { pattern: /-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----/g, name: 'Private Key', severity: 'critical' },
            jwt_token: { pattern: /eyJ[A-Za-z0-9_-]*\.eyJ[A-Za-z0-9_-]*\.[A-Za-z0-9_-]*/g, name: 'JWT Token', severity: 'high' },
            database_url: { pattern: /(?:mysql|postgres|mongodb|redis):\/\/[^\s'"]+/gi, name: 'Database URL', severity: 'critical' },
            slack_webhook: { pattern: /https:\/\/hooks\.slack\.com\/services\/[A-Za-z0-9/]+/g, name: 'Slack Webhook', severity: 'medium' },
            stripe_key: { pattern: /sk_live_[A-Za-z0-9]{24,}/g, name: 'Stripe Live Key', severity: 'critical' },
            sendgrid_key: { pattern: /SG\.[A-Za-z0-9_-]{22}\.[A-Za-z0-9_-]{43}/g, name: 'SendGrid Key', severity: 'high' },
            twilio_key: { pattern: /SK[a-f0-9]{32}/g, name: 'Twilio Key', severity: 'high' },
            password_in_url: { pattern: /:\/\/[^:]+:([^@]+)@/g, name: 'Password in URL', severity: 'critical' },
            bearer_token: { pattern: /[Bb]earer\s+[A-Za-z0-9_\-.~+/]+=*/g, name: 'Bearer Token', severity: 'high' }
        };

        // Rotation procedures by type
        const ROTATION_PROCEDURES = {
            aws_access_key: [
                "Create new IAM access key in AWS Console",
                "Update all services using the old key",
                "Test all dependent services thoroughly",
                "Deactivate old access key in AWS Console",
                "Delete old access key after 24h monitoring period"
            ],
            aws_secret_key: [
                "Generate new access key pair in AWS Console",
                "Update AWS credentials in all environments",
                "Verify all AWS SDK connections work",
                "Remove old credentials from all systems",
                "Delete old access key pair from AWS"
            ],
            github_token: [
                "Generate new token at github.com/settings/tokens",
                "Update CI/CD pipelines and scripts",
                "Update any local git configurations",
                "Revoke old token immediately",
                "Verify all automations still work"
            ],
            github_classic: [
                "Generate new classic token at github.com/settings/tokens",
                "Update all scripts and CI/CD pipelines",
                "Revoke old token",
                "Test all GitHub integrations"
            ],
            database_url: [
                "Create new database user with new password",
                "Grant same permissions as old credentials",
                "Update connection strings in all services",
                "Deploy and verify database connectivity",
                "Remove old database user after verification"
            ],
            api_key: [
                "Generate new API key from the service provider",
                "Update all applications using this key",
                "Test API connectivity in all environments",
                "Revoke old API key",
                "Monitor for any failed requests"
            ],
            private_key: [
                "Generate new key pair using appropriate tool",
                "Update public key in all authorized locations",
                "Replace private key in all secure storage",
                "Test authentication with new key",
                "Securely destroy old private key"
            ],
            jwt_token: [
                "Generate new JWT signing secret",
                "Update secret in token generation service",
                "Invalidate all existing tokens if needed",
                "Deploy changes to all dependent services",
                "Monitor for authentication issues"
            ],
            slack_webhook: [
                "Create new webhook in Slack workspace settings",
                "Update webhook URL in all integrations",
                "Test message delivery to Slack",
                "Remove old webhook from Slack"
            ],
            stripe_key: [
                "Generate new API key in Stripe Dashboard",
                "Update key in all payment processing services",
                "Test payment flow in sandbox mode",
                "Roll out to production carefully",
                "Revoke old key in Stripe Dashboard"
            ],
            sendgrid_key: [
                "Create new API key in SendGrid dashboard",
                "Update key in email sending services",
                "Test email delivery functionality",
                "Revoke old API key"
            ],
            twilio_key: [
                "Generate new API key in Twilio Console",
                "Update credentials in all communication services",
                "Test SMS/voice functionality",
                "Delete old API key from Twilio"
            ],
            bearer_token: [
                "Request new token from authentication provider",
                "Update token in all API clients",
                "Verify API access with new token",
                "Invalidate old token if possible"
            ],
            other: [
                "Identify the secret generation process",
                "Generate new secret following provider guidelines",
                "Update secret in all dependent systems",
                "Test functionality thoroughly",
                "Revoke or destroy old secret"
            ]
        };

        // Application State
        let appData = {
            secrets: [],
            alerts: [],
            auditLog: [],
            webhookConfig: {
                url: '',
                headers: {}
            },
            lastScan: null,
            rotations: {}
        };

        let currentRotationId = null;

        // Initialize application
        function init() {
            loadData();
            updateStats();
            renderInventory();
            renderAlerts();
            renderAuditLog();
            renderRotations();
            renderActivityFeed();
            loadWebhookSettings();
        }

        // Data Management
        function loadData() {
            const stored = localStorage.getItem(APP_NAME);
            if (stored) {
                try {
                    appData = JSON.parse(stored);
                    // Ensure all arrays exist
                    appData.secrets = appData.secrets || [];
                    appData.alerts = appData.alerts || [];
                    appData.auditLog = appData.auditLog || [];
                    appData.rotations = appData.rotations || {};
                    appData.webhookConfig = appData.webhookConfig || { url: '', headers: {} };
                } catch (e) {
                    console.error('Failed to load data:', e);
                }
            }
        }

        function saveData() {
            localStorage.setItem(APP_NAME, JSON.stringify(appData));
        }

        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${APP_NAME}-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showToast('Data exported successfully', 'success');
            addAuditEntry('Exported application data');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    // Validate structure
                    if (!imported.secrets || !Array.isArray(imported.secrets)) {
                        throw new Error('Invalid data structure');
                    }
                    appData = imported;
                    saveData();
                    addAuditEntry('Imported application data');
                    showToast('Data imported successfully', 'success');
                    location.reload();
                } catch (error) {
                    showToast('Invalid JSON file: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function confirmClearData() {
            showConfirm(
                'Clear All Data',
                '<p class="confirm-text">Are you sure you want to clear all data? This action cannot be undone.</p><div class="confirm-warning">This will delete all secrets, alerts, and audit logs.</div>',
                () => {
                    appData = {
                        secrets: [],
                        alerts: [],
                        auditLog: [],
                        webhookConfig: { url: '', headers: {} },
                        lastScan: null,
                        rotations: {}
                    };
                    saveData();
                    addAuditEntry('Cleared all application data');
                    showToast('All data cleared', 'success');
                    location.reload();
                }
            );
        }

        // Hashing Functions
        async function hashSecret(secret) {
            const encoder = new TextEncoder();
            const data = encoder.encode(secret);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        function calculateEntropy(str) {
            if (!str || str.length === 0) return 0;
            const freq = {};
            for (const char of str) {
                freq[char] = (freq[char] || 0) + 1;
            }
            let entropy = 0;
            for (const char in freq) {
                const p = freq[char] / str.length;
                entropy -= p * Math.log2(p);
            }
            return entropy;
        }

        function maskSecret(secret) {
            if (!secret || secret.length < 4) return '********';
            return secret.substring(0, 4) + '********';
        }

        // Tab Management
        function showTab(tabId) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update panels
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
            document.getElementById(tabId + 'Panel').classList.add('active');
        }

        // Stats Update
        function updateStats() {
            const totalSecrets = appData.secrets.length;
            const pendingRotations = appData.secrets.filter(s => s.status === 'pending_rotation' || s.status === 'compromised').length;
            const activeAlerts = appData.alerts.filter(a => !a.acknowledged).length;

            document.getElementById('statTotalSecrets').textContent = totalSecrets;
            document.getElementById('statPendingRotations').textContent = pendingRotations;
            document.getElementById('statActiveAlerts').textContent = activeAlerts;

            if (appData.lastScan) {
                const scanDate = new Date(appData.lastScan);
                document.getElementById('statLastScan').textContent = formatRelativeTime(scanDate);
            }

            // Update badges
            const rotationBadge = document.getElementById('rotationBadge');
            if (pendingRotations > 0) {
                rotationBadge.textContent = pendingRotations;
                rotationBadge.style.display = 'inline';
            } else {
                rotationBadge.style.display = 'none';
            }

            const alertBadge = document.getElementById('alertBadge');
            if (activeAlerts > 0) {
                alertBadge.textContent = activeAlerts;
                alertBadge.style.display = 'inline';
            } else {
                alertBadge.style.display = 'none';
            }

            // Update security status
            document.getElementById('statusCompromised').textContent = appData.secrets.filter(s => s.status === 'compromised').length;
            document.getElementById('statusPending').textContent = appData.secrets.filter(s => s.status === 'pending_rotation').length;
            document.getElementById('statusActive').textContent = appData.secrets.filter(s => s.status === 'active').length;
            document.getElementById('statusRotated').textContent = appData.secrets.filter(s => s.status === 'rotated').length;
        }

        // Secret Management
        function openAddSecretModal() {
            document.getElementById('secretName').value = '';
            document.getElementById('secretValue').value = '';
            document.getElementById('secretType').value = '';
            document.getElementById('secretService').value = '';
            document.getElementById('secretEnv').value = 'production';
            document.getElementById('secretStatus').value = 'active';
            openModal('addSecretModal');
        }

        async function addSecret() {
            const name = document.getElementById('secretName').value.trim();
            const value = document.getElementById('secretValue').value;
            const type = document.getElementById('secretType').value;
            const service = document.getElementById('secretService').value.trim();
            const environment = document.getElementById('secretEnv').value;
            const status = document.getElementById('secretStatus').value;

            if (!name || !value || !type) {
                showToast('Please fill in all required fields', 'error');
                return;
            }

            const hash = await hashSecret(value);
            const preview = maskSecret(value);

            const secret = {
                id: generateId(),
                name,
                type,
                hash,
                preview,
                service,
                environment,
                status,
                created: new Date().toISOString(),
                lastRotated: null
            };

            appData.secrets.push(secret);
            saveData();

            closeModal('addSecretModal');
            renderInventory();
            updateStats();
            renderActivityFeed();
            addAuditEntry(`Added secret: ${name}`);
            showToast('Secret added to inventory', 'success');

            // Clear the value from memory
            document.getElementById('secretValue').value = '';
        }

        function renderInventory() {
            const searchTerm = document.getElementById('inventorySearch')?.value.toLowerCase() || '';
            const typeFilter = document.getElementById('inventoryFilter')?.value || '';
            const statusFilter = document.getElementById('statusFilter')?.value || '';

            let filtered = appData.secrets.filter(secret => {
                const matchesSearch = !searchTerm ||
                    secret.name.toLowerCase().includes(searchTerm) ||
                    secret.service?.toLowerCase().includes(searchTerm);
                const matchesType = !typeFilter || secret.type === typeFilter;
                const matchesStatus = !statusFilter || secret.status === statusFilter;
                return matchesSearch && matchesType && matchesStatus;
            });

            const tbody = document.getElementById('inventoryTable');

            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8">
                            <div class="empty-state">
                                <div class="empty-state-icon">&#128274;</div>
                                <div class="empty-state-text">No secrets found</div>
                                <div class="empty-state-subtext">${appData.secrets.length === 0 ? 'Add secrets to track and manage rotation' : 'Try adjusting your filters'}</div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = filtered.map(secret => `
                <tr>
                    <td><strong>${escapeHtml(secret.name)}</strong></td>
                    <td><span class="badge badge-info">${getTypeName(secret.type)}</span></td>
                    <td><code class="secret-masked">${secret.preview}</code></td>
                    <td>${escapeHtml(secret.service) || '-'}</td>
                    <td><span class="badge badge-secondary">${capitalize(secret.environment)}</span></td>
                    <td><span class="badge ${getStatusBadgeClass(secret.status)}">${formatStatus(secret.status)}</span></td>
                    <td>${secret.lastRotated ? formatDate(secret.lastRotated) : 'Never'}</td>
                    <td>
                        <div style="display: flex; gap: 0.25rem;">
                            <button class="btn btn-secondary btn-sm" onclick="startRotation('${secret.id}')" title="Start Rotation">&#128260;</button>
                            <button class="btn btn-secondary btn-sm" onclick="updateSecretStatus('${secret.id}')" title="Update Status">&#9998;</button>
                            <button class="btn btn-danger btn-sm" onclick="confirmDeleteSecret('${secret.id}')" title="Delete">&#128465;</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function filterInventory() {
            renderInventory();
        }

        function updateSecretStatus(id) {
            const secret = appData.secrets.find(s => s.id === id);
            if (!secret) return;

            const statuses = ['active', 'pending_rotation', 'rotated', 'compromised'];
            const currentIndex = statuses.indexOf(secret.status);
            const nextIndex = (currentIndex + 1) % statuses.length;
            secret.status = statuses[nextIndex];

            if (secret.status === 'compromised') {
                createAlert('critical', `Secret "${secret.name}" marked as compromised`, `A ${getTypeName(secret.type)} has been marked as compromised. Immediate rotation required.`);
            }

            saveData();
            renderInventory();
            updateStats();
            renderRotations();
            renderActivityFeed();
            addAuditEntry(`Updated status of "${secret.name}" to ${formatStatus(secret.status)}`);
            showToast(`Status updated to ${formatStatus(secret.status)}`, 'success');
        }

        function confirmDeleteSecret(id) {
            const secret = appData.secrets.find(s => s.id === id);
            if (!secret) return;

            showConfirm(
                'Delete Secret',
                `<p class="confirm-text">Are you sure you want to delete "${escapeHtml(secret.name)}"?</p><div class="confirm-warning">This will remove the secret from your inventory. Make sure the actual credential has been rotated first.</div>`,
                () => {
                    appData.secrets = appData.secrets.filter(s => s.id !== id);
                    delete appData.rotations[id];
                    saveData();
                    renderInventory();
                    updateStats();
                    renderRotations();
                    renderActivityFeed();
                    addAuditEntry(`Deleted secret: ${secret.name}`);
                    showToast('Secret deleted', 'success');
                }
            );
        }

        // Scanner
        function runScan() {
            const input = document.getElementById('scanInput').value;
            if (!input.trim()) {
                showToast('Please enter text to scan', 'error');
                return;
            }

            const results = [];

            for (const [type, config] of Object.entries(SECRET_PATTERNS)) {
                const pattern = new RegExp(config.pattern.source, config.pattern.flags);
                let match;
                while ((match = pattern.exec(input)) !== null) {
                    const matchedText = match[1] || match[0];
                    const entropy = calculateEntropy(matchedText);

                    // Skip low entropy matches for patterns that require it
                    if (config.minEntropy && entropy < config.minEntropy) continue;

                    results.push({
                        type,
                        name: config.name,
                        match: matchedText,
                        severity: config.severity,
                        entropy: entropy.toFixed(2),
                        position: match.index
                    });
                }
            }

            // Check for high entropy strings
            const words = input.match(/[A-Za-z0-9_\-/+=]{20,}/g) || [];
            for (const word of words) {
                const entropy = calculateEntropy(word);
                if (entropy > 4.5 && !results.some(r => r.match === word)) {
                    results.push({
                        type: 'high_entropy',
                        name: 'High Entropy String',
                        match: word,
                        severity: 'low',
                        entropy: entropy.toFixed(2)
                    });
                }
            }

            appData.lastScan = new Date().toISOString();
            saveData();
            updateStats();

            displayScanResults(results);
            addAuditEntry(`Ran secret scan (found ${results.length} potential secrets)`);
        }

        async function displayScanResults(results) {
            const container = document.getElementById('scanResults');
            const list = document.getElementById('scanResultsList');

            if (results.length === 0) {
                container.style.display = 'block';
                list.innerHTML = `
                    <div class="empty-state" style="padding: 1.5rem;">
                        <div class="empty-state-icon" style="color: var(--success);">&#10004;</div>
                        <div class="empty-state-text">No secrets detected</div>
                        <div class="empty-state-subtext">The scanned text appears to be clean</div>
                    </div>
                `;
                showToast('Scan complete - no secrets found', 'success');
                return;
            }

            // Check against inventory
            for (const result of results) {
                const hash = await hashSecret(result.match);
                const inInventory = appData.secrets.find(s => s.hash === hash);
                result.inInventory = !!inInventory;
                result.inventorySecret = inInventory;

                if (inInventory && inInventory.environment === 'production') {
                    result.severity = 'critical';
                }
            }

            // Sort by severity
            const severityOrder = { critical: 0, high: 1, medium: 2, low: 3 };
            results.sort((a, b) => severityOrder[a.severity] - severityOrder[b.severity]);

            container.style.display = 'block';
            list.innerHTML = results.map(result => `
                <div class="scan-result ${result.severity}">
                    <div class="scan-result-header">
                        <div>
                            <span class="scan-result-type">${result.name}</span>
                            ${result.inInventory ? '<span class="badge badge-warning" style="margin-left: 0.5rem;">In Inventory</span>' : ''}
                        </div>
                        <span class="badge severity-${result.severity}">${result.severity.toUpperCase()}</span>
                    </div>
                    <div class="scan-result-match">${maskSecret(result.match)}</div>
                    <div style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-muted);">
                        Entropy: ${result.entropy} bits
                        ${result.inInventory ? ` | Inventory: ${result.inventorySecret.name} (${formatStatus(result.inventorySecret.status)})` : ''}
                    </div>
                    ${!result.inInventory ? `
                        <button class="btn btn-sm btn-secondary" style="margin-top: 0.5rem;" onclick="addFoundSecretToInventory('${escapeHtml(result.match)}', '${result.type}')">
                            Add to Inventory
                        </button>
                    ` : ''}
                </div>
            `).join('');

            // Create alerts for critical findings
            const criticalFindings = results.filter(r => r.severity === 'critical' && r.inInventory);
            for (const finding of criticalFindings) {
                createAlert('critical', `Exposed credential detected: ${finding.inventorySecret.name}`,
                    `A ${finding.name} from your inventory was found in the scanned text. Immediate rotation required.`);
            }

            showToast(`Found ${results.length} potential secrets`, 'warning');
        }

        function addFoundSecretToInventory(match, type) {
            document.getElementById('secretValue').value = match;
            document.getElementById('secretType').value = type !== 'high_entropy' ? type : 'other';
            openAddSecretModal();
        }

        function clearScan() {
            document.getElementById('scanInput').value = '';
            document.getElementById('scanResults').style.display = 'none';
        }

        // Rotation Workflow
        function startRotation(secretId) {
            const secret = appData.secrets.find(s => s.id === secretId);
            if (!secret) return;

            currentRotationId = secretId;
            const procedures = ROTATION_PROCEDURES[secret.type] || ROTATION_PROCEDURES.other;

            // Initialize rotation state if not exists
            if (!appData.rotations[secretId]) {
                appData.rotations[secretId] = {
                    startedAt: new Date().toISOString(),
                    steps: procedures.map((step, index) => ({
                        index,
                        text: step,
                        completed: false,
                        completedAt: null
                    }))
                };
                saveData();
            }

            renderRotationWorkflow(secret);
            openModal('rotationModal');
            addAuditEntry(`Started rotation workflow for: ${secret.name}`);
        }

        function renderRotationWorkflow(secret) {
            const rotation = appData.rotations[secret.id];
            const content = document.getElementById('rotationWorkflowContent');

            const allCompleted = rotation.steps.every(s => s.completed);
            document.getElementById('completeRotationBtn').disabled = !allCompleted;

            content.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h4 style="margin-bottom: 0.5rem;">${escapeHtml(secret.name)}</h4>
                    <p style="color: var(--text-secondary); font-size: 0.875rem;">
                        Type: ${getTypeName(secret.type)} | Environment: ${capitalize(secret.environment)}
                    </p>
                </div>
                <div style="margin-bottom: 1rem;">
                    <button class="btn btn-sm btn-secondary" onclick="generateSecureCredential()">
                        &#128273; Generate New Credential
                    </button>
                </div>
                <ul class="rotation-checklist">
                    ${rotation.steps.map((step, index) => `
                        <li class="rotation-step ${step.completed ? 'completed' : ''}">
                            <input type="checkbox" ${step.completed ? 'checked' : ''}
                                onchange="toggleRotationStep('${secret.id}', ${index})">
                            <span class="rotation-step-text">${step.text}</span>
                        </li>
                    `).join('')}
                </ul>
            `;
        }

        function toggleRotationStep(secretId, stepIndex) {
            const rotation = appData.rotations[secretId];
            if (!rotation) return;

            rotation.steps[stepIndex].completed = !rotation.steps[stepIndex].completed;
            rotation.steps[stepIndex].completedAt = rotation.steps[stepIndex].completed
                ? new Date().toISOString()
                : null;

            saveData();

            const secret = appData.secrets.find(s => s.id === secretId);
            if (secret) {
                renderRotationWorkflow(secret);
            }
        }

        function completeRotation() {
            if (!currentRotationId) return;

            const secret = appData.secrets.find(s => s.id === currentRotationId);
            if (!secret) return;

            secret.status = 'rotated';
            secret.lastRotated = new Date().toISOString();
            delete appData.rotations[currentRotationId];

            saveData();
            closeModal('rotationModal');
            renderInventory();
            renderRotations();
            updateStats();
            renderActivityFeed();
            addAuditEntry(`Completed rotation for: ${secret.name}`);
            showToast('Rotation completed successfully', 'success');
            currentRotationId = null;
        }

        function renderRotations() {
            const container = document.getElementById('rotationsList');
            const pendingSecrets = appData.secrets.filter(s =>
                s.status === 'pending_rotation' || s.status === 'compromised' || appData.rotations[s.id]
            );

            if (pendingSecrets.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">&#128260;</div>
                        <div class="empty-state-text">No active rotations</div>
                        <div class="empty-state-subtext">Mark secrets as pending rotation to start a workflow</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = pendingSecrets.map(secret => {
                const rotation = appData.rotations[secret.id];
                const progress = rotation
                    ? Math.round((rotation.steps.filter(s => s.completed).length / rotation.steps.length) * 100)
                    : 0;

                return `
                    <div class="card" style="margin-bottom: 0.75rem;">
                        <div class="card-body">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <h4 style="margin-bottom: 0.25rem;">${escapeHtml(secret.name)}</h4>
                                    <p style="font-size: 0.8125rem; color: var(--text-muted);">
                                        ${getTypeName(secret.type)} | ${capitalize(secret.environment)}
                                    </p>
                                </div>
                                <span class="badge ${getStatusBadgeClass(secret.status)}">${formatStatus(secret.status)}</span>
                            </div>
                            ${rotation ? `
                                <div style="margin-top: 0.75rem;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem; font-size: 0.75rem;">
                                        <span>Progress</span>
                                        <span>${progress}%</span>
                                    </div>
                                    <div style="background: var(--bg-tertiary); border-radius: 4px; height: 6px;">
                                        <div style="background: var(--primary); border-radius: 4px; height: 100%; width: ${progress}%;"></div>
                                    </div>
                                </div>
                            ` : ''}
                            <div style="margin-top: 0.75rem;">
                                <button class="btn btn-primary btn-sm" onclick="startRotation('${secret.id}')">
                                    ${rotation ? 'Continue Rotation' : 'Start Rotation'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Alerts
        function createAlert(severity, title, message) {
            const alert = {
                id: generateId(),
                severity,
                title,
                message,
                timestamp: new Date().toISOString(),
                acknowledged: false
            };

            appData.alerts.unshift(alert);
            saveData();
            renderAlerts();
            updateStats();
            sendWebhookAlert(alert);
        }

        function renderAlerts() {
            const filterValue = document.getElementById('alertFilter')?.value || '';
            let filtered = appData.alerts;

            if (filterValue) {
                filtered = filtered.filter(a => a.severity === filterValue);
            }

            const container = document.getElementById('alertsList');

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">&#128276;</div>
                        <div class="empty-state-text">No alerts</div>
                        <div class="empty-state-subtext">Alerts will appear when exposures are detected</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(alert => `
                <div class="alert-item ${alert.severity} ${alert.acknowledged ? 'acknowledged' : ''}">
                    <div class="alert-content">
                        <div class="alert-title">
                            <span class="badge severity-${alert.severity}" style="margin-right: 0.5rem;">${alert.severity.toUpperCase()}</span>
                            ${escapeHtml(alert.title)}
                        </div>
                        <div class="alert-message">${escapeHtml(alert.message)}</div>
                        <div class="alert-meta">${formatDate(alert.timestamp)}</div>
                    </div>
                    <div style="display: flex; gap: 0.25rem;">
                        ${!alert.acknowledged ? `
                            <button class="btn btn-secondary btn-sm" onclick="acknowledgeAlert('${alert.id}')" title="Acknowledge">&#10004;</button>
                        ` : ''}
                        <button class="btn btn-secondary btn-sm" onclick="dismissAlert('${alert.id}')" title="Dismiss">&#10006;</button>
                    </div>
                </div>
            `).join('');
        }

        function filterAlerts() {
            renderAlerts();
        }

        function acknowledgeAlert(id) {
            const alert = appData.alerts.find(a => a.id === id);
            if (alert) {
                alert.acknowledged = true;
                saveData();
                renderAlerts();
                updateStats();
                addAuditEntry(`Acknowledged alert: ${alert.title}`);
            }
        }

        function dismissAlert(id) {
            appData.alerts = appData.alerts.filter(a => a.id !== id);
            saveData();
            renderAlerts();
            updateStats();
        }

        // Webhook
        function loadWebhookSettings() {
            document.getElementById('webhookUrl').value = appData.webhookConfig?.url || '';
            document.getElementById('webhookHeaders').value = appData.webhookConfig?.headers
                ? JSON.stringify(appData.webhookConfig.headers, null, 2)
                : '';
        }

        function saveWebhookSettings() {
            const url = document.getElementById('webhookUrl').value.trim();
            let headers = {};

            try {
                const headersText = document.getElementById('webhookHeaders').value.trim();
                if (headersText) {
                    headers = JSON.parse(headersText);
                }
            } catch (e) {
                showToast('Invalid JSON in headers field', 'error');
                return;
            }

            appData.webhookConfig = { url, headers };
            saveData();
            addAuditEntry('Updated webhook configuration');
            showToast('Webhook settings saved', 'success');
        }

        async function testWebhook() {
            const url = appData.webhookConfig?.url;
            if (!url) {
                showToast('Please configure a webhook URL first', 'error');
                return;
            }

            try {
                const testPayload = {
                    type: 'test',
                    message: 'Test webhook from Secret Rotation Service',
                    timestamp: new Date().toISOString()
                };

                await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...appData.webhookConfig.headers
                    },
                    body: JSON.stringify(testPayload)
                });

                showToast('Webhook test sent', 'success');
            } catch (e) {
                showToast('Webhook test failed: ' + e.message, 'error');
            }
        }

        async function sendWebhookAlert(alert) {
            const url = appData.webhookConfig?.url;
            if (!url) return;

            try {
                await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...appData.webhookConfig.headers
                    },
                    body: JSON.stringify({
                        type: 'alert',
                        severity: alert.severity,
                        title: alert.title,
                        message: alert.message,
                        timestamp: alert.timestamp
                    })
                });
            } catch (e) {
                console.error('Failed to send webhook:', e);
            }
        }

        // Audit Log
        function addAuditEntry(action) {
            appData.auditLog.unshift({
                timestamp: new Date().toISOString(),
                action
            });

            // Keep only last 100 entries
            if (appData.auditLog.length > 100) {
                appData.auditLog = appData.auditLog.slice(0, 100);
            }

            saveData();
            renderAuditLog();
        }

        function renderAuditLog() {
            const container = document.getElementById('auditLog');

            if (appData.auditLog.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">&#128221;</div>
                        <div class="empty-state-text">No audit entries</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = appData.auditLog.slice(0, 50).map(entry => `
                <div class="audit-entry">
                    <span class="audit-time">${formatDate(entry.timestamp)}</span>
                    <span class="audit-action">${escapeHtml(entry.action)}</span>
                </div>
            `).join('');
        }

        // Activity Feed
        function renderActivityFeed() {
            const container = document.getElementById('activityFeed');

            // Combine recent activities
            const activities = [];

            // Recent secrets
            appData.secrets.slice(0, 5).forEach(secret => {
                activities.push({
                    type: 'secret',
                    icon: '&#128274;',
                    iconClass: 'scan',
                    text: `Added "${secret.name}" to inventory`,
                    time: secret.created
                });
            });

            // Recent rotations
            appData.secrets.filter(s => s.lastRotated).slice(0, 5).forEach(secret => {
                activities.push({
                    type: 'rotation',
                    icon: '&#128260;',
                    iconClass: 'rotation',
                    text: `Rotated "${secret.name}"`,
                    time: secret.lastRotated
                });
            });

            // Recent alerts
            appData.alerts.slice(0, 5).forEach(alert => {
                activities.push({
                    type: 'alert',
                    icon: '&#9888;',
                    iconClass: 'alert',
                    text: alert.title,
                    time: alert.timestamp
                });
            });

            // Sort by time
            activities.sort((a, b) => new Date(b.time) - new Date(a.time));

            if (activities.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">&#128202;</div>
                        <div class="empty-state-text">No recent activity</div>
                        <div class="empty-state-subtext">Start by adding secrets to your inventory or running a scan</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = activities.slice(0, 10).map(activity => `
                <div class="activity-item">
                    <div class="activity-icon ${activity.iconClass}">${activity.icon}</div>
                    <div class="activity-content">
                        <div class="activity-text">${escapeHtml(activity.text)}</div>
                        <div class="activity-time">${formatRelativeTime(new Date(activity.time))}</div>
                    </div>
                </div>
            `).join('');
        }

        // Credential Generator
        function generateSecureCredential() {
            openModal('credentialModal');
            generateCredential();
        }

        function generateCredential() {
            const type = document.getElementById('credentialType').value;
            let length, charset;

            switch (type) {
                case 'password':
                    length = 32;
                    charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:,.<>?';
                    break;
                case 'api_key':
                    length = 40;
                    charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                    break;
                case 'secret_key':
                    length = 64;
                    charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
                    break;
                case 'token':
                    length = 48;
                    charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-';
                    break;
            }

            const array = new Uint32Array(length);
            crypto.getRandomValues(array);
            let result = '';
            for (let i = 0; i < length; i++) {
                result += charset[array[i] % charset.length];
            }

            document.getElementById('generatedValue').textContent = result;

            // Calculate entropy
            const entropy = Math.log2(Math.pow(charset.length, length));
            document.getElementById('credentialEntropy').textContent = Math.round(entropy);
        }

        function copyGeneratedCredential() {
            const value = document.getElementById('generatedValue').textContent;
            navigator.clipboard.writeText(value).then(() => {
                showToast('Credential copied to clipboard', 'success');
            }).catch(() => {
                showToast('Failed to copy to clipboard', 'error');
            });
        }

        // Modal Helpers
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showConfirm(title, body, onConfirm) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmBody').innerHTML = body;
            document.getElementById('confirmBtn').onclick = () => {
                closeModal('confirmModal');
                onConfirm();
            };
            openModal('confirmModal');
        }

        // Toast Notifications
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${type === 'success' ? '&#10004;' : type === 'error' ? '&#10006;' : '&#9888;'}</span>
                <span>${escapeHtml(message)}</span>
            `;
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Utility Functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function capitalize(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function getTypeName(type) {
            const names = {
                aws_access_key: 'AWS Access Key',
                aws_secret_key: 'AWS Secret Key',
                github_token: 'GitHub Token',
                github_classic: 'GitHub Classic',
                database_url: 'Database URL',
                api_key: 'API Key',
                private_key: 'Private Key',
                jwt_token: 'JWT Token',
                slack_webhook: 'Slack Webhook',
                stripe_key: 'Stripe Key',
                sendgrid_key: 'SendGrid Key',
                twilio_key: 'Twilio Key',
                bearer_token: 'Bearer Token',
                other: 'Other'
            };
            return names[type] || type;
        }

        function getStatusBadgeClass(status) {
            const classes = {
                active: 'badge-success',
                pending_rotation: 'badge-warning',
                rotated: 'badge-info',
                compromised: 'badge-danger'
            };
            return classes[status] || 'badge-secondary';
        }

        function formatStatus(status) {
            const names = {
                active: 'Active',
                pending_rotation: 'Pending Rotation',
                rotated: 'Rotated',
                compromised: 'Compromised'
            };
            return names[status] || status;
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function formatRelativeTime(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            if (days < 7) return `${days}d ago`;
            return date.toLocaleDateString();
        }

        // Close modals on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });

        // Close modals on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });

        // Initialize on load
        init();
    </script>
</body>
</html>

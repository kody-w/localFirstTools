<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ego Death Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: #000;
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .data-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            opacity: 0.3;
            transition: opacity 0.3s;
        }

        .data-controls:hover {
            opacity: 1;
        }

        .data-controls button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #888;
            padding: 6px 12px;
            margin-left: 8px;
            cursor: pointer;
            font-size: 12px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .data-controls button:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .intro-screen, .stage-screen, .void-screen, .return-screen {
            text-align: center;
            animation: fadeIn 2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        @keyframes dissolve {
            0% { opacity: 1; filter: blur(0); }
            100% { opacity: 0; filter: blur(10px); }
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 30px;
            letter-spacing: 4px;
            color: #fff;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #888;
            margin-bottom: 50px;
            line-height: 1.8;
            font-style: italic;
        }

        .warning {
            background: rgba(139, 69, 69, 0.2);
            border: 1px solid rgba(139, 69, 69, 0.4);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 40px;
            font-size: 0.9rem;
            color: #c9a0a0;
        }

        .btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 15px 40px;
            font-size: 1rem;
            cursor: pointer;
            letter-spacing: 2px;
            transition: all 0.5s ease;
            font-family: inherit;
            margin: 10px;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.02);
        }

        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .btn-dissolve {
            border-color: rgba(100, 100, 150, 0.5);
        }

        .btn-dissolve:hover {
            border-color: rgba(100, 100, 150, 0.8);
            box-shadow: 0 0 30px rgba(100, 100, 150, 0.3);
        }

        .stage-indicator {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 50px;
        }

        .stage-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.5s;
        }

        .stage-dot.active {
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .stage-dot.completed {
            background: rgba(100, 100, 150, 0.6);
        }

        .stage-title {
            font-size: 1.8rem;
            font-weight: 300;
            margin-bottom: 20px;
            color: #fff;
            letter-spacing: 3px;
        }

        .stage-description {
            font-size: 1rem;
            color: #999;
            margin-bottom: 40px;
            line-height: 1.8;
        }

        .prompt-container {
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .prompt {
            font-size: 1.4rem;
            line-height: 2;
            color: #d0d0d0;
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeIn 3s ease-out forwards;
        }

        .prompt.question {
            color: #a0a0c0;
            font-style: italic;
        }

        .reflection-input {
            width: 100%;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            padding: 15px 20px;
            font-size: 1rem;
            font-family: inherit;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s;
        }

        .reflection-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.08);
        }

        .reflection-input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .dissolving-text {
            animation: dissolve 3s ease-out forwards;
        }

        .breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 50px auto;
            animation: breathe 6s ease-in-out infinite;
        }

        .void-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .void-text {
            font-size: 1.2rem;
            color: #666;
            opacity: 0;
            animation: fadeIn 5s ease-out 2s forwards;
        }

        .timer {
            font-size: 0.9rem;
            color: #555;
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            max-width: 300px;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            margin: 20px auto;
            border-radius: 1px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: rgba(255, 255, 255, 0.4);
            transition: width 0.5s ease;
        }

        .hidden {
            display: none !important;
        }

        .journal-entry {
            background: rgba(255, 255, 255, 0.03);
            border-left: 2px solid rgba(100, 100, 150, 0.3);
            padding: 15px 20px;
            margin: 10px 0;
            text-align: left;
            font-size: 0.95rem;
            color: #888;
        }

        .journal-entry .stage-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .background-effect {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: -1;
            transition: all 2s ease;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #fff;
            border-radius: 50%;
            opacity: 0.3;
            animation: pulse 3s ease-in-out infinite;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .stage-title {
                font-size: 1.4rem;
            }

            .prompt {
                font-size: 1.1rem;
            }

            .container {
                padding: 20px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="data-controls">
        <button onclick="exportData()">Export</button>
        <button onclick="document.getElementById('importFile').click()">Import</button>
        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
    </div>

    <div class="background-effect">
        <div class="stars" id="stars"></div>
    </div>

    <div class="container">
        <!-- Intro Screen -->
        <div id="intro-screen" class="intro-screen">
            <h1>EGO DEATH SIMULATOR</h1>
            <p class="subtitle">
                A guided dissolution of self through five layers of identity.<br>
                What remains when "you" are gone?
            </p>

            <div class="warning">
                This is a contemplative experience designed to temporarily dissolve your sense of self
                through philosophical inquiry. It replicates aspects of deep meditation and expanded states
                of consciousness through language alone. Proceed with openness and curiosity.
            </div>

            <button class="btn" onclick="beginJourney()">BEGIN DISSOLUTION</button>

            <div style="margin-top: 40px;">
                <button class="btn" style="font-size: 0.9rem; padding: 10px 20px;" onclick="viewJournal()">
                    VIEW PAST JOURNEYS
                </button>
            </div>
        </div>

        <!-- Stage Screen -->
        <div id="stage-screen" class="stage-screen hidden">
            <div class="stage-indicator" id="stage-indicator"></div>

            <h2 class="stage-title" id="stage-title"></h2>
            <p class="stage-description" id="stage-description"></p>

            <div class="prompt-container" id="prompt-container"></div>

            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>

        <!-- Void Screen -->
        <div id="void-screen" class="void-screen hidden">
            <div class="void-container">
                <div class="breathing-circle"></div>
                <p class="void-text" id="void-text"></p>
                <p class="timer" id="void-timer"></p>
            </div>
        </div>

        <!-- Return Screen -->
        <div id="return-screen" class="return-screen hidden">
            <h1>RETURN</h1>
            <p class="subtitle" id="return-message"></p>

            <div id="journey-summary"></div>

            <div style="margin-top: 50px;">
                <button class="btn" onclick="location.reload()">JOURNEY AGAIN</button>
                <button class="btn" onclick="viewJournal()">VIEW JOURNAL</button>
            </div>
        </div>

        <!-- Journal Screen -->
        <div id="journal-screen" class="hidden">
            <h1>JOURNEY JOURNAL</h1>
            <p class="subtitle">Records of dissolution</p>

            <div id="journal-entries"></div>

            <div style="margin-top: 40px;">
                <button class="btn" onclick="showIntro()">RETURN</button>
                <button class="btn" onclick="clearJournal()" style="border-color: rgba(139, 69, 69, 0.5);">CLEAR JOURNAL</button>
            </div>
        </div>
    </div>

    <script>
        const APP_NAME = 'ego-death-simulator';

        let appData = JSON.parse(localStorage.getItem(APP_NAME) || '{"journeys": [], "totalDissolutions": 0}');

        let currentStage = 0;
        let currentPromptIndex = 0;
        let currentJourney = {
            startTime: null,
            responses: [],
            completed: false
        };

        const stages = [
            {
                title: "IDENTITY",
                description: "The labels you wear, the name you answer to, the roles you play.",
                prompts: [
                    { type: "text", content: "You have a name. Someone gave it to you before you could object." },
                    { type: "input", content: "What is this name?", placeholder: "Enter your name..." },
                    { type: "text", content: "But you existed before you knew this sound." },
                    { type: "question", content: "If everyone forgot your name tomorrow, would you still exist?" },
                    { type: "text", content: "You have roles: child, friend, worker, citizen..." },
                    { type: "question", content: "Strip them away. What remains?" },
                    { type: "dissolve", content: "Let the name dissolve. It was always just a sound." }
                ]
            },
            {
                title: "MEMORY",
                description: "The stories you tell yourself about who you've been.",
                prompts: [
                    { type: "text", content: "Your past is a story you tell in the present." },
                    { type: "text", content: "Each time you remember, you change the memory." },
                    { type: "question", content: "Which version of your past is true?" },
                    { type: "text", content: "The child you were is gone. The teenager. The person from yesterday." },
                    { type: "question", content: "Are you the same being that experienced those moments?" },
                    { type: "input", content: "What memory do you cling to most?", placeholder: "A memory..." },
                    { type: "text", content: "That moment exists only in neurons firing now." },
                    { type: "dissolve", content: "Release the story. It was always being rewritten." }
                ]
            },
            {
                title: "BODY",
                description: "The physical form you assume is you.",
                prompts: [
                    { type: "text", content: "Every cell in your body has been replaced multiple times." },
                    { type: "question", content: "Which body was the real you?" },
                    { type: "text", content: "Your body moves without your permission. Heart beating. Lungs breathing." },
                    { type: "text", content: "You don't make these happen. They happen to you." },
                    { type: "question", content: "Where does your body end and the world begin?" },
                    { type: "text", content: "Air enters you. Becomes you. Leaves you." },
                    { type: "question", content: "Are you the air? When did it stop being you?" },
                    { type: "dissolve", content: "The boundary was always imaginary. Let it fade." }
                ]
            },
            {
                title: "THOUGHTS",
                description: "The mind you believe is generating you.",
                prompts: [
                    { type: "text", content: "Thoughts appear. You don't choose them." },
                    { type: "text", content: "Try not to think of anything for the next moment." },
                    { type: "question", content: "Did thoughts arise anyway?" },
                    { type: "text", content: "If you can observe your thoughts, you cannot be your thoughts." },
                    { type: "question", content: "What is doing the observing?" },
                    { type: "text", content: "Even the sense of being an observer... is that not also a thought?" },
                    { type: "input", content: "What thought is present right now?", placeholder: "The thought..." },
                    { type: "dissolve", content: "Watch it dissolve before you finish grasping it." }
                ]
            },
            {
                title: "THE OBSERVER",
                description: "The final refuge. The one who watches.",
                prompts: [
                    { type: "text", content: "You've retreated here. The witness. The awareness behind experience." },
                    { type: "text", content: "But who is aware of being aware?" },
                    { type: "question", content: "Can you find the observer without creating another one to look?" },
                    { type: "text", content: "Every time you look for yourself, you find only... looking." },
                    { type: "text", content: "The searcher and the searched are the same." },
                    { type: "question", content: "If there is no fixed point called 'you', what is experiencing this moment?" },
                    { type: "text", content: "Perhaps there is only experiencing. No experiencer." },
                    { type: "text", content: "Just this. Here. Now. Without center." },
                    { type: "dissolve", content: "The final refuge dissolves. What remains?" }
                ]
            }
        ];

        const voidMessages = [
            "This is the space between thoughts.",
            "No name. No story. No body. No mind. No observer.",
            "Just... this.",
            "What notices this nothingness?",
            "Even the question dissolves.",
            "...",
            "Remain here."
        ];

        const returnMessages = [
            "You return, but something has shifted.",
            "The self reconstitutes, but you've glimpsed its construction.",
            "Welcome back to the dream of being someone.",
            "Names and stories await. But now you know their nature."
        ];

        function saveData() {
            localStorage.setItem(APP_NAME, JSON.stringify(appData));
        }

        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${APP_NAME}-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    appData = JSON.parse(e.target.result);
                    saveData();
                    location.reload();
                } catch (error) {
                    alert('Invalid JSON file');
                }
            };
            reader.readAsText(file);
        }

        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (2 + Math.random() * 2) + 's';
                starsContainer.appendChild(star);
            }
        }

        function hideAllScreens() {
            document.querySelectorAll('.intro-screen, .stage-screen, .void-screen, .return-screen, #journal-screen').forEach(el => {
                el.classList.add('hidden');
            });
        }

        function showIntro() {
            hideAllScreens();
            document.getElementById('intro-screen').classList.remove('hidden');
        }

        function beginJourney() {
            currentStage = 0;
            currentPromptIndex = 0;
            currentJourney = {
                startTime: new Date().toISOString(),
                responses: [],
                completed: false
            };

            hideAllScreens();
            document.getElementById('stage-screen').classList.remove('hidden');
            renderStageIndicator();
            showStage();
        }

        function renderStageIndicator() {
            const indicator = document.getElementById('stage-indicator');
            indicator.innerHTML = '';
            stages.forEach((_, i) => {
                const dot = document.createElement('div');
                dot.className = 'stage-dot';
                if (i < currentStage) dot.classList.add('completed');
                if (i === currentStage) dot.classList.add('active');
                indicator.appendChild(dot);
            });
        }

        function showStage() {
            const stage = stages[currentStage];
            document.getElementById('stage-title').textContent = stage.title;
            document.getElementById('stage-description').textContent = stage.description;

            currentPromptIndex = 0;
            showPrompt();
        }

        function showPrompt() {
            const stage = stages[currentStage];
            if (currentPromptIndex >= stage.prompts.length) {
                nextStage();
                return;
            }

            const prompt = stage.prompts[currentPromptIndex];
            const container = document.getElementById('prompt-container');
            container.innerHTML = '';

            const progress = ((currentPromptIndex + 1) / stage.prompts.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';

            if (prompt.type === 'text') {
                const p = document.createElement('p');
                p.className = 'prompt';
                p.textContent = prompt.content;
                container.appendChild(p);

                setTimeout(() => {
                    const btn = document.createElement('button');
                    btn.className = 'btn';
                    btn.textContent = 'CONTINUE';
                    btn.onclick = () => { currentPromptIndex++; showPrompt(); };
                    container.appendChild(btn);
                }, 2000);
            } else if (prompt.type === 'question') {
                const p = document.createElement('p');
                p.className = 'prompt question';
                p.textContent = prompt.content;
                container.appendChild(p);

                setTimeout(() => {
                    const btn = document.createElement('button');
                    btn.className = 'btn';
                    btn.textContent = 'SIT WITH THIS';
                    btn.onclick = () => { currentPromptIndex++; showPrompt(); };
                    container.appendChild(btn);
                }, 3000);
            } else if (prompt.type === 'input') {
                const p = document.createElement('p');
                p.className = 'prompt';
                p.textContent = prompt.content;
                container.appendChild(p);

                setTimeout(() => {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'reflection-input';
                    input.placeholder = prompt.placeholder || 'Type here...';
                    container.appendChild(input);

                    const btn = document.createElement('button');
                    btn.className = 'btn';
                    btn.textContent = 'RELEASE';
                    btn.onclick = () => {
                        if (input.value.trim()) {
                            currentJourney.responses.push({
                                stage: stages[currentStage].title,
                                prompt: prompt.content,
                                response: input.value.trim()
                            });
                        }
                        input.classList.add('dissolving-text');
                        setTimeout(() => {
                            currentPromptIndex++;
                            showPrompt();
                        }, 1500);
                    };
                    container.appendChild(btn);

                    input.focus();
                }, 1500);
            } else if (prompt.type === 'dissolve') {
                const p = document.createElement('p');
                p.className = 'prompt';
                p.textContent = prompt.content;
                container.appendChild(p);

                setTimeout(() => {
                    const btn = document.createElement('button');
                    btn.className = 'btn btn-dissolve';
                    btn.textContent = 'DISSOLVE';
                    btn.onclick = () => {
                        container.classList.add('dissolving-text');
                        setTimeout(() => {
                            container.classList.remove('dissolving-text');
                            currentPromptIndex++;
                            showPrompt();
                        }, 2000);
                    };
                    container.appendChild(btn);
                }, 2000);
            }
        }

        function nextStage() {
            currentStage++;
            if (currentStage >= stages.length) {
                enterVoid();
            } else {
                renderStageIndicator();
                showStage();
            }
        }

        function enterVoid() {
            hideAllScreens();
            document.getElementById('void-screen').classList.remove('hidden');

            const stars = document.querySelectorAll('.star');
            stars.forEach(star => star.style.opacity = '0');

            let voidIndex = 0;
            const voidText = document.getElementById('void-text');
            const voidTimer = document.getElementById('void-timer');

            const voidDuration = 60;
            let remaining = voidDuration;

            function showVoidMessage() {
                if (voidIndex < voidMessages.length) {
                    voidText.style.animation = 'none';
                    voidText.offsetHeight;
                    voidText.style.animation = 'fadeIn 3s ease-out forwards';
                    voidText.textContent = voidMessages[voidIndex];
                    voidIndex++;
                }
            }

            showVoidMessage();
            const messageInterval = setInterval(() => {
                showVoidMessage();
            }, 8000);

            const timerInterval = setInterval(() => {
                remaining--;
                voidTimer.textContent = remaining > 0 ? `${remaining}s` : '';

                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    clearInterval(messageInterval);
                    returnFromVoid();
                }
            }, 1000);
        }

        function returnFromVoid() {
            hideAllScreens();
            document.getElementById('return-screen').classList.remove('hidden');

            const stars = document.querySelectorAll('.star');
            stars.forEach(star => star.style.opacity = '0.3');

            currentJourney.completed = true;
            currentJourney.endTime = new Date().toISOString();
            appData.journeys.push(currentJourney);
            appData.totalDissolutions++;
            saveData();

            const returnMessage = returnMessages[Math.floor(Math.random() * returnMessages.length)];
            document.getElementById('return-message').textContent = returnMessage;

            const summary = document.getElementById('journey-summary');
            if (currentJourney.responses.length > 0) {
                let html = '<h3 style="margin-bottom: 20px; color: #888;">What you released:</h3>';
                currentJourney.responses.forEach(r => {
                    html += `<div class="journal-entry">
                        <div class="stage-label">${r.stage}</div>
                        "${r.response}"
                    </div>`;
                });
                summary.innerHTML = html;
            }
        }

        function viewJournal() {
            hideAllScreens();
            document.getElementById('journal-screen').classList.remove('hidden');

            const container = document.getElementById('journal-entries');

            if (appData.journeys.length === 0) {
                container.innerHTML = '<p style="color: #666; margin: 40px 0;">No journeys recorded yet.</p>';
                return;
            }

            let html = `<p style="color: #888; margin-bottom: 30px;">Total dissolutions: ${appData.totalDissolutions}</p>`;

            appData.journeys.slice().reverse().forEach((journey, i) => {
                const date = new Date(journey.startTime).toLocaleDateString();
                html += `<div style="margin-bottom: 40px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 30px;">
                    <h3 style="color: #aaa; margin-bottom: 15px;">Journey ${appData.journeys.length - i} - ${date}</h3>`;

                if (journey.responses && journey.responses.length > 0) {
                    journey.responses.forEach(r => {
                        html += `<div class="journal-entry">
                            <div class="stage-label">${r.stage}</div>
                            "${r.response}"
                        </div>`;
                    });
                } else {
                    html += '<p style="color: #555; font-style: italic;">Silent journey - no words captured</p>';
                }

                html += '</div>';
            });

            container.innerHTML = html;
        }

        function clearJournal() {
            if (confirm('Clear all journey records? This cannot be undone.')) {
                appData = { journeys: [], totalDissolutions: 0 };
                saveData();
                viewJournal();
            }
        }

        // Initialize
        createStars();
    </script>
</body>
</html>
